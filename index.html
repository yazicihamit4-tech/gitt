<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <title>TahminSon v25.5 (PERFORMANCE FIX)</title>
    <meta name="color-scheme" content="light only">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <!-- ANDROID PORTRAIT LOCK -->
    <meta name="screen-orientation" content="portrait">
    <link rel="manifest"
        href='data:application/manifest+json,{"display":"standalone","orientation":"portrait","theme_color":"#f0f2f5","background_color":"#f0f2f5","name":"TahminSon","short_name":"TahminSon"}'>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script>
    // --- T√úM MESAJLARI G√ñRME FONKSƒ∞YONLARI (YENƒ∞LENMƒ∞≈û - √áALI≈ûAN VERSƒ∞YON) ---
    function showAllPlayerMessages() {
        showModal('modal-all-messages');
        loadAllMessages('all');
    }

    function loadAllMessages(type) {
        const list = document.getElementById('allMessagesList');
        if (!list) return;

        list.innerHTML = "<div style='padding:20px; text-align:center;'>‚è≥ Mesajlar y√ºkleniyor...</div>";

        let allMessages = [];
        let loadedCount = 0;
        const totalSources = 2;

        function checkComplete() {
            loadedCount++;
            if (loadedCount >= totalSources) {
                displayMessages();
            }
        }

        function displayMessages() {
            // Tarihe g√∂re sƒ±rala (en yeni en √ºstte)
            allMessages.sort((a, b) => b.time - a.time);

            if (allMessages.length === 0) {
                list.innerHTML = "<div style='padding:20px; text-align:center; color:#999;'>üì≠ Hen√ºz mesaj bulunamadƒ±.</div>";
                return;
            }

            let html = '';
            allMessages.slice(0, 100).forEach(msg => {
                const date = new Date(msg.time).toLocaleString('tr-TR');
                const typeIcon = msg.type === 'game' ? 'üéÆ' : 'üè†';
                const typeColor = msg.type === 'game' ? '#3498db' : '#2ecc71';
                const roomInfo = msg.room ? `<small style='color:#666; font-size:0.7rem;'>(Oda: ${escapeHtml(msg.room)})</small>` : '';

                html += `
                    <div style='background:#f8f9fa; border-left:4px solid ${typeColor}; padding:12px; margin-bottom:8px; border-radius:8px; text-align:left;'>
                        <div style='display:flex; justify-content:space-between; align-items:flex-start;'>
                            <div style='flex:1;'>
                                <div style='font-weight:bold; color:#2d3436; font-size:0.9rem;'>
                                    ${typeIcon} ${escapeHtml(msg.user)}
                                </div>
                                ${roomInfo}
                                <div style='margin-top:5px; color:#333; word-break:break-word; font-size:0.85rem;'>
                                    ${escapeHtml(msg.text)}
                                </div>
                            </div>
                            <small style='color:#999; font-size:0.7rem; white-space:nowrap; margin-left:10px;'>${date}</small>
                        </div>
                    </div>
                `;
            });

            list.innerHTML = html;
        }

        // Oyun mesajlarƒ±nƒ± √ßek
        if (type === 'all' || type === 'game') {
            db.ref('rooms').once('value')
                .then(snap => {
                    snap.forEach(roomSnap => {
                        const room = roomSnap.val();
                        if (room && room.chat) {
                            Object.entries(room.chat).forEach(([key, msg]) => {
                                allMessages.push({
                                    type: 'game',
                                    user: msg.u || msg.user || 'Bilinmeyen',
                                    text: msg.m || msg.message || msg.text || '',
                                    time: msg.t || msg.time || Date.now(),
                                    room: roomSnap.key
                                });
                            });
                        }
                    });
                    checkComplete();
                })
                .catch(err => {
                    console.error("Oyun mesajlarƒ± hatasƒ±:", err);
                    checkComplete();
                });
        } else {
            checkComplete();
        }

        // Lobi mesajlarƒ±nƒ± √ßek
        if (type === 'all' || type === 'lobby') {
            db.ref('lobby_chat').limitToLast(100).once('value')
                .then(snap => {
                    snap.forEach(msgSnap => {
                        const msg = msgSnap.val();
                        allMessages.push({
                            type: 'lobby',
                            user: msg.u || msg.user || 'Bilinmeyen',
                            text: msg.m || msg.message || msg.text || '',
                            time: msg.t || msg.time || Date.now()
                        });
                    });
                    checkComplete();
                })
                .catch(err => {
                    console.error("Lobi mesajlarƒ± hatasƒ±:", err);
                    checkComplete();
                });
        } else {
            checkComplete();
        }
    }

    function escapeHtml(text) {
        if (!text) return '';
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }
</script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-messaging.js"></script>
    <style>
        :root {
            --bg: #f0f2f5;
            --card: #ffffff;
            /* Opak renk */
            --primary: #6c5ce7;
            --text: #333;
            --text-muted: #666;
            --gold: #f1c40f;
            --danger: #ff4757;
            --success: #2ed573;
            --nav-bg: #ffffff;
            --cyan: #00d2ff;
            --electric: #3a7bd5;
            --safe-top: max(env(safe-area-inset-top), 15px);
            --safe-bottom: max(env(safe-area-inset-bottom), 30px);
            --app-height: 100vh;
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        * {
            box-sizing: border-box;
            outline: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        html,
        body {
            width: 100%;
            height: 100%;
            height: var(--app-height);
            margin: 0;
            padding: 0;
            position: fixed;
            overflow: hidden;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            user-select: none;
            overscroll-behavior: none;
            padding-top: 0 !important;
            padding-bottom: var(--safe-bottom) !important;
            -webkit-font-smoothing: antialiased;
            /* GPU Render Fixleri */
            backface-visibility: hidden;
            perspective: 1000px;
        }

        /* YAZI RENK FIXLERƒ∞ */
        [style*="color:#eee"],
        [style*="color:#ccc"],
        [style*="color:#999"],
        [style*="color:#666"],
        .text-muted-fix {
            color: var(--text-muted) !important;
            text-shadow: none !important;
        }

        /* INPUT FIX */
        body input,
        body select,
        body textarea {
            background: #ffffff !important;
            color: #000000 !important;
            border: 2px solid rgba(0, 0, 0, 0.2) !important;
            text-shadow: none !important;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        body input:focus {
            border-color: var(--primary) !important;
            background: #fff !important;
        }

        /* KART STƒ∞Lƒ∞ (PERFORMANS OPTƒ∞Mƒ∞ZASYONU) */
        .card {
            background: #ffffff !important;
            /* backdrop-filter KALDIRILDI (Beyaz ekran sebebi) */
            border: 1px solid rgba(200, 200, 200, 0.5);
            box-shadow: var(--card-shadow);
            color: var(--text);
            border-radius: 20px;
            padding: 15px;
            margin: 10px;
            transition: 0.3s;
            /* GPU Zorlama */
            transform: translate3d(0, 0, 0);
            backface-visibility: hidden;
        }

        .card h1,
        .card h2,
        .card h3,
        .card h4,
        .card h5 {
            color: var(--text) !important;
        }

        /* --- YENƒ∞ NESƒ∞L TEMA MOTORU (ULTIMATE COLORS) --- */

        /* Ortak Animasyon: Arkaplanƒ±n yava≈ü√ßa hareket etmesini saƒülar */
        @keyframes bgPan {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        /* 1. TAKIM TEMALARI (Daha Canlƒ± ve Agresif) */
        body.theme-tr {
            --bg: #E30A17;
            --primary: #fff;
            --text: #fff;
            --text-muted: #ddd;
            --card: rgba(255, 255, 255, 0.15);
            /* Glassmorphism */
            background: linear-gradient(135deg, #E30A17 0%, #880000 100%);
        }

        body.theme-gs {
            --bg: #a90432;
            --primary: #fdb912;
            --text: #fff;
            --text-muted: #ddd;
            --card: rgba(0, 0, 0, 0.4);
            background: linear-gradient(45deg, #a90432 25%, #fdb912 25%, #fdb912 50%, #a90432 50%, #a90432 75%, #fdb912 75%, #fdb912 100%);
            background-size: 40px 40px;
            /* √áizgili Forma Deseni */
        }

        body.theme-fb {
            --bg: #002d72;
            --primary: #ffed00;
            --text: #fff;
            --text-muted: #ccc;
            --card: rgba(0, 45, 114, 0.6);
            border: 1px solid #ffed00;
            background: repeating-linear-gradient(45deg, #002d72, #002d72 20px, #001f4d 20px, #001f4d 40px);
        }

        body.theme-bjk {
            --bg: #111;
            --primary: #fff;
            --text: #fff;
            --text-muted: #bbb;
            --card: rgba(255, 255, 255, 0.1);
            background: radial-gradient(circle at center, #333 0%, #000 100%);
        }

        body.theme-ts {
            --bg: #800000;
            --primary: #3498db;
            --text: #fff;
            --text-muted: #ddd;
            --card: rgba(0, 0, 0, 0.3);
            background: linear-gradient(to bottom, #800000, #3498db);
        }

        body.theme-goz {
            --bg: #a30928;
            --primary: #ffcf00;
            --text: #fff;
            --text-muted: #eee;
            --card: rgba(0, 0, 0, 0.3);
            background: conic-gradient(from 0deg at 50% 50%, #a30928, #ffcf00, #a30928);
        }

        body.theme-ksk {
            --bg: #004d25;
            --primary: #e30a17;
            --text: #fff;
            --text-muted: #eee;
            --card: rgba(0, 0, 0, 0.4);
            background: linear-gradient(120deg, #004d25 50%, #e30a17 50%);
        }

        /* 2. ATMOSFERƒ∞K VE DOƒûA TEMALARI (Yumu≈üak ve Okunaklƒ±) */
        body.theme-dark {
            --bg: #121212;
            --primary: #bb86fc;
            --text: #e0e0e0;
            --text-muted: #a0a0a0;
            --card: #1e1e1e;
            background: #121212;
            /* Tam Siyah deƒüil, G√∂z yormayan koyu gri */
        }

        body.theme-forest {
            --bg: #2d3436;
            --primary: #55efc4;
            --text: #fff;
            --text-muted: #dfe6e9;
            --card: rgba(0, 0, 0, 0.5);
            background: linear-gradient(to bottom, #093028, #237A57);
            /* Mistik Orman */
        }

        body.theme-ocean {
            --bg: #006994;
            --primary: #7FDBFF;
            --text: #fff;
            --text-muted: #dff9fb;
            --card: rgba(255, 255, 255, 0.1);
            background: linear-gradient(180deg, #0093E9 0%, #80D0C7 100%);
            /* Turkuaz Sular */
        }

        body.theme-love {
            --bg: #ff758c;
            --primary: #fff;
            --text: #fff;
            --text-muted: #ffeaa7;
            --card: rgba(255, 255, 255, 0.25);
            background: linear-gradient(to top, #ff758c 0%, #ff7eb3 100%);
            /* Pembe A≈ük */
        }

        /* 3. √ñZEL EFEKTLƒ∞ ARKAPLANLAR (Hareketli ve Derin) */
        body.bg-space {
            --bg: #000;
            --primary: #00d2ff;
            --text: #fff;
            --text-muted: #888;
            --card: rgba(20, 24, 30, 0.9);
            background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%);
        }

        body.bg-matrix {
            --bg: #000;
            --primary: #0f0;
            --text: #0f0;
            --text-muted: #008000;
            --card: rgba(0, 20, 0, 0.9);
            border: 1px solid #0f0;
            background: linear-gradient(0deg, rgba(0, 0, 0, 0.9), rgba(0, 50, 0, 0.5)), url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext x='0' y='30' fill='%2300ff00' font-family='monospace' font-size='20'%3E10%3C/text%3E%3C/svg%3E");
        }

        body.bg-hex {
            --bg: #222;
            --primary: #f39c12;
            --text: #ecf0f1;
            --text-muted: #bdc3c7;
            --card: rgba(44, 62, 80, 0.95);
            background: radial-gradient(black 15%, transparent 16%) 0 0, radial-gradient(black 15%, transparent 16%) 8px 8px, radial-gradient(rgba(255, 255, 255, .1) 15%, transparent 20%) 0 1px, radial-gradient(rgba(255, 255, 255, .1) 15%, transparent 20%) 8px 9px;
            background-color: #282828;
            background-size: 16px 16px;
        }

        body.bg-sky {
            --bg: #87CEEB;
            --primary: #2980b9;
            --text: #2c3e50;
            --text-muted: #555;
            --card: rgba(255, 255, 255, 0.85);
            background: linear-gradient(to top, #dfe9f3 0%, white 100%);
            /* Bulutlu G√∂ky√ºz√º */
        }

        body.skin-gold {
            --bg: #f1c40f;
            --primary: #000;
            --text: #4e342e;
            --text-muted: #795548;
            --card: rgba(255, 255, 255, 0.9);
            background: radial-gradient(ellipse farthest-corner at right bottom, #FEDB37 0%, #FDB931 8%, #9f7928 30%, #8A6E2F 40%, transparent 80%), radial-gradient(ellipse farthest-corner at left top, #FFFFFF 0%, #FFFFAC 8%, #D1B464 25%, #5d4a1f 62.5%, #5d4a1f 100%);
        }

        body.bg-neon-city {
            --bg: #0f0c29;
            --primary: #ff00cc;
            --text: #fff;
            --text-muted: #aaa;
            --card: rgba(20, 20, 40, 0.85);
            background: linear-gradient(to right, #0f0c29, #302b63, #24243e);
            /* Cyberpunk */
            background-size: 200% 200%;
            animation: bgPan 10s ease infinite;
        }

        body.bg-mystic-purple {
            --bg: #4a00e0;
            --primary: #00d2ff;
            --text: #fff;
            --text-muted: #e0c3fc;
            --card: rgba(40, 0, 70, 0.6);
            background: linear-gradient(160deg, #8e2de2 0%, #4a00e0 100%);
            /* B√ºy√ºc√º Moru */
        }

        body.bg-volcano {
            --bg: #b00;
            --primary: #ffcc00;
            --text: #fff;
            --text-muted: #ffcccc;
            --card: rgba(50, 0, 0, 0.7);
            background: linear-gradient(to bottom, #232526, #414345);
            /* Lav K√ºl√º */
            border-bottom: 5px solid #ff4500;
        }

        body.bg-deep-sea {
            --bg: #001f3f;
            --primary: #7FDBFF;
            --text: #fff;
            --text-muted: #8ecae6;
            --card: rgba(0, 20, 40, 0.8);
            background: radial-gradient(circle at center, #023e8a, #001219);
        }

        /* Se√ßili Tema Kartlarƒ±nƒ±n Kenar Rengi Uyumu */
        body[class*="theme-"] .card,
        body[class*="bg-"] .card {
            backdrop-filter: blur(5px);
            /* Kartlarƒ±n arkasƒ±nƒ± hafif buzlu cam yap */
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            max-width: 500px;
            margin: 0 auto;
            position: relative;
            z-index: 2;
        }

        .screen {
            display: none;
            width: 100%;
            height: 100%;
            flex-direction: column;
            overflow-y: auto;
            padding-bottom: calc(80px + var(--safe-bottom));
            padding-top: calc(var(--safe-top) + 100px);
            box-sizing: border-box;
            -webkit-overflow-scrolling: touch
        }

        .screen.active {
            display: flex
        }

        button {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 15px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 8px;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            transition: transform 0.1s;
        }

        button:active {
            transform: scale(0.97);
        }

        .btn-green {
            background: linear-gradient(135deg, #2ecc71, #27ae60)
        }

        .btn-blue {
            background: linear-gradient(135deg, #3498db, #2980b9)
        }

        .btn-red {
            background: linear-gradient(135deg, #e74c3c, #c0392b)
        }

        .btn-gold {
            background: linear-gradient(135deg, #f1c40f, #f39c12);
            color: #000;
            text-shadow: none;
        }

        .btn-dark {
            background: linear-gradient(135deg, #34495e, #2c3e50)
        }

        .btn-purple {
            background: linear-gradient(135deg, #9b59b6, #8e44ad)
        }

        .btn-grey {
            background: #95a5a6;
            color: #2c3e50
        }

        .nav-btn {
            position: absolute;
            top: 5px;
            left: 15px;
            background: #ff4757;
            color: white;
            border: 2px solid white;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            box-shadow: 0 4px 15px rgba(255, 71, 87, 0.5)
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 14px;
            margin: 5px 0;
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            font-weight: bold;
            text-align: center;
            font-size: 1rem;
            background: #ffffff !important;
            color: #000000 !important;
            text-shadow: none !important;
        }

        /* CHAT UI - √úST MESAJ ALANI Gƒ∞ZLENDƒ∞ */
        #gameChatContainer {
            display: none !important;
            width: 100%;
            margin-top: 10px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 12px;
            padding: 10px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .game-chat-box {
            height: 180px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding-right: 5px;
        }

        .game-chat-msg {
            max-width: 80%;
            padding: 8px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            position: relative;
            text-shadow: none !important;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .msg-me {
            align-self: flex-end;
            background: #dcf8c6 !important;
            color: #000 !important;
            border-radius: 12px 12px 0 12px;
        }

        .msg-other {
            align-self: flex-start;
            background: #ffffff !important;
            color: #000 !important;
            border-radius: 12px 12px 12px 0;
        }

        /* √úST BAR */
        .screen {
            display: none;
            position: absolute;
            /* Sabit body i√ßinde serbest dola≈üsƒ±n */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;

            /* KAYDIRMA MOTORU */
            overflow-y: auto !important;
            overflow-x: hidden;

            /* MOBƒ∞L PARMAK KAYDIRMA AYARI */
            -webkit-overflow-scrolling: touch;
            touch-action: pan-y;

            /* ƒ∞√ßerik d√ºzeni */
            padding-top: var(--safe-top);
            padding-bottom: calc(90px + env(safe-area-inset-bottom)) !important;
            box-sizing: border-box;

            /* Men√ºden (z-index: 9999) daha altta olsun */
            z-index: 1;
        }

        /* Flex yerine Block yapƒ±yoruz ki i√ßerik a≈üaƒüƒ± akabilsin */
        .screen.active {
            display: block !important;
        }

        /* 2. Gƒ∞Rƒ∞≈û EKRANI (Merkezleme Fixi) */
        #screen-login {
            padding-top: 0 !important;
            /* √úst bo≈üluƒüu sƒ±fƒ±rla */
            padding-bottom: 0 !important;
            justify-content: center;
            /* Tam ortala */
            align-items: center;
            background: var(--bg);
            /* Arkaplan rengini garantiye al */
            z-index: 1000;
            /* Diƒüer her ≈üeyin √ºst√ºnde */
        }

        /* 3. LOBƒ∞ EKRANI (√úst Bar ve Kayan Yazƒ± ƒ∞√ßin √ñzel Bo≈üluk) */



        /* 7. ƒ∞STATƒ∞STƒ∞K KUTULARI (Hizalama) */
        .stats-row {
            display: flex;
            gap: 10px;
            margin: 0 20px 10px 20px;
            /* Kenarlardan bo≈üluk ver */
            width: calc(100% - 40px);
            /* Ta≈ümayƒ± √∂nle */
        }

        /* 6. KAYAN YAZI ALANI (Sabitleme) */
        #marqueeArea {
            position: absolute;
            top: var(--safe-top);
            left: 0;
            width: 100%;
            height: 30px;
            background: #000;
            color: var(--gold);
            font-size: 0.8rem;
            font-weight: bold;
            z-index: 2000;
            display: flex;
            align-items: center;
            border-bottom: 1px solid rgba(255, 215, 0, 0.5);
        }

        /* --- ULTIMATE "MAGMA CORE" OYNA BUTONU (ORƒ∞Jƒ∞NAL) --- */
        .play-container {
            position: relative;
            width: 160px;
            height: 160px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            animation: floatBreath 3s ease-in-out infinite;
            /* Nefes alma efekti */
        }

        /* Arkadaki D√∂nen Tek Enerji Halkasƒ± */
        .play-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 4px solid transparent;
            border-top-color: #f1c40f;
            border-right-color: #e67e22;
            animation: spinRing 2s linear infinite;
            box-shadow: 0 0 20px rgba(241, 196, 15, 0.5);
            opacity: 0.7;
        }

        .play-btn-huge {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            /* M√ºkemmel Gradyan: Turuncudan Altƒ±na */
            background: radial-gradient(circle at 35% 35%, #f1c40f 0%, #f39c12 40%, #d35400 100%);
            box-shadow:
                inset 0 10px 20px rgba(255, 255, 255, 0.6),
                /* √úst I≈üƒ±k */
                inset 0 -10px 20px rgba(0, 0, 0, 0.3),
                /* Alt G√∂lge */
                0 15px 30px rgba(211, 84, 0, 0.6),
                /* Dƒ±≈ü G√∂lge (Glow) */
                0 8px 0 #a04000;
            /* 3D Taban (Derinlik) */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            transition: all 0.1s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 20;
            border: 4px solid rgba(255, 255, 255, 0.2);
        }

        .play-content {
            text-align: center;
            pointer-events: none;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
            transform: translateY(-4px);
        }

        .play-icon {
            font-size: 3.5rem;
            color: #fff;
            margin-left: 8px;
            filter: drop-shadow(0 2px 5px rgba(0, 0, 0, 0.3));
        }

        .play-text {
            font-size: 1rem;
            color: #ffeaa7;
            font-weight: 900;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-top: -5px;
        }

        /* TIKLAMA EFEKTƒ∞ */
        .play-btn-huge:active {
            transform: translateY(8px) scale(0.95);
            box-shadow:
                inset 0 10px 20px rgba(255, 255, 255, 0.4),
                inset 0 -5px 10px rgba(0, 0, 0, 0.2),
                0 5px 15px rgba(211, 84, 0, 0.8),
                0 0 0 #a04000;
        }

        .play-btn-huge:active .play-content {
            transform: translateY(0);
        }

        /* Animasyonlar */
        @keyframes spinRing {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        @keyframes floatBreath {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        @keyframes spinLeft {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(-360deg);
            }
        }

        /* Idle (Bekleme) Animasyonu: Nefes Alma */
        .play-container {
            animation: floatBreath 3s ease-in-out infinite;
        }

        @keyframes floatBreath {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        @keyframes shake {
            0% {
                transform: translate(1px, 1px) rotate(0deg);
            }

            10% {
                transform: translate(-1px, -2px) rotate(-1deg);
            }

            50% {
                transform: translate(-1px, 2px) rotate(-1deg);
            }

            100% {
                transform: translate(1px, -2px) rotate(-1deg);
            }
        }

        .shake-anim {
            animation: shake 0.5s;
        }

        /* PET SHEET ANIMATIONS (STABLE) */
        .anim-sheet-idle {
            animation: sheetIdle 0.8s steps(4) infinite;
        }

        @keyframes sheetIdle {
            from {
                transform: translateX(0);
            }

            to {
                transform: translateX(-100%);
            }
        }

        .quick-actions {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            width: 100%;
            max-width: 350px
        }

        .xp-container {
            width: 100%;
            padding: 0 20px;
            box-sizing: border-box;
            margin-bottom: 10px
        }

        .xp-bar-bg {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .xp-bar-fill {
            height: 100%;
            background: var(--success);
            width: 0%;
            transition: width 0.5s;
            border-radius: 4px;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            padding-bottom: var(--safe-bottom);
        }

        .modal-box {
            background: #fff;
            color: #333;
            border: none;
            padding: 25px;
            border-radius: 25px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px) scale(0.9);
                opacity: 0
            }

            to {
                transform: translateY(0) scale(1);
                opacity: 1
            }
        }

        .avatar-wrapper {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            justify-content: center;
            padding: 10px;
        }

        /* --- 3D AVATAR STƒ∞LLERƒ∞ --- */
        .avatar-wrapper {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            justify-content: center;
            padding: 10px;
        }

        .avatar-item {
            width: 65px;
            height: 65px;
            padding: 8px;
            background: #ffffff;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            /* Se√ßili deƒüilken √ßer√ßeve yok */
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .avatar-item img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            pointer-events: none;
            /* Tƒ±klamayƒ± engellemesin */
            filter: drop-shadow(0 2px 5px rgba(0, 0, 0, 0.2));
            /* 3D G√∂lge */
        }

        .avatar-item:active {
            transform: scale(0.9);
        }

        .avatar-item.selected {
            border-color: #2ed573;
            background: #e8f5e9;
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(46, 213, 115, 0.5);
        }

        .list-container {
            max-height: 200px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 15px;
            padding: 5px;
            text-align: left
        }

        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            font-size: 0.9rem;
            color: var(--text);
        }

        .turn-indicator {
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            font-weight: bold;
            color: white
        }

        .turn-active {
            background: var(--success);
            transform: scale(1.05);
            box-shadow: 0 0 10px var(--success);
        }

        .turn-wait {
            background: #999;
            opacity: 0.5
        }

        #toast {
            visibility: hidden;
            min-width: 200px;
            background: rgba(0, 0, 0, 0.9);
            color: #fff;
            text-align: center;
            border-radius: 50px;
            padding: 12px 25px;
            position: fixed;
            z-index: 4000;
            left: 50%;
            bottom: calc(90px + var(--safe-bottom));
            transform: translateX(-50%);
            font-size: 0.9rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        #toast.show {
            visibility: visible;
            animation: fadein 0.3s, fadeout 0.3s 2.5s
        }

        @keyframes fadein {
            from {
                bottom: 0;
                opacity: 0
            }

            to {
                bottom: calc(90px + var(--safe-bottom));
                opacity: 1
            }
        }

        @keyframes fadeout {
            from {
                bottom: calc(90px + var(--safe-bottom));
                opacity: 1
            }

            to {
                bottom: 0;
                opacity: 0
            }
        }

        /* Admin & Game UI */
        .admin-dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .admin-card {
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            text-align: center;
            border: 1px solid #eee;
            color: #333;
            text-shadow: none;
        }

        .admin-section {
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.9);
            text-align: left;
            color: #333 !important;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.03);
            text-shadow: none;
        }

        .market-category {
            text-align: left;
            margin: 10px 0 5px 0;
            color: var(--primary);
            font-size: 0.9rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 3px;
            font-weight: bold
        }

        /* --- KAYIP OLAN √úST BAR STƒ∞LLERƒ∞ (GERƒ∞ Y√úKLEME) --- */

        /* ƒ∞statistik Satƒ±rƒ± Hizalamasƒ± */
        .top-bar-row-stats {
            width: 100%;
            display: flex;
            gap: 10px;
            padding: 0 15px 8px 15px;
            justify-content: space-between;
        }

        /* Kaps√ºl Tasarƒ±mƒ± (Genel) */
        /* --- MOBƒ∞L UYUMLU ƒ∞STATƒ∞STƒ∞K BUTONLARI --- */

        .mini-stat-pill {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 8px;
            /* Padding'i biraz kƒ±stƒ±k */
            border-radius: 12px;
            color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            height: 42px;
            /* Y√ºksekliƒüi biraz artƒ±rdƒ±k ki sƒ±ƒüsƒ±n */
            overflow: hidden;
            text-shadow: none !important;
        }

        /* Mobilde ba≈ülƒ±k boyutunu dinamik yap */
        .mini-stat-title {
            font-weight: bold;
            font-size: 0.65rem;
            opacity: 0.9;
            text-transform: uppercase;
            color: #fff;
            white-space: nowrap;
            /* Asla alt satƒ±ra inmesin */
        }

        /* Deƒüerler (ƒ∞sim ve S√ºre) */
        .mini-stat-val {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8rem;
            color: #fff;
            max-width: 110px;
            /* Geni≈ületildi */
            text-align: right;
            line-height: 1.1;
        }

        .mini-stat-val span {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        /* Speedrun Kutusu √ñzel Hizalama */
        #speedrunBox .mini-stat-val {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            justify-content: center;
            line-height: 1;
            /* Satƒ±r aralƒ±ƒüƒ±nƒ± sƒ±kƒ±la≈ütƒ±r */
        }

        /* K√º√ß√ºk Ekranlar (iPhone SE, Android Mini vb.) i√ßin √ñzel K√º√ß√ºltme */
        @media (max-width: 380px) {
            .mini-stat-title {
                font-size: 0.55rem;
            }

            .mini-stat-val {
                font-size: 0.7rem;
            }

            .mini-stat-pill {
                padding: 0 5px;
            }

            #lobbyAvatarDisplay {
                font-size: 1.5rem !important;
            }

            /* Avatarƒ± da hafif k√º√ß√ºlt */
        }

        /* XP √áubuƒüu ƒ∞nce √áizgi */
        .header-xp-container {
            width: 100%;
            height: 4px;
            background: #eee;
            margin-top: auto;
        }

        .header-xp-fill {
            height: 100%;
            background: var(--success);
            width: 0%;
            box-shadow: 0 0 5px var(--success);
        }

        /* --- PRO G√úNL√úK KASA TASARIMI --- */
        .vault-container {
            perspective: 1000px;
            width: 220px;
            height: 220px;
            margin: 20px auto;
            position: relative;
        }

        .vault-body {
            width: 100%;
            height: 100%;
            background: linear-gradient(145deg, #2c3e50, #1a252f);
            border-radius: 20px;
            border: 5px solid #bdc3c7;
            box-shadow:
                inset 0 0 30px #000,
                0 15px 35px rgba(0, 0, 0, 0.5);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Kasa ƒ∞√ßi (√ñd√ºl Alanƒ±) */
        .vault-inside {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            background: radial-gradient(circle, #f1c40f 0%, #d35400 80%);
            border-radius: 15px;
            box-shadow: inset 0 0 20px #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1;
            opacity: 0;
            transition: opacity 0.5s;
        }

        /* Kasa Kapƒ±sƒ± */
        .vault-door {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            border-radius: 14px;
            /* √áer√ßeveden biraz k√º√ß√ºk */
            position: absolute;
            top: 0;
            left: 0;
            transform-origin: left center;
            transition: all 1s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 2;
            border: 2px solid #bdc3c7;
            box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Metalik √áevirme Kolu */
        .vault-handle-base {
            width: 90px;
            height: 90px;
            background: radial-gradient(circle, #bdc3c7, #7f8c8d);
            border-radius: 50%;
            border: 4px solid #34495e;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.8s ease-in-out;
        }

        .vault-handle-bars {
            width: 100%;
            height: 12px;
            background: #2c3e50;
            border-radius: 5px;
            position: absolute;
        }

        .vault-handle-bars.vertical {
            transform: rotate(90deg);
        }

        .vault-knob {
            width: 20px;
            height: 20px;
            background: #f1c40f;
            border-radius: 50%;
            position: absolute;
            z-index: 5;
            box-shadow: 0 0 5px #f1c40f;
        }

        /* Durum I≈üƒ±klarƒ± */
        .vault-status-light {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #c0392b;
            /* Kƒ±rmƒ±zƒ± (Kilitli) */
            box-shadow: 0 0 5px #c0392b;
            transition: 0.3s;
            border: 1px solid rgba(0, 0, 0, 0.3);
            backface-visibility: hidden;
            /* Android Fix */
            transform: translateZ(0);
            /* GPU Force */
        }

        /* A√ßƒ±lma Animasyon Sƒ±nƒ±flarƒ± */
        .vault-open .vault-handle-base {
            transform: rotate(360deg) translateZ(0);
        }

        .vault-open .vault-door {
            transform: rotateY(-115deg) translateZ(0);
        }

        .vault-open .vault-inside {
            opacity: 1;
            /* Titremeyi √∂nlemek i√ßin statik tutuyoruz */
        }

        .vault-open .vault-status-light {
            background: #2ecc71;
            box-shadow: 0 0 10px #2ecc71;
        }

        .quest-box {
            display: none;
            width: 100%;
            background: rgba(255, 255, 255, 0.9);
            padding: 12px;
            border-radius: 12px;
            border: 1px solid #90caf9;
            font-size: 0.85rem;
            color: #333;
            box-sizing: border-box;
            transition: 0.3s;
            text-shadow: none;
        }

        .quest-box.completed {
            background: #e8f5e9;
            border-color: #a5d6a7
        }

        .quest-bar-bg {
            width: 100%;
            height: 8px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            margin-top: 8px;
            overflow: hidden
        }

        .quest-bar-fill {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.5s
        }

        /* --- YENƒ∞ GE√áMƒ∞≈û Lƒ∞STESƒ∞ TASARIMI (SOHBET STƒ∞Lƒ∞) --- */
        #history {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 10px;
        }

        #history li {
            display: inline-flex;
            align-items: center;
            padding: 8px 12px;
            border-radius: 15px;
            max-width: 90%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            font-size: 1rem;
            position: relative;
            width: fit-content;
            /* ƒ∞√ßerik kadar geni≈ülik */
        }

        /* BENƒ∞M TAHMƒ∞NLERƒ∞M (SAƒûDA - YE≈ûƒ∞L) - 3D */
        .his-me {
            align-self: flex-end;
            background: linear-gradient(145deg, #dcf8c6, #c8e6a8);
            color: #333;
            border-bottom-right-radius: 2px !important;
            flex-direction: row-reverse;
            box-shadow: 
                0 4px 8px rgba(0,0,0,0.1),
                0 2px 4px rgba(0,0,0,0.05),
                inset 0 1px 0 rgba(255,255,255,0.8);
            transform: translateZ(0);
            transition: all 0.2s ease;
        }

        /* RAKƒ∞Bƒ∞N TAHMƒ∞NLERƒ∞ (SOLDA - BEYAZ) - 3D */
        .his-other {
            align-self: flex-start;
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            color: #333;
            border-bottom-left-radius: 2px !important;
            flex-direction: row;
            box-shadow: 
                0 4px 8px rgba(0,0,0,0.1),
                0 2px 4px rgba(0,0,0,0.05),
                inset 0 1px 0 rgba(255,255,255,0.8);
            transform: translateZ(0);
            transition: all 0.2s ease;
        }

        /* SAYI KUTUSU - 3D */
        .his-badge {
            font-weight: 900;
            letter-spacing: 3px;
            background: linear-gradient(145deg, #444, #222);
            color: #fff;
            padding: 8px 12px;
            border-radius: 10px;
            font-size: 1rem;
            margin: 0 10px;
            box-shadow: 
                0 4px 8px rgba(0,0,0,0.2),
                0 2px 4px rgba(0,0,0,0.1),
                inset 0 1px 0 rgba(255,255,255,0.2);
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
            animation: badgePop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes badgePop {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        /* PUAN (+/-) ALANI (YAN YANA) */
        .his-score {
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.1rem;
            white-space: nowrap;
            /* Alt satƒ±ra inmeyi engeller */
        }




        .item-bar {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-top: 10px;
        }

        .item-btn {
            position: relative;
            font-size: 0.8rem;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            transition: 0.2s;
            color: white;
        }

        .item-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--danger);
            color: white;
            border-radius: 50%;
            font-size: 0.65rem;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #fff;
            font-weight: bold;
        }

        .ink-blot {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, #000 20%, transparent 80%);
            z-index: 9999;
            display: none;
            animation: pulseInk 3s forwards;
            pointer-events: none;
        }

        @keyframes pulseInk {
            0% {
                opacity: 0;
                transform: scale(0.5);
            }

            10% {
                opacity: 1;
                transform: scale(1.2);
            }

            80% {
                opacity: 1;
            }

            100% {
                opacity: 0;
            }
        }

        .stats-row {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }

        /* ƒ∞statistik Kutusu Sabitleme */
        .stat-box {
            height: 65px;
            /* Y√ºkseklik SABƒ∞T (B√ºy√ºy√ºp k√º√ß√ºlmez) */
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow: hidden;
            /* Ta≈üarsa gizle */
        }

        .stat-winner {
            background: linear-gradient(135deg, #f1c40f, #e67e22);
        }

        .stat-speed {
            background: linear-gradient(135deg, #00d2ff, #3a7bd5);
        }

        .stat-title {
            font-size: 0.7rem;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 5px;
            opacity: 0.9;
        }

        /* G√ºn√ºn Kralƒ± ve Rekor Deƒüerleri */
        .stat-value {
            font-size: 0.9rem;
            /* Biraz k√º√ß√ºltt√ºk */
            white-space: nowrap;
            /* Alt satƒ±ra inmesin */
            text-overflow: ellipsis;
            /* Sƒ±ƒümazsa ... koysun */
            overflow: hidden;
        }

        /* --- Speedrun Kutusu ƒ∞√ßin √ñzel Ayar --- */
        #speedrunBox .mini-stat-val {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            justify-content: center;
        }

        #srUser {
            color: #fff;
            font-weight: bold;
        }

        #srTime {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .floating-numbers-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
            z-index: 0;
        }

        .float-num {
            position: absolute;
            bottom: -50px;
            color: var(--primary);
            font-weight: bold;
            opacity: 0.15;
            animation: floatUp 15s linear infinite;
        }

        @keyframes floatUp {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }

            20% {
                opacity: 0.2;
            }

            80% {
                opacity: 0.2;
            }

            100% {
                transform: translateY(-20vh) rotate(360deg);
                opacity: 0;
            }
        }

        .emoji-bar {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
            background: rgba(255, 255, 255, 0.5);
            padding: 5px;
            border-radius: 20px;
            backdrop-filter: blur(5px);
        }

        .emoji-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
            transition: 0.2s;
            box-shadow: none;
            text-shadow: none;
        }

        .floating-emoji {
            position: fixed;
            font-size: 4rem;
            pointer-events: none;
            z-index: 9999;
            animation: wobble-up 3s ease-in forwards;
        }

        @keyframes wobble-up {
            0% {
                bottom: 50px;
                opacity: 1;
                transform: translateX(0) rotate(0);
            }

            75% {
                transform: translateX(10px) rotate(5deg);
                opacity: 0.8;
            }

            100% {
                bottom: 80vh;
                opacity: 0;
                transform: translateX(0);
            }
        }

        /* Marquee & Gold Rain */
        @keyframes gold-flash {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        .pulse-active {
            animation: gold-flash 1.5s infinite !important;
            background: linear-gradient(135deg, #ff9f43, #feca57) !important;
            color: #fff !important;
            z-index: 100;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        #marqueeArea {
            position: absolute;
            top: var(--safe-top);
            left: 0;
            width: 100%;
            height: 30px;
            background: #000000;
            color: var(--gold);
            font-size: 0.8rem;
            font-weight: bold;
            z-index: 2000;
            display: flex;
            align-items: center;
            border-bottom: 1px solid rgba(255, 215, 0, 0.5);
        }

        .gold-rain-active {
            background: linear-gradient(45deg, #f1c40f, #e67e22, #f1c40f);
            background-size: 200% 200%;
            animation: gradientShift 3s ease infinite;
            border: 2px solid #fff;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 15px;
            margin-bottom: 10px;
            display: none;
            text-align: center;
            font-weight: bold;
        }

        @keyframes gradientShift {
            0% {
                background-position: 0% 50%
            }

            50% {
                background-position: 100% 50%
            }

            100% {
                background-position: 0% 50%
            }
        }

        /* --- ROZET Sƒ∞STEMƒ∞ CSS --- */
        .badge-container {
            display: inline-flex;
            gap: 3px;
            vertical-align: middle;
            margin-left: 5px;
        }

        .badge-icon {
            font-size: 0.85rem;
            padding: 2px 4px;
            border-radius: 4px;
            background: rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            cursor: help;
            position: relative;
        }

        .badge-king {
            animation: pulse-active 1.5s infinite;
            border-color: gold;
            color: gold;
            background: rgba(0, 0, 0, 0.8);
        }

        .badge-ad {
            color: #a29bfe;
            border-color: #a29bfe;
        }

        .badge-rich {
            color: #f1c40f;
            border-color: #f1c40f;
        }

        /* --- MASTER OKUNABƒ∞Lƒ∞RLƒ∞K VE UI YAMASI (v2.0) --- */

        /* 1. INPUT, SELECT VE TEXTAREA (HER YERDE KESƒ∞N OKUNURLUK) */
        input,
        select,
        textarea {
            background-color: #ffffff !important;
            color: #000000 !important;
            border: 2px solid #ccc !important;
            border-radius: 10px;
            padding: 12px;
            font-size: 1rem;
            font-weight: 700;
            text-shadow: none !important;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.05);
            opacity: 1 !important;
            -webkit-text-fill-color: #000000 !important;
            /* iOS Safari Fix */
        }

        input::placeholder {
            color: #888 !important;
            opacity: 1;
        }

        input:focus,
        select:focus {
            border-color: var(--primary) !important;
            background: #fff !important;
        }

        /* 2. GENEL KART YAPISI (TEMAYA UYUMLU AMA OKUNAKLI) */
        .card,
        .modal-box,
        .quest-box {
            background: rgba(255, 255, 255, 0.94) !important;
            /* √áok y√ºksek opaklƒ±k */
            color: #222 !important;
            backdrop-filter: blur(20px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2) !important;
            border: 1px solid rgba(255, 255, 255, 0.5);
            text-shadow: none !important;
        }

        /* KOYU TEMA KARTLARI (Dark Mode, Uzay, Gece vb.) */
        body[class*="theme-dark"] .card,
        body[class*="bg-space"] .card,
        body[class*="bg-neon"] .card,
        body[class*="theme-bjk"] .card,
        body[class*="bg-deep-sea"] .card,
        body[class*="bg-matrix"] .card,
        body[class*="bg-volcano"] .card,
        body[class*="bg-mystic"] .card {
            background: rgba(28, 28, 30, 0.94) !important;
            /* Koyu zemin */
            color: #ffffff !important;
            /* Beyaz yazƒ± */
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* 3. Lƒ∞STE ELEMANLARI (Market, √áanta, Skor, Admin Listeleri) */
        .list-item {
            background: #ffffff !important;
            color: #000000 !important;
            border-radius: 8px;
            margin-bottom: 6px;
            padding: 12px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            font-weight: 600;
            text-shadow: none !important;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        /* Koyu temada listeler */
        body[class*="theme-dark"] .list-item,
        body[class*="bg-"] .list-item {
            background: #333 !important;
            color: #fff !important;
            border-color: #555;
        }

        /* 4. ADMIN PANELƒ∞ ƒ∞√áƒ∞N √ñZEL KORUMA (TEMADAN ETKƒ∞LENMEZ) */
        /* Admin paneli ne olursa olsun Beyaz/Gri kurumsal renkte kalƒ±r */
        #screen-admin .card,
        #screen-admin .admin-section,
        #screen-admin .admin-card {
            background-color: #ffffff !important;
            color: #2d3436 !important;
            border: 1px solid #dfe6e9 !important;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1) !important;
            text-shadow: none !important;
        }

        #screen-admin h2,
        #screen-admin h3,
        #screen-admin h4,
        #screen-admin small {
            color: #2d3436 !important;
            text-shadow: none !important;
        }

        #screen-admin .list-item {
            background-color: #f5f6fa !important;
            color: #2d3436 !important;
            border: 1px solid #dcdde1 !important;
        }

        /* Admin i√ßi butonlar daha belirgin olsun */
        #screen-admin button {
            text-shadow: none !important;
            font-weight: bold;
            border: 1px solid rgba(0, 0, 0, 0.2);
        }

        /* 5. BUTON YAZILARI VE ƒ∞KONLAR */
        button {
            color: white !important;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .btn-gold,
        .btn-grey {
            color: #2d3436 !important;
            text-shadow: none !important;
        }

        /* 6. NAVBAR (ALT VE √úST √áUBUK - D√úZELTƒ∞LMƒ∞≈û) */

        /* √úst √áubuk Temel Ayarƒ± */
        .top-bar {
            position: absolute;
            top: calc(var(--safe-top) + 30px);
            /* Marquee'nin altƒ± */
            left: 0;
            width: 100%;
            height: auto;
            /* Y√ºkseklik i√ßeriƒüe g√∂re uzasƒ±n */
            min-height: 90px;
            /* Biraz daha uzun */
            display: flex;
            flex-direction: column;
            /* Alt alta dizilim */
            background: rgba(255, 255, 255, 0.98);
            z-index: 90;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            padding-bottom: 5px;
        }

        /* ALT MEN√ú SABƒ∞TLEME VE Hƒ∞ZALAMA (KRƒ∞Tƒ∞K D√úZELTME) */
        .bottom-nav {
            position: fixed !important;
            bottom: 0 !important;
            left: 0 !important;
            width: 100% !important;
            z-index: 9999 !important;
            /* En √ºstte durmasƒ± garanti olsun */

            /* Android Sanal Tu≈ü Payƒ± */
            padding-bottom: env(safe-area-inset-bottom) !important;
            height: calc(70px + env(safe-area-inset-bottom));

            background: #ffffff !important;
            color: #333 !important;
            border-top: 1px solid #eee;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);

            display: flex;
            justify-content: space-around;
            align-items: center;

            /* K√∂≈üeleri d√ºzelttik */
            border-top-left-radius: 0;
            border-top-right-radius: 0;
        }

        /* Men√º ƒ∞√ßindeki ƒ∞kon ve Yazƒ±lar */
        .bottom-nav .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            color: inherit;
            opacity: 0.6;
            cursor: pointer;
            font-size: 0.75rem;
        }

        .bottom-nav .nav-icon {
            font-size: 1.5rem;
            margin-bottom: 3px;
        }

        .bottom-nav .nav-item.active {
            opacity: 1;
            font-weight: bold;
            color: var(--primary);
            transform: scale(1.1);
            transition: 0.2s;
        }

        /* KOYU TEMALARDA NAVBAR RENGƒ∞ */
        body[class*="theme-dark"] .top-bar,
        body[class*="bg-"] .top-bar,
        body[class*="theme-dark"] .bottom-nav,
        body[class*="bg-"] .bottom-nav {
            background: #1e1e1e !important;
            color: #fff !important;
            border-top: 1px solid #333;
            border-bottom: 1px solid #333;
        }

        h1,
        h2,
        h3,
h4,
h5,
p,
span,
div {
/* Yazƒ±larƒ±n okunmasƒ±nƒ± engelleyen glow efektlerini kaldƒ±r */
text-shadow: none;
}

.market-category {
color: inherit !important;
background: rgba(0, 0, 0, 0.05);
padding: 5px 10px;
border-radius: 5px;
margin-top: 15px;
}

/* 8. MARKET KARTLARI */
#modal-market .card {
flex-direction: column;
align-items: stretch;
background: #fff !important;
color: #333 !important;
}

/* --- PROFƒ∞L MODALI D√úZELTMESƒ∞ (EKSƒ∞K OLAN KODLAR) --- */
.profile-header {
display: flex;
flex-direction: column;
align-items: center;
background: linear-gradient(to bottom, #f8f9fa, #e9ecef);
padding: 20px;
border-radius: 20px;
margin-bottom: 15px;
border: 1px solid #dee2e6;
position: relative;
}

.profile-avatar-huge {
font-size: 4rem;
background: #fff;
width: 100px;
height: 100px;
display: flex;
align-items: center;
justify-content: center;
border-radius: 50%;
box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
border: 3px solid var(--primary);
z-index: 2;
overflow: hidden;
/* Resim ta≈ümasƒ±n */
}

.profile-avatar-huge img {
width: 100%;
height: 100%;
object-fit: cover;
/* Resmi kutuya sƒ±ƒüdƒ±r */
}

.profile-online-badge {
position: absolute;
bottom: 5px;
right: 5px;
width: 20px;
height: 20px;
border-radius: 50%;
border: 2px solid #fff;
}

.status-online {
background: #2ed573;
box-shadow: 0 0 5px #2ed573;
}

.status-offline {
background: #a4b0be;
}

.profile-stats-grid {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 10px;
margin-bottom: 15px;
}

.p-stat-box {
background: #fff;
padding: 10px;
border-radius: 12px;
text-align: center;
border: 1px solid #eee;
box-shadow: 0 2px 5px rgba(0, 0, 0, 0.02);
}

.p-stat-val {
font-weight: 900;
font-size: 1.1rem;
color: #2d3436;
}

.p-stat-label {
font-size: 0.7rem;
color: #636e72;
text-transform: uppercase;
}

.profile-bio-box {
background: #fff;
padding: 15px;
border-radius: 12px;
border: 1px solid #eee;
margin-bottom: 15px;
text-align: left;
min-height: 60px;
font-size: 0.9rem;
color: #555;
font-style: italic;
position: relative;
}

.bio-edit-btn {
position: absolute;
right: 5px;
top: 5px;
font-size: 0.7rem;
padding: 2px 6px;
background: #eee;
border-radius: 4px;
cursor: pointer;
color: #333;
}

/* 2. EKRAN KUTUSU (Scroll Motoru Tamiri) */
.screen {
display: none;
position: absolute !important;
/* G√∂vdeye baƒüƒ±mlƒ± kal */
top: 0;
left: 0;
width: 100%;
height: 100%;
/* Ekran boyu kadar ol */

/* KAYDIRMA MOTORU */
overflow-y: auto !important;
/* ƒ∞√ßindekiler sƒ±ƒümazsa kaydƒ±r */
overflow-x: hidden;

/* MOBƒ∞L PARMAK KAYDIRMA */
-webkit-overflow-scrolling: touch;
touch-action: pan-y;

/* BO≈ûLUKLAR */
padding-top: var(--safe-top) !important;
/* Alt men√º + Android tu≈ülarƒ± kadar bo≈üluk bƒ±rak */
padding-bottom: calc(90px + env(safe-area-inset-bottom)) !important;
box-sizing: border-box;
z-index: 1;
}

.screen.active {
display: block !important;
/* Flex deƒüil Block */
}

/* 3. LOBƒ∞ EKRANI AYARLARI */
#screen-lobby {
padding-bottom: 90px !important;
/* Alt men√º i√ßin bo≈üluk */
}

/* 4. √úST BAR VE KAYAN YAZI: ARTIK AKI≈ûKAN */
#marqueeArea,
.top-bar {
position: relative !important;
/* Sabit deƒüil, sƒ±radan bir kutu */
top: 0 !important;
left: 0 !important;
width: 100% !important;
z-index: 50;
margin-bottom: 0 !important;
box-shadow: none !important;
/* G√∂lgeyi kaldƒ±r, b√ºt√ºnl√ºk saƒüla */
}

/* 5. ƒ∞√áERƒ∞K ALANI: TAM ORTALAMA VE BO≈ûLUK AYARI (FINAL) */
.hero-section {
display: flex !important;
flex-direction: column !important;
align-items: center !important;

/* ƒ∞√ßeriƒüi en tepeden ba≈ülat, ortalama yapma */
justify-content: flex-start !important;

width: 100% !important;
max-width: 100% !important;

/* BU KISIM KAYDIRMAYI TETƒ∞KLER */
height: auto !important;
min-height: calc(100% + 1px) !important;
/* Ekrandan 1px uzun olsun ki scroll olu≈üsun */

/* Men√ºlerin altƒ±nda kalmamasƒ± i√ßin bo≈üluklar */
padding-top: 40px !important;
padding-bottom: 150px !important;
/* Alt bo≈üluƒüu artƒ±rdƒ±k */
padding-left: 15px !important;
padding-right: 15px !important;

box-sizing: border-box !important;
overflow: visible !important;
}

/* --- KESƒ∞N TAMƒ∞R: ƒ∞STATƒ∞STƒ∞K KUTULARI (Hƒ∞ZALAMA FIX) --- */

/* 1. Kaps√ºl√ºn Kendisi */
.mini-stat-pill {
flex: 1;
display: flex;
align-items: center;
/* Dikeyde tam ortala */
justify-content: space-between;
/* Saƒüa ve sola yasla */
padding: 6px 12px !important;
/* ƒ∞√ß bo≈üluƒüu artƒ±rdƒ±k */
border-radius: 12px;
height: auto !important;
/* Y√ºkseklik i√ßeriƒüe g√∂re uzasƒ±n */
min-height: 50px !important;
/* Minimum y√ºkseklik (Kesilmeyi √∂nler) */
color: white !important;
box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2) !important;
overflow: visible !important;
/* Ta≈üma olursa gizleme */
}

/* 2. G√ºn√ºn Kralƒ± Arka Planƒ± */
.pill-winner {
background: linear-gradient(135deg, #f1c40f, #e67e22) !important;
border: 1px solid rgba(255, 255, 255, 0.4) !important;
}

/* 3. Rekor Arka Planƒ± */
.pill-speed {
background: linear-gradient(135deg, #00d2ff, #3a7bd5) !important;
border: 1px solid rgba(255, 255, 255, 0.4) !important;
}

/* 4. Sol Taraf (ƒ∞kon ve Ba≈ülƒ±k) */
.mini-stat-left {
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
margin-right: 8px;
/* Saƒü tarafla mesafe bƒ±rak */
flex-shrink: 0;
/* Asla k√º√ß√ºlmesin */
}

.mini-stat-title {
font-size: 0.65rem !important;
font-weight: 800;
text-transform: uppercase;
opacity: 1;
margin-top: 2px;
text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

/* 5. Saƒü Taraf (ƒ∞sim ve Puan) */
.mini-stat-val {
display: flex !important;
flex-direction: column !important;
align-items: flex-end !important;
/* Saƒüa yasla */
justify-content: center !important;
text-align: right;
line-height: 1.3 !important;
/* Satƒ±r arasƒ±nƒ± a√ßtƒ±k (Kesilmeyi engeller) */
width: 100%;
/* Alanƒ± doldur */
}

/* ƒ∞sim Satƒ±rƒ± */
.stat-user-line {
font-size: 0.85rem !important;
font-weight: 800;
color: #fff !important;
text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
/* Daha belirgin g√∂lge */
white-space: normal !important;
/* Alt satƒ±ra inebilsin */
word-break: break-word;
/* Uzun kelimeleri kƒ±r */
margin-bottom: 2px;
line-height: 1 !important;
position: relative;
z-index: 10;
/* Rengin √ºst√ºnde kalsƒ±n */
display: block;
/* Flex i√ßinde wrap sorunu olmasƒ±n */
}

/* Puan Satƒ±rƒ± */
.stat-score-line {
font-size: 0.75rem !important;
font-weight: 600;
color: #ffeaa7 !important;
text-shadow: none;
white-space: nowrap;
position: relative;
z-index: 10;
}

/* K√º√ß√ºk Ekranlar ƒ∞√ßin Ayar */
@media (max-width: 360px) {
.mini-stat-pill {
padding: 4px 6px;
}

.stat-user-line {
font-size: 0.7rem;
}

.stat-score-line {
font-size: 0.6rem;
}
}

/* Alt Men√º Sabitleme Yamasƒ± */
html,
body {
width: 100%;
height: 100%;
margin: 0;
padding: 0;
overflow: hidden !important;
/* Sayfanƒ±n kendisi asla kaymasƒ±n */
position: fixed;
/* Ekrana kilitle */
background: var(--bg);
}

/* --- KARƒ∞YER YOLU (SAGA MAP) TASARIMI --- */
/* --- PRO SAGA MAP TASARIMI (V2.0) --- */
.career-container {
display: flex;
flex-direction: column-reverse;
/* 1. Seviye en altta ba≈ülar */
align-items: center;
padding: 40px 20px;
position: relative;
background: linear-gradient(180deg, #81ecec 0%, #74b9ff 40%, #55efc4 80%, #00b894 100%);
/* G√∂ky√ºz√ºnden √ßimene ge√ßi≈ü */
min-height: 100%;
overflow-x: hidden;
}

/* Arkaplan Bulut S√ºslemesi */
.career-bg-decoration {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-image:
radial-gradient(circle at 10% 20%, rgba(255, 255, 255, 0.4) 10px, transparent 11px),
radial-gradient(circle at 90% 60%, rgba(255, 255, 255, 0.3) 15px, transparent 16px);
pointer-events: none;
z-index: 0;
}

.career-step {
position: relative;
width: 100%;
display: flex;
justify-content: center;
margin-bottom: 50px;
/* D√ºƒü√ºmler arasƒ± mesafe */
z-index: 2;
}

/* D√ºƒü√ºm (Level Kutusu) */
/* D√ºƒü√ºm (Level Kutusu) */
.career-node {
width: 80px;
height: 80px;
border-radius: 20px;
/* Hafif karemsi yuvarlak */
background: #bdc3c7;
border-bottom: 6px solid #7f8c8d;
/* 3D Derinlik */
display: flex;
align-items: center;
justify-content: center;
font-size: 2.2rem;
/* Icon i√ßin b√ºy√ºk font */
color: #fff;
font-weight: bold;
cursor: pointer;
position: relative;
transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
}



/* Kilitli */
.career-node.locked {
background: #95a5a6;
border-bottom-color: #7f8c8d;
opacity: 0.8;
filter: grayscale(1);
}

/* Tamamlanmƒ±≈ü */
.career-node.completed {
background: linear-gradient(135deg, #2ecc71, #27ae60);
border-bottom-color: #1e8449;
color: #fff;
}

.career-node.completed::after {
content: '‚≠ê‚≠ê‚≠ê';
position: absolute;
top: -15px;
left: 50%;
transform: translateX(-50%);
font-size: 0.8rem;
width: 100%;
text-align: center;
text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

/* Mevcut Seviye (Aktif) */
.career-node.current {
background: linear-gradient(135deg, #f1c40f, #e67e22);
border-bottom-color: #d35400;
transform: scale(1.15);
z-index: 5;
box-shadow: 0 0 25px rgba(241, 196, 15, 0.6);
animation: bounceNode 2s infinite ease-in-out;
}

@keyframes bounceNode {

0%,
100% {
transform: scale(1.15);
}

50% {
transform: scale(1.2) translateY(-5px);
}
}

/* Baƒülantƒ± Yolu (Kesik √áizgiler) */
.path-dots {
position: absolute;
width: 60px;
height: 80px;
/* Y√ºkseklik d√ºƒü√ºmler arasƒ± mesafe kadar */
pointer-events: none;
z-index: 1;
}

/* Yolun ≈üekli SVG ile JS tarafƒ±nda √ßizilecek, burasƒ± container */

/* Seviye Bilgisi (Baloncuk) */
.career-label {
position: absolute;
bottom: -25px;
background: rgba(0, 0, 0, 0.7);
color: #fff;
padding: 3px 10px;
border-radius: 10px;
font-size: 0.7rem;
white-space: nowrap;
font-weight: bold;
backdrop-filter: blur(4px);
}

/* --- KARƒ∞YER RAKƒ∞PLER Lƒ∞STESƒ∞ (STƒ∞L) --- */
.career-rivals {
position: absolute;
top: 50%;
transform: translateY(-50%);
background: rgba(255, 255, 255, 0.95);
padding: 6px 10px;
border-radius: 8px;
font-size: 0.65rem;
color: #333;
box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
min-width: 90px;
max-width: 120px;
z-index: 10;
line-height: 1.3;
border: 1px solid rgba(0, 0, 0, 0.1);
display: flex;
flex-direction: column;
pointer-events: none;
}

.career-rivals b {
color: #d35400;
display: block;
margin-bottom: 3px;
font-size: 0.6rem;
border-bottom: 1px solid #eee;
text-transform: uppercase;
letter-spacing: 1px;
}

.rivals-left {
right: 50%;
margin-right: 55px;
text-align: right;
align-items: flex-end;
}

.rivals-left::after {
content: '';
position: absolute;
top: 50%;
right: -6px;
transform: translateY(-50%);
border-width: 6px 0 6px 6px;
border-style: solid;
border-color: transparent transparent transparent rgba(255, 255, 255, 0.95);
}

.rivals-right {
left: 50%;
margin-left: 55px;
text-align: left;
align-items: flex-start;
}

.rivals-right::after {
content: '';
position: absolute;
top: 50%;
left: -6px;
transform: translateY(-50%);
border-width: 6px 6px 6px 0;
border-style: solid;
border-color: transparent rgba(255, 255, 255, 0.95) transparent transparent;
}

/* --- KARƒ∞YER √ñD√úL SANDIKLARI (CAREER CHESTS) --- */
.career-chest {
position: absolute;
right: -15px;
top: -15px;
font-size: 1.5rem;
cursor: pointer;
z-index: 10;
transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.3));
}

.career-chest.claimable {
animation: chestGlow 2s infinite, shake 1s infinite;
}

.career-chest.claimed {
filter: grayscale(1) opacity(0.5);
cursor: default;
}

@keyframes chestGlow {

0%,
100% {
filter: drop-shadow(0 0 5px #f1c40f);
transform: scale(1);
}

50% {
filter: drop-shadow(0 0 20px #f1c40f);
transform: scale(1.2);
}
}

.chest-reward-badge {
position: absolute;
top: -8px;
right: -8px;
background: linear-gradient(135deg, #f1c40f, #fa8231);
color: #000;
font-size: 0.5rem;
padding: 2px 5px;
border-radius: 8px;
font-weight: 900;
border: 1px solid #fff;
box-shadow: 0 2px 8px rgba(255, 215, 0, 0.4);
white-space: nowrap;
animation: badgeGlow 2s infinite alternate;
}

@keyframes badgeGlow {
from {
box-shadow: 0 0 2px #f1c40f;
}

to {
box-shadow: 0 0 8px #fa8231;
}
}

.career-chest:hover {
transform: translateY(-5px) scale(1.1);
}

/* CRITICAL FIX FOR CHAMPION DISPLAY */
.mini-stat-val {
display: flex !important;
flex-direction: column !important;
align-items: flex-end !important;
justify-content: center !important;
text-align: right !important;
line-height: 1.1 !important;
width: 100% !important;
max-width: 130px !important;
position: relative !important;
z-index: 9999 !important;
overflow: visible !important;
}

.stat-user-line {
font-size: 0.85rem !important;
font-weight: 800 !important;
color: #fff !important;
text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8) !important;
white-space: normal !important;
word-break: break-word !important;
line-height: 1 !important;
position: relative !important;
z-index: 9999 !important;
display: block !important;
}

/* LANDSCAPE WARNING OVERLAY */
#landscape-warning {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100vw;
height: 100vh;
background: #000;
color: #fff;
z-index: 999999;
flex-direction: column;
align-items: center;
justify-content: center;
text-align: center;
padding: 20px;
}

@media screen and (orientation: landscape) {
body.mobile-app #landscape-warning {
display: flex;
}

body.mobile-app>*:not(#landscape-warning) {
display: none !important;
}
}

/* PET WALKER (if enabled) - keep visible in top bar */
.pet-walker {
position: absolute;
top: 10px;
left: 160px;
width: 80px;
height: 80px;
z-index: 50;
cursor: pointer;
user-select: none;
}

@keyframes petWalk {
0% {
transform: translateY(0) rotate(0deg);
}

25% {
transform: translateY(-5px) rotate(5deg);
}

50% {
transform: translateY(0) rotate(0deg);
}

75% {
transform: translateY(-5px) rotate(-5deg);
}

100% {
transform: translateY(0) rotate(0deg);
}
}

.pet-walker-v2 {
width: 100%;
height: 100%;
object-fit: contain;
/* 3D G√ñR√úN√úM ƒ∞√áƒ∞N Fƒ∞LTRELER */
filter: drop-shadow(0 10px 10px rgba(0, 0, 0, 0.4)) contrast(1.15) saturate(1.2);
/* Hafif arkaya yatƒ±rarak 3D hissi ver */
transform-style: preserve-3d;
backface-visibility: hidden;
will-change: transform;
z-index: 2;
position: relative;
}



/* --- PET SPRITE ENGINE V4 (WebView-safe) --- */
.pet-sprite {
width: 100%;
height: 100%;
background-repeat: no-repeat;
background-position: 0 0;
image-rendering: auto;
will-change: background-position, transform;
filter: drop-shadow(0 10px 10px rgba(0, 0, 0, 0.4)) contrast(1.15) saturate(1.2);
transform-style: preserve-3d;
backface-visibility: hidden;
position: relative;
z-index: 2;
}

.pet-sprite-layer {
position: absolute;
inset: 0;
pointer-events: none;
}

.pet-debug-badge {
position: absolute;
top: -14px;
left: 50%;
transform: translateX(-50%);
font-size: 10px;
padding: 2px 6px;
border-radius: 8px;
background: rgba(0, 0, 0, 0.55);
color: #fff;
z-index: 99;
white-space: nowrap;
}

@media (prefers-reduced-motion: reduce) {

.pet-sprite,
.pet-walker-v2,
.pet-shadow {
animation: none !important;
}
}

/* GER√áEK√áƒ∞ G√ñLGE */
.pet-shadow {
position: absolute;
bottom: -5px;
left: 50%;
transform: translateX(-50%);
width: 40px;
height: 10px;
background: radial-gradient(ellipse at center, rgba(0, 0, 0, 0.6) 0%, rgba(0, 0, 0, 0) 70%);
border-radius: 50%;
z-index: 1;
animation: shadowPulse 2s infinite ease-in-out;
opacity: 0.7;
}

@keyframes shadowPulse {

0%,
100% {
transform: translateX(-50%) scale(1);
opacity: 0.7;
}

50% {
transform: translateX(-50%) scale(0.8);
opacity: 0.4;
}
}

/* --- 3D WALK (Cats, Dogs, Foxes) --- */
.anim-walk {
animation: walk3D 4s ease-in-out infinite;
transform-origin: bottom center;
}

@keyframes walk3D {
0% {
transform: translateY(0) scaleX(1) rotateZ(0deg);
}

10% {
transform: translateY(-5px) scaleX(1) rotateZ(2deg);
}

20% {
transform: translateY(0) scaleX(1) rotateZ(0deg);
}

30% {
transform: translateY(-5px) scaleX(1) rotateZ(-2deg);
}

40% {
transform: translateY(0) scaleX(1) rotateZ(0deg);
}

50% {
transform: translateY(0) scaleX(1);
}

60% {
transform: translateY(-5px) scaleX(1) rotateZ(2deg);
}

70% {
transform: translateY(0) scaleX(1) rotateZ(0deg);
}

80% {
transform: translateY(-5px) scaleX(1) rotateZ(-2deg);
}

90% {
transform: translateY(0) scaleX(1) rotateZ(0deg);
}

100% {
transform: translateY(0) scaleX(1);
}
}

/* --- HEAVY WALK 3D (Turtle) --- */
.anim-heavy {
animation: heavy3D 8s ease-in-out infinite;
}

@keyframes heavy3D {

0%,
100% {
transform: scaleX(1);
}

50% {
transform: scaleX(1);
}
}

/* --- HOP 3D (Mouse) --- */
.anim-hop {
animation: hop3D 3s ease-in-out infinite;
}

@keyframes hop3D {

0%,
100% {
transform: translateY(0) scale(1, 1);
}

10% {
transform: translateY(-15px) scale(0.9, 1.1);
}

20% {
transform: translateY(0) scale(1.1, 0.9);
}

30% {
transform: translateY(-15px) scale(0.9, 1.1);
}

40% {
transform: translateY(0) scale(1, 1);
}

50% {
transform: translateY(0) scaleX(1);
}

60% {
transform: translateY(-15px) scaleX(1);
}

80% {
transform: translateY(-15px) scaleX(1);
}

90% {
transform: translateY(0) scaleX(1);
}
}

/* --- SWIM/FLOAT 3D (Fish) --- */
.anim-float {
animation: float3D 6s ease-in-out infinite;
}

@keyframes float3D {

0%,
100% {
transform: translateY(0) rotateZ(0deg);
}

25% {
transform: translateY(-8px) rotateZ(5deg);
}

50% {
transform: translateY(0) rotateZ(0deg);
}

75% {
transform: translateY(8px) rotateZ(-5deg);
}
}

/* --- FLY 3D (Birds) --- */
.anim-fly {
animation: fly3D 5s ease-in-out infinite;
}

@keyframes fly3D {
0% {
transform: translateY(5px) scaleX(1);
}

50% {
transform: translateY(-15px) scaleX(1);
}

100% {
transform: translateY(5px) scaleX(1);
}
}

.pet-hunger-float {
position: absolute;
top: -15px;
left: 50%;
transform: translateX(-50%);
background: linear-gradient(135deg, #2d3436, #000000);
color: #2ecc71;
padding: 3px 8px;
border-radius: 8px;
font-size: 0.65rem;
font-weight: 800;
white-space: nowrap;
z-index: 15;
pointer-events: none;
border: 1px solid rgba(255, 255, 255, 0.4);
box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
letter-spacing: 0.5px;
}

/* --- LANDSCAPE LOCK (ZORUNLU Dƒ∞K MOD) --- */
#landscape-warning {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100vw;
height: 100vh;
background-color: #000;
color: #fff;
z-index: 999999;
flex-direction: column;
align-items: center;
justify-content: center;
text-align: center;
}

/* === CONFETTI STABILITY FIX (prevents flicker/shake on some Android WebViews) === */
#confettiCanvas {
    position: fixed;
    inset: 0;
    width: 100vw;
    height: 100vh;
    pointer-events: none;
    z-index: 9998;
}
@media (prefers-reduced-motion: reduce) {
    #confettiCanvas { display: none !important; }
}

/* --- PIGGY BANK WIN OVERLAY --- */
/* === PIGGY BANK STYLES === */
.piggy-container {
    position: relative;
    background: linear-gradient(135deg, #2d3436, #000);
    border: 3px solid var(--gold);
    border-radius: 25px;
    padding: 40px 30px;
    width: 90%;
    max-width: 400px;
    text-align: center;
    box-shadow: 0 20px 60px rgba(0,0,0,0.8);
    display: flex;
    flex-direction: column;
    align-items: center;
}
.piggy-icon {
    font-size: 5rem;
    margin-bottom: 10px;
    filter: drop-shadow(0 5px 15px rgba(241, 196, 15, 0.6));
}
.piggy-glow {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 200px; height: 200px;
    background: radial-gradient(circle, rgba(241, 196, 15, 0.3), transparent);
    border-radius: 50%;
    pointer-events: none;
    z-index: 0;
}
.piggy-title {
    color: var(--gold);
    font-size: 2rem;
    margin: 10px 0;
    text-shadow: 0 2px 10px rgba(241, 196, 15, 0.8);
    z-index: 1;
}
.piggy-amount {
    font-size: 2.5rem;
    font-weight: 900;
    color: #fff;
    margin: 15px 0;
    text-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
    z-index: 1;
}
.piggy-fill-container {
    width: 100%;
    height: 12px;
    background: rgba(255,255,255,0.2);
    border-radius: 10px;
    overflow: hidden;
    margin-top: 20px;
    box-shadow: inset 0 2px 5px rgba(0,0,0,0.3);
    z-index: 1;
}
.piggy-fill-bar {
    height: 100%;
    background: linear-gradient(90deg, #f1c40f, #f39c12, #e67e22);
    width: 0%;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(241, 196, 15, 0.8);
    transition: width 1s ease-out;
}
.coin-drop-layer {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
    z-index: 10;
}
.coin-particle {
    position: absolute;
    font-size: 2rem;
    animation: coinFall 0.8s ease-in forwards;
    filter: drop-shadow(0 2px 5px rgba(241, 196, 15, 0.6));
}
@keyframes coinFall {
    0% { opacity: 1; transform: translateY(0) rotate(0deg); }
    100% { opacity: 0; transform: translateY(200px) rotate(720deg); }
}

.piggy-overlay {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.85);
    z-index: 5000;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.5s ease-in-out;
}
.piggy-overlay.show {
    display: flex;
    opacity: 1;
}

/* WORD GAME STYLES - 3D ENHANCED */

/* 3D Tahmin Kutucuklarƒ± */
.word-cell {
    width: auto;
    aspect-ratio: 1/1;
    max-width: 55px; max-height: 55px;
    border: none;
    display: flex; align-items: center; justify-content: center;
    font-size: calc(0.8rem + 1vw);
    font-weight: bold;
    text-transform: uppercase;
    background: linear-gradient(145deg, #ffffff, #e6e6e6);
    color: #333;
    border-radius: 12px;
    box-shadow: 
        0 4px 8px rgba(0,0,0,0.15),
        0 1px 3px rgba(0,0,0,0.1),
        inset 0 1px 0 rgba(255,255,255,0.8);
    transform: translateZ(0);
    transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    position: relative;
}

.word-cell::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    border-radius: 12px;
    background: linear-gradient(145deg, rgba(255,255,255,0.4), transparent);
    pointer-events: none;
}

.word-cell.filled { 
    box-shadow: 
        0 6px 12px rgba(0,0,0,0.2),
        0 2px 4px rgba(0,0,0,0.15),
        inset 0 1px 0 rgba(255,255,255,0.9);
    animation: popIn3D 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.word-cell.correct { 
    background: linear-gradient(145deg, #2ecc71, #27ae60);
    color: white; 
    box-shadow: 
        0 6px 15px rgba(46, 204, 113, 0.4),
        0 2px 5px rgba(0,0,0,0.2),
        inset 0 1px 0 rgba(255,255,255,0.3);
    animation: correctFlip 0.5s ease-out;
}

.word-cell.present { 
    background: linear-gradient(145deg, #f1c40f, #f39c12);
    color: white; 
    box-shadow: 
        0 6px 15px rgba(241, 196, 15, 0.4),
        0 2px 5px rgba(0,0,0,0.2),
        inset 0 1px 0 rgba(255,255,255,0.3);
    animation: presentFlip 0.5s ease-out;
}

.word-cell.absent { 
    background: linear-gradient(145deg, #7f8c8d, #616a6b);
    color: white; 
    box-shadow: 
        0 4px 8px rgba(127, 140, 141, 0.3),
        0 1px 3px rgba(0,0,0,0.15),
        inset 0 1px 0 rgba(255,255,255,0.2);
    animation: absentFlip 0.5s ease-out;
}

/* 3D Animasyonlar */
@keyframes popIn3D {
    0% { transform: scale(0.5) rotateX(-30deg); opacity: 0; }
    50% { transform: scale(1.1) rotateX(10deg); }
    100% { transform: scale(1) rotateX(0deg); opacity: 1; }
}

@keyframes correctFlip {
    0% { transform: rotateY(0deg) scale(1); }
    50% { transform: rotateY(90deg) scale(1.1); }
    100% { transform: rotateY(0deg) scale(1); }
}

@keyframes presentFlip {
    0% { transform: rotateX(0deg) scale(1); }
    50% { transform: rotateX(90deg) scale(1.1); }
    100% { transform: rotateX(0deg) scale(1); }
}

@keyframes absentFlip {
    0% { transform: scale(1); }
    50% { transform: scale(0.9); }
    100% { transform: scale(1); }
}

/* M√ºkemmel 3D Klavye */
#wordKeyboard {
    flex-shrink: 0;
    background: linear-gradient(145deg, #f5f5f5, #e0e0e0);
    padding: 12px 8px;
    border-radius: 20px;
    box-shadow: 
        0 8px 20px rgba(0,0,0,0.15),
        0 2px 8px rgba(0,0,0,0.1),
        inset 0 1px 0 rgba(255,255,255,0.8);
    max-width: 100%;
    overflow-x: hidden;
}

.kb-row {
    display: flex;
    justify-content: center;
    gap: 4px;
    margin-bottom: 6px;
}

/* ULTRA G√ñR√úN√úR KOYU KLAVYE - D√úZELTƒ∞LDƒ∞: Telefon ekranlarƒ±na uygun */
.key-btn {
    padding: 12px 4px;
    font-size: clamp(0.75rem, 3.5vw, 1rem);
    font-weight: 700;
    border: 2px solid #1a1a2e;
    border-radius: 8px;
    background: linear-gradient(180deg, #4a4a6a 0%, #2d2d44 50%, #1a1a2e 100%);
    color: #ffffff;
    min-width: 28px;
    min-height: 44px;
    cursor: pointer;
    box-shadow: 
        0 3px 0 #0d0d15,
        0 4px 8px rgba(0,0,0,0.4),
        inset 0 1px 0 rgba(255,255,255,0.15);
    flex: 1;
    transition: all 0.06s ease;
    text-shadow: 0 1px 2px rgba(0,0,0,0.8);
    position: relative;
    overflow: hidden;
    letter-spacing: 1px;
}

.key-btn::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 60%;
    background: linear-gradient(180deg, rgba(255,255,255,0.2), transparent);
    pointer-events: none;
    border-radius: 7px 7px 0 0;
}

.key-btn:active { 
    transform: translateY(3px);
    box-shadow: 
        0 2px 0 #0d0d15,
        0 4px 8px rgba(0,0,0,0.4),
        inset 0 2px 6px rgba(0,0,0,0.3);
}

.key-btn.special { 
    flex: 1.5; 
    background: linear-gradient(180deg, #5d6d7e 0%, #34495e 50%, #2c3e50 100%);
    color: #fff;
    border-color: #1a252f;
    box-shadow: 
        0 5px 0 #1a252f,
        0 8px 15px rgba(0,0,0,0.5),
        inset 0 1px 0 rgba(255,255,255,0.15);
    font-size: clamp(0.8rem, 3.5vw, 1rem);
    font-weight: 800;
}

.key-btn.special:active {
    box-shadow: 
        0 2px 0 #1a252f,
        0 4px 8px rgba(0,0,0,0.4),
        inset 0 2px 6px rgba(0,0,0,0.3);
}

.key-btn.correct { 
    background: linear-gradient(180deg, #27ae60 0%, #1e8449 50%, #145a32 100%);
    color: #ffffff;
    border-color: #0b3d1f;
    text-shadow: 0 2px 4px rgba(0,0,0,0.8);
    box-shadow: 
        0 5px 0 #0b3d1f,
        0 8px 20px rgba(39, 174, 96, 0.6),
        inset 0 1px 0 rgba(255,255,255,0.2);
}

.key-btn.correct:active {
    box-shadow: 
        0 2px 0 #0b3d1f,
        0 4px 10px rgba(39, 174, 96, 0.5),
        inset 0 2px 6px rgba(0,0,0,0.3);
}

.key-btn.present { 
    background: linear-gradient(180deg, #f39c12 0%, #d68910 50%, #9c640c 100%);
    color: #ffffff;
    border-color: #5a3d05;
    text-shadow: 0 2px 4px rgba(0,0,0,0.8);
    box-shadow: 
        0 5px 0 #5a3d05,
        0 8px 20px rgba(243, 156, 18, 0.6),
        inset 0 1px 0 rgba(255,255,255,0.2);
}

.key-btn.present:active {
    box-shadow: 
        0 2px 0 #5a3d05,
        0 4px 10px rgba(243, 156, 18, 0.5),
        inset 0 2px 6px rgba(0,0,0,0.3);
}

.key-btn.absent { 
    background: linear-gradient(180deg, #95a5a6 0%, #7f8c8d 50%, #616a6b 100%);
    color: #ecf0f1;
    border-color: #4a4a4a;
    box-shadow: 
        0 4px 0 #4a4a4a,
        inset 0 1px 0 rgba(255,255,255,0.2);
    opacity: 0.7;
}

/* Mobil i√ßin klavye optimizasyonu - D√úZELTƒ∞LDƒ∞ */
@media (max-width: 380px) {
    .key-btn {
        padding: 8px 2px;
        font-size: 0.7rem;
        min-width: 22px;
        min-height: 36px;
        border-radius: 6px;
    }
    .key-btn.special {
        font-size: 0.6rem;
        padding: 8px 3px;
    }
}

/* Ekstra k√º√ß√ºk ekranlar i√ßin */
@media (max-width: 320px) {
    .key-btn {
        padding: 6px 1px;
        font-size: 0.65rem;
        min-width: 20px;
        min-height: 32px;
    }
    .key-btn.special {
        font-size: 0.55rem;
        padding: 6px 2px;
    }
}

@keyframes popIn {
    0% { transform: scale(0.8); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}
</style>
</head>

<body>
    <div id="landscape-warning">
        <div style="font-size: 3rem;">üì±</div>
        <h2>L√ºtfen Telefonu √áevirin</h2>
        <p>Bu oyun sadece dik (portrait) modda oynanabilir.</p>
    </div>
    <div class="floating-numbers-container" id="bgAnim"></div>
    <div id="emojiLayer"></div>
    <div id="sabotageLayer" class="ink-blot"></div>

    <div id="loading"
        style="position:fixed;top:0;left:0;width:100%;height:100%;background:white;z-index:9999;display:flex;align-items:center;justify-content:center;flex-direction:column;color:#333;text-shadow:none;">
        <h2 style="color:#6c5ce7;font-size:2rem;">TahminSon</h2>
        <p style="color:#999;">v25.6 (ULTIMATE)</p>
        <div id="errorLog" style="color:red;font-size:0.7rem;margin-top:10px;"></div>
    </div>

    <div id="screen-login" class="screen" style="justify-content:center;padding:20px; z-index:5;">
        <div class="card">
            <h1 style="color:var(--primary);">TahminSon</h1>
            <div style="font-size:0.8rem; margin-bottom:10px;">üü¢ <span id="fakeOnlineCount">...</span> Ki≈üi Online
            </div>
            <div class="avatar-wrapper" id="avatarList">
                <div class="avatar-item selected"><img
                        src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Smilies/Smiling%20Face%20with%20Sunglasses.png">
                </div>
                <div class="avatar-item"><img
                        src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/People/Man%20Technologist.png">
                </div>
                <div class="avatar-item"><img
                        src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/People/Woman%20Technologist.png">
                </div>
                <div class="avatar-item"><img
                        src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/People/Ninja.png">
                </div>

                <div class="avatar-item"><img
                        src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Animals/Lion.png">
                </div>
                <div class="avatar-item"><img
                        src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Animals/Wolf.png">
                </div>
                <div class="avatar-item"><img
                        src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Animals/Panda.png">
                </div>
                <div class="avatar-item"><img
                        src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Animals/Cat%20Face.png">
                </div>


                <div class="avatar-item"><img
                        src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Smilies/Robot.png">
                </div>
                <div class="avatar-item"><img
                        src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Smilies/Alien%20Monster.png">
                </div>
                <div class="avatar-item"><img
                        src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Smilies/Clown%20Face.png">
                </div>
            </div>
            <input type="text" id="usernameInput" placeholder="Kullanƒ±cƒ± Adƒ±" maxlength="12" oninput="checkAdminPasswordField()">
            <input type="password" id="passwordInput" placeholder="≈ûifre (Sadece Admin)" maxlength="12" style="display:none;">
            
            <!-- Google Play Store Veri Payla≈üƒ±m Onayƒ± -->
            <div style="margin:15px 0; padding:10px; background:rgba(108,92,231,0.1); border-radius:10px; border:1px solid rgba(108,92,231,0.3);">
                <label style="display:flex; align-items:flex-start; gap:10px; cursor:pointer; text-align:left;">
                    <input type="checkbox" id="dataConsentCheckbox" style="width:auto; margin-top:3px;">
                    <span style="font-size:0.75rem; color:#555; line-height:1.4;">
                        <b>Google Play Store Gereklilikleri:</b><br>
                        Oyun verilerimin (kullanƒ±cƒ± adƒ±, skor, seviye) g√ºvenli bir ≈üekilde saklanmasƒ±nƒ± ve i≈ülenmesini kabul ediyorum. 
                        <a href="#" onclick="showPrivacyPolicy(); return false;" style="color:var(--primary);">Gizlilik Politikasƒ±</a>'nƒ± okudum.
                    </span>
                </label>
            </div>
            
            <button id="btnLogin" class="btn-blue" style="margin-top:10px;">OYUNA Gƒ∞R</button>
            <p style="font-size:0.75rem;color:#888; margin-top:10px;">ƒ∞lk giri≈üte ≈üifreniz otomatik olu≈üturulur.</p>
        </div>
    </div>

    <div id="screen-lobby" class="screen">

        <div id="marqueeArea">
            <marquee id="dynamicMarquee" scrollamount="6" style="width:100%;"></marquee>
        </div>

        <div class="top-bar">
            <div class="top-bar-row-main"
                style="display:flex; align-items:center; width:100%; padding:8px 15px; position:relative; overflow:hidden;">

                <div class="user-info" onclick="openUserProfile(user.name)"
                    style="cursor:pointer; display:flex; align-items:center; gap:8px;">
                    <div id="lobbyAvatarDisplay"
                        style="width:45px; height:45px; font-size:1.8rem; display:flex; align-items:center; justify-content:center; flex-shrink:0;">
                        üòé</div>
                    <div style="line-height:1.1;">
                        <div id="lobbyName" style="font-weight:bold; font-size:0.95rem; color:#2d3436;">Kullanƒ±cƒ±</div>
                        <div style="font-size:0.65rem; color:#888; font-weight:600;">
                            Lv. <span id="userLevelDisplay">1</span> <span id="lobbyClanTag"
                                style="color:#e17055;"></span>
                        </div>
                    </div>
                </div>

                <div style="display:flex; align-items:center; margin-left: auto;">
                    <div id="lobbyPetWalker"
                        style="margin-right: 10px; position: relative; height: 60px; width: 60px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
                        <div id="petVisualContainer"
                            style="width:48px; height:48px; overflow:visible; position:relative; display:flex; align-items:center; justify-content:center;">
                            <!-- Pet Image: Initial class 'anim-idle-breath' -->
                            <img id="petMainImage" src="assets/pet_cat_3d.png" class="anim-idle-breath"
                                style="width:100%; height:100%; object-fit:contain; filter:drop-shadow(0 4px 6px rgba(0,0,0,0.3)); will-change: transform;">
                        </div>
                        <style>
                            /* Idle Breath (Default) */
                            @keyframes pet-idle-breath {
                                0% {
                                    transform: scale(1);
                                }

                                50% {
                                    transform: scale(1.05);
                                }

                                100% {
                                    transform: scale(1);
                                }
                            }

                            /* Happy Bounce */
                            @keyframes pet-anim-bounce {

                                0%,
                                100% {
                                    transform: translateY(0) scale(1, 1);
                                }

                                30% {
                                    transform: translateY(-15px) scale(0.9, 1.1);
                                }

                                50% {
                                    transform: translateY(0) scale(1.1, 0.9);
                                }

                                70% {
                                    transform: translateY(-8px) scale(0.95, 1.05);
                                }
                            }

                            /* Curious Wobble */
                            @keyframes pet-anim-wobble {
                                0% {
                                    transform: rotate(0deg);
                                }

                                25% {
                                    transform: rotate(-5deg);
                                }

                                75% {
                                    transform: rotate(5deg);
                                }

                                100% {
                                    transform: rotate(0deg);
                                }
                            }

                            /* Alert Shake */
                            @keyframes pet-anim-shake {
                                0% {
                                    transform: translateX(0);
                                }

                                25% {
                                    transform: translateX(-3px);
                                }

                                75% {
                                    transform: translateX(3px);
                                }

                                100% {
                                    transform: translateX(0);
                                }
                            }

                            .anim-idle-breath {
                                animation: pet-idle-breath 3s ease-in-out infinite;
                            }

                            .anim-bounce {
                                animation: pet-anim-bounce 0.8s ease-out;
                            }

                            .anim-wobble {
                                animation: pet-anim-wobble 1s ease-in-out;
                            }

                            .anim-shake {
                                animation: pet-anim-shake 0.5s ease-in-out;
                            }
                        </style>
                        <div id="petEnergyBadge"
                                style="font-size: 0.6rem; background: #2ecc71; color: white; padding: 1px 4px; border-radius: 4px; margin-top: -5px; z-index: 2;">
                                100%</div>
                    </div>
                    <!-- LOBBY FEED BUTTON -->
                    <button id="btnLobbyFeed" class="btn-green" onclick="PetSystem.feedPet()"
                        style="display:none; width:auto; padding:2px 8px; margin:0 5px 0 0; font-size:0.7rem; border-radius:8px; animation: pulse-active 1s infinite;">
                        üçñ BESLE
                    </button>
                    <div id="btnMute" class="currency-pill" onclick="toggleMute()"
                        style="background:#fff; color:#333; margin-right:5px; cursor:pointer; padding:4px 8px; border-radius:12px; font-weight:bold; font-size:1rem; border:1px solid #ddd; display:flex; align-items:center; justify-content:center;">
                        üîä
                    </div>
                    <div id="btnNewMsg" class="currency-pill" onclick="openLastMessage()"
                        style="display:none; background:#ff4757; color:#fff; margin-right:8px; cursor:pointer; animation: pulse-active 1s infinite; padding:4px 8px; border-radius:12px; font-weight:bold; font-size:0.7rem;">
                        <span>üì©</span>
                    </div>
                    <div class="currency-pill"
                        style="background:#f1c40f; color:#000; padding:4px 10px; border-radius:15px; font-weight:bold; display:flex; align-items:center; gap:4px; font-size:0.9rem; border:1px solid rgba(0,0,0,0.05);">
                        <span>üí∞</span> <span id="lobbyGold">0</span>
                    </div>
                </div>
            </div>

            <div class="top-bar-row-stats">
                <div id="dailyWinnerDisplay" class="mini-stat-pill pill-winner">
                    <div class="mini-stat-left">
                        <span style="font-size:1rem;">üèÜ</span>
                        <span class="mini-stat-title">≈ûAMPƒ∞YON</span>
                    </div>
                    <div class="mini-stat-val">
                        <span id="dwScore" class="stat-score-line" style="color:#fff; font-size:0.9rem;">0 üí∞</span>
                        <span id="dwUser" class="stat-user-line" style="font-size:0.75rem;">Yok</span>
                    </div>
                </div>

                <div id="speedrunBox" class="mini-stat-pill pill-speed">
                    <div class="mini-stat-left">
                        <span style="font-size:1rem;">‚ö°</span>
                        <span id="srTitle" class="mini-stat-title">REKOR</span>
                    </div>
                    <div class="mini-stat-val">
                        <span id="srTime" class="stat-score-line" style="color:#fff; font-size:0.9rem;"></span>
                        <span id="srUser" class="stat-user-line" style="font-size:0.75rem;">Yok</span>
                    </div>
                </div>
            </div>

            <div class="header-xp-container">
                <div id="xpBarFill" class="header-xp-fill"></div>
            </div>
            <span id="xpText" style="display:none;"></span>
        </div>

        <div class="hero-section">

            <div class="play-container" style="margin-bottom: 20px;">
                <div class="play-ring"></div>
                <div class="play-btn-huge" onclick="openGameSelector()">
                    <div class="play-content">
                        <div class="play-icon">‚ñ∂</div>
                        <div class="play-text">OYNA</div>
                    </div>
                </div>
            </div>

            <div id="dailyQuestBox" class="quest-box" style="width:100%; max-width:350px; margin-bottom: 15px;">
                <div style="display:flex;justify-content:space-between;align-items:center;">
                    <div><b style="color:#d35400;">üî• G√úNL√úK SERƒ∞:</b> <span id="questText">√úst √ºste 3 oyun
                            kazan!</span>
                    </div>
                    <button id="btnClaimQuest" class="btn-gold"
                        style="width:auto;padding:5px 10px;margin:0;display:none;" onclick="claimQuestReward()">1000 üí∞
                        AL</button>
                </div>
                <div style="margin-top:5px;font-size:0.75rem;color:#666;display:flex;justify-content:space-between;">
                    <span>Durum: <b id="questProgress">0/3</b></span>
                </div>
                <div class="quest-bar-bg">
                    <div id="questBarFill" class="quest-bar-fill"></div>
                </div>
            </div>


        <div style="display:flex; gap:10px; width:100%; max-width:350px; margin-bottom:20px;">
            <button class="btn-green"
                style="flex:1; background:linear-gradient(135deg, #00b894, #00cec9); border:2px solid #fff; height:60px; font-size:1.1rem; margin-bottom:20px; box-shadow: 0 5px 15px rgba(0, 184, 148, 0.4); position:relative; padding-right:40px;"
                onclick="openCareerMap()">
                <span style="display:flex; align-items:center; justify-content:center; width:100%;">üó∫Ô∏è KARƒ∞YER (SAYI)</span>
                <span onclick="event.stopPropagation(); showModal('modal-career-info');" style="position:absolute; right:8px; top:50%; transform:translateY(-50%);
                 width:24px; height:24px; border-radius:50%;
                 background:rgba(255,255,255,0.9); color:#00b894; font-size:14px;
                 display:flex; align-items:center; justify-content:center;
                 font-weight:bold; cursor:pointer; box-shadow:0 2px 5px rgba(0,0,0,0.2); z-index:10;">
                    ?
                </span>
            </button>

            <button class="btn-purple" style="flex:1; background:linear-gradient(135deg, #8e44ad, #9b59b6); border:2px solid #fff; height:60px; font-size:0.9rem; box-shadow: 0 5px 15px rgba(142, 68, 173, 0.4); position:relative;" onclick="openWordCareer()">
                üìö KARƒ∞YER (KELƒ∞ME)
                <span onclick="event.stopPropagation(); showModal('modal-word-info');" style="position:absolute; right:5px; top:5px; width:18px; height:18px; border-radius:50%; background:#fff; color:#8e44ad; font-size:12px; display:flex; align-items:center; justify-content:center; font-weight:bold;">?</span>
            </button>

        </div>

            <div style="position:relative; width:100%; max-width:350px; margin-top:10px;">
                <button id="btnBountyLobby" class="btn-gold" style="width:100%; background:linear-gradient(135deg, #f39c12, #d35400); border:1px solid #fff; color:white; text-shadow:0 1px 2px rgba(0,0,0,0.3);" onclick="openBountyScreen()">
                    ü§† √ñD√úL AVCILARI
                </button>
                <div onclick="event.stopPropagation(); showModal('modal-bounty-info');" style="position:absolute; right:12px; top:50%; transform:translateY(-50%); width:22px; height:22px; border-radius:50%; background:#0984e3; color:white; font-size:14px; display:flex; align-items:center; justify-content:center; font-weight:bold; cursor:pointer; z-index:5;">
                    ?
                </div>
            </div>




            <div id="goldRainBadge" class="gold-rain-active" style="width:100%; max-width:350px;">üåßÔ∏è ALTIN YAƒûMURU
                AKTƒ∞F!
                (x2 KAZAN√á) üí∞</div>



            <div class="card"
                style="width:100%; max-width:350px; box-sizing:border-box; padding:10px; margin-top:10px;">
                <h4 style="margin:0 0 10px 0; color:#eee;">üü¢ Aktif Oyuncular</h4>
                <div id="activePlayersList" class="list-container" style="height:100px;"></div>
            </div>



            <button id="btnAdminPanel" class="btn-dark"
                style="display:none; width:auto; padding:5px 10px; font-size:0.7rem; margin-top:10px;"
                onclick="changeScreen('screen-admin')">üëë Y√∂netim</button>

            <!-- Banner Ad Container -->
            <div id="bannerAdContainer"
                style="width:100%; min-height:60px; display:flex; justify-content:center; align-items:center; background:rgba(0,0,0,0.02); margin-top:10px; border-top: 1px solid #eee; padding-top: 10px;">
                <!-- Native Banner Ad (Filled by AdManager) -->
                <div id="yandex-banner-ad" style="width:100%; max-width:728px; text-align:center;">
                    <!-- Native Ad Will Be Injected Here -->
                </div>
            </div>

        </div>
        <!-- 3D Alt Navigasyon Barƒ± -->
        <div class="bottom-nav-3d">
            <div class="nav-item-3d active" onclick="showSection('home')">
                <div class="nav-icon-3d">üè†</div>
                <div class="nav-label-3d">Ana Sayfa</div>
            </div>
            <div class="nav-item-3d" onclick="openMarket()">
                <div class="nav-icon-3d">üõí</div>
                <div class="nav-label-3d">Market</div>
            </div>
            <div class="nav-item-3d" onclick="openInboxModal()">
                <div class="nav-icon-3d" style="position:relative;">üí¨
                    <div id="msgBadge" class="msg-badge-3d"></div>
                </div>
                <div class="nav-label-3d">Mesajlar</div>
            </div>
            <div class="nav-item-3d" onclick="openInventory()">
                <div class="nav-icon-3d">üéí</div>
                <div class="nav-label-3d">√áanta</div>
            </div>
            <div class="nav-item-3d" onclick="showLeaderboard()">
                <div class="nav-icon-3d">üèÜ</div>
                <div class="nav-label-3d">Sƒ±ralama</div>
            </div>
            <div class="nav-item-3d" onclick="showModal('modal-more')">
                <div class="nav-icon-3d">üçî</div>
                <div class="nav-label-3d">Diƒüer</div>
            </div>
        </div>

        <style>
            /* Ultra 3D Alt Navigasyon Barƒ± */
            .bottom-nav-3d {
                display: flex;
                justify-content: space-around;
                align-items: center;
                padding: 8px 5px 12px 5px;
                background: linear-gradient(180deg, 
                    rgba(255,255,255,0.95) 0%, 
                    rgba(245,247,250,0.98) 50%,
                    rgba(235,238,242,1) 100%);
                box-shadow: 
                    0 -8px 32px rgba(0,0,0,0.12),
                    0 -2px 8px rgba(0,0,0,0.05),
                    inset 0 1px 0 rgba(255,255,255,0.8);
                border-top: 1px solid rgba(0,0,0,0.06);
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                z-index: 1000;
            }

            .bottom-nav-3d::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 1px;
                background: linear-gradient(90deg, 
                    transparent 0%, 
                    rgba(108,92,231,0.3) 20%, 
                    rgba(108,92,231,0.5) 50%, 
                    rgba(108,92,231,0.3) 80%, 
                    transparent 100%);
            }

            .nav-item-3d {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                padding: 6px 8px;
                border-radius: 16px;
                cursor: pointer;
                transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
                position: relative;
                min-width: 50px;
            }

            .nav-item-3d::before {
                content: '';
                position: absolute;
                inset: 0;
                border-radius: 16px;
                background: linear-gradient(135deg, 
                    rgba(108,92,231,0) 0%, 
                    rgba(162,155,254,0) 100%);
                opacity: 0;
                transition: all 0.3s ease;
            }

            .nav-item-3d.active::before {
                background: linear-gradient(135deg, 
                    rgba(108,92,231,0.15) 0%, 
                    rgba(162,155,254,0.1) 100%);
                opacity: 1;
            }

            .nav-item-3d.active {
                transform: translateY(-4px);
            }

            .nav-item-3d:active {
                transform: scale(0.92) translateY(2px);
            }

            .nav-icon-3d {
                font-size: 1.7rem;
                margin-bottom: 3px;
                transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
                filter: drop-shadow(0 3px 6px rgba(0,0,0,0.15));
                transform-style: preserve-3d;
            }

            .nav-item-3d.active .nav-icon-3d {
                transform: translateY(-3px) scale(1.15);
                filter: drop-shadow(0 6px 12px rgba(108,92,231,0.4));
            }

            .nav-item-3d:hover .nav-icon-3d {
                transform: translateY(-2px) scale(1.08);
            }

            .nav-label-3d {
                font-size: 0.65rem;
                font-weight: 600;
                color: #7f8c8d;
                transition: all 0.3s ease;
                text-shadow: 0 1px 2px rgba(0,0,0,0.05);
                letter-spacing: 0.3px;
            }

            .nav-item-3d.active .nav-label-3d {
                color: #6c5ce7;
                font-weight: 700;
                text-shadow: 0 1px 3px rgba(108,92,231,0.2);
            }

            .msg-badge-3d {
                display: none;
                position: absolute;
                top: -6px;
                right: -8px;
                width: 16px;
                height: 16px;
                background: linear-gradient(135deg, #ff4757, #ff6b81);
                border-radius: 50%;
                border: 2px solid #fff;
                box-shadow: 0 3px 8px rgba(255,71,87,0.4);
                animation: badgePulse 2s infinite;
            }

            @keyframes badgePulse {
                0%, 100% { transform: scale(1); }
                50% { transform: scale(1.1); }
            }

            /* Glow efekti aktif item i√ßin */
            .nav-item-3d.active::after {
                content: '';
                position: absolute;
                bottom: -2px;
                left: 50%;
                transform: translateX(-50%);
                width: 20px;
                height: 3px;
                background: linear-gradient(90deg, #6c5ce7, #a29bfe);
                border-radius: 2px;
                box-shadow: 0 2px 8px rgba(108,92,231,0.5);
            }
        </style>

        <div id="toast"></div>
    </div>
    <div id="screen-bounty" class="screen">
        <div class="card" style="height: 100%; display: flex; flex-direction: column;">
            <div style="flex-shrink: 0;">
                <button class="nav-btn" onclick="changeScreen('screen-lobby')">‚¨Ö</button>
                <h2 style="color:#d35400; text-align: center; margin-top: 5px;">ü§† √ñD√úL AVCILARI</h2>

                <div style="display:flex; gap:10px; margin-bottom:15px; background: rgba(0,0,0,0.05); padding: 5px; border-radius: 12px;">
                    <button id="tabBountyList" class="btn-blue" onclick="switchBountyTab('list')" style="font-size:0.85rem; flex: 1;">üéØ AKTƒ∞F ƒ∞LANLAR</button>
                    <button id="tabBountyCreate" class="btn-grey" onclick="switchBountyTab('create')" style="font-size:0.85rem; flex: 1;">üìù ƒ∞LAN OLU≈ûTUR</button>
                    <button class="btn-gold" onclick="showModal('modal-bounty-info')" style="width:auto; padding:5px 12px; font-size: 1.2rem;">‚ùì</button>
                </div>
            </div>

            <div id="bountyListArea" style="flex: 1; overflow-y: auto; padding-bottom: 20px;">
                <p style="font-size:0.8rem; color:#666; text-align: center; margin-bottom:10px;">
                    Bir ilanƒ± se√ß ve √∂d√ºl√º kazan!<br>
                    <small>Kazanamazsan giri≈ü √ºcreti ilan sahibine gider.</small>
                </p>
                <div id="bountyListContainer" class="list-container" style="max-height:none; overflow: visible;">Y√ºkleniyor...</div>
            </div>

            <div id="bountyCreateArea" style="display:none; text-align:left; flex: 1; overflow-y: auto;">
                <div style="background:rgba(255,255,255,0.8); padding:15px; border-radius:15px; border: 1px solid #ddd; box-shadow: 0 5px 15px rgba(0,0,0,0.05);">
                    <h4 style="margin: 0 0 10px 0; color: var(--primary);">Yeni Av Ba≈ülat</h4>

                    <label style="font-size:0.8rem; font-weight:bold; color:#555;">1. Zorluk Se√ß:</label>
                    <select id="bountyDiffSelect" style="width:100%; margin:5px 0 15px 0; padding:12px; border-radius:10px; border:2px solid #eee; font-weight:bold;" onchange="updateBountyInputRules(this.value)">
                        <option value="4">4 Hane (Normal)</option>
                        <option value="5">5 Hane (Zor)</option>
                        <option value="6">6 Hane (√áok Zor)</option>
                        <option value="7">7 Hane (ƒ∞mkansƒ±z)</option>
                    </select>

                    <label style="font-size:0.8rem; font-weight:bold; color:#555;">2. Gizli Sayƒ± Belirle:</label>
                    <input type="tel" id="bountySecretInput" placeholder="√ñrn: 1234" maxlength="4" style="letter-spacing:5px; font-size: 1.2rem; text-align:center;">
                    <small style="color:#999; display:block; margin-top:-5px; margin-bottom: 15px;">Rakamlarƒ± birbirinden farklƒ± olmalƒ±.</small>

                    <label style="font-size:0.8rem; font-weight:bold; color:#555;">3. √ñd√ºl Miktarƒ± (Altƒ±n):</label>
                    <div style="display:flex; gap:10px; align-items: center;">
                        <input type="number" id="bountyRewardInput" placeholder="Min: 100" style="margin:0;">
                        <span style="font-size:1.5rem;">üí∞</span>
                    </div>

                    <div style="margin-top:15px; padding:10px; background:#fff3cd; border-radius:8px; font-size:0.75rem; color:#856404; border: 1px solid #ffeeba;">
                        üí° <b>Kazan√ß Sistemi:</b><br>
                        ‚Ä¢ ƒ∞lan verirken √∂d√ºl hesabƒ±ndan d√º≈üer.<br>
                        ‚Ä¢ Avcƒ±lar ba≈üarƒ±sƒ±z olursa, √∂dedikleri giri≈ü √ºcreti (%10) <b>SANA GELƒ∞R.</b>
                    </div>
                </div>
                <button class="btn-green" onclick="postBounty()" style="margin-top:15px; padding: 15px; font-size: 1rem;">ƒ∞LAN YAYINLA</button>
            </div>
        </div>
    </div>
    <div id="screen-word-game" class="screen">
        <div class="card" style="height: 100%; display: flex; flex-direction: column;">
            <div style="flex-shrink: 0; display:flex; align-items:center; justify-content:space-between; margin-bottom:15px;">
                <button class="nav-btn" style="position:static; margin:0;" onclick="attemptExit()">‚¨Ö</button>
                <div style="text-align:center;">
                    <h3 style="margin:0; color:#8e44ad;">KELƒ∞ME HAZƒ∞NESƒ∞</h3>
                    <small id="wordLevelDisplay" style="color:#666;">Seviye 1</small><div id="wordTimerDisplay" style="color:#e74c3c; font-weight:bold; font-size:0.9rem; display:none;">00:00</div>
                </div>
                <button id="btnWordChat" class="nav-btn" style="position:static; margin:0; font-size:1rem; background:#3498db; display:none;" onclick="toggleGameChat()">üí¨</button>
            </div>


            <!-- Helper Items -->
            <div class="item-bar" style="margin-bottom:10px;">
                <button class="item-btn" onclick="useItem('oracle')">üîÆ Harf A√ß<div id="qty-oracle-word" class="item-count">0</div></button>
                <button class="item-btn" onclick="useItem('freeze')">‚ùÑÔ∏è Zaman<div id="qty-freeze-word" class="item-count">0</div></button>
            </div>
            <!-- Game Board -->
            <div id="wordGameBoardContainer" style="flex:1; display:flex; justify-content:center; align-items:flex-start; overflow-y:auto; padding-top:20px; padding-bottom:100px;">
                <div id="wordGameBoard" style="display:grid; gap:5px; margin-bottom:20px;">
                    <!-- Cells generated by JS -->
                </div>
            </div>

            <!-- Virtual Keyboard - Mobile Optimized -->
            <div id="wordKeyboard" style="flex-shrink:0; background:linear-gradient(145deg, #f5f5f5, #e0e0e0); padding:8px 5px; border-radius:15px; width:100%; box-sizing:border-box;">
                <div class="kb-row" style="display:flex; justify-content:center; gap:2px; margin-bottom:4px; width:100%;">
                    <button class="key-btn word-key" data-key="E" onclick="handleWordKey('E')">E</button>
                    <button class="key-btn word-key" data-key="R" onclick="handleWordKey('R')">R</button>
                    <button class="key-btn word-key" data-key="T" onclick="handleWordKey('T')">T</button>
                    <button class="key-btn word-key" data-key="Y" onclick="handleWordKey('Y')">Y</button>
                    <button class="key-btn word-key" data-key="U" onclick="handleWordKey('U')">U</button>
                    <button class="key-btn word-key" data-key="I" onclick="handleWordKey('I')">I</button>
                    <button class="key-btn word-key" data-key="O" onclick="handleWordKey('O')">O</button>
                    <button class="key-btn word-key" data-key="P" onclick="handleWordKey('P')">P</button>
                    <button class="key-btn word-key" data-key="ƒû" onclick="handleWordKey('ƒû')">ƒû</button>
                    <button class="key-btn word-key" data-key="√ú" onclick="handleWordKey('√ú')">√ú</button>
                </div>
                <div class="kb-row" style="display:flex; justify-content:center; gap:2px; margin-bottom:4px; width:100%; padding:0 5px;">
                    <button class="key-btn word-key" data-key="A" onclick="handleWordKey('A')">A</button>
                    <button class="key-btn word-key" data-key="S" onclick="handleWordKey('S')">S</button>
                    <button class="key-btn word-key" data-key="D" onclick="handleWordKey('D')">D</button>
                    <button class="key-btn word-key" data-key="F" onclick="handleWordKey('F')">F</button>
                    <button class="key-btn word-key" data-key="G" onclick="handleWordKey('G')">G</button>
                    <button class="key-btn word-key" data-key="H" onclick="handleWordKey('H')">H</button>
                    <button class="key-btn word-key" data-key="J" onclick="handleWordKey('J')">J</button>
                    <button class="key-btn word-key" data-key="K" onclick="handleWordKey('K')">K</button>
                    <button class="key-btn word-key" data-key="L" onclick="handleWordKey('L')">L</button>
                    <button class="key-btn word-key" data-key="≈û" onclick="handleWordKey('≈û')">≈û</button>
                    <button class="key-btn word-key" data-key="ƒ∞" onclick="handleWordKey('ƒ∞')">ƒ∞</button>
                </div>
                <div class="kb-row" style="display:flex; justify-content:center; gap:2px; width:100%;">
                    <button class="key-btn word-key special" onclick="handleWordKey('ENTER')" style="flex:1.3;">‚èé</button>
                    <button class="key-btn word-key" data-key="Z" onclick="handleWordKey('Z')">Z</button>
                    <button class="key-btn word-key" data-key="C" onclick="handleWordKey('C')">C</button>
                    <button class="key-btn word-key" data-key="V" onclick="handleWordKey('V')">V</button>
                    <button class="key-btn word-key" data-key="B" onclick="handleWordKey('B')">B</button>
                    <button class="key-btn word-key" data-key="N" onclick="handleWordKey('N')">N</button>
                    <button class="key-btn word-key" data-key="M" onclick="handleWordKey('M')">M</button>
                    <button class="key-btn word-key" data-key="√ñ" onclick="handleWordKey('√ñ')">√ñ</button>
                    <button class="key-btn word-key" data-key="√á" onclick="handleWordKey('√á')">√á</button>
                    <button class="key-btn word-key special" onclick="handleWordKey('DEL')" style="flex:1.3;">‚å´</button>
                </div>
            </div>

            <style>
                /* Mobile Optimized Word Game Keyboard */
                #wordKeyboard .word-key {
                    flex: 1;
                    min-width: 26px;
                    max-width: 36px;
                    height: 44px;
                    padding: 0 2px;
                    font-size: clamp(0.7rem, 3vw, 0.9rem);
                    font-weight: 700;
                    border: 1px solid #1a1a2e;
                    border-radius: 6px;
                    background: linear-gradient(180deg, #4a4a6a 0%, #2d2d44 50%, #1a1a2e 100%);
                    color: #ffffff;
                    cursor: pointer;
                    box-shadow: 0 2px 0 #0d0d15, 0 3px 5px rgba(0,0,0,0.3);
                    transition: all 0.06s ease;
                    text-shadow: 0 1px 2px rgba(0,0,0,0.8);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }

                #wordKeyboard .word-key:active {
                    transform: translateY(2px);
                    box-shadow: 0 1px 0 #0d0d15, 0 2px 3px rgba(0,0,0,0.3);
                }

                #wordKeyboard .word-key.special {
                    background: linear-gradient(180deg, #5d6d7e 0%, #34495e 50%, #2c3e50 100%);
                    border-color: #1a252f;
                    font-size: clamp(0.8rem, 3.5vw, 1rem);
                    min-width: 36px;
                    max-width: 50px;
                }

                @media (max-width: 380px) {
                    #wordKeyboard .word-key {
                        min-width: 22px;
                        height: 40px;
                        font-size: 0.7rem;
                        border-radius: 5px;
                    }
                    #wordKeyboard .word-key.special {
                        min-width: 30px;
                        font-size: 0.75rem;
                    }
                }

                @media (max-width: 320px) {
                    #wordKeyboard .word-key {
                        min-width: 20px;
                        height: 36px;
                        font-size: 0.65rem;
                    }
                }

                @media (min-width: 400px) {
                    #wordKeyboard .word-key {
                        min-width: 30px;
                        max-width: 40px;
                        height: 48px;
                    }
                }
            </style>
        </div>
    </div>

    <!-- Word Info Modal -->
    <div id="modal-word-info" class="modal-overlay">
        <div class="modal-box">
            <h3>üáπüá∑ Kelime Hazinesi</h3>
            <p style="text-align:left; font-size:0.9rem;">Gizli kelimeyi bulmaya √ßalƒ±≈ü!<br><br>
            üü© <b>YE≈ûƒ∞L:</b> Harf doƒüru yerde.<br>
            üü® <b>SARI:</b> Harf kelimede var ama yanlƒ±≈ü yerde.<br>
            ‚¨ú <b>GRƒ∞:</b> Harf kelimede yok.<br><br>
            Kelimeyi bulursan seviye atlar ve altƒ±n kazanƒ±rsƒ±n. Ba≈üarƒ±lar!</p>
            <button class="btn-green" onclick="closeModal('modal-word-info')">ANLADIM</button>
        </div>
    </div>

    <!-- Game Selector Modal -->
    <div id="modal-game-selector" class="modal-overlay">
        <div class="modal-box" style="max-width: 380px;">
            <h3 style="margin-bottom: 20px;">üéÆ Oyun Se√ß</h3>
            <p style="font-size:0.9rem; color:#666; margin-bottom:15px;">Hangi oyunu oynamak istersin?</p>
            
            <div style="display:flex; flex-direction:column; gap:12px;">
                <button class="btn-blue" onclick="closeModal('modal-game-selector'); safeOpenSetup();" style="padding:18px; font-size:1.1rem; display:flex; align-items:center; justify-content:center; gap:10px;">
                    <span style="font-size:2rem;">üî¢</span>
                    <div style="text-align:left;">
                        <div style="font-weight:bold;">SAYI TAHMƒ∞N</div>
                        <div style="font-size:0.75rem; opacity:0.9;">Klasik + - oyunu</div>
                    </div>
                </button>
                
                <button class="btn-purple" onclick="closeModal('modal-game-selector'); safeOpenWordSetup();" style="padding:18px; font-size:1.1rem; display:flex; align-items:center; justify-content:center; gap:10px;">
                    <span style="font-size:2rem;">üáπüá∑</span>
                    <div style="text-align:left;">
                        <div style="font-weight:bold;">KELƒ∞ME HAZƒ∞NESƒ∞</div>
                        <div style="font-size:0.75rem; opacity:0.9;">Kelime bulma oyunu</div>
                    </div>
                </button>
            </div>
            
            <button class="btn-grey" onclick="closeModal('modal-game-selector')" style="margin-top:15px; width:auto; padding:8px 20px;">ƒ∞ptal</button>
        </div>
    </div>


    <div id="modal-bounty-info" class="modal-overlay">
        <div class="modal-box" style="text-align:left;">
            <h3 style="text-align:center; color:#d35400;">ü§† NASIL OYNANIR?</h3>
            <div style="font-size:0.9rem; color:#333; line-height:1.5;">
                <p><b>1. AVCI OLMAK (ƒ∞lan Se√ß):</b><br>Listeden bir ilan se√ß. Giri≈ü √ºcretini √∂de (√ñd√ºl√ºn %10'u). Gizli sayƒ±yƒ± bulursan <b>B√úY√úK √ñD√úL√ú</b> alƒ±rsƒ±n!</p>
                <hr>
                <p><b>2. ƒ∞LAN VERMEK (Tuzak Kur):</b><br>Zor bir sayƒ± belirle ve √∂d√ºl koy. Diƒüer oyuncular senin sayƒ±nƒ± bulmaya √ßalƒ±≈üƒ±r. Bulamazlarsa √∂dedikleri giri≈ü √ºcreti <b>SANA GELƒ∞R!</b></p>
            </div>
            <button class="btn-red" onclick="closeModal('modal-bounty-info')" style="margin-top:15px;">TAMAM, BA≈ûLA!</button>
        </div>
    </div>
<div id="modal-invite-incoming" class="modal-overlay">
        <div class="modal-box">
            <h3>üì¢ Davet Var!</h3>
            <p><b id="inviterNameDisplay">...</b> seni oyuna √ßaƒüƒ±rƒ±yor!</p>
            <div style="display:flex;gap:10px;justify-content:center;"><button class="btn-green"
                    onclick="acceptInvite()">KABUL ET</button><button class="btn-red"
                    onclick="closeModal('modal-invite-incoming')">REDDET</button></div>
        </div>
    </div>
    <div id="modal-disconnect" class="modal-overlay">
        <div class="modal-box">
            <h3 style="color:var(--danger)">‚ö†Ô∏è Baƒülantƒ± Koptu</h3>
            <p>Rakip oyundan d√º≈üt√º!</p>
            <div style="font-size:3rem;">üèÅ</div>
            <p>H√ºkmen galip sayƒ±ldƒ±n.</p><button class="btn-green" onclick="leaveRoom()">ANA MEN√úYE D√ñN</button>
        </div>
    </div>
    <div id="modal-broadcast" class="modal-overlay">
        <div class="modal-box" style="border: 2px solid var(--gold);">
            <h3 style="color:var(--gold)">üì¢ Sƒ∞STEM DUYURUSU</h3>
            <p id="broadcastMsg"
                style="font-size:1.1rem; padding:10px; background:rgba(255,255,255,0.1); border-radius:10px;">...</p>
            <button class="btn-blue" onclick="closeModal('modal-broadcast')">TAMAM</button>
        </div>
    </div>

    <div id="modal-exit-confirm" class="modal-overlay">
        <div class="modal-box">
            <h3>üö™ √áƒ±kƒ±≈ü</h3>
            <p>Oyundan √ßƒ±kmak istediƒüine emin misin?</p>
            <div style="display:flex;gap:10px;justify-content:center;"><button class="btn-red"
                    onclick="confirmExitGame()">EVET, √áIK</button><button class="btn-grey"
                    onclick="closeModal('modal-exit-confirm')">ƒ∞PTAL</button></div>
        </div>
    </div>

    <!-- PROFƒ∞L MODALI -->
    <div id="modal-profile-v2" class="modal-overlay">
        <div class="modal-box" style="max-width: 380px; padding: 20px; max-height: 90vh; overflow-y: auto;">

            <div class="profile-header">
                <div style="position: relative; display: inline-block;">
                    <div id="pAvatar" class="profile-avatar-huge">üòé</div>
                    <div id="pOnlineStatus" class="profile-online-badge status-offline"></div>
                    <div id="btnChangeAvatarProfile" onclick="openAvatarChangeFromProfile()"
                        style="display:none; position: absolute; bottom: 0; right: 0; background: #2d3436; color:white; border-radius: 50%; width:30px; height:30px; align-items:center; justify-content:center; cursor: pointer; border:2px solid #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.3); font-size: 1rem; z-index: 10;">
                        ‚úèÔ∏è
                    </div>
                </div>
                <h2 id="pName" style="margin: 10px 0 5px 0; color: #2d3436;">Kullanƒ±cƒ±</h2>
                <div id="pBadges" style="margin-bottom: 5px;"></div>
            </div>

            <div class="profile-stats-grid">
                <div class="p-stat-box">
                    <div id="pLevel" class="p-stat-val">1</div>
                    <div class="p-stat-label">Seviye</div>
                </div>
                <div class="p-stat-box">
                    <div id="pGold" class="p-stat-val" style="color:#f1c40f;">0</div>
                    <div class="p-stat-label">Altƒ±n</div>
                </div>
                <div class="p-stat-box">
                    <div id="pWins" class="p-stat-val" style="color:#2ed573;">0</div>
                    <div class="p-stat-label">Zafer</div>
                </div>
            </div>

            <div class="profile-bio-box" style="text-align:left;">

                <div id="btnEditBio" class="bio-edit-btn" style="display:none;" onclick="enableBioEdit()">‚úèÔ∏è Profili
                    D√ºzenle
                </div>

                <div id="pViewMode">
                    <p id="pBioText" style="margin-bottom:10px; font-style:italic; color:#555;">...</p>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px; font-size:0.8rem; color:#333;">
                        <div>üìç <b>≈ûehir:</b> <span id="pCityDisplay">-</span></div>
                        <div>üíº <b>Meslek:</b> <span id="pJobDisplay">-</span></div>
                        <div>üéÇ <b>Ya≈ü:</b> <span id="pAgeDisplay">-</span></div>
                        <div>‚öß <b>Cinsiyet:</b> <span id="pGenderDisplay">-</span></div>
                    </div>
                    <div style="margin-top:8px; font-size:0.8rem;">
                        üé® <b>Hobiler:</b> <span id="pHobbyDisplay">-</span>
                    </div>
                </div>

                <div id="pEditMode" style="display:none; margin-top:10px;">
                    <label style="font-size:0.7rem; font-weight:bold;">Biyografi:</label>
                    <textarea id="pBioInput" style="width:100%; font-size:0.8rem; padding:5px; margin-bottom:5px;"
                        maxlength="50" placeholder="Kƒ±sa bir s√∂z..."></textarea>

                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px;">
                        <div>
                            <label style="font-size:0.7rem;">≈ûehir:</label>
                            <input id="pCityInput" type="text" maxlength="15" placeholder="ƒ∞stanbul"
                                style="padding:5px;">
                        </div>
                        <div>
                            <label style="font-size:0.7rem;">Meslek:</label>
                            <input id="pJobInput" type="text" maxlength="15" placeholder="√ñƒürenci" style="padding:5px;">
                        </div>
                        <div>
                            <label style="font-size:0.7rem;">Doƒüum Yƒ±lƒ±:</label>
                            <input id="pBirthInput" type="number" placeholder="2000" style="padding:5px;">
                        </div>
                        <div>
                            <label style="font-size:0.7rem;">Cinsiyet:</label>
                            <select id="pGenderInput" style="padding:5px; height:38px;">
                                <option value="">Belirtme</option>
                                <option value="Erkek">Erkek</option>
                                <option value="Kadƒ±n">Kadƒ±n</option>
                            </select>
                        </div>
                    </div>

                    <label style="font-size:0.7rem; margin-top:5px; display:block;">Hobiler:</label>
                    <input id="pHobbyInput" type="text" maxlength="30" placeholder="Futbol, M√ºzik..."
                        style="padding:5px;">

                    <button id="btnSaveBio" class="btn-green"
                        style="width:100%; padding:8px; margin-top:10px; font-size:0.8rem;"
                        onclick="saveBio()">KAYDET</button>
                </div>

            </div>

            <!-- PET SECTION (New) -->
            <div id="profilePetSection"
                style="margin-top:15px; border-top:1px solid #eee; padding-top:10px; display:none;">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h4 style="margin:0; color:#2d3436;">üêæ Evcil Hayvanlarƒ±m</h4>
                    <button id="btnTogglePetList" class="btn-sm btn-blue" onclick="toggleProfilePetList()">G√ñSTER
                        ‚ñº</button>
                </div>

                <div id="profilePetListContainer"
                    style="display:none; margin-top:10px; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap:8px;">
                    <!-- Pets will be rendered here -->
                </div>
            </div>

            <div style="display: flex; gap: 10px; margin-top:10px;">
                <button id="btnProfileDM" class="btn-blue" onclick="startDMFromProfile()">üí¨ MESAJ G√ñNDER</button>
                <button id="btnDeleteProfile" class="btn-red" onclick="deleteMyProfile()" style="display:none;">üóëÔ∏è PROFƒ∞Lƒ∞ Sƒ∞L</button>
                <button class="btn-grey" onclick="closeModal('modal-profile-v2')">KAPAT</button>
            </div>
        </div>
    </div>

    <!-- DM MODALI -->
    <div id="modal-dm" class="modal-overlay">
        <div class="modal-box" style="display:flex;flex-direction:column;height:80vh;">

            <h3 id="dmTitle">Mesajla≈üma</h3>

            <div id="dmMessages" style="flex:1;overflow-y:auto;
                background:#f5f5f5;
                border-radius:10px;
                padding:10px;
                margin-bottom:10px;">
            </div>

            <input type="text" id="dmInput" placeholder="Mesaj yaz...">

            <button class="btn-green" onclick="sendDM()">G√∂nder</button>

            <button class="btn-grey" style="margin-top:5px;" onclick="closeModal('modal-dm')">
                Kapat
            </button>

        </div>
    </div>
        <div id="modal-setup" class="modal-overlay" style="backdrop-filter: blur(10px);">
        <div class="modal-box"
            style="padding: 0; max-width: 420px; width: 90%; background: #fff; border-radius: 24px; overflow: hidden; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); display: flex; flex-direction: column; max-height: 85vh;">

            <div
                style="background: linear-gradient(135deg, #6c5ce7, #a29bfe); padding: 15px; color: white; text-align: center; position: relative; flex-shrink: 0;">
                <h3 style="margin:0; font-size: 1.3rem; letter-spacing: 1px; text-shadow: 0 2px 4px rgba(0,0,0,0.2);">
                    OYUN MODU</h3>
                <div style="font-size: 0.75rem; opacity: 0.8; margin-top: 3px;">M√ºcadele t√ºr√ºn√º se√ß</div>
            </div>

            <div style="padding: 15px; background: #f4f6f8; overflow-y: auto; flex: 1;">

                <!-- SINGLE PLAYER & PvC -->
                <div style="background: white; border-radius: 16px; padding: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); border: 1px solid #eee; margin-bottom: 15px; position: relative; overflow: hidden;">
                    <div style="position: absolute; left: 0; top: 0; height: 100%; width: 4px; background: #9b59b6;"></div>
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; padding-left: 8px;">
                        <span style="font-weight: 800; color: #2d3436; font-size: 0.9rem;">üë§ TEK Kƒ∞≈ûƒ∞Lƒ∞K / PvC</span>
                    </div>

                    <div style="display: flex; gap: 6px; margin-bottom:10px;">
                        <select id="singleDiffSelect" style="flex:1; padding: 8px; border-radius: 8px; border: 1px solid #dfe6e9; background: #fdfdfd; font-weight: 600;">
                            <option value="3">3 Basamaklƒ±</option>
                            <option value="4" selected>4 Basamaklƒ±</option>
                            <option value="5">5 Basamaklƒ±</option>
                        </select>
                    </div>

                    <div style="margin-top: 5px; padding: 8px; background: rgba(0,0,0,0.03); border-radius: 8px;">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <label style="font-size: 0.8rem; font-weight: bold; color: #555;">ü§ñ Bilgisayara Kar≈üƒ±</label>
                            <input type="checkbox" id="checkVsCpu" style="width: 20px; height: 20px;">
                        </div>
                    </div>

                    <button onclick="startSingle()" class="btn-green" style="margin-top: 10px; width: 100%; border-radius: 8px; padding: 10px; background: linear-gradient(135deg, #2ecc71, #27ae60);">BA≈ûLA</button>
                </div>

                <div style="text-align: center; margin: -25px 0 8px 0; position: relative; z-index: 2;">
                    <span style="background: #fff; border: 2px solid #eee; padding: 3px 8px; border-radius: 20px; font-size: 0.65rem; color: #999; font-weight: bold;">VEYA</span>
                </div>

                <!-- ONLINE -->
                <div style="background: white; border-radius: 16px; padding: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); border: 1px solid #eee; position: relative; overflow: hidden; margin-bottom: 15px;">
                    <div style="position: absolute; left: 0; top: 0; height: 100%; width: 4px; background: #3498db;"></div>
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; padding-left: 8px;">
                        <span style="font-weight: 800; color: #2d3436; font-size: 0.9rem;">üåç ONLINE D√úELLO</span>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-bottom: 6px;">
                        <select id="createDiff" style="padding: 6px; border-radius: 6px; border: 1px solid #dbeafe; font-size: 0.75rem; font-weight:600;">
                            <option value="3">3 Basamak</option>
                            <option value="4" selected>4 Basamak</option>
                            <option value="5">5 Basamak</option>
                        </select>
                        <button onclick="createRoom()" class="btn-blue" style="margin:0; padding: 5px; font-size: 0.7rem;">ODA KUR (50üí∞)</button>
                    </div>

                    <div style="display: flex; gap: 5px; align-items: center; background: #fff; border-top: 2px solid #f1f2f6; padding-top: 8px;">
                        <input type="tel" id="joinCode" placeholder="Oda Kodu" style="flex: 1; padding: 8px; border-radius: 6px; border: 2px solid #eee; text-align: center; font-size: 0.9rem; margin:0;">
                        <button onclick="joinRoom(document.getElementById('joinCode').value)" class="btn-purple" style="width: auto; padding: 8px 12px; border-radius: 6px; margin:0;">Gƒ∞R</button>
                    </div>

                    <!-- Online Player List -->
                    <div style="margin-top:10px; border-top:1px dashed #ddd; padding-top:10px;">
                        <div style="font-size:0.75rem; font-weight:bold; color:#555; margin-bottom:5px;">üü¢ Aktif Oyuncular (Sayƒ± Daveti)</div>
                        <div id="activePlayersList" class="list-container" style="height:120px; background:#fafafa;">
                           <div style="padding:10px; text-align:center; color:#999;">Y√ºkleniyor...</div>
                        </div>
                    </div>
                </div>

            </div>

            <div style="padding: 10px; background: #fff; text-align: center; border-top: 1px solid #eee; flex-shrink: 0;">
                <button onclick="closeModal('modal-setup')" style="background: transparent; color: #b2bec3; font-weight: bold; border: none; font-size: 0.85rem; padding: 5px; width: 100%; cursor: pointer;">VAZGE√á</button>
            </div>
        </div>
    </div>


    <div id="modal-word-setup" class="modal-overlay" style="backdrop-filter: blur(10px);">
        <div class="modal-box"
            style="padding: 0; max-width: 420px; width: 90%; background: #fff; border-radius: 24px; overflow: hidden; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); display: flex; flex-direction: column; max-height: 85vh;">

            <div
                style="background: linear-gradient(135deg, #6c5ce7, #a29bfe); padding: 15px; color: white; text-align: center; position: relative; flex-shrink: 0;">
                <h3 style="margin:0; font-size: 1.3rem; letter-spacing: 1px; text-shadow: 0 2px 4px rgba(0,0,0,0.2);">
                    OYUN
                    MODU</h3>
                <div style="font-size: 0.75rem; opacity: 0.8; margin-top: 3px;">M√ºcadele t√ºr√ºn√º se√ß</div>
                <div style="position: absolute; top: 10px; right: 15px; font-size: 1.5rem; opacity: 0.2;">üéÆ</div>
            </div>

            <div style="padding: 15px; background: #f4f6f8; overflow-y: auto; flex: 1;">

                <!-- SINGLE PLAYER & PvC -->
                <div style="background: white; border-radius: 16px; padding: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); border: 1px solid #eee; margin-bottom: 15px; position: relative; overflow: hidden;">
                    <div style="position: absolute; left: 0; top: 0; height: 100%; width: 4px; background: #9b59b6;"></div>
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; padding-left: 8px;">
                        <span style="font-weight: 800; color: #2d3436; font-size: 0.9rem;">üë§ TEK Kƒ∞≈ûƒ∞Lƒ∞K / PvC</span>
                    </div>

                    <div style="margin-bottom:10px;">
                        <label style="font-size:0.75rem; font-weight:bold; color:#666;">Kelime Uzunluƒüu:</label>
                        <select id="wordDiffSelect" style="width:100%; padding: 8px; border-radius: 8px; border: 1px solid #dfe6e9; background: #fdfdfd; font-weight: 600;">
                            <option value="3">3 Harfli</option>
                            <option value="4">4 Harfli</option>
                            <option value="5" selected>5 Harfli</option>
                            <option value="6">6 Harfli</option>
                            <option value="7">7 Harfli</option>
                            <option value="8">8 Harfli</option>
                            <option value="9">9 Harfli</option>
                            <option value="10">10 Harfli</option>
                        </select>
                    </div>

                    <!-- Mode Selection -->
                    <div style="display:flex; gap:10px; margin-bottom:10px;">
                        <label style="flex:1; display:flex; align-items:center; gap:5px; padding:5px; border:1px solid #eee; border-radius:8px; cursor:pointer;" onclick="toggleWordMode('single', 'time')">
                            <input type="radio" name="wordSingleMode" id="radioSingleTime" checked>
                            <span style="font-size:0.8rem; font-weight:bold;">‚è±Ô∏è S√ºreli</span>
                        </label>
                        <label style="flex:1; display:flex; align-items:center; gap:5px; padding:5px; border:1px solid #eee; border-radius:8px; cursor:pointer;" onclick="toggleWordMode('single', 'moves')">
                            <input type="radio" name="wordSingleMode" id="radioSingleMoves">
                            <span style="font-size:0.8rem; font-weight:bold;">‚ö° Haklƒ±</span>
                        </label>
                    </div>

                    <!-- Options -->
                    <div id="singleTimeOptions">
                        <select id="wordTimeSelect" style="width:100%; padding: 8px; border-radius: 8px; border: 1px solid #dfe6e9; background: #fdfdfd; font-weight: 600;">
                            <option value="3">3 Dakika</option>
                            <option value="5" selected>5 Dakika</option>
                            <option value="7">7 Dakika</option>
                        </select>
                    </div>
                    <div id="singleMoveOptions" style="display:none; text-align:center; padding:10px; background:#f0f2f5; border-radius:8px; color:#2d3436; font-weight:bold; border:1px dashed #ccc;">
                        15 HAK (Standart)
                    </div>

                    <div style="margin-top: 10px; padding: 8px; background: rgba(0,0,0,0.03); border-radius: 8px;">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <label style="font-size: 0.8rem; font-weight: bold; color: #555;">ü§ñ Bilgisayara Kar≈üƒ±</label>
                            <input type="checkbox" id="checkWordVsCpu" style="width: 20px; height: 20px;">
                        </div>
                    </div>

                    <button onclick="startWordGameCustom()" class="btn-green" style="margin-top: 10px; width: 100%; border-radius: 8px; padding: 10px; background: linear-gradient(135deg, #8e44ad, #9b59b6);">BA≈ûLA</button>
                </div>

                <div style="text-align: center; margin: -25px 0 8px 0; position: relative; z-index: 2;">
                    <span style="background: #fff; border: 2px solid #eee; padding: 3px 8px; border-radius: 20px; font-size: 0.65rem; color: #999; font-weight: bold;">VEYA</span>
                </div>

                <!-- ONLINE -->
                <div style="background: white; border-radius: 16px; padding: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); border: 1px solid #eee; position: relative; overflow: hidden; margin-bottom: 15px;">
                    <div style="position: absolute; left: 0; top: 0; height: 100%; width: 4px; background: #3498db;"></div>
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; padding-left: 8px;">
                        <span style="font-weight: 800; color: #2d3436; font-size: 0.9rem;">üåç ONLINE D√úELLO</span>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-bottom: 6px;">
                        <select id="createWordDiff" style="padding: 6px; border-radius: 6px; border: 1px solid #dbeafe; font-size: 0.75rem; font-weight:600;">
                            <option value="3">3 Harf</option>
                            <option value="4">4 Harf</option>
                            <option value="5" selected>5 Harf</option>
                            <option value="6">6 Harf</option>
                            <option value="7">7 Harf</option>
                            <option value="8">8 Harf</option>
                            <option value="9">9 Harf</option>
                            <option value="10">10 Harf</option>
                        </select>
                        <button onclick="createWordRoom()" class="btn-blue" style="margin:0; padding: 5px; font-size: 0.7rem;">ODA KUR (50üí∞)</button>
                    </div>

                     <!-- Online Mode Selection -->
                    <div style="display:flex; gap:10px; margin-bottom:10px;">
                        <label style="flex:1; display:flex; align-items:center; gap:5px; padding:5px; border:1px solid #eee; border-radius:8px; cursor:pointer;" onclick="toggleWordMode('online', 'time')">
                            <input type="radio" name="wordOnlineMode" id="radioOnlineTime" checked>
                            <span style="font-size:0.7rem; font-weight:bold;">‚è±Ô∏è S√ºreli (5dk)</span>
                        </label>
                        <label style="flex:1; display:flex; align-items:center; gap:5px; padding:5px; border:1px solid #eee; border-radius:8px; cursor:pointer;" onclick="toggleWordMode('online', 'moves')">
                            <input type="radio" name="wordOnlineMode" id="radioOnlineMoves">
                            <span style="font-size:0.7rem; font-weight:bold;">‚ö° Haklƒ± (15)</span>
                        </label>
                    </div>

                    <div style="display: flex; gap: 5px; align-items: center; background: #fff; border-top: 2px solid #f1f2f6; padding-top: 8px;">
                        <input type="tel" id="joinWordCode" placeholder="Oda Kodu" style="flex: 1; padding: 8px; border-radius: 6px; border: 2px solid #eee; text-align: center; font-size: 0.9rem; margin:0;">
                        <button onclick="joinWordRoom(document.getElementById('joinWordCode').value)" class="btn-purple" style="width: auto; padding: 8px 12px; border-radius: 6px; margin:0;">Gƒ∞R</button>
                    </div>

                    <!-- Online Player List -->
                    <div style="margin-top:10px; border-top:1px dashed #ddd; padding-top:10px;">
                        <div style="font-size:0.75rem; font-weight:bold; color:#555; margin-bottom:5px;">üü¢ Aktif Oyuncular (Kelime Daveti)</div>
                        <div id="wordActivePlayersList" class="list-container" style="height:120px; background:#fafafa;">
                           <div style="padding:10px; text-align:center; color:#999;">Y√ºkleniyor...</div>
                        </div>
                    </div>
                </div>

</div>

            <div style="padding: 10px; background: #fff; text-align: center; border-top: 1px solid #eee; flex-shrink: 0;">
                <button onclick="closeModal('modal-word-setup')" style="background: transparent; color: #b2bec3; font-weight: bold; border: none; font-size: 0.85rem; padding: 5px; width: 100%; cursor: pointer;">VAZGE√á</button>
            </div>
        </div>
    </div>

    <!-- WORD CAREER MAP MODAL -->
    <div id="modal-word-career" class="modal-overlay">
        <div style="position:absolute; top:20px; right:20px; z-index:100;">
            <button class="nav-btn" onclick="closeModal('modal-word-career')" style="width:40px; height:40px; font-size:1.2rem;">X</button>
        </div>
        <div id="wordCareerContent" style="width:100%; height:100%; overflow-y:auto; -webkit-overflow-scrolling:touch;">
            <!-- Generated by JS -->
        </div>
    </div>



    <div id="modal-market" class="modal-overlay">
        <div class="modal-box">
            <h3>üõí Market</h3>
            <p style="font-size:0.8rem;color:#ccc;">T√ºm √úr√ºnler Reklam ƒ∞zleyerek Alƒ±nƒ±r!</p>
            <div id="marketItems" style="text-align:left;max-height:300px;overflow-y:auto;"></div><button
                onclick="closeModal('modal-market')" class="btn-red">KAPAT</button>
        </div>
    </div>
    <div id="modal-inventory" class="modal-overlay">
        <div class="modal-box">
            <h3>üéí √áanta</h3>
            <div id="inventoryList"></div><button onclick="closeModal('modal-inventory')" class="btn-red">KAPAT</button>
        </div>
    </div>
    <div id="modal-leaderboard" class="modal-overlay">
        <div class="modal-box" style="max-width: 400px;">
            <h3 style="margin-bottom: 15px;">üèÜ Sƒ±ralama</h3>
            <div style="display:flex; gap:5px; margin-bottom:15px; background: #f0f2f5; padding: 8px; border-radius: 12px;">
                <button id="lbBtnDaily" class="btn-green" onclick="loadLeaderboard('daily')" style="flex:1; font-size:0.8rem; padding:8px 5px;">üìÖ G√ºnl√ºk</button>
                <button id="lbBtnWeekly" class="btn-blue" onclick="loadLeaderboard('weekly')" style="flex:1; font-size:0.8rem; padding:8px 5px;">üóìÔ∏è Haftalƒ±k</button>
                <button id="lbBtnAll" class="btn-gold" onclick="loadLeaderboard('all')" style="flex:1; font-size:0.8rem; padding:8px 5px;">‚ôæÔ∏è Genel</button>
            </div>
            <div id="lbContent" class="list-container" style="min-height:200px; max-height: 400px; overflow-y: auto;"></div>
            <button onclick="closeModal('modal-leaderboard')" class="btn-red" style="margin-top: 10px;">KAPAT</button>
        </div>
    </div>
    <div id="modal-more" class="modal-overlay">
        <div class="modal-box">
            <h3>üçî Diƒüer</h3>
            <button class="btn-gold" onclick="openVaultModal()">üîê G√ºnl√ºk Kasa</button>
            <button class="btn-dark" onclick="openPetModalSafe()">üêæ Evcil Hayvanlar</button>
            <button class="btn-dark" onclick="openAvatarChange()">üòé Avatar Deƒüi≈ütir</button>
            <button class="btn-purple" onclick="showModal('modal-features')">‚ú® Oyun √ñzellikleri</button>
            <button class="btn-dark" onclick="showModal('modal-contact')">üì® ƒ∞leti≈üim</button>
            <button class="btn-blue" onclick="showPrivacyPolicy()">üîí Gizlilik Politikasƒ±</button>
            <button class="btn-red" style="margin-top:15px;" onclick="confirmLogout()">√áIKI≈û YAP</button>
            <button class="btn-grey" onclick="closeModal('modal-more')">KAPAT</button>
        </div>
    </div>

    <!-- Gƒ∞ZLƒ∞Lƒ∞K POLƒ∞Tƒ∞KASI MODAL -->
    <div id="modal-privacy" class="modal-overlay">
        <div class="modal-box" style="max-width: 400px; max-height: 85vh; overflow-y: auto;">
            <h3 style="color: #2980b9; margin-bottom: 15px;">üîí Gizlilik Politikasƒ±</h3>
            
            <div style="text-align: left; font-size: 0.85rem; line-height: 1.6; color: #333;">
                <div style="background: #f8f9fa; padding: 15px; border-radius: 12px; margin-bottom: 15px; border-left: 4px solid #2980b9;">
                    <h4 style="margin: 0 0 10px 0; color: #2980b9;">üìã Veri Toplama ve Kullanƒ±mƒ±</h4>
                    <p style="margin: 0;">
                        <b>TahminSon</b> olarak kullanƒ±cƒ±larƒ±mƒ±zƒ±n gizliliƒüine √∂nem veriyoruz. 
                        Bu uygulama <b>hi√ßbir ki≈üisel verinizi</b> (isim, telefon, e-posta, konum vb.) toplamamaktadƒ±r.
                    </p>
                </div>

                <div style="background: #f8f9fa; padding: 15px; border-radius: 12px; margin-bottom: 15px; border-left: 4px solid #27ae60;">
                    <h4 style="margin: 0 0 10px 0; color: #27ae60;">üéÆ Saklanan Veriler</h4>
                    <ul style="margin: 0; padding-left: 20px;">
                        <li>Kullanƒ±cƒ± adƒ± (oyun i√ßi kimliƒüiniz)</li>
                        <li>Oyun skorlarƒ± ve seviyeleri</li>
                        <li>Altƒ±n miktarƒ± ve envanter</li>
                        <li>Oyun istatistikleri (galibiyet, maƒülubiyet)</li>
                    </ul>
                </div>

                <div style="background: #f8f9fa; padding: 15px; border-radius: 12px; margin-bottom: 15px; border-left: 4px solid #e74c3c;">
                    <h4 style="margin: 0 0 10px 0; color: #e74c3c;">‚ùå Toplanmayan Veriler</h4>
                    <ul style="margin: 0; padding-left: 20px;">
                        <li>Telefon numarasƒ±</li>
                        <li>E-posta adresi</li>
                        <li>Konum bilgisi</li>
                        <li>Cihaz kimliƒüi</li>
                        <li>Reklam kimliƒüi (IDFA/AAID)</li>
                    </ul>
                </div>

                <div style="background: #f8f9fa; padding: 15px; border-radius: 12px; margin-bottom: 15px; border-left: 4px solid #9b59b6;">
                    <h4 style="margin: 0 0 10px 0; color: #9b59b6;">üìû ƒ∞leti≈üim</h4>
                    <p style="margin: 0;">
                        Gizlilik politikamƒ±z hakkƒ±nda sorularƒ±nƒ±z i√ßin 
                        <b>yazilimci.hamit@gmail.com</b> adresine e-posta g√∂nderebilirsiniz.
                    </p>
                </div>

                <p style="text-align: center; color: #666; font-size: 0.75rem; margin-top: 15px;">
                    Son G√ºncelleme: ≈ûubat 2026
                </p>
            </div>
            
            <button class="btn-grey" onclick="closeModal('modal-privacy')" style="margin-top: 15px;">KAPAT</button>
        </div>
    </div>

    <!-- OYUN √ñZELLƒ∞KLERƒ∞ MODAL -->
    <div id="modal-features" class="modal-overlay">
        <div class="modal-box" style="max-width: 400px; max-height: 85vh; overflow-y: auto;">
            <h3 style="color: #8e44ad; margin-bottom: 15px;">‚ú® Oyun √ñzellikleri</h3>
            
            <div style="text-align: left; font-size: 0.9rem; line-height: 1.6;">
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 12px; margin-bottom: 15px;">
                    <h4 style="margin: 0 0 10px 0; font-size: 1rem;">üéÆ Oyun Modlarƒ±</h4>
                    <ul style="margin: 0; padding-left: 20px;">
                        <li><b>Sayƒ± Tahmin:</b> Klasik + - mantƒ±ƒüƒ± ile oyna</li>
                        <li><b>Kelime Hazinesi:</b> T√ºrk√ße kelime bulma oyunu</li>
                        <li><b>Tek Ki≈üilik:</b> Bilgisayara kar≈üƒ± pratik yap</li>
                        <li><b>Online:</b> Ger√ßek oyunculara kar≈üƒ± m√ºcadele et</li>
                    </ul>
                </div>

                <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 15px; border-radius: 12px; margin-bottom: 15px;">
                    <h4 style="margin: 0 0 10px 0; font-size: 1rem;">üèÜ Kariyer Modu</h4>
                    <ul style="margin: 0; padding-left: 20px;">
                        <li>Seviye atlama sistemi (1-5 arasƒ±)</li>
                        <li>Her seviyede 10 galibiyet hedefi</li>
                        <li>Seviye y√ºkseldik√ße zorluk artar</li>
                        <li>Her seviyede √∂zel √∂d√ºller</li>
                    </ul>
                </div>

                <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 15px; border-radius: 12px; margin-bottom: 15px;">
                    <h4 style="margin: 0 0 10px 0; font-size: 1rem;">üí∞ Ek √ñzellikler</h4>
                    <ul style="margin: 0; padding-left: 20px;">
                        <li><b>G√ºnl√ºk Kasa:</b> Her g√ºn √ºcretsiz altƒ±n</li>
                        <li><b>Evcil Hayvanlar:</b> Seninle birlikte y√ºr√ºyen dostlar</li>
                        <li><b>Market:</b> √ñzel e≈üyalar ve g√º√ßlendirmeler</li>
                        <li><b>Sƒ±ralama:</b> G√ºnl√ºk, haftalƒ±k ve genel liderlik</li>
                        <li><b>√ñd√ºl Avcƒ±larƒ±:</b> Diƒüer oyuncularƒ±n √∂d√ºllerini avla</li>
                    </ul>
                </div>

                <div style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: #1a5f3f; padding: 15px; border-radius: 12px;">
                    <h4 style="margin: 0 0 10px 0; font-size: 1rem;">üéØ Nasƒ±l Oynanƒ±r?</h4>
                    <p style="margin: 0; font-size: 0.85rem;">
                        <b>+X -Y</b> sistemi: +X doƒüru yerdeki rakam sayƒ±sƒ±, -Y yanlƒ±≈ü yerdeki rakam sayƒ±sƒ±.<br>
                        √ñrnek: Gizli sayƒ± 1234, tahmin 1567 ‚Üí <b>+1 -0</b> (1 doƒüru yerde)<br>
                        Tahmin 5612 ‚Üí <b>+0 -2</b> (1 ve 2 var ama yanlƒ±≈ü yerde)
                    </p>
                </div>
            </div>

            <button onclick="closeModal('modal-features')" class="btn-purple" style="margin-top: 15px; width: 100%;">KAPAT</button>
        </div>
    </div>

    <div id="modal-inbox" class="modal-overlay">
        <div class="modal-box">
            <h3>üì¨ Gelen Kutusu</h3>
            <p style="font-size:0.8rem; color:#666;">Son konu≈ümalarƒ±n burada g√∂r√ºn√ºr.</p>

            <div id="inboxList" class="list-container" style="max-height:300px; overflow-y:auto; margin-bottom:15px;">
                Y√ºkleniyor...
            </div>

            <button class="btn-blue" onclick="openNewChatPrompt()">‚ûï Yeni Sohbet Ba≈ülat</button>
            <button class="btn-red" style="margin-top:5px;" onclick="closeModal('modal-inbox')">KAPAT</button>
        </div>
    </div>
    <div id="modal-avatar-change" class="modal-overlay">
        <div class="modal-box">
            <h3>Avatar Se√ß</h3>
            <div class="avatar-wrapper" id="changeAvatarList"></div><button onclick="closeModal('modal-avatar-change')"
                class="btn-red" style="margin-top:10px;">ƒ∞PTAL</button>
        </div>
    </div>

    <div id="modal-career-info" class="modal-overlay">
        <div class="modal-box" style="max-width:380px; text-align:center;">
            <h3>üó∫Ô∏è Kariyer Yolu (Saga)</h3>

            <p style="font-size:0.9rem; color:#333; line-height:1.5;">
                Kariyer Yolu, oyunun hik√¢ye ve ilerleme modudur.
                Her seviye bir b√∂lgeyi temsil eder.
            </p>

            <div style="background:#f1f2f6; border-radius:12px; padding:10px; text-align:left; font-size:0.85rem;">
                üîπ Her seviyede <b>10 galibiyet</b> alƒ±rsan bir √ºst seviye a√ßƒ±lƒ±r.<br>
                üîπ Seviye y√ºkseldik√ße sayƒ± zorluƒüu artar.<br>
                üîπ Kahin, hak sayƒ±sƒ± ve s√ºre kƒ±sƒ±tlarƒ± deƒüi≈üir.<br>
                üîπ Son seviyeyi bitiren oyuncu <b>Kariyer ≈ûampiyonu</b> olur.
            </div>

            <button class="btn-green" style="margin-top:15px;" onclick="closeModal('modal-career-info')">TAMAM</button>
        </div>
    </div>

    <div id="modal-career" class="modal-overlay">
        <div class="modal-box"
            style="height: 85vh; padding: 0; background: #f0f2f5; display: flex; flex-direction: column;">
            <div style="padding: 15px; background: #fff; border-bottom: 1px solid #eee;">
                <h3 style="margin:0; color:#2d3436;">üó∫Ô∏è KARƒ∞YER YOLU</h3>
                <small style="color:#666;">Zirveye ula≈üabilir misin?</small>
            </div>

            <div style="flex: 1; overflow-y: auto; padding: 20px;" id="careerMapContent">
            </div>

            <div id="careerLevelSetupModal" class="modal-overlay" style="z-index: 3100;">
                <div class="modal-box" style="max-width: 300px;">
                    <h3 id="careerLevelTitle">Seviye 1</h3>
                    <p id="careerLevelDesc" style="font-size:0.8rem; color:#666;"></p>
                    <div
                        style="background:#fff3cd; padding:8px; border-radius:5px; font-size:0.7rem; color:#856404; margin-bottom:10px;">
                        ‚ö†Ô∏è <span id="careerRestrictionText">Kƒ±sƒ±tlama Yok</span>
                    </div>

                    <label style="font-weight:bold; font-size:0.8rem;">Oyun Modu Se√ß:</label>
                    <select id="careerModeSelect" style="width:100%; padding:8px; margin-top:5px; margin-bottom:10px;"
                        onchange="toggleCareerTimeSelect()">
                        <option value="classic">üéØ Klasik (Haklƒ±)</option>
                        <option value="timed">‚è±Ô∏è S√ºreli (Zamanlƒ±)</option>
                    </select>

                    <div id="careerTimeDiv" style="display:none;">
                        <label style="font-weight:bold; font-size:0.8rem;">S√ºre Se√ß:</label>
                        <select id="careerTimeSelect"
                            style="width:100%; padding:8px; margin-top:5px; font-weight:bold; color:#e74c3c;"></select>
                    </div>

                    <button class="btn-green" onclick="launchCareerGame()" style="margin-top:15px;">BA≈ûLA</button>
                    <button class="btn-red" onclick="closeModal('careerLevelSetupModal')"
                        style="margin-top:5px;">ƒ∞PTAL</button>
                </div>
            </div>

            <button onclick="closeModal('modal-career')" class="btn-grey" style="margin: 10px;">KAPAT</button>
        </div>
    </div>

    <div id="modal-contact" class="modal-overlay">
        <div class="modal-box">
            <h3>üì® ƒ∞leti≈üim</h3><textarea id="adminMsgInput"></textarea><button onclick="sendAdminMessage()"
                class="btn-blue">G√ñNDER</button><button onclick="closeModal('modal-contact')"
                class="btn-red">ƒ∞PTAL</button>
        </div>
    </div>

    <div id="modal-vault" class="modal-overlay">
        <div class="modal-box">
            <h3>üîê G√ºnl√ºk Kasa</h3>
            <p style="font-size:0.8rem;color:#ccc;">24 Saatte 1 Kez A√ßƒ±labilir</p>
            <div class="vault-container" id="vaultContainer">
                <div class="vault-body">
                    <div class="vault-inside">
                        <div style="font-size:3rem;">üíé</div>
                        <h2 id="vaultRewardDisplay"
                            style="color:#fff; text-shadow:0 2px 5px rgba(0,0,0,0.5); margin:5px 0;">???</h2>
                        <small style="color:#fff; font-weight:bold;">ALTIN KAZANDIN!</small>
                    </div>

                    <div class="vault-door">
                        <div class="vault-status-light" id="vaultLight"></div>
                        <div class="vault-handle-base" id="vaultHandle">
                            <div class="vault-handle-bars"></div>
                            <div class="vault-handle-bars vertical"></div>
                            <div class="vault-knob"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="vaultTimerText" style="margin-top:15px; font-weight:bold; color:#e74c3c; display:none;">
                ‚è≥ Kilitli! <span id="vaultTimeLeft"></span> sonra gel.
            </div>

            <button id="btnOpenVault" class="btn-gold"
                style="width:100%; margin-top:15px; padding:12px; font-size:1rem; border-radius:12px; box-shadow:0 4px 10px rgba(241, 196, 15, 0.3);"
                onclick="openVault()">
                üîê ≈ûƒ∞FREYƒ∞ Gƒ∞R VE A√á
            </button>
            <button onclick="closeModal('modal-vault')" class="btn-red">KAPAT</button>
        </div>
    </div>
    <div id="modal-levelup" class="modal-overlay">
        <div class="modal-box">
            <h3>‚≠ê SEVƒ∞YE ATLADIN!</h3>
            <h1 id="newLevelDisplay">1</h1>
            <p style="font-size:1.1rem; font-weight:bold; color:#f1c40f; margin-top:5px;">+50 Altƒ±n!</p><button
                onclick="closeModal('modal-levelup')" class="btn-purple">HARƒ∞KA</button>
        </div>
    </div>
    <div id="modal-end" class="modal-overlay">
        <div class="modal-box">
            <h2 id="endTitle">OYUN Bƒ∞TTƒ∞</h2>
            <p id="endMsg"></p>

            <div id="rematchSettings"
                style="display:none; margin:15px 0; background:#f0f2f5; padding:10px; border-radius:10px;">
                <label style="font-size:0.8rem; font-weight:bold; color:#555;">Yeni Oyun Zorluƒüu:</label>
                <select id="rematchDiffSelect"
                    style="width:100%; margin-top:5px; padding:8px; border-radius:5px; border:1px solid #ccc; font-weight:bold;">
                    <option value="4">4 Hane (Normal)</option>
                    <option value="5">5 Hane (Zor)</option>
                    <option value="6">6 Hane (√áok Zor)</option>
                    <option value="7">7 Hane (ƒ∞mkansƒ±z)</option>
                </select>
            </div>

            <div id="incomingRematchArea"
                style="display:none; margin:15px 0; background:#e8f5e9; padding:15px; border-radius:10px; border:1px solid #4caf50;">
                <h4 style="margin:0 0 5px 0; color:#2e7d32;">üî• R√ñVAN≈û ƒ∞STEƒûƒ∞!</h4>
                <p id="incomingRematchText" style="margin:0; font-size:0.9rem; color:#333;">Rakip 5 Haneli oyun istiyor.
                </p>
                <div style="display:flex; gap:10px; margin-top:10px; justify-content:center;">
                    <button id="btnAcceptRematch" class="btn-green" onclick="acceptRematch()">KABUL ET</button>
                    <button class="btn-red" onclick="rejectRematch()">REDDET</button>
                </div>
            </div>

            <div id="endButtons" style="display:none; gap:10px; justify-content:center;">
                <button id="btnRematch" onclick="requestRematch()" class="btn-green">TEKRAR OYNA</button>
                <button onclick="leaveRoom()" class="btn-red">√áIK</button>
            </div>

            <p id="rematchStatus" style="color:var(--primary); font-weight:bold; margin-top:10px; font-size:0.8rem;">
            </p>
        </div>
    </div>

    <div id="modal-pet-help" class="modal-overlay">
        <div class="modal-box"
            style="border: 2px solid var(--gold); background: linear-gradient(135deg, #2d3436, #000); color: white;">
            <div id="petHelpIcon" style="font-size: 4rem; margin-bottom: 10px;">üêæ</div>
            <h3 style="color:var(--gold); margin-bottom: 15px;">DOSTUNDAN YARDIM!</h3>
            <p id="petHelpMsg" style="font-size:1.1rem; line-height: 1.5; margin-bottom: 20px;">
                Sahibi, pes etme! Sana biraz daha zaman ve ≈üans getirdim.
            </p>
            <div id="petHelpReward" style="font-size: 1.5rem; font-weight: bold; color: #2ecc71; margin-bottom: 20px;">
                +3 HAK / +30 SN
            </div>
            <button class="btn-gold" onclick="closeModal('modal-pet-help')"
                style="width: 100%; padding: 12px; font-weight: bold;">TE≈ûEKK√úRLER!</button>
        </div>
    </div>

    <!-- PIGGY BANK WIN OVERLAY (ONLY FOR WINS) -->
    <div id="piggyWinOverlay" class="piggy-overlay">
        <div class="piggy-container">
            <div class="piggy-icon">üè¶</div>
            <div class="piggy-glow"></div>
            <h2 class="piggy-title">KAZANDIN!</h2>
            <div id="piggyAmount" class="piggy-amount">+0 Altƒ±n</div>
            <div class="piggy-fill-container">
                <div id="piggyFillBar" class="piggy-fill-bar"></div>
            </div>
            <div id="coinDropLayer" class="coin-drop-layer"></div>
            <!-- BUTONLAR -->
            <div id="piggyButtons" style="display:none; margin-top:25px; gap:10px; justify-content:center;">
                <button class="btn-green" onclick="closePiggyAndReplay()" style="padding:15px 25px; font-size:1rem;">üîÑ
                    TEKRAR OYNA</button>
                <button class="btn-red" onclick="closePiggyAndExit()" style="padding:15px 25px; font-size:1rem;">üö™
                    √áIKI≈û</button>
            </div>
        </div>
    </div>

    <div id="modal-feedback" class="modal-overlay">
        <div class="modal-box">
            <h3>üì¢ Geri Bildirim</h3>
            <p style="color:#eee;font-size:0.8rem;">Oyunla ilgili hata veya √∂nerini yaz.</p><textarea id="feedbackInput"
                placeholder="Mesajƒ±nƒ±z..." style="height:100px;"></textarea><button onclick="submitFeedback()"
                class="btn-blue">G√ñNDER</button><button onclick="closeModal('modal-feedback')"
                class="btn-red">ƒ∞PTAL</button>
        </div>
    </div>


    <div id="screen-wait" class="screen">
        <div class="card"><button class="btn-red"
                style="width:auto;padding:5px 15px;font-size:0.9rem;z-index:9999;position:relative;"
                ontouchstart="attemptExit()" onclick="attemptExit()">√áIKI≈û</button><br>
            <h2>Bekleniyor...</h2>
            <div id="roomCodeDisplay"
                style="font-size:3rem;background:rgba(255,255,255,0.2);padding:10px;letter-spacing:5px;"></div>
            <p id="roomModeInfo"></p>
            <h4>Davet Et</h4>
            <div id="inviteListWait" class="list-container"></div>
        </div>
    </div>

    <div id="screen-game" class="screen">
        <div class="card"
            style="display:flex;justify-content:space-between;background:rgba(0,0,0,0.8);color:white;padding:10px;">
            <div id="p1Indicator" class="turn-indicator">P1</div>
            <div id="timerDisplay" style="color:var(--gold);display:none;font-weight:bold;"></div>
            <div id="gamePetDisplay"></div>
            <div id="p2Indicator" class="turn-indicator">P2</div>
        </div>
        <div class="card" id="gameCard">
            <div style="display:flex;justify-content:space-between;"><button class="btn-red"
                    style="width:auto;padding:5px 15px;font-size:0.9rem;z-index:9999;position:relative;"
                    ontouchstart="attemptExit()" onclick="attemptExit()">√áIKI≈û</button>
                <div style="text-align:right;"><span id="rightsDisplay"
                        style="font-weight:bold;color:var(--danger);">Hak:
                        15</span><button class="btn-gold" style="padding:2px 8px;font-size:0.7rem;width:auto;"
                        onclick="useHint()">üì∫ ƒ∞pucu (Reklam)</button></div>
            </div>
            <div class="item-bar"><button class="item-btn" onclick="useItem('oracle')">üîÆ Kahin<div id="qty-oracle"
                        class="item-count">0</div></button><button class="item-btn" onclick="useItem('freeze')">‚ùÑÔ∏è Zaman
                    <div id="qty-freeze" class="item-count">0</div>
                </button><button id="btnSabotage" class="item-btn" onclick="useItem('sabotage')">üòà Sabotaj<div
                        id="qty-sabotage" class="item-count">0</div></button>
            </div>
            <input type="tel" id="guessInput" placeholder="____"
                style="font-size:24px;letter-spacing:5px;margin-top:20px;" autocomplete="off"><button id="btnGuess"
                class="btn-green" onclick="makeGuess()" style="height:50px;">TAHMƒ∞N
                ET</button>
            <div class="emoji-bar"><button class="emoji-btn" onclick="sendEmoji('üëç')">üëç</button><button
                    class="emoji-btn" onclick="sendEmoji('üòÇ')">üòÇ</button><button class="emoji-btn"
                    onclick="sendEmoji('üòé')">üòé</button><button class="emoji-btn"
                    onclick="sendEmoji('üò±')">üò±</button><button class="emoji-btn" onclick="sendEmoji('üò°')">üò°</button>
            </div>
            <ul id="history" style="list-style:none;padding:0;margin-top:10px;max-height:200px;overflow-y:auto;"></ul>
            <div style="margin-top:15px;border-top:1px solid #eee;padding-top:10px;">
                <div style="display:flex;justify-content:space-between;align-items:center;">
                    <button id="btnGameChatToggle" class="btn-grey"
                        style="font-size:0.7rem;padding:5px;width:auto;position:relative;" onclick="toggleGameChat()">
                        üí¨ Sohbet
                        <span id="gameChatBadge"
                            style="display:none; position:absolute; top:-5px; right:-5px; width:10px; height:10px; background:red; border-radius:50%; border:1px solid white;"></span>
                    </button>
                    <button id="btnBlockChat" class="btn-dark" style="font-size:0.7rem;padding:5px;width:auto;"
                        onclick="toggleChatBlock()">üö´ Engelle</button>
                    <button class="btn-gold" style="font-size:0.7rem;padding:5px;width:auto;"
                        onclick="showModal('modal-feedback')">üì¢ Bildir</button>
                </div>
                <div id="gameChatContainer">
                    <div
                        style="display:flex;justify-content:space-between;margin-bottom:5px;color:#eee;font-size:0.8rem;">
                        <span>üí¨ Canlƒ± Sohbet</span><span onclick="toggleGameChat()"
                            style="cursor:pointer;color:#bbb;">Kapat ‚ñ≤</span>
                    </div>
                    <div id="gameChatBox" class="game-chat-box"></div>
                    <div style="display:flex;gap:5px;margin-top:5px;"><input id="gameChatInput" placeholder="Mesaj..."
                            style="padding:8px;margin:0;text-shadow:none;"><button class="btn-blue"
                            style="width:auto;margin:0;padding:5px 10px;" onclick="sendGameChat()">‚û§</button></div>
                </div>
            </div>
        </div>
    </div>




    <div id="screen-admin" class="screen">
        <div class="card"><button class="nav-btn" onclick="handleBackButton()">‚¨Ö</button>
            <h2>üëë Pro Y√∂netim</h2>
            <div class="admin-dashboard">
                <div class="admin-card">
                    <h4>üë• √úye</h4>
                    <div class="val" id="totalUserCount">0</div>
                </div>
                <div class="admin-card">
                    <h4>üü¢ Online</h4>
                    <div class="val" id="statOnline">0</div>
                </div>
                <div class="admin-card">
                    <h4>üè† Odalar</h4>
                    <div class="val" id="statRooms">0</div>
                </div>
            </div>

            <!-- KULLANICILAR - EN BA≈ûA TA≈ûINDI -->
            <div class="admin-section">
                <h3>üë• Kullanƒ±cƒ±lar</h3>
                <input type="text" id="adminUserSearch" placeholder="Kullanƒ±cƒ± Ara..." oninput="renderAdminView()" style="font-size:0.8rem; padding:8px; margin-bottom:5px; width:100%;">
                <div style="display:flex;gap:5px;margin-bottom:5px;">
                    <button id="btnFilterAll" class="btn-dark" style="flex:1;padding:5px;font-size:0.7rem;" onclick="filterAdminUsers('all')">‚ôæÔ∏è T√ºm√º</button>
                    <button id="btnFilterOnline" class="btn-green" style="flex:1;padding:5px;font-size:0.7rem;" onclick="filterAdminUsers('online')">üü¢ Online</button>
                    <button id="btnFilterOffline" class="btn-grey" style="flex:1;padding:5px;font-size:0.7rem;" onclick="filterAdminUsers('offline')">‚ö´ Offline</button>
                    <button id="btnFilterNew" class="btn-blue" style="flex:1;padding:5px;font-size:0.7rem;" onclick="filterAdminUsers('new')">üÜï Yeni</button>
                </div>
                <div id="adminUserList" class="list-container" style="max-height:300px;">Y√ºkleniyor...</div>
            </div>

            <!-- T√úM MESAJLAR - YENƒ∞ EKLENDƒ∞ -->
            <div class="admin-section">
                <h3>üí¨ T√ºm Oyuncu Mesajlarƒ±</h3>
                <button class="btn-purple" onclick="showAllPlayerMessages()" style="width:100%; margin-bottom:10px;">üì® T√ºm Mesajlarƒ± G√∂r</button>
            </div>

            <div class="admin-section">
                <h3>üõ†Ô∏è Sistem</h3><input id="marqueeInput" placeholder="Kayan Yazƒ± Gir..."
                    style="font-size:0.8rem; padding:8px;"><button class="btn-blue" onclick="updateMarquee()"
                    style="padding:8px; font-size:0.8rem;">G√úNCELLE</button>
                <div style="margin-top:10px; border-top:1px solid #eee; padding-top:5px;"><small
                        style="color:#666; font-weight:bold;">üåßÔ∏è Altƒ±n Yaƒümuru (√áarpan)</small>
                    <div style="display:flex; gap:5px; margin-top:3px;"><button class="btn-grey"
                            onclick="setGoldMultiplier(1)" style="flex:1; padding:5px; font-size:0.7rem;">Normal
                            (x1)</button><button class="btn-gold" onclick="setGoldMultiplier(2)"
                            style="flex:1; padding:5px; font-size:0.7rem;">Ba≈ülat (x2)</button><button class="btn-red"
                            onclick="setGoldMultiplier(5)" style="flex:1; padding:5px; font-size:0.7rem;">Dev
                            (x5)</button>
                    </div>
                </div>

                <div style="margin-top:10px; border-top:1px solid #eee; padding-top:5px;">
                    <small style="color:#666; font-weight:bold;">‚ö†Ô∏è Sƒ±fƒ±rlama ƒ∞≈ülemleri</small>
                    <div style="display:flex; gap:5px; margin-top:3px;">
                        <button class="btn-red" onclick="resetDailyJackpot()"
                            style="flex:1; padding:5px; font-size:0.7rem;">üóëÔ∏è JACKPOT Sƒ∞L</button>
                        <button class="btn-red" onclick="resetSpeedRuns()"
                            style="flex:1; padding:5px; font-size:0.7rem;">üóëÔ∏è SPEEDRUN Sƒ∞L</button>
                        <button class="btn-red" onclick="adminResetAllCareer()"
                            style="flex:1; padding:5px; font-size:0.7rem; background:#d63031; border:1px solid red;">‚ôªÔ∏è
                            KARƒ∞YER SIFIRLA</button>
                        <button class="btn-red" onclick="adminResetWordCareer()"
                            style="flex:1; padding:5px; font-size:0.7rem; background:#d63031; border:1px solid red;">‚ôªÔ∏è KELƒ∞ME SIFIRLA</button>
                    </div>
                </div>

                <div style="margin-top:10px; border-top:1px solid #eee; padding-top:5px;">
                    <small style="color:#666; font-weight:bold;">‚öôÔ∏è Sistem Kontrol√º</small>
                    <div style="display:flex; gap:5px; margin-top:3px;">
                        <button id="btnTogglePet" class="btn-dark" onclick="toggleSystem('pet')"
                            style="flex:1; padding:5px; font-size:0.7rem;">üêæ Pet: ...</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="admin-section">
            <h3>üì® Gelen Mesajlar</h3>
            <div id="adminMsgList" class="list-container" style="max-height:200px; overflow-y:auto;">
                <div style="padding:10px; text-align:center;">Y√ºkleniyor...</div>
            </div>
        </div>

        <div class="admin-section">
            <h3>üì¢ ≈ûikayet & Bildirimler</h3>
            <div id="adminReportList" class="list-container" style="max-height:200px;">Y√ºkleniyor...</div>
        </div>

        <div class="admin-section">
            <h3>üì¢ Duyuru</h3><input id="broadcastInput"><button class="btn-gold" onclick="sendBroadcast()">G√ñNDER</button>
        </div>
    </div>

    <!-- T√úM MESAJLAR MODAL - YENƒ∞ EKLENDƒ∞ -->
    <div id="modal-all-messages" class="modal-overlay">
        <div class="modal-box" style="max-width: 500px; max-height: 80vh;">
            <h3>üí¨ T√ºm Oyuncu Mesajlarƒ±</h3>
            <div style="display:flex; gap:5px; margin-bottom:10px;">
                <button class="btn-blue" onclick="loadAllMessages('game')" style="flex:1; font-size:0.8rem;">üéÆ Oyun</button>
                <button class="btn-purple" onclick="loadAllMessages('lobby')" style="flex:1; font-size:0.8rem;">üè† Lobi</button>
                <button class="btn-green" onclick="loadAllMessages('all')" style="flex:1; font-size:0.8rem;">‚ôæÔ∏è T√ºm√º</button>
            </div>
            <div id="allMessagesList" class="list-container" style="max-height: 400px; overflow-y: auto;">
                <div style="padding:10px; text-align:center;">Y√ºkleniyor...</div>
            </div>
            <button class="btn-red" onclick="closeModal('modal-all-messages')" style="margin-top:10px;">KAPAT</button>
        </div>
    </div>
</div>



<!-- SANDIK ETKƒ∞LE≈ûƒ∞M MODALI -->


<!-- SANDIK √ñD√úL MODALI -->
<div id="modal-pet" class="modal-overlay">
    <div class="modal-box"
        style="width:90%; max-width:400px; height:80vh; padding:0; display:flex; flex-direction:column; overflow:hidden;">
        <div
            style="padding:15px; background:#f4f4f4; border-bottom:1px solid #ddd; display:flex; justify-content:space-between; align-items:center;">
            <h3 style="margin:0;">üêæ Pet Kul√ºb√º</h3>
            <button class="btn-sm btn-red" onclick="closeModal('modal-pet')">X</button>
        </div>
        <div id="petListContainer" style="flex:1; overflow-y:auto; padding:10px; background:#fff;"></div>
        <div style="padding:15px; background:#fff; border-top:1px solid #eee; text-align:center;">
            <button id="btnFeedPet" class="btn-green" style="width:100%; padding:15px; font-size:1rem;"
                onclick="PetSystem.feedPet()">üçñ BESLE</button>
            <small style="display:block; margin-top:5px; color:#999;">Enerji: Bonuslarƒ±n √ßalƒ±≈ümasƒ±nƒ± saƒülar.</small>
        </div>
    </div>
</div>


<!-- MISSING MODAL RESTORED: Ad Watch / Web Mock -->
<div id="modal-ad-watch" class="modal-overlay" style="z-index:99999;">
    <div class="modal-box" style="text-align:center;">
        <h3>üì∫ Reklam Y√ºkleniyor...</h3>
        <p>L√ºtfen bekleyin...</p>
        <button class="btn-red" onclick="closeModal('modal-ad-watch')">Kapat</button>
    </div>
</div>
<script>
    window.onerror = function (msg, url, line) {
        const el = document.getElementById('errorLog');
        if (el) el.innerText = "Hata: " + msg;
        console.error("Global Error:", msg, url, line);
    };

    // Alert Override to filter generic AdMob errors
    const _originalAlert = window.alert;
    window.alert = function (msg) {
        if (msg && typeof msg === "string" && (msg.toLowerCase().includes("google bu kullanƒ±cƒ±ya reklam g√∂ndermedi") || msg.toLowerCase().includes("google bu kullanƒ±cƒ± i√ßin reklam g√∂ndermedi"))) return;
        if (_originalAlert) _originalAlert(msg);
    };
    let lastWidth = window.innerWidth;
    const fixH = () => {
        const newWidth = window.innerWidth;
        if (newWidth !== lastWidth) { lastWidth = newWidth; document.documentElement.style.setProperty('--app-height', `${window.innerHeight}px`); }
    };
    document.documentElement.style.setProperty('--app-height', `${window.innerHeight}px`);
    window.addEventListener('resize', fixH);

    const firebaseConfig = { apiKey: "AIzaSyD4Pe0CHilO9fEZd832vEK3-c5-MAZo3X8", authDomain: "oyuntahmin.firebaseapp.com", databaseURL: "https://oyuntahmin-default-rtdb.firebaseio.com", projectId: "oyuntahmin", storageBucket: "oyuntahmin.firebasestorage.app", messagingSenderId: "326852389532", appId: "1:326852389532:web:efd391392459a0c75a1b59", measurementId: "G-Q8JQJCTL62" };

    let db;
    let messaging; // Messaging servisi i√ßin deƒüi≈üken
    let user = { name: "", avatar: "üòé", gold: 500, xp: 0, level: 1, wordLevel: 1, careerLevel: 1, careerWins: 0, clan: "", winStreak: 0, extraSpins: 0, inventory: [], totalMinutes: 0, lastVaultTime: 0, claimedCareerRewards: {}, items: { oracle: 0, freeze: 0, sabotage: 0 } }; let gamesPlayedCount = 0; // Reklam sayacƒ±
    const ADMIN_NAMES = ["YazHamit", "Yazhamit"];
    const FORCE_AD_SIMULATOR = true; // Geli≈ütirme a≈üamasƒ±nda veya sorun olduƒüunda true yapƒ±n
    const VIP_NAMES = ["YazHamit", "Yazhamit"];
    const ADMIN_HASH = "OTc2NDkzLkh5"; // Base64 encoded
    const OKUEMEL_HASH = "RW1lbGfDtmthbHA="; // Base64 encoded
    let game = { active: false, mode: "", room: "", role: "", diff: 4, type: "classic", playStyle: "turn", turn: "p1", mySecret: "", rights: 15, duration: 3, timerInt: null, usedItems: [] };
    let globalMultiplier = 1;
    let activeQuest = null;
    let currentScreen = 'screen-login';
    let adminData = { users: {}, presence: {}, banned: {} };
    let adminListenersActive = false;
    let currentAdminTab = 'online';

    let pendingInviteRoom = null;
    let isChatBlocked = false;
    let playTimeInterval = null;
    let careerLevel = parseInt(localStorage.getItem("careerLevel")) || 1;


    // --- KELƒ∞ME OYUNU VERƒ∞TABANI (T√úRKƒ∞YE & TARƒ∞H) ---
    // D√úZELTƒ∞LDƒ∞: T√ºm kelimeler kendi seviye uzunluklarƒ±na uygun hale getirildi
    const WORD_DATA = {
        1: { length: 3, words: ["√ñH√ñ", "P√ñF", "B√ñƒû", "J√ñN", "F√ñY", "√á√ñP", "Fƒ∞ƒû", "G√ñZ", "G√ñ√á", "Jƒ∞G", "P√ñ√á", "√á√ñZ", "F√ñN", "F√úG", "HUƒû", "√ñRF", "P√úF", "BEJ", "√áIƒû", "D√ñ≈û", "J√úT", "√ñC√ú", "PUF", "POF", "√áAƒû", "√áƒ∞ƒû", "FO≈û", "GAF", "G√ñT", "G√ñN", "G√ñL", "G√ñK", "H√ñT", "HAF", "HAV", "JUL", "L√ñP", "OJE", "√ñGE", "RUJ", "S√ñZ", "≈ûOV", "VAH", "VIZ", "YOƒû", "ZAƒû", "CAƒû", "BAƒû", "√á√ñL", "√áAV", "DAƒû", "EV√á", "Fƒ∞≈û", "FAZ", "FA≈û", "G√ú√á", "G√úZ", "HOP", "JAK", "JEL", "JET", "K√ñZ", "√ñZE", "POP", "POG", "SIƒû", "≈ûƒ∞F", "≈ûEV", "≈ûEF", "T√ñZ", "VAZ", "YUF", "YEƒû", "YAƒû", "AƒûI", "B√ñN", "BAV", "√á√ú≈û", "D√ñL", "DAV", "DEF", "DEV", "FOS", "FAY", "GAH", "GAG", "HIZ", "HO≈û", "HU≈û", "HAH", "HEP", "HAP", "K√ñY", "K√úF", "KIƒû", "LOƒû", "LIƒû", "√ñL√ú", "√ñR√ú", "PAH", "POZ", "SOF", "SAƒû", "≈ûUH", "≈ûIP", "TUƒû", "T√úF", "TIƒû", "VAY", "Y√ñN", "Yƒ∞V", "ZIP", "ZIH", "COP", "CUP", "C√úZ", "AƒûA", "BOP", "B√úZ", "√áƒ∞P", "√áAP", "D√ú≈û", "D√úZ", "EƒûE", "FUL", "FON", "FOL", "FOK", "FLU", "FIR", "FES", "FAS", "FUT", "G√úM", "GEZ", "GE√á", "GAZ", "Gƒ∞Z", "Hƒ∞√á", "Hƒ∞≈û", "HUY", "HAC", "HA√á", "HAZ", "KOF", "KOV", "K√ñS", "L√ñS", "OVA", "√ñRS", "POY", "PE√á", "PE≈û", "Pƒ∞√á", "RUF", "S√ñR", "Sƒ∞F", "SAF", "SAV", "≈ûƒ∞P", "≈ûAP", "≈ûAH", "T√ñS", "VIN", "YUH", "Y√úZ", "Cƒ∞P", "CIZ", "CEP", "AFƒ∞", "AFT", "BO≈û", "BOZ", "BUZ", "BAP", "√áƒ∞≈û", "√áE√á", "DU≈û", "DOZ", "Dƒ∞P", "DAH", "DI≈û", "DEH", "EFE", "FAK", "Fƒ∞T", "Fƒ∞N", "Fƒ∞L", "FER", "FEN", "FEL", "FEK", "FAR", "FAN", "FAL", "G√úN", "G√úL", "G√úR", "HAB", "HEY", "HAD", "HAY", "H√úR", "ƒ∞FA", "KEF", "K√ñK", "K√úP", "K√ñR", "KAV", "LAF", "L√ñK", "Lƒ∞F", "LEF", "LAV", "L√úP", "MIH", "NEV", "√ñKE", "√ñRK", "√ñTE", "PUS", "POS", "PAY", "PEY", "P√úR", "RAF", "SUP", "≈ûƒ∞≈û", "≈ûE≈û", "≈ûAZ", "T√ñR", "T√úH", "T√úP", "TAV", "TEF", "VAN", "VAR", "VAT", "YOZ", "ZA√á", "CAZ", "AGU", "AHU", "Bƒ∞Z", "BOY", "BEZ", "BA√á", "BA≈û", "BAZ", "BE≈û", "√áƒ∞Y", "√áAY", "√á√úK", "DUY", "Dƒ∞Z", "Dƒ∞≈û", "DAZ", "EGO", "GUT", "GOL", "GIR", "GIK", "GEM", "GAM", "HIK", "HIR", "Hƒ∞S", "HOR", "HUN", "HOL", "HEM", "HAM", "HAS", "KUP", "LUP", "LOP", "MUZ", "MU≈û", "NUH", "OHA", "ORG", "PUT", "PUL", "POT", "Pƒ∞S", "Pƒ∞M", "PAS", "PIR", "PIT", "PES", "RUH", "ROP", "RIH", "SU√á", "Sƒ∞H", "SAH", "SAP", "≈ûAD", "≈ûOM", "≈ûEY"] },
        2: { length: 4, words: ["√ñVG√ú", "√ñV√ú≈û", "FEV√á", "G√ñ√á√ú", "J√ñLE", "√ñVE√á", "√ñZG√ú", "√ñP√ú≈û", "√ñƒû√úN", "√ñƒû√úR", "√ñƒû√úT", "BL√ñF", "GUAJ", "Jƒ∞PS", "√ñDEV", "B√ñC√ú", "D√úƒû√ú", "G√ñZE", "G√ñN√á", "G√ñM√ú", "G√ñCE", "HAJE", "JUDO", "√ñVME", "√ñZGE", "√ñƒûLE", "PLAJ", "S√ñRF", "S√ñVE", "AFƒ∞F", "BUJƒ∞", "√áOƒûU", "F√ñTR", "FAVA", "FEVT", "FEVK", "G√ñR√ú", "G√úVE", "OBJE", "OƒûUZ", "√ñRG√ú", "√ñRFƒ∞", "√ñFKE", "S√úJE", "≈ûARJ", "VEFA", "VALF", "ZEV√á", "AƒûCI", "AƒûI≈û", "AƒûIZ", "B√ñCE", "BUƒûU", "√áIƒûA", "DOƒûU", "FI√áI", "F√úZE", "GOLF", "G√úC√ú", "H√ñST", "JURO", "J√úRƒ∞", "√ñR√ú≈û", "√ñ≈û√úR", "√ñT√ú≈û", "√ñZL√ú", "√ñ√áL√ú", "√ñZ√úR", "√ñL√á√ú", "√ñL√ú≈û", "√ñNC√ú", "√ñPME", "√ñK√úZ", "√ñZ√úT", "UZUV", "√úZG√ú", "√úVEZ", "VAMP", "AVCI", "AVU√á", "AƒûA√á", "AJUR", "BOƒûA", "B√ñL√ú", "B√úVE", "B√úFE", "BAƒûI", "√áAƒûA", "DOƒûA", "D√úVE", "Eƒûƒ∞≈û", "Eƒûƒ∞√á", "FLO≈û", "FO√áA", "FO≈ûA", "G√ñRK", "G√ñRE", "G√ñLE", "GREV", "G√úD√ú", "GIGI", "HAVƒ∞", "HAVA", "HAFƒ∞", "HARF", "ƒ∞VGƒ∞", "ƒ∞MAJ", "ƒ∞ƒûCƒ∞", "JEST", "KAJU", "MARJ", "OJƒ∞T", "√ñRGE", "√ñYK√ú", "√ñB√úR", "√ñD√úL", "√ñD√úN", "POPO", "PUHU", "STAJ", "≈ûUFA", "UZVƒ∞", "√úVEY", "√ú√á√úZ", "VAHA", "VAHƒ∞", "VAZO", "YAƒûI", "CIVA", "CEZP", "AVAZ", "AFƒ∞≈û", "AGOP", "AƒûDA", "AƒûIM", "AƒûSI", "AJAN", "BAƒûA", "√áƒ∞FT", "√áƒ∞Vƒ∞", "DAƒûƒ∞", "DEFO", "EVƒ∞√á", "EVCƒ∞", "EVCE", "Fƒ∞≈ûE", "FLA≈û", "FOBƒ∞", "F√úRS", "F√úME", "FRƒ∞Z", "FOYA", "F√úRU", "FA√áA", "FAƒ∞Z", "FARZ", "FECƒ∞", "FEZA", "FER√á", "FEL√á", "FERZ", "G√úRZ", "G√úCE", "GRUP", "GASP", "GAYZ", "HOPA", "HU≈ûU", "IƒûIL", "ƒ∞VAZ", "ƒ∞≈ûVE", "ƒ∞F≈ûA", "ƒ∞ƒûDE", "JALE", "JANR", "JANT", "Jƒ∞LE", "K√ñ≈ûE", "K√ñ≈ûK", "KUƒûU", "KIƒûI", "M√úFT", "M√ñN√ú", "OƒûUL", "√ñR√úM", "√ñZEK", "√ñZEL", "√ñZEN", "√ñZET", "√ñZNE", "√ñDEM", "√ñK√áE", "√ñL√úM", "√ñM√úR", "√ñNCE", "Pƒ∞PO", "PUPA", "PO≈ûU", "REJƒ∞", "SOFU", "S√ñBE", "SIVI", "S√úLF", "SAƒûI", "SIƒûA", "≈ûAFT", "≈ûEYH", "≈ûƒ∞FA", "≈ûƒ∞VE", "≈ûEVK", "≈ûAVK", "≈ûELF", "UƒûRU", "UƒûUR", "UƒûUT", "Vƒ∞DO", "Vƒ∞N√á", "Vƒ∞ZE", "VECT", "VAAZ", "VAƒ∞Z", "VECA", "YIVA", "YUVA", "ZAAF", "Zƒ∞FT", "ZEVK", "ZARF", "Z√úHT", "Cƒ∞FE", "C√ñNK", "CEFA", "API≈û", "AYVA", "AGAH", "AGU≈û", "AƒûIL", "AƒûIN", "AƒûIR", "AƒûIT", "AƒûLI", "AƒûMA", "AƒûRI", "AH√áI", "B√ñLE", "B√ñKE", "B√ñRK", "B√úY√ú", "√áIPA", "√áƒ∞PO", "√áUCU", "√áUHA", "D√ñRT", "DEVE", "DEVA", "DAVA", "DEFƒ∞", "DEFA", "EY√úP", "ET√úV", "EƒûSƒ∞", "EƒûME", "Eƒûƒ∞M", "FL√úT", "FORM", "FORS", "FOTO", "FABL", "FEDA", "Fƒ∞DE", "G√úN√ú", "GU≈ûA", "GRƒ∞P", "G√úYA", "GARP", "GANG", "GAƒ∞P", "GAHƒ∞", "GAGA", "GACI", "GIDI", "HACI", "HIN√á", "HOCA", "HO≈ûT", "HUR√á", "H√úDA", "HARP", "K√ñT√ú", "K√úFE", "Kƒ∞ƒûI", "MUAF", "N√úVE", "OVMA", "OTAƒû", "OFƒ∞S", "OƒûAN", "√ñBEK", "√ñRT√ú", "√ñR√úK"] },
        3: { length: 5, words: ["G√ñƒû√úS", "D√ñV√ú≈û", "G√ñZG√ú", "√ñV√úC√ú", "S√ñVG√ú", "S√ñƒû√ú≈û", "√á√ñP√á√ú", "√á√ñZG√ú", "√á√ñƒû√úR", "G√ñZC√ú", "G√ñVDE", "G√ñ√á√ú≈û", "G√ñƒûEM", "S√ñV√ú≈û", "B√ñƒû√úR", "√á√ñZ√ú≈û", "√á√ñƒûME", "D√ñVƒ∞Z", "D√ñVE√á", "G√ñVDE", "√ñV√úN√á", "REF√úJ", "A√áG√ñZ", "FUJER", "FEHVA", "G√ñM√ú≈û", "G√ñREV", "G√ñRG√ú", "G√ñVEK", "G√ñVEL", "G√ñZ√úM", "G√ñ√á√úM", "G√úƒû√úM", "HAFƒ∞F", "J√úPON", "KUV√ñZ", "M√ñSY√ñ", "MAJ√ñR", "S√ñƒû√úT", "≈ûOF√ñR", "VOYVO", "BAGAJ", "√á√ñPL√ú", "√á√ñVEN", "√á√ñZ√úM", "DOZAJ", "D√ñVME", "DEGAJ", "FUHU≈û", "G√ñNC√ú", "G√ñR√ú≈û", "G√ñZDE", "G√ñZL√ú", "G√ñ√á√úK", "G√ñDE≈û", "G√úVE√á", "G√úVEZ", "G√úZAF", "HIFIZ", "LAVAJ", "√ñZG√úL", "√ñZG√úN", "√ñZG√úR", "P√ñ√á√úK", "S√ñZC√ú", "Vƒ∞RAJ", "VUZUH", "Vƒ∞Z√ñR", "Zƒ∞FAF", "CEVVƒ∞", "BUƒûUZ", "BR√ñVE", "√á√ñZ√úK", "√á√ñK√ú≈û", "D√ñNG√ú", "DOƒûU≈û", "D√úƒû√úM", "G√ñY√úK", "G√ñME√á", "G√ñLGE", "G√ñB√úT", "G√ñ√áME", "H√ñY√úK", "HO≈ûAF", "H√ñD√úK", "HAFIZ", "HAVU√á", "HAVUZ", "JAPON", "LAƒûIV", "M√úJDE", "√ñZDE≈û", "√ñL√á√ú≈û", "PONJE", "PROJE", "PASAJ", "PENG√ñ", "S√ñVME", "T√ñVBE", "VUKUF", "VAZIH", "VASIF", "YIƒûI≈û", "YUVGU", "ZAƒûCI", "Z√úYUF", "ARPEJ", "AHFE≈û", "BOƒûAZ", "B√úƒûL√ú", "B√úZG√ú", "B√ñL√ú≈û", "BAƒûCI", "BAƒûI≈û", "√á√ñMEZ", "√á√ñZME", "√áUVA≈û", "√á√ñM√áE", "√áAVU≈û", "D√ñN√ú≈û", "DOƒûA√á", "D√ñ≈ûL√ú", "D√úƒû√úN", "D√úZG√ú", "DAƒûCI", "EVSAF", "FARƒ∞ƒû", "FAHƒ∞≈û", "FERAƒû", "G√ñM√úK", "G√ñM√úT", "G√ñR√úM", "G√ñYME", "G√ñZER", "G√ñCEN", "G√ñK√áE", "G√ñ√áER", "GAZVE", "GARAJ", "GEVA≈û", "GEVƒ∞≈û", "Hƒ∞Cƒ∞V", "HUSUF", "HOPPA", "HA≈ûƒ∞V", "HAVZA", "HAYIF", "IƒûRIP", "ƒ∞FRAƒû", "ƒ∞ƒûFAL", "JELOZ", "KUVVE", "K√ñYC√ú", "√ñR√úC√ú", "√ñT√úC√ú", "√ñVMEK", "√ñZALP", "√ñD√úN√á", "√ñƒûLEN", "√ñƒûREK", "Pƒ∞KAJ", "POP√áU", "POSOF", "S√ñZCE", "S√ñVEN", "≈û√ñMƒ∞Z", "≈û√úPHE", "VACƒ∞P", "VULVA", "VAKIF", "VAH≈ûƒ∞", "VE√áHE", "VECƒ∞H", "YAƒûCI", "YAƒûI≈û", "YAƒûIZ", "Zƒ∞HAF", "Z√úPPE", "Z√úL√úF", "CEVAP", "ABUJA", "AFƒ∞FE", "BOƒûUM", "B√úLUƒû", "B√ñLGE", "B√ñB√úR", "BANJO", "BAVCI", "√áƒ∞ƒûDE", "√áIƒûIR", "√áOƒûUL", "√áOƒûUN", "√á√ñK√úM", "D√ñGER", "D√ñ≈ûEM", "DOƒûUM", "D√ú≈û√á√ú", "D√ú≈û√ú≈û", "D√úƒûME", "D√úGAH", "DEƒûƒ∞≈û", "DEƒûE√á", "EVVEL", "EYVAH", "EVKAF", "Fƒ∞FRE", "Fƒ∞G√úR", "FL√ñRE", "FL√ñRT", "FETVA", "FEVRƒ∞", "FIKIH", "G√ñN√úL", "G√ñNYE", "G√ñMME", "G√ñBEK", "G√ñBEL", "G√ñL√úK", "G√ñDEN", "G√úM√ú≈û", "G√úVEN", "G√úP√úR", "G√úFTE", "GEYVE", "Hƒ∞Dƒ∞V", "HEDEF", "Hƒ∞PPƒ∞", "HAHHA", "HAP√áI", "HAVYA", "HAYFA", "HAP≈ûU", "ƒ∞FFET", "ƒ∞ƒûDƒ∞≈û", "JOKEY", "KOƒûU≈û", "Kƒ∞FAF", "K√ñM√ú≈û", "K√ñPR√ú", "K√ñP√úK", "K√ñS√á√ú", "K√ñFTE", "KAVAF", "L√ñP√úR", "Lƒ∞Z√ñZ", "MAHIV", "N√úFUZ", "OBERJ", "√ñB√úR√ú", "√ñRG√úT", "√ñZEN√á", "√ñRG√úN", "√ñKS√úZ", "√ñL√á√úM", "√ñLG√úN", "√ñLM√ú≈û", "RODAJ", "R√ñFLE", "S√úZG√ú", "S√ñZL√ú", "S√ñZDE", "S√ñK√ú≈û", "SAƒûCI", "T√ñRP√ú", "TUƒûCU", "TAVAF", "√úZ√úC√ú", "√úRG√úP", "√úƒûR√úM", "VEREV", "V√úCUT", "VURGU", "VELEV", "VAL√ñR", "VAKFE", "VAHƒ∞Y", "VEFAT", "VECƒ∞Z", "VADUZ", "YAVUZ", "Y√úZ√ú≈û", "ZEVCE", "ZAYIF", "CEZVE", "C√úRUF", "CEVZA", "CEVƒ∞Z", "CEVAZ", "AYVAZ", "AZVAY", "A≈ûAƒûI", "AƒûCIK", "AH≈ûAP", "BOƒûUK", "BOƒûMA", "B√úƒûET", "B√ñL√úM", "B√ñCEK", "B√ñNCE", "BUƒûUR"] },
        4: { length: 6, words: ["√ñVG√úC√ú", "G√ñMG√ñK", "≈ûEFFAF", "FAƒûFUR", "G√ñ√á√úC√ú", "HAVHAV", "√ñZBE√ñZ", "√ñƒû√úR√ú≈û", "√ñƒû√úT√á√ú", "√ñƒû√úT√ú≈û", "S√ñV√úC√ú", "Y√úZG√ñZ", "BL√ñF√á√ú", "√á√ñPS√úZ", "√á√ñZ√úC√ú", "G√ñZS√úZ", "G√ñZEVƒ∞", "H√ñRG√ú√á", "JORJET", "√ñV√úL√ú≈û", "POMPAJ", "BEVVAP", "√á√ñZG√úN", "DEJAVU", "G√ñLK√ñY", "JANJAN", "√ñNG√ñR√ú", "POHPOH", "PEYZAJ", "R√ñL√ñVE", "S√ñRF√á√ú", "≈ûARJ√ñR", "CAFCAF", "Cƒ∞VCƒ∞V", "√á√ñƒûMEK", "D√ñ≈ûS√úZ", "G√ñR√úC√ú", "G√ñLOVA", "JUDOCU", "√ñRG√úC√ú", "√ñV√úNCE", "√ñP√úC√úK", "√ñƒû√úRT√ú", "SOLFEJ", "SUFL√ñZ", "SAƒûYAƒû", "CAMG√ñZ", "√áUH√áUH", "FISFIS", "G√ñRM√ú≈û", "G√ñVERƒ∞", "GOLF√á√ú", "G√ñKEVƒ∞", "GEHGEH", "GAFFAR", "HECCAV", "HO≈ûHO≈û", "KA√áG√ñ√á", "M√úJGAN", "√ñ≈û√úRC√ú", "√ñP√ú≈ûME", "√ñZGECƒ∞", "√ñV√úNT√ú", "√ñƒû√úRME", "√ñƒû√úTME", "√ñL√á√úC√ú", "PEHPEH", "SOVHOZ", "S√ñZS√úZ", "≈ûIP≈ûIP", "TAHFƒ∞F", "VOLTAJ", "ZIPZIP", "Cƒ∞NG√ñZ", "AVERAJ", "AHUVAH", "BOƒûUCU", "B√úGD√úZ", "B√ñL√úC√ú", "BA≈ûBUƒû", "√áIVGIN", "√á√ñPL√úK", "√áAƒûDA≈û", "D√úZK√ñY", "D√ñVMEK", "D√ñRD√úZ", "DEGAJE", "FLA≈û√ñR", "FRƒ∞T√ñZ", "FOSFOR", "FALANJ", "FI√áICI", "G√ñM√úL√ú", "G√ñ√áEBE", "G√ñ√áK√úN", "G√ñK√á√úL", "G√ñLC√úK", "G√ñLC√úL", "G√úVEN√á", "G√ñZL√úK", "G√ú√áS√úZ", "G√úD√úC√ú", "Hƒ∞JYEN", "ƒ∞√áG√ñR√ú", "J√ñLELƒ∞", "Jƒ∞GOLO", "JEOLOG", "K√ñRFEZ", "Mƒ∞LF√ñY", "MEVSUF", "MAƒû≈ûU≈û", "MAƒûFUR", "MAHFUZ", "ORD√ñVR", "OƒûUZCA", "√ñV√úLME", "√ñYK√úC√ú", "√ñV√úNME", "√ñD√úNC√ú", "√ñZVERƒ∞", "POƒûA√áA", "RUJSUZ", "R√ñVAN≈û", "S√ñZC√úK", "S√ñYLEV", "STOPAJ", "≈ûIVGIN", "≈ûEVVAL", "≈û√ñVALE", "TAVZƒ∞F", "TEFVƒ∞Z", "VODVƒ∞L", "VAJƒ∞NA", "VAFTƒ∞Z", "VAZƒ∞FE", "ZAƒûSIZ", "CEVVAL", "ACIG√ñL", "BOƒûUN√á", "Bƒ∞VEFA", "BUZAƒûI", "BUƒûDAY", "BAƒûSIZ", "BAƒûDA≈û", "BAƒûICI", "√áIVGAR", "√áAƒûCIL", "√á√úNG√ú≈û", "DOƒûACI", "D√úƒûM√úK", "DUBLAJ", "DE≈ûARJ", "FOSFAT", "FIRFIR", "F√úZYON", "G√ñRMEZ", "G√ñT√úR√ú", "G√ñYN√úK", "G√ñ√áMEK", "G√ñ√áMEN", "G√ñZEME", "G√ñZLEM", "G√úVEYƒ∞", "GRAMAJ", "GE√áGE√á", "GIYGIY", "GERGEF", "GEVHER", "HAFIZA", "HAVACI", "HA≈ûHA≈û", "JAGUAR", "JARGON", "JAPONE", "K√úFFAR", "K√ñSEƒûƒ∞", "K√ñFT√úN", "Mƒ∞ƒûFER", "MEVKUF", "MELFUF", "N√úH√úFT", "√ñRG√úL√ú", "√ñV√úNEK", "√ñDEVLƒ∞", "√ñL√úEVƒ∞", "Pƒ∞≈ûTOV", "Pƒ∞JAMA", "R√ñLYEF", "SOƒûDCA", "S√ñVMEK", "SUFL√ñR", "SAƒûDI√á", "Y√úZGE√á", "Y√ñNS√úZ", "YAPAƒûI", "YAƒûSIZ", "Y√úZ√úC√ú", "Z√úƒû√úRT", "CIDAƒûI", "ANGAJE", "AƒûDACI", "BONJUR", "B√úFECƒ∞", "B√úY√úC√ú", "BOZOVA", "BANDAJ", "BAƒûRI≈û", "BAƒûCIK", "BEYDAƒû", "√áƒ∞ƒûDEM", "√áEVGEN", "√á√ñZMEK", "√áAV≈ûIR", "D√úZG√úN", "D√ú≈ûS√úZ", "DEBBAƒû", "DEƒûGƒ∞N", "DEHHA≈û", "DAƒûLI√á", "DAƒûCIL", "DIƒûDIK", "Fƒ∞≈ûSƒ∞Z", "FORVET", "FL√úT√á√ú", "FONDƒ∞P", "FAHƒ∞≈ûE", "FA≈ûƒ∞NG", "FAKFON", "FEYYAZ", "FAVORƒ∞", "FA≈ûƒ∞ZM", "G√ñNEN√á", "G√ñRDES", "G√ñRECE", "G√ñRECƒ∞", "G√ñYMEK", "G√ñZELƒ∞", "G√ñ√áERƒ∞", "G√ñK√áEK", "G√ñK≈ûƒ∞N", "G√ñZENE", "G√úND√úZ", "G√úN√úC√ú", "G√úRB√úZ", "GREVCƒ∞", "GASP√áI", "GEV≈ûEK", "GEVEZE", "H√úZZAM", "HO≈ûBE≈û", "HAYHUY", "HASK√ñY", "HA≈ûEFE", "ƒ∞VEƒûEN", "ƒ∞√áYAƒûI", "ƒ∞√áG√úD√ú", "JAMBON", "JALUZƒ∞", "JAKUZƒ∞", "J√úBƒ∞LE", "KOF√áAZ", "KUVVET", "K√ñYDE≈û", "KUAF√ñR", "MEVHUM", "MUSHAF", "MAHCUP", "MAƒûLUP", "MAFEVK", "MEFSUH", "MEFHUM", "OVOGON", "√ñTLEƒûƒ∞", "√ñP√úLME", "√ñR√úL√ú≈û", "√ñZ√úNL√ú", "√ñZCESƒ∞", "√ñZ√úRL√ú", "√ñƒûRETƒ∞", "√ñL√á√úL√ú", "POZSUZ", "P√ñRS√úK", "PARF√úM", "PERVAZ", "PE≈ûREV", "PAVYON", "PAZVAL", "SONDAJ", "S√úZGE√á", "S√ñLP√úK", "SAƒûICI", "SAFFET", "S√úZ√úC√ú", "≈ûƒ∞FAHƒ∞", "≈û√ñHRET", "≈ûEHVET", "≈ûEHEVƒ∞", "TEV≈ûƒ∞H", "TEVCƒ∞H", "T√úVEY√á"] },
        5: { length: 7, words: ["√á√ñPL√úƒû√ú", "D√ñV√ú≈û√á√ú", "D√ñ≈ûG√ñM√ú", "S√ñVG√úC√ú", "√á√ñƒû√úRC√ú", "G√ñƒû√úMS√ú", "G√ñZDAƒûI", "B√ñƒû√úR√ú≈û", "G√ñƒû√úSL√ú", "JOGGƒ∞NG", "√ñƒû√úT√úC√ú", "D√ñV√úN√ú≈û", "D√ñV√úL√ú≈û", "DIƒûDIƒûI", "√á√ñZ√úMC√ú", "D√ñV√ú≈ûME", "FAƒûFURƒ∞", "G√ñZLEƒûƒ∞", "HO≈ûG√ñR√ú", "JEOLOJƒ∞", "SAƒûG√ñR√ú", "BURJUVA", "B√ñƒû√úRT√ú", "√á√ñZ√úL√ú≈û", "√á√ñƒû√úNME", "G√ñVERƒ∞≈û", "G√ñKY√úZ√ú", "G√ñ√á√ú≈ûME", "G√ñZYA≈ûI", "HAFƒ∞F√áE", "J√ñLESƒ∞Z", "KU≈ûG√ñZ√ú", "K√ñPOƒûLU", "PORTF√ñY", "S√ñV√ú≈ûME", "A√áG√ñZL√ú", "B√ñƒû√úRME", "√á√ñZ√ú≈ûME", "D√úƒû√úNC√ú", "D√ñVMECƒ∞", "DAƒûDAƒûA", "FEVVARE", "G√ñRG√úL√ú", "G√ñM√úL√ú≈û", "G√ñR√úNG√ú", "G√ñVDELƒ∞", "GAGAVUZ", "H√ñP√úRT√ú", "Hƒ∞POFƒ∞Z", "HAVUZCU", "√ñRG√úS√úZ", "√ñZG√úRCE", "√ñV√úNGEN", "√ñL√úDOƒûA", "P√ñTƒ∞B√ñR", "S√ñƒû√úTL√ú", "UHUVVET", "VOYVODA", "A√áIKG√ñZ", "AFFEDƒ∞≈û", "BUƒûUEVƒ∞", "BAƒûI≈û√áI", "√á√ñZ√úL√úM", "D√ñV√úNME", "D√ñV√úLME", "DAƒûLAƒûI", "Fƒ∞LOZOF", "FOTOJEN", "G√ñVERME", "G√ñT√úR√ú≈û", "G√ñR√ú≈ûL√ú", "G√ñR√úN√ú≈û", "G√ñ√áELGE", "G√úM√ú≈û√á√ú", "G√ñZ√úNDE", "GAZOJEN", "GARAJCI", "H√ñD√úK√áE", "JAPONCA", "KU≈ûG√ñM√ú", "K√ñPR√úC√ú", "K√ñP√úR√ú≈û", "M√úJDECƒ∞", "√ñRG√úT√á√ú", "√ñNOLOJƒ∞", "√ñZ√úRS√úZ", "√ñZG√úL√úK", "√ñNG√ñRME", "√ñƒû√úRL√úK", "√ñDEVCƒ∞L", "√ñL√á√úS√úZ", "Pƒ∞KAJCI", "PROJECƒ∞", "P√ñTƒ∞FUR", "PARAG√ñZ", "S√ñƒû√úRME", "S√ñV√úNT√ú", "≈û√ñVALYE", "TEPEG√ñZ", "√úZG√úS√úZ", "Vƒ∞RT√ú√ñZ", "VEFASIZ", "COƒûRAFƒ∞", "AƒûIZSIZ", "AKS√ñƒû√úT", "B√ñL√úNG√ú", "B√ñL√ú≈û√úM", "√áIƒûIRI≈û", "√áUVA≈û√áA", "√á√ñZ√úNT√ú", "√áOƒûULCU", "DOƒûURGU", "D√úƒû√úML√ú", "D√ñN√ú≈û√úM", "D√ñK√úMC√ú", "D√ñ≈ûEYƒ∞≈û", "FETVACI", "G√ñR√úMCE", "G√ñREVLƒ∞", "G√ñR√úNGE", "G√ñVERTƒ∞", "G√ñR√ú≈ûME", "G√ñLBA≈ûI", "G√ñ√á√úRME", "G√ñZ√úKME", "G√ñZETƒ∞≈û", "G√úLAƒûA√á", "G√úD√úMC√ú", "H√úVEYDA", "HOMOJEN", "HOPPACA", "KAFDAƒûI", "MUHAFIZ", "√ñP√ú≈ûMEK", "√ñZSEVER", "√ñZGECƒ∞L", "√ñZDEYƒ∞≈û", "√ñƒû√úTMEK", "√ñƒû√úRTME", "√ñƒû√úRMEK", "√ñƒûRETƒ∞≈û", "√ñƒûRENCƒ∞", "√ñƒûLENCƒ∞", "√ñFKESƒ∞Z", "√ñD√úNS√úZ", "√ñƒûRENƒ∞≈û", "REJƒ∞S√ñR", "SOƒûUYU≈û", "S√ñV√úLME", "≈û√úPHECƒ∞", "UZG√ñR√úR", "VAR≈ûOVA", "Vƒ∞RAJLI", "VAH≈ûƒ∞CE", "YIƒûI≈ûIM", "Z√úPPECE", "ARANJ√ñR", "AVANTAJ", "AƒûA√áSIZ", "AƒûIZCIL", "BOƒûU≈ûMA", "BOƒûULU≈û", "B√úZG√úL√ú", "B√úY√úY√ú≈û", "B√ñLGECƒ∞", "B√ñL√úN√ú≈û", "BA≈ûAƒûA√á", "√á√ñK√ú≈ûME", "√á√ñZ√úLME", "√á√ñZ√úNME", "√áOƒûALI≈û", "√áAƒûIRI≈û", "√áAƒûRICI", "DOƒûURU≈û", "DOƒûRUCU", "Dƒ∞PFRƒ∞Z", "Dƒ∞VRƒ∞ƒûƒ∞", "D√úPED√úZ", "D√úƒûMECƒ∞", "D√úZG√úL√ú", "D√ñPƒ∞YES", "D√ñN√ú≈ûL√ú", "D√ñ≈ûEMCƒ∞", "D√ñK√úL√ú≈û", "DEƒûƒ∞≈ûƒ∞≈û", "DAƒûBA≈ûI", "DAL√ñƒûLE", "EVVELCE", "EJEKT√ñR", "EJDERHA", "EGZOZCU", "G√ñN√áL√úK", "G√ñM√úLT√ú", "G√ñYN√úME", "G√ñT√úR√úM", "G√ñR√úN√úM", "G√ñBELEZ", "G√úM√ú≈ûS√ú", "G√úVENƒ∞≈û", "G√úVENCE", "G√úNY√úZ√ú", "G√úFTECƒ∞", "G√úB√úRC√ú", "GAZOZCU", "GEPGEN√á", "Hƒ∞CVƒ∞YE", "H√úCUMCU", "HACIAƒûA", "HAVASIZ", "HAVLUCU", "HAVUZLU", "JEODEZƒ∞", "J√úPƒ∞TER", "K√ñFTECƒ∞", "K√ñROƒûLU", "M√úVEZZƒ∞", "MUSAFFA", "MUVAFIK", "MARJSIZ", "MAVƒ∞K√úF", "MASAJCI", "√ñT√úMS√úZ", "√ñZVATAN", "√ñV√úNMEK", "√ñV√úLMEK", "√ñƒûLEYƒ∞N", "√ñƒûLENDE", "√ñZVEREN", "√ñM√úRS√úZ", "√ñL√úMS√úZ", "√ñLD√úR√ú≈û", "√ñL√á√ú≈ûME", "PLONJON", "POLƒ∞SAJ", "PARD√ñS√ú", "PAPAƒûAN", "PEN√áGAH", "PEDAGOG", "RAFƒ∞NAJ", "S√úR≈ûARJ", "S√ñM√úR√ú≈û", "SARIFƒ∞ƒû", "SARIG√ñZ", "≈û√ñMƒ∞ZYE", "V√úCUT√áA", "VUKUFLU", "VASIFLI", "VARSAƒûI", "YIƒûI≈ûMA", "YIƒûI≈ûIK", "YAVUZCA", "Z√úL√úFL√ú", "Z√úHREVƒ∞", "ZOOLOJƒ∞", "ZAPPƒ∞NG", "AƒûRIYI≈û", "AƒûA√á√áIK", "BOH√áACI", "BOƒûMACA", "BOƒûAZLI", "BOBƒ∞NAJ", "Bƒ∞R√áOƒûU", "B√úY√úS√úZ", "B√úZ√úL√ú≈û", "B√úZ√ú≈û√úK", "B√ñB√úRT√ú", "B√ñL√ú≈ûME", "BA≈ûK√ñ≈ûE", "BAƒûI≈ûIK", "BAƒûIT√áI", "BEYAƒûA√á", "√á√ñPLEME", "√áUVALCI", "√áAƒûANOZ", "√á√úR√úY√ú≈û", "DOƒûMACA", "DOƒûANCI", "DOƒûALCI", "DOƒûRUCA", "D√ú≈û√úR√ú≈û", "D√ú≈û√úN√ú≈û", "D√ñN√ú≈ûME", "D√ñ≈ûENƒ∞≈û", "DEFOSUZ", "DAƒûITI≈û", "DAƒûILI≈û", "Fƒ∞G√úRL√ú", "FAYDACI", "FIR√áACI", "G√ñRMECE", "G√ñM√úLME", "G√ñN√úLL√ú", "G√ñR√úNT√ú", "G√ñR√úN√úR", "G√ñLGELƒ∞", "G√ñKYOLU", "G√ñ√áERME", "G√ñZALTI", "G√ñZEMEK", "G√úM√ú≈ûL√ú"] },
        6: { length: 6, words: ["TESKILAT", "MEMLEKET", "HURRIYET", "ISTIKLAL", "TEKIRDAG", "OSMANIYE", "NEVSEHIR", "KAHRAMAN", "YILDIRIM", "BARBAROS", "TURKLERI", "ORDULARI", "KAYILARI", "BEYLIKIN", "HANLIGIN", "TURKUMUZ", "SARKISIN", "TURKUSUN", "OYUNCASI", "HALAYCIS", "ZEYBEGIN", "OKULCUKU", "EVLERINI", "KAPISINI", "SOKAGINI", "YOLCULUG", "CAYCISIN", "KOYLUSUN", "KOYUNUNU", "BOYUNUNU", "TOYUNUNU", "SOYUNUNU", "KAYIGINI", "MAYININI", "PAYDASIN", "SAYFASIN", "TAYFASIN", "YAYLASIN", "BEYAZISI", "DEYIMINI", "FEYIZINI", "GEYIGINI", "HEYBESIN", "KEYIFINI", "LEYLASIN", "MEYVESIN", "PEYDASIN", "REYONUNU", "SEYIRINI", "TEYITINI", "ZEYININI", "AGACLIK", "CICEKLI", "YAPRAKLI", "DALLANMA", "KOKLENME", "TOPRAKLI", "GUNESLI", "AYDINLIK", "YILDIZLI", "GOKYUZU", "BULUTLU", "YAGMURLU", "KARLI", "DOLULU", "RUZGARLI", "FIRTINALI", "GOKKUSAGI", "SIMSEKLI", "SISLI", "BUHARLI", "BUZLU", "BUZULLU", "COLLU", "ORMANLIK", "DAGLIK", "TEPELIK", "VADILIK", "OVALIK", "PLATOLUK", "ADASAL", "YARIMADALIK", "KORFEZLIK", "BOGAZLIK", "DENIZLIK", "OKYANUS", "GOLLUK", "NEHIRLIK", "DERELIK", "CAYLIK", "PINARLIK", "KUYULUK", "GOLETLIK", "BARAJLIK", "SANTRALLI", "TERMIKLI", "NUKLEERLI", "GUNESLI", "RUZGARLI", "JEOTERMALLI", "ELEKTRIKLI", "ELEKTRONIKLI", "MEKANIKLI", "HIDROLIKLI", "TERMODINAMIKLI", "OPTIKLI", "AKUSTIKLI", "ATOMIK", "MOLEKULER", "HUCRELI", "DOKULU", "ORGANLI", "SISTEMLI", "TICARETLI", "SATISLI", "PAZARLI", "REKLAMLI", "TANITIMLI", "KAMPANYALI", "INDIRIMLI", "HEDIYELI", "YARISMALI", "TURNUVALI", "SAMPIYONALI", "LIGLI", "KUPALI", "ODULLU", "ARMAGANLI", "BAGISLI", "YARDIMLI", "DESTEKLI", "KATKILI", "SALDIRILI", "SAVUNMALI", "STRATEJIK", "TAKTIKLI", "PLANLI", "PROJELI", "TASARIMLI", "MODELLI", "ORNEKLI", "KALIPLI", "SABLONLU", "DESENLI", "MOTIFLI", "SUSLU", "DEKORASYONLU", "AKSESUARLI", "APARATLI", "ALETLI", "MALZEMELI", "HAMMADDELI", "URUNLU", "ESYALI", "RESIMLI", "FOTOGRAFLI", "VIDEOLU", "FILMLI", "DIZILI", "BELGESELLI", "PROGRAMLI", "YAYINLI", "CANLILI", "KAYITLI", "STUDYOLU", "SAHNELI", "PERDELI", "DEKORLU", "KOSTUMLU", "MAKYAJLI", "ISIKLI", "SESLI", "MUZIKLI", "SARKILI", "TURKULU", "SIIRLI", "HIKAYELI", "MASALLI", "FABLLI", "DESTANLI", "EFSANELI", "EDEBIYATLI", "SANATLI", "KULTURLU", "GELENEKLI", "GORENEKLI", "ADETLI", "HUKUKLU", "KANUNLU", "YASALI", "TUZUKLU", "YONETMELIKLI", "TALIMATLI", "EMIRLI", "KARARLI", "HUKUMLU", "CEZALI", "HAPISLI", "KALELI", "HISARLI", "KOSKLU", "SARAYLI", "KONAKLI", "KONUTLU", "MESKENLI", "YUVALI", "OCAKLI", "SOBALI", "SOMINELI", "ISITICILI", "KLIMASIZ", "VANTILATORLU", "BUZDOLABLI", "DERINLI", "DONDURUCULU", "BULASIKLI", "MAKINELI", "CAMASIRLI", "KURUTMALI", "UTULU", "SUPURGELI", "ROBOTLU", "FIRCALI", "PASPASLI", "KOVALI", "TORPIDOLU", "COPLU", "TENEKELI", "POSETLI", "TORBASIZ", "KUTULU", "KAVANOZLU", "SISELI", "BARDAKLI", "FINCANLI", "TABAKLI", "KASELI", "TENCERELI", "TAVALI", "KEPCELI", "SPATULALI", "BICAKLI", "CATALI", "KASIKLI", "SURAHILI", "SUZGECLI", "RENDELI", "MIKSERLI", "BLENDERLI", "TOSTLU", "KETTLELI", "KAHVELI", "EKMEKLI", "KIZARTMALI", "MEYVELI", "SIKACAKLI", "MIKRODALGASIZ", "FIRINLI", "OCAKLI", "DAVULLU", "MANGALLI", "IZGARALI", "TANDIRLI", "SACLI", "KAZANLI", "TENCERELI", "KEBAPLI", "DONERLI", "LAHMACUNLU", "PIDELER", "BOREKLI", "POGACALI", "SIMITLI", "ACMALI", "COREKLI", "PASTALI", "BAKLVALI", "KADAYIFLI", "KUNEFELI", "SUTLACLI", "ASURELI", "HOSAFLI", "KOMPOSTOLU", "SERBETLI", "LIMONATALI", "AYRANLI", "KEFIRLI", "YOGURTLU", "TEREYAGLI", "KAYMAKLI", "SUTLU", "PEYNIRLI", "ZEYTINLI", "YUMURTALI", "BALLI", "RECELLI", "MARMELATLI", "TAHINLI", "PEKMEZLI", "HELVALI", "LOKUMLU", "SEKERLI", "KROKANLI", "CIKOLATALI", "BISKUVILI", "KEKLI", "KURABIYELI", "GOFRETLI", "CIPSLI", "KURUYEMISLI", "FINDIKLI", "FISTIKLI", "CEVIZLI", "BADEMLI", "KAJULU", "ANTEPLI", "LEBLEBILI", "NOHUTLU", "FASULYELI", "MERCIMEKLI", "BULGURLU", "PIRINCLI", "ARPALI", "BUGDAYLI", "YULAFI", "MISIRLI", "CAVDARLI", "KUSKUSLU", "MAKARNALI", "ERISTELI", "SEHRIYELI", "SOSLU", "SALCALI", "BAHARATLI", "TUZLU", "KARABIBERLI", "BIBERLI", "SUMAKLI", "NANELI", "FESLEGENLI", "KEKIKLI", "KIMYONLU", "KISNISLI", "ZENCEFILLI", "ZERDECALLI", "SAFRANLI", "VANILYALI", "TARCINLI", "KARANFILLI", "YENIBAHARLI", "MUSKATLI", "SUSAMLI", "DOMATESLI", "BIBERLI", "PATLICANLI", "KABAKLI", "SALATALIKLI", "MARULLU", "ISPANAKLI", "PAZILI", "LAHANALI", "KARNABAHARLI", "BROKOLILI", "TURPLU", "HAVUCLU", "PANCARLI", "KEREVIZLI", "MAYDANOZLU", "DEREOTULU", "ROKALI", "ENGINARLI", "MANTARLI", "SOGANLI", "SARIMSAKLI", "PIRASALI", "SALGAMLI", "KEREVIZLI", "YERLI", "ELMASLI", "PATATESLI", "TATLILI", "KIZILCAHAMAMLI", "BEYPAZARLI", "AYASLI", "CUBUKLU", "KALECIKLI", "BALALI", "POLATLILI", "SINCANLI", "ETIMESGUTLU", "YENIMAHALLELI", "KECIORENLI", "CANKAYALI", "MAMAKLI", "ALTINDAGLI", "PURSAKLARLI", "GOLBASILI", "AKYURTLU", "KAHRAMANKAZANLI", "ELMADAGLI"] },
        7: { length: 7, words: ["KASTAMONU", "ZONGULDAK", "GUMUSHANE", "CANAKKALE", "BALIKESIR", "GAZIANTEP", "KIRIKKALE", "ADAPAZARI", "EGEMENLIK", "DEMOKRASI", "ANITKABIR", "ESKISEHIR", "SANLIURFA", "ALPARSLAN", "MALAZGIRT", "TURKLERIN", "ORDULARIN", "KAYILARIN", "BEYLIKINI", "HANLIGINI", "TURKUMUZU", "SARKISINI", "TURKUSUNU", "OYUNCASIN", "HALAYCISI", "ZEYBEGINI", "OKULCUKU", "EVLERINIZ", "KAPISINIZ", "SOKAGINIZ", "YOLCULUGU", "CAYCISINIZ", "KOYLUSUNU", "KOYUNUNUZ", "BOYUNUNUZ", "TOYUNUNUZ", "SOYUNUNUZ", "KAYIGINIZ", "MAYININIZ", "PAYDASINIZ", "SAYFASINIZ", "TAYFASINIZ", "YAYLASINIZ", "BEYAZISIN", "DEYIMINIZ", "FEYIZINIZ", "GEYIGINIZ", "HEYBESINI", "KEYIFINIZ", "LEYLASINIZ", "MEYVESINI", "PEYDASINIZ", "REYONUNUZ", "SEYIRINIZ", "SEYLERINI", "TEYITINIZ", "VEYAHTINIZ", "ZEYININIZ", "AGACLIK", "CICEKLI", "YAPRAKLI", "DALLANMA", "KOKLENME", "TOPRAKLI", "GUNESLI", "AYDINLIK", "YILDIZLI", "GOKYUZU", "BULUTLU", "YAGMURLU", "KARLI", "DOLULU", "RUZGARLI", "FIRTINALI", "GOKKUSAGI", "SIMSEKLI", "SISLI", "BUHARLI", "BUZLU", "BUZULLU", "COLLU", "ORMANLIK", "DAGLIK", "TEPELIK", "VADILIK", "OVALIK", "PLATOLUK", "ADASAL", "YARIMADALIK", "KORFEZLIK", "BOGAZLIK", "DENIZLIK", "OKYANUS", "GOLLUK", "NEHIRLIK", "DERELIK", "CAYLIK", "PINARLIK", "KUYULUK", "GOLETLIK", "BARAJLIK", "SANTRALLI", "TERMIKLI", "NUKLEERLI", "GUNESLI", "RUZGARLI", "JEOTERMALLI", "ELEKTRIKLI", "ELEKTRONIKLI", "MEKANIKLI", "HIDROLIKLI", "TERMODINAMIKLI", "OPTIKLI", "AKUSTIKLI", "ATOMIK", "MOLEKULER", "HUCRELI", "DOKULU", "ORGANLI", "SISTEMLI", "TICARETLI", "SATISLI", "PAZARLI", "REKLAMLI", "TANITIMLI", "KAMPANYALI", "INDIRIMLI", "HEDIYELI", "YARISMALI", "TURNUVALI", "SAMPIYONALI", "LIGLI", "KUPALI", "ODULLU", "ARMAGANLI", "BAGISLI", "YARDIMLI", "DESTEKLI", "KATKILI", "SALDIRILI", "SAVUNMALI", "STRATEJIK", "TAKTIKLI", "PLANLI", "PROJELI", "TASARIMLI", "MODELLI", "ORNEKLI", "KALIPLI", "SABLONLU", "DESENLI", "MOTIFLI", "SUSLU", "DEKORASYONLU", "AKSESUARLI", "APARATLI", "ALETLI", "MALZEMELI", "HAMMADDELI", "URUNLU", "ESYALI", "RESIMLI", "FOTOGRAFLI", "VIDEOLU", "FILMLI", "DIZILI", "BELGESELLI", "PROGRAMLI", "YAYINLI", "CANLILI", "KAYITLI", "STUDYOLU", "SAHNELI", "PERDELI", "DEKORLU", "KOSTUMLU", "MAKYAJLI", "ISIKLI", "SESLI", "MUZIKLI", "SARKILI", "TURKULU", "SIIRLI", "HIKAYELI", "MASALLI", "FABLLI", "DESTANLI", "EFSANELI", "EDEBIYATLI", "SANATLI", "KULTURLU", "GELENEKLI", "GORENEKLI", "ADETLI", "HUKUKLU", "KANUNLU", "YASALI", "TUZUKLU", "YONETMELIKLI", "TALIMATLI", "EMIRLI", "KARARLI", "HUKUMLU", "CEZALI", "HAPISLI", "KALELI", "HISARLI", "KOSKLU", "SARAYLI", "KONAKLI", "KONUTLU", "MESKENLI", "YUVALI", "OCAKLI", "SOBALI", "SOMINELI", "ISITICILI", "KLIMASIZ", "VANTILATORLU", "BUZDOLABLI", "DERINLI", "DONDURUCULU", "BULASIKLI", "MAKINELI", "CAMASIRLI", "KURUTMALI", "UTULU", "SUPURGELI", "ROBOTLU", "FIRCALI", "PASPASLI", "KOVALI", "TORPIDOLU", "COPLU", "TENEKELI", "POSETLI", "TORBASIZ", "KUTULU", "KAVANOZLU", "SISELI", "BARDAKLI", "FINCANLI", "TABAKLI", "KASELI", "TENCERELI", "TAVALI", "KEPCELI", "SPATULALI", "BICAKLI", "CATALI", "KASIKLI", "SURAHILI", "SUZGECLI", "RENDELI", "MIKSERLI", "BLENDERLI", "TOSTLU", "KETTLELI", "KAHVELI", "EKMEKLI", "KIZARTMALI", "MEYVELI", "SIKACAKLI", "MIKRODALGASIZ", "FIRINLI", "OCAKLI", "DAVULLU", "MANGALLI", "IZGARALI", "TANDIRLI", "SACLI", "KAZANLI", "TENCERELI", "KEBAPLI", "DONERLI", "LAHMACUNLU", "PIDELER", "BOREKLI", "POGACALI", "SIMITLI", "ACMALI", "COREKLI", "PASTALI", "BAKLVALI", "KADAYIFLI", "KUNEFELI", "SUTLACLI", "ASURELI", "HOSAFLI", "KOMPOSTOLU", "SERBETLI", "LIMONATALI", "AYRANLI", "KEFIRLI", "YOGURTLU", "TEREYAGLI", "KAYMAKLI", "SUTLU", "PEYNIRLI", "ZEYTINLI", "YUMURTALI", "BALLI", "RECELLI", "MARMELATLI", "TAHINLI", "PEKMEZLI", "HELVALI", "LOKUMLU", "SEKERLI", "KROKANLI", "CIKOLATALI", "BISKUVILI", "KEKLI", "KURABIYELI", "GOFRETLI", "CIPSLI", "KURUYEMISLI", "FINDIKLI", "FISTIKLI", "CEVIZLI", "BADEMLI", "KAJULU", "ANTEPLI", "LEBLEBILI", "NOHUTLU", "FASULYELI", "MERCIMEKLI", "BULGURLU", "PIRINCLI", "ARPALI", "BUGDAYLI", "YULAFI", "MISIRLI", "CAVDARLI", "KUSKUSLU", "MAKARNALI", "ERISTELI", "SEHRIYELI", "SOSLU", "SALCALI", "BAHARATLI", "TUZLU", "KARABIBERLI", "BIBERLI", "SUMAKLI", "NANELI", "FESLEGENLI", "KEKIKLI", "KIMYONLU", "KISNISLI", "ZENCEFILLI", "ZERDECALLI", "SAFRANLI", "VANILYALI", "TARCINLI", "KARANFILLI", "YENIBAHARLI", "MUSKATLI", "SUSAMLI", "DOMATESLI", "BIBERLI", "PATLICANLI", "KABAKLI", "SALATALIKLI", "MARULLU", "ISPANAKLI", "PAZILI", "LAHANALI", "KARNABAHARLI", "BROKOLILI", "TURPLU", "HAVUCLU", "PANCARLI", "KEREVIZLI", "MAYDANOZLU", "DEREOTULU", "ROKALI", "ENGINARLI", "MANTARLI", "SOGANLI", "SARIMSAKLI", "PIRASALI", "SALGAMLI", "KEREVIZLI", "YERLI", "ELMASLI", "PATATESLI", "TATLILI", "KIZILCAHAMAMLI", "BEYPAZARLI", "AYASLI", "CUBUKLU", "KALECIKLI", "BALALI", "POLATLILI", "SINCANLI", "ETIMESGUTLU", "YENIMAHALLELI", "KECIORENLI", "CANKAYALI", "MAMAKLI", "ALTINDAGLI", "PURSAKLARLI", "GOLBASILI", "AKYURTLU", "KAHRAMANKAZANLI", "ELMADAGLI"] },
        8: { length: 8, words: ["BASKOMUTAN", "DOLMABAHCE", "CUMHURIYET", "DIYARBAKIR", "KIRKLARELI", "BUYUKSEHIR", "FENERBAHCE", "UNIVERSITE", "TELEVIZYON", "BILGISAYAR", "ARKADASLIK", "OGRETMENIM", "HASTANELER", "TURKLERIMIZ", "ORDULARIMIZ", "KAYILARIMIZ", "BEYLIKLERI", "HANLIKLARI", "TURKULERIZ", "SARKILARIN", "TURKULERIN", "OYUNCULARI", "HALAYCILAR", "ZEYBEKLERI", "OKULCUKLAR", "EVLERIMIZI", "KAPISIMIZI", "SOKAGIMIZI", "YOLCULUGUM", "CAYCISIMIZ", "KOYLULERIM", "KOYUNUMUZU", "BOYUNUMUZU", "TOYUNUMUZU", "SOYUNUMUZU", "KAYIGIMIZI", "MAYINIMIZI", "PAYDAMIZIN", "SAYFAMIZIN", "TAYFAMIZIN", "YAYLAMIZIN", "BEYAZIMIZI", "DEYIMIMIZI", "FEYIZIMIZI", "GEYIGIMIZI", "HEYBEMIZIN", "KEYIFIMIZI", "LEYLAMIZIN", "MEYVEMIZIN", "PEYDAMIZIN", "REYONUMUZU", "SEYIRIMIZI", "SEYLERIMIZ", "TEYITIMIZI", "VEYAHTIMIZ", "ZEYINIMIZI", "AGACLIK", "CICEKLI", "YAPRAKLI", "DALLANMA", "KOKLENME", "TOPRAKLI", "GUNESLI", "AYDINLIK", "YILDIZLI", "GOKYUZU", "BULUTLU", "YAGMURLU", "KARLI", "DOLULU", "RUZGARLI", "FIRTINALI", "GOKKUSAGI", "SIMSEKLI", "SISLI", "BUHARLI", "BUZLU", "BUZULLU", "COLLU", "ORMANLIK", "DAGLIK", "TEPELIK", "VADILIK", "OVALIK", "PLATOLUK", "ADASAL", "YARIMADALIK", "KORFEZLIK", "BOGAZLIK", "DENIZLIK", "OKYANUS", "GOLLUK", "NEHIRLIK", "DERELIK", "CAYLIK", "PINARLIK", "KUYULUK", "GOLETLIK", "BARAJLIK", "SANTRALLI", "TERMIKLI", "NUKLEERLI", "GUNESLI", "RUZGARLI", "JEOTERMALLI", "ELEKTRIKLI", "ELEKTRONIKLI", "MEKANIKLI", "HIDROLIKLI", "TERMODINAMIKLI", "OPTIKLI", "AKUSTIKLI", "ATOMIK", "MOLEKULER", "HUCRELI", "DOKULU", "ORGANLI", "SISTEMLI", "TICARETLI", "SATISLI", "PAZARLI", "REKLAMLI", "TANITIMLI", "KAMPANYALI", "INDIRIMLI", "HEDIYELI", "YARISMALI", "TURNUVALI", "SAMPIYONALI", "LIGLI", "KUPALI", "ODULLU", "ARMAGANLI", "BAGISLI", "YARDIMLI", "DESTEKLI", "KATKILI", "SALDIRILI", "SAVUNMALI", "STRATEJIK", "TAKTIKLI", "PLANLI", "PROJELI", "TASARIMLI", "MODELLI", "ORNEKLI", "KALIPLI", "SABLONLU", "DESENLI", "MOTIFLI", "SUSLU", "DEKORASYONLU", "AKSESUARLI", "APARATLI", "ALETLI", "MALZEMELI", "HAMMADDELI", "URUNLU", "ESYALI", "RESIMLI", "FOTOGRAFLI", "VIDEOLU", "FILMLI", "DIZILI", "BELGESELLI", "PROGRAMLI", "YAYINLI", "CANLILI", "KAYITLI", "STUDYOLU", "SAHNELI", "PERDELI", "DEKORLU", "KOSTUMLU", "MAKYAJLI", "ISIKLI", "SESLI", "MUZIKLI", "SARKILI", "TURKULU", "SIIRLI", "HIKAYELI", "MASALLI", "FABLLI", "DESTANLI", "EFSANELI", "EDEBIYATLI", "SANATLI", "KULTURLU", "GELENEKLI", "GORENEKLI", "ADETLI", "HUKUKLU", "KANUNLU", "YASALI", "TUZUKLU", "YONETMELIKLI", "TALIMATLI", "EMIRLI", "KARARLI", "HUKUMLU", "CEZALI", "HAPISLI", "KALELI", "HISARLI", "KOSKLU", "SARAYLI", "KONAKLI", "KONUTLU", "MESKENLI", "YUVALI", "OCAKLI", "SOBALI", "SOMINELI", "ISITICILI", "KLIMASIZ", "VANTILATORLU", "BUZDOLABLI", "DERINLI", "DONDURUCULU", "BULASIKLI", "MAKINELI", "CAMASIRLI", "KURUTMALI", "UTULU", "SUPURGELI", "ROBOTLU", "FIRCALI", "PASPASLI", "KOVALI", "TORPIDOLU", "COPLU", "TENEKELI", "POSETLI", "TORBASIZ", "KUTULU", "KAVANOZLU", "SISELI", "BARDAKLI", "FINCANLI", "TABAKLI", "KASELI", "TENCERELI", "TAVALI", "KEPCELI", "SPATULALI", "BICAKLI", "CATALI", "KASIKLI", "SURAHILI", "SUZGECLI", "RENDELI", "MIKSERLI", "BLENDERLI", "TOSTLU", "KETTLELI", "KAHVELI", "EKMEKLI", "KIZARTMALI", "MEYVELI", "SIKACAKLI", "MIKRODALGASIZ", "FIRINLI", "OCAKLI", "DAVULLU", "MANGALLI", "IZGARALI", "TANDIRLI", "SACLI", "KAZANLI", "TENCERELI", "KEBAPLI", "DONERLI", "LAHMACUNLU", "PIDELER", "BOREKLI", "POGACALI", "SIMITLI", "ACMALI", "COREKLI", "PASTALI", "BAKLVALI", "KADAYIFLI", "KUNEFELI", "SUTLACLI", "ASURELI", "HOSAFLI", "KOMPOSTOLU", "SERBETLI", "LIMONATALI", "AYRANLI", "KEFIRLI", "YOGURTLU", "TEREYAGLI", "KAYMAKLI", "SUTLU", "PEYNIRLI", "ZEYTINLI", "YUMURTALI", "BALLI", "RECELLI", "MARMELATLI", "TAHINLI", "PEKMEZLI", "HELVALI", "LOKUMLU", "SEKERLI", "KROKANLI", "CIKOLATALI", "BISKUVILI", "KEKLI", "KURABIYELI", "GOFRETLI", "CIPSLI", "KURUYEMISLI", "FINDIKLI", "FISTIKLI", "CEVIZLI", "BADEMLI", "KAJULU", "ANTEPLI", "LEBLEBILI", "NOHUTLU", "FASULYELI", "MERCIMEKLI", "BULGURLU", "PIRINCLI", "ARPALI", "BUGDAYLI", "YULAFI", "MISIRLI", "CAVDARLI", "KUSKUSLU", "MAKARNALI", "ERISTELI", "SEHRIYELI", "SOSLU", "SALCALI", "BAHARATLI", "TUZLU", "KARABIBERLI", "BIBERLI", "SUMAKLI", "NANELI", "FESLEGENLI", "KEKIKLI", "KIMYONLU", "KISNISLI", "ZENCEFILLI", "ZERDECALLI", "SAFRANLI", "VANILYALI", "TARCINLI", "KARANFILLI", "YENIBAHARLI", "MUSKATLI", "SUSAMLI", "DOMATESLI", "BIBERLI", "PATLICANLI", "KABAKLI", "SALATALIKLI", "MARULLU", "ISPANAKLI", "PAZILI", "LAHANALI", "KARNABAHARLI", "BROKOLILI", "TURPLU", "HAVUCLU", "PANCARLI", "KEREVIZLI", "MAYDANOZLU", "DEREOTULU", "ROKALI", "ENGINARLI", "MANTARLI", "SOGANLI", "SARIMSAKLI", "PIRASALI", "SALGAMLI", "KEREVIZLI", "YERLI", "ELMASLI", "PATATESLI", "TATLILI", "KIZILCAHAMAMLI", "BEYPAZARLI", "AYASLI", "CUBUKLU", "KALECIKLI", "BALALI", "POLATLILI", "SINCANLI", "ETIMESGUTLU", "YENIMAHALLELI", "KECIORENLI", "CANKAYALI", "MAMAKLI", "ALTINDAGLI", "PURSAKLARLI", "GOLBASILI", "AKYURTLU", "KAHRAMANKAZANLI", "ELMADAGLI"] }
    };
    // --- KELƒ∞ME KARƒ∞YER AYARLARI ---
    const WORD_CAREER_LEVELS = {
        1: { length: 3, reward: 200, desc: "Kelime √áƒ±raƒüƒ± (3 Harf)", icon: "üå±" },
        2: { length: 4, reward: 400, desc: "Hece Ustasƒ± (4 Harf)", icon: "üåø" },
        3: { length: 5, reward: 600, desc: "Kelime Avcƒ±sƒ± (5 Harf)", icon: "üèπ" },
        4: { length: 6, reward: 800, desc: "S√∂zl√ºk Kurdu (6 Harf)", icon: "üìö" },
        5: { length: 7, reward: 1200, desc: "Edebiyat√ßƒ± (7 Harf)", icon: "üéì" },
        6: { length: 8, reward: 2000, desc: "Bilgin (8 Harf)", icon: "üß†" },
        7: { length: 9, reward: 3500, desc: "Filolog (9 Harf)", icon: "üè∫" },
        8: { length: 10, reward: 5000, desc: "Kelimelerin Efendisi (10 Harf)", icon: "üëë" }
    };

    let wordGameState = { active: false, secret: "", guesses: [], maxGuesses: 6, currentGuess: "", level: 1 };
const THEMES = [
        { id: 'theme-tr', name: 'üáπüá∑ T√ºrkiye', cost: 'AD', type: 'team' }, { id: 'theme-gs', name: 'ü¶Å Galatasaray', cost: 'AD', type: 'team' }, { id: 'theme-fb', name: 'üê¶ Fenerbah√ße', cost: 'AD', type: 'team' }, { id: 'theme-bjk', name: 'ü¶Ö Be≈üikta≈ü', cost: 'AD', type: 'team' }, { id: 'theme-ts', name: 'üåÄ Trabzonspor', cost: 'AD', type: 'team' }, { id: 'theme-goz', name: 'üü°üî¥ G√∂ztepe', cost: 'AD', type: 'team' }, { id: 'theme-ksk', name: 'üü¢üî¥ Kar≈üƒ±yaka', cost: 'AD', type: 'team' }, { id: 'theme-dark', name: 'üåô Gece', cost: 'AD', type: 'color' }, { id: 'theme-forest', name: 'üå≤ Orman', cost: 'AD', type: 'color' }, { id: 'theme-ocean', name: 'üåä Okyanus', cost: 'AD', type: 'color' }, { id: 'theme-love', name: 'üíñ A≈ük', cost: 'AD', type: 'color' }, { id: 'bg-space', name: 'üåå Uzay', cost: 'AD', type: 'bg' }, { id: 'bg-matrix', name: 'üìü Matrix', cost: 'AD', type: 'bg' }, { id: 'bg-hex', name: 'üêù Petek', cost: 'AD', type: 'bg' }, { id: 'bg-sky', name: '‚òÅÔ∏è G√∂ky√ºz√º', cost: 'AD', type: 'bg' }, { id: 'skin-gold', name: 'üëë Altƒ±n', cost: 'AD', type: 'bg' }, { id: 'bg-neon-city', name: 'üåÉ Neon City', cost: 0, type: 'bg' }, { id: 'bg-mystic-purple', name: 'üîÆ Mistik Mor', cost: 0, type: 'bg' }, { id: 'bg-volcano', name: 'üåã Volkan', cost: 0, type: 'bg' }, { id: 'bg-deep-sea', name: 'ü¶à Derin Deniz', cost: 0, type: 'bg' }
    ];
    // --- KART VERƒ∞TABANI ---
    // --- T√úRKƒ∞YE KOLEKSƒ∞YON VERƒ∞TABANI ---




    const AdManager = {
        pendingCallback: null,
        interstitialPending: false,
        interstitialCallback: null,

        // Ad Configuration
        appId: "18543851",

        // Ad Units (Updated)
        yandexBannerId: "R-M-18543851-9", // Pet/Theme
        adMobBannerId: "ca-app-pub-5879474591831999/2171448597", // Lobby
        nativeAdId: "ca-app-pub-5879474591831999/2306675386", // General
        rewardedAdId: "ca-app-pub-5879474591831999/6350366758", // Oracle, Time, Continue, Play Again, Double Money
        adMobInterstitialId: "ca-app-pub-5879474591831999/8282395523", // Level End Interstitial
        adMobRewardedInterstitialId: "ca-app-pub-5879474591831999/3058677360", // Double Reward (Rewarded Interstitial)

        isAndroid: function () { return (typeof window.Android !== "undefined" && window.Android !== null); },

        // √ñd√ºll√º Ge√ßi≈ü Reklamƒ± (Yeni)
        showRewardedInterstitialAd: function(onSuccess) {
             this.pendingCallback = onSuccess;
             // 5 Saniye Zaman A≈üƒ±mƒ± Kuralƒ± (Safety Timer)
             setTimeout(() => {
                 if (this.pendingCallback) {
                     console.warn("Rewarded Interstitial ad timeout - forcing callback.");
                     this.pendingCallback();
                     this.pendingCallback = null;
                 }
             }, 5000);

             if (this.isAndroid() && typeof window.Android.showRewardedInterstitial === 'function') {
                 window.Android.showRewardedInterstitial(this.adMobRewardedInterstitialId);
             } else {
                 // Fallback or Web Mock
                 console.log("Rewarded Interstitial ad (mock) - ID: " + this.adMobRewardedInterstitialId);
                 if (this.pendingCallback) {
                     this.pendingCallback();
                     this.pendingCallback = null;
                 }
             }
        },

        showRewardedAd: function (onSuccess) {
            this.pendingCallback = onSuccess;
            // 5 Saniye Zaman A≈üƒ±mƒ± Kuralƒ± (Safety Timer)
            setTimeout(() => {
                if (this.pendingCallback) {
                    console.warn("Rewarded ad timeout - forcing callback.");
                    this.pendingCallback();
                    this.pendingCallback = null;
                }
            }, 5000);

            if (this.isAndroid()) {
                if (typeof window.Android.showRewardedAd === 'function') {
                    // Use new Rewarded ID
                    window.Android.showRewardedAd(this.rewardedAdId);
                } else {
                    // Web test i√ßin direkt callback
                    console.log("Rewarded ad (mock) - ID: " + this.rewardedAdId);
                    if (this.pendingCallback) {
                        this.pendingCallback();
                        this.pendingCallback = null;
                    }
                }
            } else {
                console.warn("AdManager: Not Android, cannot show rewarded ad.");
                // Web test i√ßin direkt callback
                if (this.pendingCallback) {
                    this.pendingCallback();
                    this.pendingCallback = null;
                }
            }
        },

        showBanner: function(adId) {
            if (this.isAndroid() && typeof window.Android.showBanner === 'function') {
                window.Android.showBanner(adId);
            } else {
                console.log("Banner ad (mock) - ID: " + adId);
            }
        },

        hideBanner: function() {
            if (this.isAndroid() && typeof window.Android.hideBanner === 'function') {
                window.Android.hideBanner();
            } else {
                console.log("Banner ad hidden (mock)");
            }
        },

        // Callback for Android to trigger reward
        onReward: function() {
            if (this.pendingCallback) {
                this.pendingCallback();
                this.pendingCallback = null;
            }
        },

        // D√úZELTƒ∞LDƒ∞: Ge√ßi≈ü reklamƒ± hazƒ±r olduƒüunda oynatƒ±lƒ±r
        showInterstitialAd: function (onComplete) {
            this.interstitialCallback = onComplete;
            // 5 Saniye Zaman A≈üƒ±mƒ± Kuralƒ± (Safety Timer)
            setTimeout(() => {
                if (this.interstitialCallback) {
                    console.warn("Interstitial ad timeout - forcing callback.");
                    this.interstitialCallback();
                    this.interstitialCallback = null;
                    this.interstitialPending = false;
                }
            }, 5000);

            if (this.isAndroid() && typeof window.Android.showInterstitial === 'function') {
                this.interstitialPending = true;
                // Use new AdMob Interstitial ID
                window.Android.showInterstitial(this.adMobInterstitialId);
            } else {
                console.log("Interstitial ad (mock)");
                this.interstitialPending = false;
                if (this.interstitialCallback) {
                    this.interstitialCallback();
                    this.interstitialCallback = null;
                }
            }
        },

        // Android tarafƒ±ndan √ßaƒürƒ±lƒ±r - reklam kapatƒ±ldƒ±ƒüƒ±nda
        onInterstitialClosed: function() {
            this.interstitialPending = false;
            if (this.interstitialCallback) {
                this.interstitialCallback();
                this.interstitialCallback = null;
            }
        },

        showNativeAd: function () {
            console.log('Native ad g√∂sterme deneniyor...');

            // Banner container'ƒ± g√∂ster
            const bannerContainer = document.getElementById('bannerAdContainer');
            if (bannerContainer) {
                bannerContainer.style.display = 'flex';
            }

            // Android native ad
            if (this.isAndroid() && typeof window.Android.showNativeAd === 'function') {
                try {
                    window.Android.showNativeAd(this.nativeAdId);
                    console.log('Android native ad √ßaƒürƒ±ldƒ±');
                } catch(e) {
                    console.error('Native ad hatasƒ±:', e);
                    // Fallback - demo reklam g√∂ster
                    this._showFallbackNativeAd();
                }
            } else {
                // Web fallback
                this._showFallbackNativeAd();
            }
        },

        _showFallbackNativeAd: function() {
            const container = document.getElementById('nativeAdContainer') || document.getElementById('bannerAdContainer');
            if (container) {
                container.innerHTML = `
                    <div id="yandex-native-fallback" style="width:100%; text-align:center;">
                        <script type="text/javascript">
                            (function(w, d, n, s, t) {
                                w[n] = w[n] || [];
                                w[n].push(function() {
                                    Ya.Context.AdvManager.render({
                                        blockId: "R-M-18543851-9",
                                        renderTo: "yandex-native-fallback",
                                        async: true
                                    });
                                });
                                t = d.getElementsByTagName("script")[0];
                                s = d.createElement("script");
                                s.type = "text/javascript";
                                s.src = "//an.yandex.ru/system/context.js";
                                s.async = true;
                                t.parentNode.insertBefore(s, t);
                            })(this, this.document, "yandexContextAsyncCallbacks");
                        <\/script>
                    </div>
                `;
                container.style.display = 'flex';
            }
        },

        // D√úZELTƒ∞LDƒ∞: Reklam hazƒ±r mƒ± kontrol√º
        isInterstitialReady: function() {
            if (!this.isAndroid()) return true; // Web'de her zaman hazƒ±r
            if (typeof window.Android.isInterstitialReady === 'function') {
                return window.Android.isInterstitialReady();
            }
            return true;
        }
    };

    /* --- PET Sƒ∞STEMƒ∞ V2 (Hata D√ºzeltme & Restorasyon) --- */
    const PET_DB = {
        'cat': { name: 'Tekir', emoji: 'üê±', image: 'https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Animals/Cat%20Face.png', bonus: 'xp_boost', desc: 'Her oyunda %10 fazla XP kazandƒ±rƒ±r.', price: 0 },
        'dog': { name: 'Karaba≈ü', emoji: 'üêï', image: 'https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Animals/Dog%20Face.png', bonus: 'hint_chance', desc: 'Kaybedince %20 ≈üansla bedava ipucu verir.', price: 0 },
        'mouse': { name: 'Muki', emoji: 'üê≠', image: 'https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Animals/Mouse%20Face.png', bonus: 'loss_protection', desc: 'Kaybedince %15 ≈üansla XP d√º≈ümez.', price: 0 },
        'fox': { name: 'Kurnaz', emoji: 'ü¶ä', image: 'https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Animals/Fox.png', bonus: 'gold_multiplier', desc: 'Kazanƒ±lan altƒ±nƒ± 2 katƒ±na √ßƒ±karma ≈üansƒ± (%10).', price: 0 },
        'owl': { name: 'Bilge', emoji: 'ü¶â', image: 'https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Animals/Owl.png', bonus: 'expert_eye', desc: 'Yanlƒ±≈ü tahminde %25 ≈üansla hakkƒ±n gitmez.', price: 0 },
        'fish': { name: 'Beta', emoji: 'üê†', image: 'https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Animals/Tropical%20Fish.png', bonus: 'time_freeze', desc: 'S√ºre bitince %10 ≈üansla +10sn ekler.', price: 0 },
        'lion': { name: 'Aslan', emoji: 'ü¶Å', image: 'https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Animals/Lion.png', bonus: 'gold_master', desc: 'Altƒ±n kazancƒ±nƒ± %5 artƒ±rƒ±r.', price: 0 },
        'eagle': { name: 'Kartal', emoji: 'ü¶Ö', image: 'https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Animals/Eagle.png', bonus: 'eagle_eye', desc: 'Oyun ba≈üƒ± %50 ≈üansla 1 rakamƒ± kesin bilir (Oracle).', price: 0 },
        'turtle': { name: 'Tospik', emoji: 'üê¢', image: 'https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Animals/Turtle.png', bonus: 'streak_shield', desc: 'Kaybetsen de %20 ≈üansla serin bozulmaz.', price: 0 }
    };

    window.PetSystem = {
        initialized: false,
        init: function () {
            if (this.initialized) return;

            if (!user.pet) {
                user.pet = {
                    active: 'cat',
                    energy: 100,
                    lastFeed: Date.now(),
                    unlocked: ['cat']
                };
            }
            if (!user.pet.unlocked) user.pet.unlocked = ['cat'];
            if (!Array.isArray(user.pet.unlocked)) user.pet.unlocked = ['cat'];
            if (!user.pet.unlocked.includes('cat')) user.pet.unlocked.push('cat');
            if (!user.pet.active) user.pet.active = 'cat';
            if (!user.pet.lastFeed) user.pet.lastFeed = Date.now();
            if (user.pet.energy === undefined) user.pet.energy = 100;
            if (!PET_DB[user.pet.active]) user.pet.active = 'cat';

            this.calculateDecay();

            // Check energy decay every 10 minutes
            setInterval(() => {
                this.calculateDecay();
                this.updateUI();
            }, 600000);

            this.updateUI();
            this.initialized = true;
            console.log("Pet System Initialized (RESTORED)");
        },

        calculateDecay: function () {
            if (!user.pet) return;
            const now = Date.now();
            const elapsedMs = now - (user.pet.lastFeed || now);
            const durationMs = 2 * 60 * 60 * 1000; // 2 Saat (7,200,000 ms)

            // Y√ºzde hesabƒ±: Ge√ßen s√ºre / Toplam S√ºre
            // 2 saat sonunda enerji 0 olmalƒ±.
            const decay = Math.min(100, Math.floor((elapsedMs / durationMs) * 100));
            let newEnergy = 100 - decay;
            if (newEnergy < 0) newEnergy = 0;

            if (user.pet.energy !== newEnergy) {
                user.pet.energy = newEnergy;
                this.save();
                this.updateUI();
            }
        },

        save: function () {
            if (user.name) db.ref('users/' + user.name + '/pet').set(user.pet);
        },

        getBonus: function (type) {
            if (!user.pet || user.pet.energy < 20) return 0;
            const petInfo = PET_DB[user.pet.active];
            if (petInfo && petInfo.bonus === type) return true;
            return false;
        },



        updateUI: function () {
            if (!user.pet) return;
            const walker = document.getElementById('lobbyPetWalker');
            if (!walker) return;

            const p = PET_DB[user.pet.active];

            // Update Energy Badge
            const badge = document.getElementById('petEnergyBadge');
            if (badge) {
                badge.innerText = user.pet.energy + "%";
                if (user.pet.energy < 20) {
                    badge.style.background = "#e74c3c"; // Kritik (Kƒ±rmƒ±zƒ±)
                } else if (user.pet.energy < 40) {
                    badge.style.background = "#e67e22"; // √úzg√ºn E≈üiƒüi (Turuncu)
                } else if (user.pet.energy < 60) {
                    badge.style.background = "#f1c40f"; // Orta (Sarƒ±)
                } else {
                    badge.style.background = "#2ecc71"; // ƒ∞yi (Ye≈üil)
                }
            }

            // Update Lobby Feed Button (NEW)
            const lobbyBtn = document.getElementById('btnLobbyFeed');
            if (lobbyBtn) {
                if (user.pet.energy < 50) {
                    lobbyBtn.style.display = 'block';
                } else {
                    lobbyBtn.style.display = 'none';
                }
            }

            // Update Static Image
            const img = document.getElementById('petMainImage');
            if (img && p.image) {
                const targetSrc = p.image;
                if (!img.src.includes(targetSrc)) {
                    img.src = targetSrc;
                }
                img.style.display = 'block';

                // √úzg√ºn Efekti (Energy < 40)
                if (user.pet.energy < 40) {
                    img.style.filter = "grayscale(0.8) sepia(0.2) drop-shadow(0 2px 5px rgba(0,0,0,0.5))";
                    img.style.opacity = "0.8";
                    // Titreme efekti ekleyebiliriz veya sabit √ºzg√ºn duru≈ü
                    img.style.animation = "pulse 2s infinite ease-in-out";
                } else {
                    img.style.filter = "drop-shadow(0 4px 8px rgba(0,0,0,0.3))";
                    img.style.opacity = "1";
                    img.style.animation = "none";
                }

                // Start Animation System
                if (typeof PetAnimationSystem !== 'undefined') {
                    PetAnimationSystem.start();
                }

            } else if (img) {
                img.style.display = 'none';
            }

            // Game Header
            const gameDisp = document.getElementById('gamePetDisplay');
            if (gameDisp) {
                gameDisp.innerHTML = `
                <div class="pet-game-header" style="opacity: ${user.pet.energy < 20 ? 0.5 : 1}; display:flex; align-items:center; gap:5px;">
                    <img src="${p.image}" style="width:25px; height:25px; filter:drop-shadow(0 2px 2px rgba(0,0,0,0.3));">
                    <div style="font-size:0.7rem; font-weight:bold; color:${user.pet.energy > 50 ? '#2ecc71' : '#e74c3c'}">${user.pet.energy}%</div>
                </div>`;
            }

            if (document.getElementById('modal-pet') && document.getElementById('modal-pet').style.display === 'flex') {
                this.renderPetList();
            }
        },
        renderPetList: function () {
            // Ana men√ºdeki pet listesini g√ºncelle (varsa)
            const container = document.getElementById('petListContainer');
            if (container) this.renderContainer(container);

            // Profildeki pet listesini g√ºncelle (varsa ve a√ßƒ±ksa)
            const profileContainer = document.getElementById('profilePetListContainer');
            if (profileContainer && profileContainer.style.display !== 'none') {
                this.renderContainer(profileContainer);
            }

            // Feed Button Logic
            const feedBtn = document.getElementById('btnFeedPet');
            if (feedBtn) {
                // Cooldown: 2 saat
                // Eƒüer lastFeed yoksa 0 varsay
                const lf = user.pet.lastFeed || 0;
                const diff = Date.now() - lf;
                const waitTime = 2 * 60 * 60 * 1000; // 2 saat (ms)

                if (user.pet.energy >= 90) {
                    feedBtn.innerText = "TOK (%" + user.pet.energy + ")";
                    feedBtn.disabled = true;
                    feedBtn.className = "btn-grey";
                } else if (diff < waitTime) {
                    const remMin = Math.ceil((waitTime - diff) / 60000);
                    feedBtn.innerText = `‚è≥ ${remMin}dk Bekle`;
                    feedBtn.disabled = true;
                    feedBtn.className = "btn-grey";
                } else {
                    feedBtn.innerText = "üçñ BESLE (+%100) üì∫";
                    feedBtn.disabled = false;
                    feedBtn.className = "btn-green";
                    feedBtn.onclick = () => this.feedPet();
                }
            }
        },

        renderContainer: function (container) {
            container.innerHTML = "";
            Object.keys(PET_DB).forEach(key => {
                const p = PET_DB[key];
                const isUnlocked = user.pet.unlocked.includes(key);
                const isActive = user.pet.active === key;

                const card = document.createElement('div');
                card.className = `pet-card ${isActive ? 'active' : ''} ${isUnlocked ? 'unlocked' : ''}`;
                // card.onclick = () => this.selectPet(key); // Removed to avoid double trigger
                card.style.padding = "5px";

                let btnHtml = "";
                if (isActive) {
                    btnHtml = `<span style="color:#27ae60; font-weight:bold; font-size:0.7rem;">SE√áƒ∞Lƒ∞</span>`;
                } else if (isUnlocked) {
                    btnHtml = `<button class="btn-sm" style="padding:2px 5px; font-size:0.65rem;" onclick="PetSystem.selectPet('${key}')">SE√á</button>`;
                } else {
                    btnHtml = `<button class="btn-sm btn-ad" style="padding:2px 5px; font-size:0.65rem;" onclick="PetSystem.unlockPetWithAd('${key}')">üì∫ A√á</button>`;
                }

                if (key === 'cat' && !isUnlocked) btnHtml = "√úCRETSƒ∞Z";

                card.innerHTML = `
                    <div style="text-align:center;">
                        <img src="${p.image}" style="width:40px; height:40px; filter:drop-shadow(0 2px 2px rgba(0,0,0,0.2));">
                        <div style="font-weight:bold; font-size:0.75rem; margin-top:2px;">${p.name}</div>
                        <div style="font-size:0.6rem; color:#666; display:none;">${p.desc}</div>
                        <div style="margin-top:3px;">${btnHtml}</div>
                    </div>
                `;
                container.appendChild(card);
            });
        },

        selectPet: function (key) {
            console.log("selectPet called for:", key);
            if (!user.pet || !user.pet.unlocked) return;
            if (!user.pet.unlocked.includes(key)) {
                console.warn("Pet not unlocked:", key);
                showToast("Bu pet hen√ºz a√ßƒ±k deƒüil! üîí");
                return;
            }
            user.pet.active = key;
            this.save();
            this.updateUI();
            this.renderPetList(); // Hem ana hem profil listesini g√ºnceller
            showToast(`${PET_DB[key].name} se√ßildi!`);
        },

        unlockPetWithAd: function (key) {
            AdManager.showRewardedAd(() => {
                if (!user.pet.unlocked.includes(key)) {
                    user.pet.unlocked.push(key);
                    user.pet.active = key;
                    this.save();
                    this.updateUI();
                    this.renderPetList();
                    showToast("Yeni Pet A√ßƒ±ldƒ±: " + PET_DB[key].name);

                    // ƒ∞lk a√ßƒ±lƒ±≈üta full enerji ver
                    user.pet.energy = 100;
                    user.pet.lastFeed = Date.now();
                    this.save();
                }
            });
        },

        feedPet: function () {
            // D√úZELTƒ∞LDƒ∞: Reklam √∂ncesi kontrol ve daha g√ºvenli callback
            if (!user || !user.pet) {
                showToast("Evcil hayvan bilgisi bulunamadƒ±!");
                return;
            }

            showToast("üçñ Reklam hazƒ±rlanƒ±yor...");

            const self = this; // this referansƒ±nƒ± koru

            AdManager.showRewardedAd(function() {
                // D√úZELTƒ∞LDƒ∞: Reklam ba≈üarƒ±lƒ±, ≈üarjƒ± g√ºncelle
                console.log("Pet feed: Rewarded ad completed, updating energy...");

                // Enerji deƒüerini g√ºncelle
                user.pet.energy = 100;
                user.pet.lastFeed = Date.now();

                // Veritabanƒ±na kaydet
                if (user.name && db) {
                    db.ref('users/' + user.name + '/pet').set(user.pet)
                        .then(function() {
                            console.log("Pet feed: Database updated successfully");
                        })
                        .catch(function(err) {
                            console.error("Pet feed: Database error:", err);
                        });
                }

                // UI'ƒ± g√ºncelle - self kullan
                self.updateUI();
                self.renderPetList();

                showToast("üçñ Nom nom! Enerji %100 oldu!");

                // Show floating hearts
                showEmojiAnim('üíñ');

                // Konfeti efekti
                safeConfetti();
            });
        }
    };


    function safeOpenSetup() { try { updateDifficultyOptions(); showModal('modal-setup'); } catch (e) { console.error(e); showToast("Hata! Sayfayƒ± yenile."); } }
    function showSection(id) { if (id === 'home') { closeModal('modal-market'); closeModal('modal-inventory'); } }
    function applyTheme(t, saveToDb = true) {
        // Mevcut utility sƒ±nƒ±flarƒ±nƒ± koru
        const preserved = [];
        if (document.body.classList.contains('mobile-app')) preserved.push('mobile-app');

        // Temizle ve korunanlarƒ± ekle
        document.body.className = preserved.join(" ");
        if (t) document.body.classList.add(t);

        user.activeTheme = t;
        localStorage.setItem("yh_active_theme", t);
        if (saveToDb && user.name) {
            db.ref('users/' + user.name).update({ activeTheme: t });
        }
    }
    function loadTheme() { const t = localStorage.getItem("yh_active_theme"); if (t) applyTheme(t, false); }
    function showToast(m) {
        if (m && typeof m === "string" && (m.toLowerCase().includes("google bu kullanƒ±cƒ±ya reklam g√∂ndermedi") || m.toLowerCase().includes("google bu kullanƒ±cƒ± i√ßin reklam g√∂ndermedi"))) return;
        const t = document.getElementById("toast");
        t.innerText = m;
        t.className = "show";
        setTimeout(() => t.className = "", 3000);
    }
    function generateNumber(l) { let n = []; while (n.length < l) { let r = Math.floor(Math.random() * 10); if (n.length === 0 && r === 0) continue; if (!n.includes(r)) n.push(r); } return n.join(""); }
    function changeScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        currentScreen = id;
        if (id === 'screen-admin') loadAdminDashboard();

        // REKLAM Y√ñNETƒ∞Mƒ∞
        if (typeof AdManager !== 'undefined') {
            if (id === 'screen-lobby') {
                // Lobide AdMob Banner + Native G√∂ster
                if (AdManager.showBanner && AdManager.adMobBannerId) {
                    AdManager.showBanner(AdManager.adMobBannerId);
                }
                if (AdManager.showNativeAd) {
                    AdManager.showNativeAd();
                }
            } else {
                // Diƒüer ekranlarda banner gizle (Oyun alanƒ± temiz kalsƒ±n)
                if (AdManager.hideBanner) {
                    AdManager.hideBanner();
                }
            }
        }
    }

    function openGameSelector() {
        showModal('modal-game-selector');
    }
    function attemptExit() { 
        // Oyun aktifse veya oyun ekranlarƒ±ndaysa uyarƒ± g√∂ster
        if (game.active || currentScreen === 'screen-game' || currentScreen === 'screen-word-game' || currentScreen === 'screen-wait' || currentScreen === 'screen-word-lobby') {
            showModal('modal-exit-confirm'); 
        } else {
            // Oyun aktif deƒüilse direkt √ßƒ±k
            leaveRoom();
        }
    }
    function confirmExitGame() { 
        closeModal('modal-exit-confirm'); 
        // Oyun durumunu temizle
        game.active = false;
        stopTimer();
        stopWordTimer();
        // Odadan ayrƒ±l
        leaveRoom();
    }
    function handleBackButton() { 
        if (game.active || currentScreen === 'screen-wait' || currentScreen === 'screen-game' || currentScreen === 'screen-word-game' || currentScreen === 'screen-word-lobby') { 
            attemptExit(); 
        } else if (currentScreen === 'screen-admin') {
            changeScreen('screen-lobby'); 
        } else {
            showModal('modal-exit-confirm');
        }
        document.querySelectorAll('.modal-overlay').forEach(m => m.style.display = 'none'); 
    }
    function toggleTimeSelect(ctx) { if (ctx === 'single') { document.getElementById('singleDuration').style.display = document.getElementById('singleMode').value === 'timed' ? 'block' : 'none'; } else { document.getElementById('timeSelectDiv').style.display = document.getElementById('createMode').value === 'timed' ? 'block' : 'none'; } }
    function confirmLogout() { if (confirm("√áƒ±kƒ±≈ü?")) { localStorage.clear(); location.reload(); } }

    function updateLobbyUI() {
        // PET Sƒ∞STEMƒ∞ BA≈ûLAT (Eƒüer ba≈ülamadƒ±ysa)
        if (typeof PetSystem !== 'undefined') PetSystem.init();

        // 1. VIP ve Level
        if (VIP_NAMES.includes(user.name)) { document.getElementById('userLevelDisplay').innerText = "VIP"; } else { document.getElementById('userLevelDisplay').innerText = user.level; }

        // 2. ROZETLERƒ∞ HESAPLA
        let badgesHTML = '<span class="badge-container">';

        // A. Zenginlik Rozetleri (Altƒ±n Miktarƒ±)
        const g = user.gold || 0;
        if (g >= 1000000) badgesHTML += '<span class="badge-icon badge-king" title="Milyoner Kral">üëë</span>';
        else if (g >= 500000) badgesHTML += '<span class="badge-icon badge-rich" title="Yarƒ±m Milyoner">üíé</span>';
        else if (g >= 100000) badgesHTML += '<span class="badge-icon badge-rich" title="Holding Sahibi">üè¶</span>';
        else if (g >= 10000) badgesHTML += '<span class="badge-icon badge-rich" title="T√ºccar">üí∞</span>';

        // B. Reklam Canavarƒ± Rozetleri (ƒ∞zlenen Reklam)
        const ads = user.adsWatched || 0;
        if (ads >= 500) badgesHTML += '<span class="badge-icon badge-ad" title="Reklam ƒ∞lahƒ± (500+)">üì°</span>';
        else if (ads >= 100) badgesHTML += '<span class="badge-icon badge-ad" title="TV Yƒ±ldƒ±zƒ± (100+)">üåü</span>';
        else if (ads >= 50) badgesHTML += '<span class="badge-icon badge-ad" title="Y√∂netmen (50+)">üé¨</span>';
        else if (ads >= 10) badgesHTML += '<span class="badge-icon badge-ad" title="ƒ∞zleyici (10+)">üì∫</span>';

        badgesHTML += '</span>';

        // 3. Bilgileri Ekrana Bas
        // 3. Bilgileri Ekrana Bas
        document.getElementById('lobbyName').innerHTML = user.name + badgesHTML;

        // --- AVATAR G√ñSTERƒ∞Mƒ∞ (3D G√ñRSEL DESTEƒûƒ∞) ---
        const lobbyAvatarBox = document.getElementById('lobbyAvatarDisplay');
        // Eƒüer avatar bir link i√ßeriyorsa (http) resim olarak ekle
        if (user.avatar.includes('http')) {
            lobbyAvatarBox.innerHTML = `<img src="${user.avatar}" style="width:100%; height:100%; object-fit:contain; border-radius:50%; filter:drop-shadow(0 2px 4px rgba(0,0,0,0.2));">`;
        } else {
            // Deƒüilse normal emoji (eski sistem) olarak yaz
            lobbyAvatarBox.innerText = user.avatar;
        }
        // ---------------------------------------------

        document.getElementById('lobbyGold').innerText = user.gold;
        document.getElementById('lobbyClanTag').innerText = user.clan ? "[" + user.clan + "]" : "";

        // 4. XP ve Diƒüerleri
        const xpNeeded = 500;
        document.getElementById('xpText').innerText = `${Math.floor(user.xp / 100)}/5 Galibiyet`;
        document.getElementById('xpBarFill').style.width = Math.min(100, (user.xp / xpNeeded) * 100) + "%";
        checkQuestProgress();
        try {
            document.getElementById('qty-oracle').innerText = user.items?.oracle || 0;
            document.getElementById('qty-freeze').innerText = user.items?.freeze || 0;
            document.getElementById('qty-sabotage').innerText = user.items?.sabotage || 0;
            updateDifficultyOptions();
        } catch (e) { }

        if(document.getElementById('qty-oracle-word')) document.getElementById('qty-oracle-word').innerText = user.items.oracle;
        if(document.getElementById('qty-freeze-word')) document.getElementById('qty-freeze-word').innerText = user.items.freeze;
}

    // --- G√úNL√úK SERƒ∞ (QUEST) Sƒ∞STEMƒ∞ (G√úNCELLENMƒ∞≈û STABƒ∞L VERSƒ∞YON) ---

    function checkQuestProgress() {
        const box = document.getElementById('dailyQuestBox');
        const btn = document.getElementById('btnClaimQuest');
        const text = document.getElementById('questText');
        const prog = document.getElementById('questProgress');
        const bar = document.getElementById('questBarFill');

        if (!box || !user.name) return;
        box.style.display = 'block';

        const target = 3;
        const today = getDayKey(); // YYYY-MM-DD

        // Veritabanƒ±ndan bug√ºnk√º durumu √ßek
        db.ref(`users/${user.name}/quests/${today}`).once('value').then(snap => {
            const data = snap.val() || {};
            const wins = data.wins || 0; // Bug√ºn ka√ß kez kazandƒ±?
            const claimed = data.claimed || false; // √ñd√ºl√º aldƒ± mƒ±?

            // ƒ∞lerleme √ßubuƒüunu g√ºncelle
            const safeWins = Math.min(wins, target);
            prog.innerText = `${safeWins}/${target}`;
            bar.style.width = ((safeWins / target) * 100) + "%";

            if (claimed) {
                // √ñd√ºl zaten alƒ±nmƒ±≈ü - KUTUYU TAMAMLANDI MODUNA AL
                btn.style.display = 'none';
                box.classList.add('completed');
                text.innerText = "‚úÖ Tamamlandƒ±!";
                text.style.color = "green";
                prog.innerText = "Yarƒ±n tekrar gel.";
                box.style.background = "#e8f5e9";
            } else if (wins >= target) {
                // Hedef tamamlanmƒ±≈ü ama √∂d√ºl alƒ±nmamƒ±≈ü -> BUTONU G√ñSTER VE AKTƒ∞F ET
                btn.style.display = 'block';
                btn.disabled = false;
                btn.innerHTML = "1000 üí∞ AL"; // Buton yazƒ±sƒ±nƒ± sƒ±fƒ±rla
                btn.onclick = function () { claimQuestReward(); };

                box.classList.remove('completed');
                text.innerText = "üéâ √ñd√ºl Hazƒ±r!";
                text.style.color = "#d35400";
                box.style.background = "rgba(255,255,255,0.95)";
            } else {
                // Hedef hen√ºz tamamlanmamƒ±≈ü
                btn.style.display = 'none';
                box.classList.remove('completed');
                text.innerText = "Bug√ºn 3 oyun kazan!";
                text.style.color = "#d35400";
                box.style.background = "rgba(255,255,255,0.9)";
            }
        });
    }

    function claimQuestReward() {
        const btn = document.getElementById('btnClaimQuest');

        // 1. ANINDA GERƒ∞ Bƒ∞LDƒ∞Rƒ∞M VER (Kullanƒ±cƒ± bastƒ±ƒüƒ±nƒ± anlasƒ±n)
        if (btn) {
            btn.disabled = true; // √áift tƒ±klamayƒ± engelle
            btn.innerHTML = "‚è≥ Alƒ±nƒ±yor..."; // G√∂rsel deƒüi≈üim
            btn.style.opacity = "0.7";
        }

        const today = getDayKey();

        db.ref(`users/${user.name}/quests/${today}`).once('value').then(snap => {
            const data = snap.val() || {};
            const wins = data.wins || 0;
            const claimed = data.claimed || false;

            if (claimed) {
                showToast("Bug√ºn √∂d√ºl√ºn√º zaten aldƒ±n!");
                checkQuestProgress();
                return;
            }

            if (wins < 3) {
                showToast("Hen√ºz 3 galibiyete ula≈ümadƒ±n!");
                checkQuestProgress();
                return;
            }

            // √ñd√ºl√º ver ve kaydet
            updateGold(1000);

            db.ref(`users/${user.name}/quests/${today}/claimed`).set(true).then(() => {
                showToast("1000 Altƒ±n Kazanƒ±ldƒ±! üéâ");
                AudioEngine.win();
                safeConfetti();

                // 2. ARAY√úZ√ú HEMEN G√úNCELLE
                if (btn) btn.style.display = 'none'; // Butonu hemen gizle
                checkQuestProgress(); // Kutunun tamamƒ±nƒ± ye≈üile √ßevir
            });
        });
    }
    function updateDifficultyOptions() {
        const sel1 = document.getElementById('createDiff');
        const sel2 = document.getElementById('singleDiffSelect');
        if (!sel1 || !sel2) return;
        const selects = [sel1, sel2];
        selects.forEach(sel => {
            sel.innerHTML = "";
            [{ v: 3, t: "3 Hane", l: 1 }, { v: 4, t: "4 Hane", l: 1 }, { v: 5, t: "5 Hane üîí Lv.2", l: 2 }, { v: 6, t: "6 Hane üîí Lv.5", l: 5 }, { v: 7, t: "7 Hane üîí Lv.10", l: 10 }].forEach(o => {
                const opt = document.createElement('option');
                opt.value = o.v;
                if (user.level < o.l && !VIP_NAMES.includes(user.name)) {
                    opt.disabled = true;
                    opt.innerText = o.t;
                } else {
                    opt.innerText = o.t.replace(/üîí Lv\.\d+/, "");
                }
                sel.appendChild(opt);
            });
            if (sel.value === "" || sel.options[sel.selectedIndex].disabled) sel.value = 4;
        });
    }
    function openMarket() {
        // Yandex Banner (Paid Ad) - Pet/Theme
        if (typeof AdManager !== 'undefined' && AdManager.showBanner && AdManager.yandexBannerId) {
             AdManager.showBanner(AdManager.yandexBannerId);
        }
        try {
            if (!user || !user.name) { showToast("L√ºtfen √∂nce giri≈ü yapƒ±n."); return; }
            const container = document.getElementById('marketItems'); container.innerHTML = "";
            const inventory = (Array.isArray(user.inventory)) ? user.inventory : [];
            const itemsHeader = document.createElement('div'); itemsHeader.className = 'market-category'; itemsHeader.innerHTML = '‚ö° G√º√ßlendiriciler'; container.appendChild(itemsHeader);
            const itemsGrid = document.createElement('div'); itemsGrid.style.cssText = "display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-bottom:15px;";
            const consumables = [{ id: 'oracle', name: 'üîÆ Kahin K√ºresi', price: 200, desc: '1 Rakamƒ±n yerini s√∂yler.' }, { id: 'freeze', name: '‚ùÑÔ∏è Zaman Dondurucu', price: 150, desc: '+10 Saniye ekler.' }, { id: 'sabotage', name: 'üòà Sabotaj', price: 300, desc: '(Online) Rakibi k√∂r et.' }];
            consumables.forEach(itm => { const card = document.createElement('div'); card.className = "card"; card.style.cssText = "margin:0; padding:10px; font-size:0.8rem;"; card.innerHTML = `<b>${itm.name}</b><br><span style="font-size:0.7rem;color:#ccc;">${itm.desc}</span><br><b style="color:gold;">${itm.price} üí∞</b><div style="display:flex; gap:5px; margin-top:5px;"><button class="btn-purple" style="padding:5px; flex:1;" onclick="buyItemWithAd('${itm.id}')">üì∫ ƒ∞ZLE</button></div><div style="font-size:0.7rem;margin-top:3px;">Mevcut: ${user.items[itm.id] || 0}</div>`; itemsGrid.appendChild(card); }); container.appendChild(itemsGrid);
            const groups = { team: { title: '‚öΩ Takƒ±mlar (Premium)', icon: 'üèÜ' }, bg: { title: 'üñºÔ∏è Arkaplanlar', icon: 'üé®' }, color: { title: 'üé® Renk Temalarƒ±', icon: 'üåà' } };
            Object.keys(groups).forEach(key => { const header = document.createElement('div'); header.className = 'market-category'; header.innerHTML = `${groups[key].title}`; container.appendChild(header); const grid = document.createElement('div'); grid.style.cssText = "display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-bottom:15px;"; const items = THEMES.filter(t => t.type === key); items.forEach(theme => { const card = document.createElement('div'); card.className = "card"; card.style.cssText = "margin:0; padding:10px; display:flex; flex-direction:column; justify-content:space-between; height:100%;"; const isOwned = (theme.cost === 0) || inventory.includes(theme.id); const isActive = (user.activeTheme === theme.id); let btnHTML = ""; let btnClass = ""; let btnText = ""; let btnAction = ""; if (isActive) { btnClass = "btn-grey"; btnText = "AKTƒ∞F"; btnAction = ""; } else if (isOwned) { btnClass = "btn-green"; btnText = "KULLAN"; btnAction = `applyTheme('${theme.id}')`; } else { btnClass = "btn-purple"; btnText = `üé¨ ƒ∞ZLE & AL`; btnAction = `buyTheme('${theme.id}')`; } const btnId = `btn-theme-${theme.id}`; card.innerHTML = `<div style="font-weight:bold; font-size:0.9rem; margin-bottom:5px;">${theme.name}</div><button id="${btnId}" class="${btnClass}" onclick="${btnAction}" style="padding:8px; margin-top:auto; font-size:0.8rem; width:100%;">${btnText}</button>`; grid.appendChild(card); }); container.appendChild(grid); });
            showModal('modal-market');
        } catch (err) { showToast("Market y√ºklenirken hata olu≈ütu."); }
    }

    function buyItem(id, cost) { if (user.gold < cost) return showToast("Yetersiz Altƒ±n!"); updateGold(-cost); if (!user.items) user.items = { oracle: 0, freeze: 0, sabotage: 0 }; user.items[id] = (user.items[id] || 0) + 1; db.ref('users/' + user.name + '/items').set(user.items); showToast("Satƒ±n alƒ±ndƒ±!"); openMarket(); updateLobbyUI(); }
    function buyItemWithAd(id) { if (confirm("Reklam izleyerek bu e≈üyayƒ± almak ister misin?")) { AdManager.showRewardedAd(() => { if (!user.items) user.items = { oracle: 0, freeze: 0, sabotage: 0 }; user.items[id] = (user.items[id] || 0) + 1; db.ref('users/' + user.name + '/items').set(user.items); showToast("E≈üya kazanƒ±ldƒ±! (Reklam)"); openMarket(); updateLobbyUI(); }); } }
    function useItem(type) {
        // --- Helper Function to Execute Item Logic ---
        const executeItem = (itemType) => {
            if (currentScreen === 'screen-word-game') {
                if (!wordGameState.active) return showToast("Oyun ba≈ülamadƒ±!");

                if (itemType === 'oracle') {
                    if (wordGameState.usedItems && wordGameState.usedItems.includes('oracle')) {
                        // Word Career Limit check
                        if (wordGameState.mode === 'career' && wordGameState.oracleMax && wordGameState.oracleUsedCount >= wordGameState.oracleMax) {
                             return showToast("‚ö†Ô∏è Bu seviyede Kahin limiti doldu!");
                        }
                        // Normal mode limit? usually 1
                        if (wordGameState.mode !== 'career') return showToast("‚ö†Ô∏è ƒ∞pucu her oyunda 1 kez kullanƒ±labilir!");
                    }
                    if (!wordGameState.usedItems) wordGameState.usedItems = [];
                    wordGameState.usedItems.push('oracle');
                    if (wordGameState.mode === 'career') wordGameState.oracleUsedCount = (wordGameState.oracleUsedCount || 0) + 1;

                    const secret = wordGameState.secret;
                    const idx = Math.floor(Math.random() * secret.length);
                    showToast(`üîÆ KAHƒ∞N: ${idx+1}. Harf: ${secret[idx]}`);
                }
                else if (itemType === 'freeze') {
                    // Assuming word game has a timer active?
                    if (document.getElementById('wordTimerDisplay').style.display !== 'none') {
                         game.startTime += 10000; // This might need adjustment if word game timer logic differs
                         showToast("‚ùÑÔ∏è Zaman eklendi!");
                    } else {
                        showToast("Bu modda zaman yok!");
                    }
                }
            }
            else {
                // NUMBER GAME LOGIC
                if (!game.active) return showToast("Oyun ba≈ülamadƒ±!");

                if (itemType === 'oracle') {
                    if (game.diff === 3) return showToast("üö´ 3 Haneli oyunlarda Kahin yasaktƒ±r!");
                    if (game.usedItems && game.usedItems.includes('oracle')) return showToast("‚ö†Ô∏è Kahin √∂zelliƒüi her oyunda en fazla 1 kez kullanƒ±labilir!");

                    if (!game.usedItems) game.usedItems = [];
                    game.usedItems.push('oracle');
                    if (game.mode === 'career') game.oracleUsedCount = (game.oracleUsedCount || 0) + 1;

                    const sStr = game.secret.toString();
                    const idx = Math.floor(Math.random() * sStr.length);
                    alert("üîÆ KAHƒ∞N: " + (idx+1) + ". Rakam: " + sStr[idx]);
                }
                else if (itemType === 'freeze') {
                    game.startTime += 10000;
                    showToast("‚ùÑÔ∏è +10 Saniye!");
                    try { AudioEngine.notification(); } catch(e){}
                }
                else if (itemType === 'sabotage') {
                    if (game.mode === 'online') {
                        triggerSabotageEffect();
                        db.ref('rooms/' + game.room + '/active_effects').push({ type: 'ink', sender: user.name, time: Date.now() });
                        showToast("üòà Sabotaj g√∂nderildi!");
                    } else {
                        showToast("Sadece online modda!");
                    }
                }
            }
        };

        // --- Main Check ---
        if (!user.items) user.items = { oracle: 0, freeze: 0, sabotage: 0 };

        if (user.items[type] > 0) {
            user.items[type]--;
            db.ref('users/' + user.name + '/items').set(user.items);
            updateLobbyUI();
            executeItem(type);
        } else {
            // E≈üya yoksa reklam teklif et
            if (confirm("E≈üyan kalmamƒ±≈ü! Reklam izleyerek kullanmak ister misin?")) {
                if (typeof AdManager !== 'undefined' && AdManager.showRewardedAd) {
                    AdManager.showRewardedAd(() => {
                        // Reward: Give 1 item and use it immediately?
                        // Or just execute action without giving item?
                        // "Reklam izleyerek kullanmak" implies executing action.
                        executeItem(type);
                    });
                }
            }
        }
    }
    function triggerSabotageEffect() { const layer = document.getElementById('sabotageLayer'); layer.style.display = 'block'; AudioEngine.error(); setTimeout(() => { layer.style.display = 'none'; }, 3000); }
    function buyTheme(themeId) { const theme = THEMES.find(t => t.id === themeId); if (!theme) return showToast("Hatalƒ± √ºr√ºn!"); if (confirm(`${theme.name} temasƒ±nƒ± reklam izleyerek a√ßmak ister misin?`)) { AdManager.showRewardedAd(() => { if (!user.inventory) user.inventory = []; if (!user.inventory.includes(themeId)) { user.inventory.push(themeId); } if (db && user.name) { db.ref('users/' + user.name + '/inventory').set(user.inventory); } showToast(`üéâ Tebrikler! "${theme.name}" a√ßƒ±ldƒ±.`); AudioEngine.win(); const btn = document.getElementById(`btn-theme-${themeId}`); if (btn) { btn.className = "btn-green"; btn.innerHTML = "KULLAN"; btn.onclick = function () { applyTheme(themeId); }; btn.style.animation = "pulseBtn 0.5s ease"; } }); } }
    function openInventory() { const c = document.getElementById('inventoryList'); c.innerHTML = `<div class="list-item"><span>Varsayƒ±lan</span><button class="btn-green" style="width:auto;padding:5px;" onclick="applyTheme('')">SE√á</button></div>`; const inventory = user.inventory || []; THEMES.forEach(t => { if (inventory.includes(t.id) || t.cost === 0) { c.innerHTML += `<div class="list-item"><span>${t.name}</span><button class="btn-blue" style="width:auto;padding:5px;" onclick="applyTheme('${t.id}')">SE√á</button></div>`; } }); showModal('modal-inventory'); }

    // --- YENƒ∞LENMƒ∞≈û VE KORUMALI DAVET Sƒ∞STEMƒ∞ ---

    function inviteUser(targetName) {
        if (!user.name) return showToast("√ñnce giri≈ü yapmalƒ±sƒ±n.");
        if (targetName === user.name) return showToast("Kendini davet edemezsin.");

        // DURUM 1: Zaten bir odadayƒ±m
        if (game.room) {
            // Kƒ∞Lƒ∞T NOKTA: Sadece P1 (Oda Kurucusu) davet atabilir.
            if (game.role !== 'p1') {
                return showToast("Misafir oyuncular davet g√∂nderemez!");
            }

            // Odanƒ±n dolu olup olmadƒ±ƒüƒ±nƒ± kontrol et
            db.ref('rooms/' + game.room).once('value').then(snap => {
                const r = snap.val();
                if (!r) return; // Oda silinmi≈üse i≈ülem yapma

                // Eƒüer oyun zaten oynanƒ±yorsa veya P2 koltuƒüu doluysa
                if (r.status === 'playing' || r.p2) {
                    return showToast("Oda dolu veya oyun ba≈ülamƒ±≈ü!");
                }

                // M√ºsaitse daveti g√∂nder
                db.ref('invites/' + targetName).push({
                    from: user.name,
                    room: game.room,
                    timestamp: Date.now()
                });
                showToast(`${targetName} odaya √ßaƒürƒ±ldƒ±!`);
            });
            return;
        }

        // DURUM 2: Lobideyim (Oda yok), yeni oda kurup davet atacaƒüƒ±m
        if (confirm(`${targetName} ile oynamak i√ßin 4 Haneli oda kurulsun mu?`)) {
            // Altƒ±n kontrol√º (Opsiyonel, istersen kaldƒ±rabilirsin)
            if (user.gold < 50) return showToast("Oda kurmak i√ßin 50 Altƒ±n gerekli!");
            updateGold(-50);

            const newRoomCode = Math.floor(10000 + Math.random() * 90000).toString();
            const defaultDiff = 4;

            // Odayƒ± Veritabanƒ±na Yaz
            db.ref('rooms/' + newRoomCode).set({
                secret: generateNumber(defaultDiff),
                p1: { name: user.name, avatar: user.avatar },
                config: { diff: defaultDiff, type: "classic", playStyle: "turn", duration: 3 },
                status: "waiting",
                turn: "p1",
                rights: 15,
                startTime: Date.now(),
                round: 1
            });

            // Kurucu √ßƒ±karsa odayƒ± sil
            db.ref('rooms/' + newRoomCode).onDisconnect().remove();

            // Yerel Oyun Deƒüi≈ükenlerini Ayarla
            game.room = newRoomCode;
            game.role = "p1"; // Otomatik P1 oldun
            game.diff = defaultDiff;
            game.type = "classic";
            game.mode = "online";
            game.playStyle = "turn";
            game.duration = 3;

            // Bekleme Ekranƒ±na Ge√ß
            changeScreen('screen-wait');
            document.getElementById('roomCodeDisplay').innerText = newRoomCode;
            document.getElementById('roomModeInfo').innerText = "4 Haneli (Davet)";

            // Odayƒ± Dinlemeye Ba≈üla
            listenRoom(newRoomCode);

            // Daveti G√∂nder
            db.ref('invites/' + targetName).push({
                from: user.name,
                room: newRoomCode,
                timestamp: Date.now()
            });
            showToast(`Oda kuruldu ve ${targetName} davet edildi!`);
        }
    }

    function updatePresence(isOnline) { if (!db) return; const ref = db.ref('presence/' + user.name); if (isOnline) { ref.set({ status: 'online', lastActive: Date.now() }); ref.onDisconnect().remove(); } else { ref.remove(); } }

    // Global bir sessiz mod deƒüi≈ükeni tanƒ±mlƒ±yoruz
    let isMuted = false;

    const AudioEngine = {
        ctx: null,
        init: function () { try { if (!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)(); } catch (e) { } },
        playTone: function (f, t, d) {
            // BURASI EKLENDƒ∞: Sessiz moddaysa √ßalma!
            if (isMuted) return;

            try { if (!this.ctx) this.init(); if (!this.ctx) return; const o = this.ctx.createOscillator(), g = this.ctx.createGain(); o.type = t; o.frequency.setValueAtTime(f, this.ctx.currentTime); g.gain.setValueAtTime(0.1, this.ctx.currentTime); o.connect(g); g.connect(this.ctx.destination); o.start(); o.stop(this.ctx.currentTime + d); } catch (e) { }
        },
        click: function () { this.playTone(800, 'sine', 0.05); },
        success: function () { this.playTone(1200, 'square', 0.1); },
        error: function () { this.playTone(300, 'sawtooth', 0.2); },
        win: function () { this.playTone(500, 'triangle', 0.2); },
        notification: function () { this.playTone(800, 'sine', 0.1); setTimeout(() => this.playTone(1200, 'sine', 0.2), 150); },
        heartbeat: function () { this.playTone(150, 'sine', 0.1); setTimeout(() => this.playTone(150, 'sine', 0.1), 150); },
                coin: function () {
            if (isMuted) return;
            try {
                if (!this.ctx) this.init();
                const t = this.ctx.currentTime;
                const o = this.ctx.createOscillator();
                const g = this.ctx.createGain();

                o.type = "sine";
                o.frequency.setValueAtTime(987, t); // B5
                o.frequency.setValueAtTime(1318, t + 0.08); // E6

                g.gain.setValueAtTime(0.1, t);
                g.gain.linearRampToValueAtTime(0.1, t + 0.08);
                g.gain.exponentialRampToValueAtTime(0.001, t + 0.3);

                o.connect(g);
                g.connect(this.ctx.destination);
                o.start(t);
                o.stop(t + 0.3);
            } catch (e) { }
        }
    };


    // --- CONFETTI WRAPPER (THROTTLED + SINGLE CANVAS) ---
    // Fixes "screen shake / blinking" that can happen when canvas-confetti repeatedly creates canvases on some WebViews.
    let __confettiInstance = null;
    let __lastConfettiAt = 0;

    function safeConfetti(opts) {
        try {
            // Respect reduced motion
            if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;

            const now = Date.now();
            // Throttle: prevent stacking multiple bursts in a short time (causes flicker)
            if (now - __lastConfettiAt < 1200) return;
            __lastConfettiAt = now;

            // Create / reuse a single canvas for confetti
            if (!__confettiInstance && typeof window.confetti === 'function') {
                const canvas = document.getElementById('confettiCanvas');
                if (canvas) {
                    __confettiInstance = window.confetti.create(canvas, { resize: true, useWorker: true });
                } else {
                    // Fallback: use default instance if canvas missing
                    __confettiInstance = window.confetti;
                }
            }

            if (typeof __confettiInstance !== 'function') return;

            const base = Object.assign({
                particleCount: 90,
                spread: 70,
                startVelocity: 35,
                origin: { y: 0.7 }
            }, (opts || {}));

            __confettiInstance(base);

            // Small follow-up burst (looks good, avoids long heavy animations)
            setTimeout(() => {
                if (typeof __confettiInstance === 'function') {
                    __confettiInstance(Object.assign({}, base, {
                        particleCount: Math.max(40, Math.floor((base.particleCount || 90) * 0.55)),
                        spread: Math.min(120, (base.spread || 70) + 20),
                        origin: { y: 0.55 }
                    }));
                }
            }, 180);
        } catch (e) {
            // Never let confetti break gameplay
        }
    }

// --- GOLD ANIMATION FUNCTION ---
    function animateGoldChange(amount) {
        const el = document.getElementById('lobbyGold');
        if (!el) return;

        const start = parseInt(el.innerText) || 0;
        const end = start + amount;
        const duration = 1500; // 1.5 seconds
        const startTime = Date.now();

        // Play first coin sound
        AudioEngine.coin();

        const timer = setInterval(() => {
            const now = Date.now();
            const progress = Math.min(1, (now - startTime) / duration);
            const current = Math.floor(start + (end - start) * progress);

            el.innerText = current;

            // Randomly play coin sounds during animation
            if (Math.random() > 0.8) AudioEngine.coin();

            if (progress >= 1) {
                clearInterval(timer);
                el.innerText = end;
                AudioEngine.coin(); // Final ding
            }
        }, 50);
    }

    // --- PIGGY BANK WIN ANIMATION FUNCTION ---
    function showPiggyWin(amount, nextAction) {
        const overlay = document.getElementById('piggyWinOverlay');
        const amountEl = document.getElementById('piggyAmount');
        const fillBar = document.getElementById('piggyFillBar');
        const coinLayer = document.getElementById('coinDropLayer');
        const btns = document.getElementById('piggyButtons');

        if (!overlay) return;

        // Store original amount for potential doubling
        window.lastWinAmount = amount;
        window.isDoubleReward = false;

        // Reset
        coinLayer.innerHTML = '';
        amountEl.innerText = `+${amount} Altƒ±n`;
        fillBar.style.width = '0%';
        if(btns) btns.style.display = 'none'; // Hide buttons initially

        // Show (Fade In)
        overlay.style.display = 'flex';
        // Force reflow
        void overlay.offsetWidth;
        overlay.classList.add('show'); // Use class for transition

        // Animate Bar
        setTimeout(() => {
            const fillPercent = Math.min(100, (amount / 300) * 100);
            fillBar.style.transition = 'width 1.5s cubic-bezier(0.25, 1, 0.5, 1)';
            fillBar.style.width = fillPercent + '%';
        }, 300);

        // Sound Sequence
        let soundCount = 0;
        const maxSounds = 5;
        const soundInt = setInterval(() => {
            try { AudioEngine.coin(); } catch(e){}
            soundCount++;
            if (soundCount >= maxSounds) clearInterval(soundInt);
        }, 150);

        // Particle Effect
        for(let i=0; i<20; i++) {
            const coin = document.createElement('div');
            coin.className = 'coin-particle';
            coin.innerText = 'üí∞';
            coin.style.left = (50 + (Math.random()*40 - 20)) + '%';
            coin.style.animationDuration = (0.5 + Math.random()) + 's';
            coin.style.animationDelay = (Math.random() * 0.5) + 's';
            coinLayer.appendChild(coin);
        }

        // Show Buttons and Double Reward Button after animation
        setTimeout(() => {
            if(btns) {
                // Add double reward button if not exists
                let doubleBtn = document.getElementById('btnDoubleReward');
                if (!doubleBtn && amount > 0) {
                    doubleBtn = document.createElement('button');
                    doubleBtn.id = 'btnDoubleReward';
                    doubleBtn.className = 'btn-gold';
                    doubleBtn.style.cssText = 'width:100%; margin-top:10px; padding:12px; font-size:1rem; background:linear-gradient(135deg, #f39c12, #e67e22); animation:pulse-active 1.5s infinite;';
                    doubleBtn.innerHTML = 'üì∫ REKLAM ƒ∞ZLE - KAZANCI ƒ∞Kƒ∞YE KATLA!';
                    doubleBtn.onclick = watchAdForDoubleReward;
                    btns.appendChild(doubleBtn);
                }

                // If nextAction provided, add a special Continue button
                if (nextAction) {
                    const continueBtn = document.createElement('button');
                    continueBtn.id = 'btnCustomContinue';
                    continueBtn.className = 'btn-blue';
                    continueBtn.style.cssText = 'width:100%; margin-bottom:10px; padding:12px; font-size:1rem; animation:pulse-active 1.5s infinite;';
                    continueBtn.innerHTML = nextAction.text || 'DEVAM ET';
                    continueBtn.onclick = nextAction.action;

                    btns.prepend(continueBtn);
                }

                btns.style.display = 'flex';
                btns.style.flexDirection = 'column'; // Stack buttons
                btns.style.animation = 'slideUp 0.5s ease';
            }
        }, 1500);
    }

    // Reklam izleyerek kazancƒ± ikiye katlama
    function watchAdForDoubleReward() {
        const doubleBtn = document.getElementById('btnDoubleReward');
        if (doubleBtn) {
            doubleBtn.innerHTML = '‚è≥ Reklam Y√ºkleniyor...';
            doubleBtn.disabled = true;
        }

        // Check if AdManager exists and ad is ready
        // Use Rewarded Interstitial if available, otherwise standard Rewarded
        if (typeof AdManager !== 'undefined') {
            const adMethod = (AdManager.showRewardedInterstitialAd) ?
                             AdManager.showRewardedInterstitialAd.bind(AdManager) :
                             AdManager.showRewardedAd.bind(AdManager);

            adMethod(() => {
                // Reklam ba≈üarƒ±yla izlendi - kazancƒ± ikiye katla
                const originalAmount = window.lastWinAmount || 0;
                const doubleAmount = originalAmount * 2;
                
                // Update gold
                updateGold(originalAmount); // Add the extra amount
                
                // Update UI
                const amountEl = document.getElementById('piggyAmount');
                if (amountEl) {
                    amountEl.innerHTML = `+${doubleAmount} Altƒ±n <span style="color:#f1c40f; font-size:0.7em;">(2x)</span>`;
                }
                
                window.isDoubleReward = true;
                
                // Show success message
                showToast('üéâ Tebrikler! Kazancƒ±n ikiye katlandƒ±!');
                
                // Remove double button
                if (doubleBtn) {
                    doubleBtn.style.display = 'none';
                }
                
                // Trigger confetti
                safeConfetti();
                
                try { AudioEngine.win(); } catch(e){}
            });
            
            // Set timeout for ad load failure
            setTimeout(() => {
                if (doubleBtn && !doubleBtn.disabled && doubleBtn.innerHTML.includes('Y√ºkleniyor')) {
                    doubleBtn.innerHTML = 'üì∫ REKLAM ƒ∞ZLE - KAZANCI ƒ∞Kƒ∞YE KATLA!';
                    doubleBtn.disabled = false;
                    showToast('‚ö†Ô∏è Reklam y√ºklenemedi. Tekrar dene!');
                }
            }, 5000);
        } else {
            // AdManager not available
            if (doubleBtn) {
                doubleBtn.innerHTML = 'üì∫ REKLAM ƒ∞ZLE - KAZANCI ƒ∞Kƒ∞YE KATLA!';
                doubleBtn.disabled = false;
            }
            showToast('‚ö†Ô∏è Reklam ≈üu anda kullanƒ±lamƒ±yor. Daha sonra tekrar dene!');
        }
    }


    // Piggy overlay kapatma ve tekrar oynama

    // Sessiz Modu A√ßƒ±p Kapatan Fonksiyon
    function toggleMute() {
        isMuted = !isMuted;
        localStorage.setItem("yh_muted", isMuted); // Tercihi kaydet
        updateMuteUI();
    }

    // Butonun ikonunu g√ºncelleyen fonksiyon
    function updateMuteUI() {
        const btn = document.getElementById('btnMute');
        if (btn) {
            if (isMuted) {
                btn.innerText = "üîá";
                btn.style.opacity = "0.5";
            } else {
                btn.innerText = "üîä";
                btn.style.opacity = "1";
                // A√ßƒ±ldƒ±ƒüƒ±nda test sesi verelim (kullanƒ±cƒ± anlasƒ±n)
                AudioEngine.click();
            }
        }
    }
    function addXP(amount) { user.xp += amount; const xpNeeded = 500; if (user.xp >= xpNeeded) { user.xp = 0; user.level++; updateGold(200); document.getElementById('newLevelDisplay').innerText = user.level; showModal('modal-levelup'); safeConfetti(); } db.ref('users/' + user.name).update({ xp: user.xp, level: user.level }); updateLobbyUI(); }
    // Admin ≈üifre alanƒ±nƒ± g√∂ster/gizle
    function checkAdminPasswordField() {
        const name = document.getElementById('usernameInput').value.trim();
        const passInput = document.getElementById('passwordInput');
        if (ADMIN_NAMES.includes(name)) {
            passInput.style.display = 'block';
            passInput.placeholder = 'Admin ≈ûifresi';
        } else {
            passInput.style.display = 'none';
            passInput.value = '';
        }
    }

    // Gizlilik Politikasƒ± modalƒ±nƒ± a√ß
    function showPrivacyPolicy() {
        closeModal('modal-more');
        showModal('modal-privacy');
    }

    function attemptLogin() { 
        let name = document.getElementById('usernameInput').value.trim(); 
        let pass = document.getElementById('passwordInput').value.trim();
        const dataConsent = document.getElementById('dataConsentCheckbox');
        
        if (name.length < 3) return showToast("ƒ∞sim kƒ±sa!"); 
        
        // Google Play Store - Veri payla≈üƒ±m onayƒ± kontrol√º
        if (dataConsent && !dataConsent.checked) {
            return showToast("‚ö†Ô∏è Devam etmek i√ßin Gizlilik Politikasƒ±'nƒ± kabul etmelisiniz!");
        }
        
        // Sadece admin kullanƒ±cƒ±larƒ±ndan ≈üifre iste
        if (ADMIN_NAMES.includes(name)) { 
            if (!pass || pass.length < 3) return showToast("Admin ≈üifresi gerekli!");
            if (btoa(pass) !== ADMIN_HASH) return alert("Hatalƒ± Admin ≈ûifresi!"); 
            completeLogin(name); 
            return; 
        } 
        
        if (name === "OkuEmel") { 
            if (btoa(unescape(encodeURIComponent(pass))) !== OKUEMEL_HASH) return alert("Hatalƒ± ≈ûifre!"); 
            completeLogin(name); 
            return; 
        }
        
        // Normal kullanƒ±cƒ±lar i√ßin ≈üifre sorma (ilk giri≈üte otomatik olu≈üturulur)
        db.ref('banned/' + name).once('value').then(snap => { 
            if (snap.exists()) { alert("Yasaklƒ±!"); return; } 
            db.ref('users/' + name).once('value').then(s => { 
                const val = s.val(); 
                if (val) { 
                    // Mevcut kullanƒ±cƒ± - ≈üifre kontrol√º yapma, direkt giri≈ü
                    completeLogin(name); 
                } else { 
                    // Yeni kullanƒ±cƒ± - rastgele ≈üifre olu≈ütur
                    const randomPass = Math.random().toString(36).substring(2, 8);
                    db.ref('users/' + name).set({ 
                        password: randomPass, 
                        gold: 500, 
                        xp: 0, 
                        level: 1, 
                        inventory: [], 
                        joinDate: Date.now() 
                    }).then(() => {
                        showToast("üéâ Ho≈ü geldin! ≈ûifreniz: " + randomPass);
                        completeLogin(name); 
                    }); 
                } 
            }); 
        }); 
    }

    // --- MODAL UTILS ---
    function showModal(id) {
        const el = document.getElementById(id);
        if (!el) { console.warn("Modal not found:", id); return; }
        el.style.display = 'flex';
        if (id === 'modal-about') loadAboutText();
    }
    function closeModal(id) {
        const el = document.getElementById(id);
        if (!el) return;
        el.style.display = 'none';

        // REKLAM Y√ñNETƒ∞Mƒ∞: Modal kapanƒ±nca banner durumunu g√ºncelle
        if (typeof AdManager !== 'undefined') {
            // Market veya Profil kapandƒ±ƒüƒ±nda Lobi bannerƒ±nƒ± geri getir (Eƒüer lobideysek)
            if ((id === 'modal-market' || id === 'modal-profile-v2' || id === 'modal-pet') && currentScreen === 'screen-lobby') {
                if (AdManager.showBanner && AdManager.adMobBannerId) {
                    AdManager.showBanner(AdManager.adMobBannerId);
                }
            }
        }

        // Eƒüer bu bir 'modal chest reward' ise, confetti'yi de temizleyebiliriz (isteƒüe baƒülƒ±)
        if (id === 'modal-chest-reward') {
            // Confetti temizliƒüi opsiyoneldir, k√ºt√ºphane genelde kendi temizler
        }
    }

    function completeLogin(name) {
        user.name = name; db.ref('users/' + name).once('value').then(snap => {
            const val = snap.val() || {}; if (!val.joinDate) { db.ref('users/' + name).update({ joinDate: Date.now() }); }
            user.gold = val.gold !== undefined ? Number(val.gold) : 500;
            user.xp = val.xp !== undefined ? Number(val.xp) : 0;
            user.level = val.level !== undefined ? Number(val.level) : 1;

            // --- EKLENEN KISIM BA≈ûLANGI√á ---
            // Bu satƒ±rlar veritabanƒ±ndan kariyer ilerlemesini √ßeker.
            user.careerLevel = val.careerLevel !== undefined ? Number(val.careerLevel) : 1;
            user.careerWins = val.careerWins !== undefined ? Number(val.careerWins) : 0;
            // --- EKLENEN KISIM Bƒ∞Tƒ∞≈û ---

            user.inventory = val.inventory || [];
            user.clan = val.clan || "";
            user.wordLevel = val.wordLevel || 1;
            user.wordCareerWins = val.wordCareerWins || 0;
            user.claimedWordRewards = val.claimedWordRewards || {};

            // RESET LOGIC V3
            if (!val.wordCareerResetV3) {
                console.log("Resetting Word Career to V3 Defaults");
                user.wordLevel = 1;
                user.wordCareerWins = 0;
                user.claimedWordRewards = {};
                user.wordCareerResetV3 = true;
                db.ref('users/' + name).update({
                    wordLevel: 1,
                    wordCareerWins: 0,
                    claimedWordRewards: {},
                    wordCareerResetV3: true
                });
            }
            user.winStreak = val.winStreak || 0;
            user.pet = val.pet || null; // Load pet data from DB
            user.totalMinutes = val.totalMinutes || 0; user.lastVaultTime = val.lastVaultTime || 0; user.items = val.items || { oracle: 0, freeze: 0, sabotage: 0 };
            user.adsWatched = val.adsWatched || 0;

            user.claimedCareerRewards = val.claimedCareerRewards || {}; // Load claimed career rewards

            const localAvatar = localStorage.getItem("yh_ava"); if (localAvatar && localAvatar !== "undefined") { user.avatar = localAvatar; if (val.avatar !== localAvatar) { db.ref('users/' + name).update({ avatar: localAvatar }); } } else { user.avatar = val.avatar || "üòé"; localStorage.setItem("yh_ava", user.avatar); } user.activeTheme = val.activeTheme || ""; if (user.activeTheme) applyTheme(user.activeTheme, false); const freeThemes = ['bg-neon-city', 'bg-mystic-purple', 'bg-volcano', 'bg-deep-sea']; let invChanged = false; freeThemes.forEach(t => { if (!user.inventory.includes(t)) { user.inventory.push(t); invChanged = true; } }); if (invChanged) db.ref('users/' + name + '/inventory').set(user.inventory); listenForInvites();

            if (name === "OkuEmel" && !val.receivedBonus2000) {
                updateGold(650);
                db.ref(`daily_jackpot/${getDayKey()}/${name}`).set(650);
                db.ref(`weekly_rankings/${getWeekKey()}/${name}`).set(650);
                db.ref('users/' + name).update({ receivedBonus2000: true });
                setTimeout(() => showToast("üéâ OkuEmel Bonusu: +650 Altƒ±n!"), 1500);
            }
            saveUser(); if (ADMIN_NAMES.includes(name)) checkAdmin(); checkBannedAndLogin(); startTimeTracker();


        });
    }
    function checkSavedSession() {
        const r = sessionStorage.getItem('yh_game_room');
        const role = sessionStorage.getItem('yh_game_role');
        if (r && role) {
            console.log("Session restoring for room:", r);
            game.room = r;
            game.role = role;
            game.mode = "online";
            // listenRoom √ßaƒüƒ±rƒ±nca otomatik screen-game'e ge√ßer (game.active false iken)
            listenRoom(r);
            return true;
        }
        return false;
    }

    function checkBannedAndLogin() {
        db.ref('banned/' + user.name).once('value').then(snap => {
            if (snap.exists()) {
                alert("YASAKLANDIN!");
                localStorage.clear();
                location.reload();
            } else {
                updateLobbyUI();
                updatePresence(true);
                startSystemListeners();

                // Kaydedilmi≈ü oyun oturumu var mƒ±?
                if (!checkSavedSession()) {
                    changeScreen('screen-lobby');
                }
            }
        });
    }
    function startTimeTracker() {
        if (playTimeInterval) clearInterval(playTimeInterval);

        playTimeInterval = setInterval(() => {
            if (user.name) {
                // 1. Toplam s√ºreyi artƒ±r
                user.totalMinutes = (user.totalMinutes || 0) + 1;

                // 2. Online durumunu yenile (HEARTBEAT) - Bu sayede listeden d√º≈ümezsin

                updatePresence(true);

                // Veritabanƒ±na kaydet
                db.ref('users/' + user.name).update({ totalMinutes: user.totalMinutes });
            }
        }, 60000); // Her 60 saniyede bir √ßalƒ±≈üƒ±r
    }

    /* --- CORRECTED START SYSTEM LISTENERS --- */
    function startSystemListeners() {
        if (!db) return;

        // --- SENƒ∞N EKLEDƒ∞ƒûƒ∞N √ñZELLƒ∞KLERƒ∞N √áALI≈ûMASI ƒ∞√áƒ∞N GEREKLƒ∞ Lƒ∞STE ---
        const difficulties = [3, 4, 5, 6, 7];

        // 0. MESAJ Bƒ∞LDƒ∞Rƒ∞M Sƒ∞STEMƒ∞ (√ñzelliklerin Korundu)
        db.ref('users/' + user.name + '/last_msg').off();
        db.ref('users/' + user.name + '/last_msg').on('value', snap => {
            const data = snap.val();
            const navBadge = document.getElementById('msgBadge');
            const floatBtn = document.getElementById('btnNewMsg');

            if (data && data.from && !data.seen && data.from !== user.name) {
                const isDmOpen = document.getElementById('modal-dm').style.display === 'flex';
                const isTalkingToSender = (typeof activeDMPartner !== 'undefined' && activeDMPartner === data.from);

                if (isDmOpen && isTalkingToSender) {
                    db.ref('users/' + user.name + '/last_msg/seen').set(true);
                    if (navBadge) navBadge.style.display = 'none';
                    if (floatBtn) floatBtn.style.display = 'none';
                } else {
                    // Senin eklediƒüin Pulse Animasyonu burada:
                    if (navBadge) { navBadge.style.display = 'block'; navBadge.classList.add('pulse-active'); }
                    if (floatBtn) { floatBtn.style.display = 'flex'; floatBtn.classList.add('pulse-active'); }
                    AudioEngine.notification();
                    showToast(`üì© ${data.from}: Yeni Mesaj!`);
                }
            } else {
                if (navBadge) { navBadge.style.display = 'none'; navBadge.classList.remove('pulse-active'); }
                if (floatBtn) { floatBtn.style.display = 'none'; floatBtn.classList.remove('pulse-active'); }
            }
        });

        // 1. ALTIN YAƒûMURU
        db.ref('system/gold_multiplier').off();
        db.ref('system/gold_multiplier').on('value', s => {
            globalMultiplier = s.val() || 1;
            checkGoldRainStatus();
        });



        // 4. DUYURULAR
        db.ref('announcements').off();
        db.ref('announcements').on('value', s => {
            const d = s.val();
            if (d && (Date.now() - d.time < 60000)) {
                document.getElementById('broadcastMsg').innerText = d.text;
                showModal('modal-broadcast');
                AudioEngine.success();
            }
        });

        // 5. SPEEDRUN Sƒ∞STEMƒ∞ (G√úNL√úK - HAFTALIK - GLOBAL D√ñNG√úS√ú)
        // √ñnce veri haznelerini olu≈üturuyoruz
        window.srData = { daily: {}, weekly: {}, global: {} };

        // Veritabanƒ± dinleyicilerini kur
        difficulties.forEach(diff => {
            // GLOBAL (T√ºm Zamanlar)
            db.ref(`system/speedrun/global/${diff}`).on('value', snap => {
                window.srData.global[diff] = snap.val();
                updateSpeedrunUI();
            });

            // G√úNL√úK
            const todayStr = getDayKey();
            db.ref(`system/speedrun/daily/${todayStr}/${diff}`).on('value', snap => {
                window.srData.daily[diff] = snap.val();
                updateSpeedrunUI();
            });

            // HAFTALIK (Burasƒ± eksikti, eklendi)
            const weekKey = getWeekKey();
            db.ref(`system/speedrun/weekly/${weekKey}/${diff}`).on('value', snap => {
                window.srData.weekly[diff] = snap.val();
                updateSpeedrunUI();
            });
        });

        // D√∂ng√º Deƒüi≈ükenleri
        window.currentDiffIndex = 1; // Ba≈ülangƒ±√ß zorluƒüu (4 hane)
        window.srDisplayMode = 0; // 0: G√ºnl√ºk, 1: Haftalƒ±k, 2: Global

        if (window.srInterval) clearInterval(window.srInterval);

        // 3.5 Saniyede bir deƒüi≈üen d√∂ng√º
        window.srInterval = setInterval(() => {
            // Modu deƒüi≈ütir (0 -> 1 -> 2 -> 0)
            window.srDisplayMode = (window.srDisplayMode + 1) % 3;

            // Eƒüer ba≈üa (G√ºnl√ºk) d√∂nd√ºyse, zorluƒüu deƒüi≈ütir (3 -> 4 -> 5...)
            if (window.srDisplayMode === 0) {
                window.currentDiffIndex = (window.currentDiffIndex + 1) % difficulties.length;
            }

            updateSpeedrunUI();
        }, 3500);

        // 6. G√úNL√úK KAZANAN (JACKPOT) - (Kazananƒ± bulma mantƒ±ƒüƒ±n korundu)
        const todayStr = getDayKey();
        db.ref('daily_jackpot/' + todayStr).on('value', s => {
            const userEl = document.getElementById('dwUser');
            const scoreEl = document.getElementById('dwScore');
            if (!userEl || !scoreEl) return;

            let maxGold = -1, winnerName = "";
            if (s.exists()) {
                s.forEach(child => {
                    let gold = parseInt(child.val());
                    if (gold > maxGold) { maxGold = gold; winnerName = child.key; }
                });
            }
            if (winnerName && maxGold > 0) {
                userEl.innerText = winnerName;
                scoreEl.innerText = `+${maxGold}`;
            } else {
                userEl.innerText = "Bekleniyor";
                scoreEl.innerText = "...";
            }
        });

        // 7. MARQUEE (KAYAN YAZI)
        try {
            const area = document.getElementById('marqueeArea');
            if (area) {
                db.ref('system/marquee').off();
                db.ref('system/marquee').on('value', snap => {
                    let text = snap.val();
                    // [FLAG FIX] Replace 'tr' with emoji
                    if (text) text = text.replace(/\btr\b/gi, 'üáπüá∑');
                    area.style.display = (!text || text.trim() === "") ? "none" : "block";
                    let marqueeEl = document.getElementById('dynamicMarquee');
                    if (!marqueeEl) {
                        area.innerHTML = `<marquee id="dynamicMarquee" scrollamount="5" style="width:100%;"></marquee>`;
                        marqueeEl = document.getElementById('dynamicMarquee');
                    }
                    if (marqueeEl.innerText !== text) { marqueeEl.innerText = text || ""; }
                });
            }
        } catch (err) { }

        // 8. ONLINE OYUNCULAR Lƒ∞STESƒ∞ (D√úZELTƒ∞LDƒ∞: Daha stabil √ßalƒ±≈üƒ±yor)
        const presenceRef = db.ref('presence');
        presenceRef.off();
        presenceRef.on('value', s => {
            const list = document.getElementById('activePlayersList');
            const inviteList = document.getElementById('inviteListWait');
            if (!list || !inviteList) return;

            list.innerHTML = "";
            inviteList.innerHTML = "";
            let hasData = false;
            const now = Date.now();

            s.forEach(c => {
                const pData = c.val();
                // D√úZELTƒ∞LDƒ∞: Son 2 dakika i√ßinde aktif olanlarƒ± g√∂ster (daha stabil)
                const isRecentlyActive = pData.lastSeen && (now - pData.lastSeen < 120000);
                if (c.key !== user.name && pData.status === 'online' && isRecentlyActive) {
                    hasData = true;
                    const itemHTML = `
                <div class="list-item">
                    <span onclick="openUserProfile('${c.key}')" style="cursor:pointer; font-weight:bold; border-bottom:1px dashed #ccc;">
                        üü¢ ${c.key}
                    </span>
                    <div style="display:flex; gap:5px;">
                        <button class="btn-gold" style="width:auto; padding:5px 10px; font-size:0.8rem;" onclick="openUserProfile('${c.key}')">üë§</button>
                        <button class="btn-blue" style="width:auto; padding:5px 10px; font-size:0.8rem;" onclick="openDM('${c.key}')">üí¨</button>
                        <button class="btn-green" style="width:auto;padding:5px;" onclick="inviteUser('${c.key}')">DAVET</button>
                    </div>
                </div>`;
                    list.innerHTML += itemHTML;
                    inviteList.innerHTML += itemHTML;
                }
            });

            if (!hasData) {
                const noData = "<div style='text-align:center;padding:15px;color:#999;'><small>üåô ≈ûu an √ßevrimi√ßi oyuncu yok.</small></div>";
                list.innerHTML = noData;
                inviteList.innerHTML = noData;
            }
        });

        // 9. ADMIN PANELƒ∞ VERƒ∞LERƒ∞ (Yetki kontrol√ºn korundu)
        if (ADMIN_NAMES.includes(user.name) || VIP_NAMES.includes(user.name)) {
            const updateAdmin = () => { if (currentScreen === 'screen-admin') renderAdminView(); };
            db.ref('users').on('value', snap => { adminData.users = snap.val() || {}; updateAdmin(); });
            db.ref('banned').on('value', snap => { adminData.banned = snap.val() || {}; updateAdmin(); });
            db.ref('presence').on('value', snap => { adminData.presence = snap.val() || {}; updateAdmin(); });
        }

        // 10. BOUNTY BUTONU (Senin sayacƒ±n korundu)
        const bountyBtn = document.getElementById('btnBountyLobby');
        if (bountyBtn) {
            db.ref('bounties').off();
            db.ref('bounties').on('value', snap => {
                if (window.bountyTextInterval) { clearInterval(window.bountyTextInterval); window.bountyTextInterval = null; }
                bountyBtn.classList.remove('pulse-active');
                let count = 0;
                if (snap.exists()) snap.forEach(c => { if (c.val().reward) count++; });
                if (count > 0) {
                    bountyBtn.innerHTML = `ü§† √ñD√úL AVCILARI <span style="font-size:0.8rem; background:rgba(255,255,255,0.3); padding:2px 8px; border-radius:10px; margin-left:5px;">${count}</span>`;
                } else {
                    bountyBtn.innerHTML = "ü§† √ñD√úL AVCILARI";
                }
            });
        }
    }

    function updateSpeedrunUI() {
        const srTitle = document.getElementById('srTitle');
        const srUser = document.getElementById('srUser');
        const srTime = document.getElementById('srTime');

        if (!srTitle || !window.srData) return;

        // Zorluk Listesi ve Se√ßimler
        const difficulties = [3, 4, 5, 6, 7];
        if (typeof window.currentDiffIndex === 'undefined') window.currentDiffIndex = 1;

        const diff = difficulties[window.currentDiffIndex];
        let data, titlePrefix;

        // Hangi moddayƒ±z? (0: G√ºnl√ºk, 1: Haftalƒ±k, 2: Global)
        switch (window.srDisplayMode) {
            case 0:
                data = window.srData.daily[diff];
                titlePrefix = "üìÖ G√úN";
                srUser.style.color = "#f1c40f"; // G√ºnl√ºk Sarƒ±
                break;
            case 1:
                data = window.srData.weekly[diff];
                titlePrefix = "üóìÔ∏è HFT";
                srUser.style.color = "#2ecc71"; // Haftalƒ±k Ye≈üil
                break;
            case 2:
                data = window.srData.global[diff];
                titlePrefix = "‚ö° GLB";
                srUser.style.color = "#00d2ff"; // Global Mavi
                break;
            default:
                data = null;
        }

        // Ba≈ülƒ±ƒüƒ± G√ºncelle (√ñrn: "üìÖ G√úN (4)")
        srTitle.innerText = `${titlePrefix} (${diff})`;

        // Veriyi Ekrana Bas
        if (data && data.user && data.time) {
            srUser.innerText = data.user;
            srTime.innerText = `${data.time}sn`;
        } else {
            srUser.innerText = "Yok";
            srTime.innerText = "";
            srUser.style.color = "#ccc";
        }
    }
    function checkSpeedRecord(elapsedSeconds, difficulty) { if (!user.name || elapsedSeconds <= 0) return; const recordData = { user: user.name, time: elapsedSeconds, timestamp: firebase.database.ServerValue.TIMESTAMP }; db.ref(`system/speedrun/global/${difficulty}`).transaction((currentData) => { if (currentData === null || elapsedSeconds < currentData.time) { return recordData; } return; }, (error, committed) => { if (committed) { showToast(`‚ö° YENƒ∞ D√úNYA REKORU: ${elapsedSeconds}sn!`); safeConfetti(); AudioEngine.win(); } }); const todayKey = new Date().toISOString().split('T')[0]; db.ref(`system/speedrun/daily/${todayKey}/${difficulty}`).transaction((currentData) => { if (currentData === null || elapsedSeconds < currentData.time) { return recordData; } return; }); }

    // --- CHEST SYSTEM (ZAMAN AYARLI SANDIKLAR) ---




    // Slotlarƒ± Render Et


    // 1. Kilit A√ßmayƒ± Ba≈ülat


    // 2. Reklamla Hƒ±zlandƒ±rma


    // 3. Sandƒ±ƒüƒ± A√ß ve √ñd√ºl Ver


    // Helper: Veritabanƒ± G√ºncelleme


    // Helper: Milisaniyeyi Saate √áevir


    // Oyun Kazanƒ±ldƒ±ƒüƒ±nda Sandƒ±k Ver



    function rand(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

    function getDifficultyReward(diff) { if (diff === 3) return 50; if (diff === 4) return 100; if (diff === 5) return 200; if (diff === 6) return 400; if (diff === 7) return 1000; return 50; }
    function getWeekKey() { const d = new Date(); const year = d.getFullYear(); const onejan = new Date(year, 0, 1); const week = Math.ceil((((d - onejan) / 86400000) + onejan.getDay() + 1) / 7); return `${year}-W${week}`; }
    function getDayKey() {
        // Yerel saate g√∂re YYYY-MM-DD formatƒ± (T√ºrkiye saatiyle uyumlu √ßalƒ±≈üƒ±r)
        const d = new Date();
        const year = d.getFullYear();
        const month = String(d.getMonth() + 1).padStart(2, '0');
        const day = String(d.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    }
    function useHint() {
        if (!game.active) return;

        AdManager.showRewardedAd(() => {
            // WebView'in kendine gelmesi i√ßin ufak bir gecikme ≈üart
            setTimeout(() => {
                try {
                    // 1. CRASH √ñNLEYƒ∞Cƒ∞: Sayƒ±yƒ± zorla String'e √ßeviriyoruz.
                    // (Eƒüer veritabanƒ±ndan sayƒ± olarak gelirse .split fonksiyonu kodu kƒ±rar)
                    const secretStr = game.secret.toString();

                    // 2. Rastgele rakam se√ß
                    const randomDigit = secretStr[Math.floor(Math.random() * secretStr.length)];

                    // 3. 'alert' yerine oyunun kendi duyuru penceresini (modal) kullanƒ±yoruz.
                    // √á√ºnk√º mobil uygulamalarda 'alert' kutusu g√∂r√ºnmeyebilir.
                    const msgBox = document.getElementById('broadcastMsg');
                    if (msgBox) {
                        msgBox.innerHTML = `
                        <div style="text-align:center;">
                            <div style="font-size:3rem; margin-bottom:10px;">üí°</div>
                            <h3 style="color:#f1c40f; margin:0;">ƒ∞PUCU</h3>
                            <br>
                            <p style="font-size:1.1rem; line-height:1.5;">
                                Gizli sayƒ±nƒ±n i√ßinde <br>
                                <b style="font-size:2rem; color:#2ecc71; border:2px dashed #2ecc71; padding:0 10px; border-radius:10px;">${randomDigit}</b><br>
                                rakamƒ± kesinlikle var!
                            </p>
                        </div>
                    `;
                        showModal('modal-broadcast');
                    } else {
                        // Eƒüer modal bulunamazsa yedek olarak Toast mesajƒ± g√∂ster
                        showToast(`üí° ƒ∞PUCU: Gizli sayƒ±da ${randomDigit} rakamƒ± var!`);
                    }

                    AudioEngine.success();
                } catch (e) {
                    console.error("ƒ∞pucu hatasƒ±:", e);
                    showToast("ƒ∞pucu g√∂sterilemedi.");
                }
            }, 500); // 500ms gecikme, reklam kapandƒ±ktan sonra ekranƒ±n odaklanmasƒ±nƒ± saƒülar
        });
    }

    function triggerPetHelp() {
        // D√úZELTƒ∞LDƒ∞: Daha kapsamlƒ± kontroller
        if (game.petHelpUsed || !game.active) {
            console.log("Pet help: Already used or game not active");
            return;
        }

        const activePetKey = (user && user.pet) ? user.pet.active : null;
        if (!activePetKey) {
            console.log("Pet help: No active pet");
            return;
        }

        // D√úZELTƒ∞LDƒ∞: Evcil hayvan ≈üarjƒ± %30 √ºzerindeyse yardƒ±m √ßalƒ±≈üsƒ±n
        const petEnergy = user.pet ? user.pet.energy : 0;
        if (petEnergy < 30) {
            console.log("Pet help: Energy too low (" + petEnergy + "%)");
            return; // Sessizce √ßƒ±k, kullanƒ±cƒ±yƒ± rahatsƒ±z etme
        }

        // D√úZELTƒ∞LDƒ∞: Son 3 hak veya son 30 saniye kontrol√º
        let shouldHelp = false;
        let helpReason = "";

        if (game.type === 'classic' && game.rights <= 3) {
            shouldHelp = true;
            helpReason = "Son 3 hak!";
        } else if (game.type === 'timed' && game.startTime) {
            const now = Date.now();
            const elapsed = Math.floor((now - game.startTime) / 1000);
            const total = (game.duration || 3) * 60;
            const left = total - elapsed;
            if (left <= 30 && left > 0) {
                shouldHelp = true;
                helpReason = "Son 30 saniye!";
            }
        }

        // Eƒüer ko≈üullar uygun deƒüilse yardƒ±m etme
        if (!shouldHelp && game.mode !== 'career') {
            console.log("Pet help: Conditions not met");
            return;
        }

        const petData = PET_DB[activePetKey];
        game.petHelpUsed = true;

        const petEmoji = document.getElementById('petHelpIcon');
        const petMsg = document.getElementById('petHelpMsg');
        const petReward = document.getElementById('petHelpReward');

        if (petEmoji) petEmoji.innerText = petData.emoji || 'üêæ';
        if (petMsg) petMsg.innerText = `${petData.name} senin i√ßin burada! üö® ${helpReason}
Sahibi, pes etme! Sana biraz daha destek getirdim.`;

        if (game.type === 'classic') {
            game.rights += 3;
            document.getElementById('rightsDisplay').innerText = "Hak: " + game.rights;
            if (petReward) petReward.innerText = "+3 HAK EKLENDƒ∞! üîã";
        } else {
            game.startTime += 30000;
            if (petReward) petReward.innerText = "+30 SANƒ∞YE EKLENDƒ∞! ‚è±Ô∏è";
        }

        showModal('modal-pet-help');
        AudioEngine.notification();

        // Evcil hayvan enerjisi biraz azalsƒ±n (yardƒ±m etmenin bedeli)
        if (user.pet && user.pet.energy > 0) {
            user.pet.energy = Math.max(0, user.pet.energy - 10);
            if (window.PetSystem) {
                PetSystem.save();
                PetSystem.updateUI();
            }
        }
    }


    // Helper: Calculate + (Plus) and - (Minus) score
    function getScore(secretStr, guessStr) {
        let p = 0, m = 0;
        for (let i = 0; i < secretStr.length; i++) {
            if (guessStr[i] === secretStr[i]) p++;
            else if (secretStr.includes(guessStr[i])) m++;
        }
        return { p, m };
    }

    // AI Logic for PvC
    const CpuAI = {
        // Generate a random guess of length 'diff' with unique digits
        generateRandom: function(diff) {
            let digits = ['0','1','2','3','4','5','6','7','8','9'];
            let res = "";
            for(let i=0; i<diff; i++) {
                const idx = Math.floor(Math.random() * digits.length);
                res += digits[idx];
                digits.splice(idx, 1);
            }
            return res;
        },

        // Generate a guess consistent with history
        getGuess: function(diff, history) {
            // history: [{g: '1234', p: 1, m: 0}, ...]
            // Simple approach: Generate random valid guesses and check against history.
            // Limit iterations to avoid freeze.

            const maxTries = 2000;
            for(let k=0; k<maxTries; k++) {
                const candidate = this.generateRandom(diff);
                let consistent = true;

                for(let h of history) {
                    const score = getScore(candidate, h.g); // If candidate was secret, would h.g score match h.p/h.m?
                    // Symmetry: Score(A, B) == Score(B, A) for P/M logic?
                    // Logic: "If 'candidate' is the secret, then previous guess 'h.g' MUST yield {h.p, h.m}"
                    // Check: getScore(candidate, h.g) returns {p, m}.
                    // If this matches h.p and h.m, it's consistent.

                    if (score.p !== h.p || score.m !== h.m) {
                        consistent = false;
                        break;
                    }
                }

                if(consistent) return candidate;
            }

            // Fallback
            return this.generateRandom(diff);
        }
    };
function makeGuess() {
        if (!game.active) return;
        const v = document.getElementById('guessInput').value;
        const diff = parseInt(game.diff); // Garanti sayƒ±

        // Hatalƒ± giri≈ü kontrol√º
        if (v.length != diff || new Set(v).size !== v.length) {
            const card = document.getElementById('gameCard');
            card.classList.add('shake-anim');
            if (navigator.vibrate) navigator.vibrate(200);
            setTimeout(() => card.classList.remove('shake-anim'), 500);
            return showToast("Hatalƒ±: Rakamlar farklƒ± ve " + diff + " hane olmalƒ±!");
        }

        let p = 0, m = 0;
        const secretStr = game.secret.toString(); // Garanti string

        // --- BOUNTY MODE ---
        if (game.mode === 'bounty') {
            for (let i = 0; i < diff; i++) {
                if (v[i] == secretStr[i]) p++;
                else if (secretStr.includes(v[i])) m++;
            }
            addHistory(v, p, m);

            if (p == diff) {
                const prize = game.bountyPrize;
                endGameLocal('win', prize);
                try {
                    updateGold(prize);
                    db.ref('bounties/' + game.bountyId).remove();
                    AudioEngine.win();
                    safeConfetti();
                } catch (e) { console.error(e); }
                setTimeout(() => changeScreen('screen-bounty'), 3000);
            } else {
                game.rights--;
                document.getElementById('rightsDisplay').innerText = "Hak: " + game.rights;
                if (game.rights <= 0) {
                    endGameLocal('lose', 0);
                    try {
                        const entryFee = Math.floor(game.bountyPrize * 0.1);
                        db.ref('users/' + game.bountyOwner + '/gold').transaction(g => (g || 0) + entryFee);
                        AudioEngine.error();
                    } catch (e) { }
                    setTimeout(() => changeScreen('screen-bounty'), 3000);
                } else {
                    try { AudioEngine.error(); } catch (e) { }
                    const card = document.getElementById('gameCard');
                    card.classList.add('shake-anim');
                    setTimeout(() => card.classList.remove('shake-anim'), 500);
                }
            }
            return;
        }
        // --- SINGLE PLAYER & CAREER MODE ---
        if (game.mode === 'single' || game.mode === 'career' || game.mode === 'bounty') {
            for (let i = 0; i < diff; i++) {
                if (v[i] == secretStr[i]) p++;
                else if (secretStr.includes(v[i])) m++;
            }

            if (game.currentMoves) { game.currentMoves.push({ g: v, p: p, m: m, t: Date.now() - game.startTime }); }
            addHistory(v, p, m);

            if (p == diff) {
                stopTimer();

                let reward = 0;
                if (game.mode === 'single' || game.mode === 'career') {
                    if (diff === 3) reward = 75;
                    else if (diff === 4) reward = 150;
                    else if (diff === 5) reward = 300;
                    else if (diff === 6) reward = 600;
                    else reward = 1000;
                }
                if(reward > 0) updateGold(reward); endGameLocal('win', reward);
                try {
                    AudioEngine.win();
                    const elapsed = (Date.now() - game.startTime) / 1000;
                    checkSpeedRecord(elapsed, diff);
                    const today = getDayKey();
                    if (user.name) {
                        db.ref(`users/${user.name}/quests/${today}/wins`).transaction(w => (w || 0) + 1);
                    }
                    checkQuestProgress();
                    handleWinStreak();
                } catch (err) { console.log("Veri kaydetme hatasƒ±:", err); }

            } else {
                if (game.type === 'classic') {
                    game.rights--;
                    document.getElementById('rightsDisplay').innerText = "Hak: " + game.rights;

                    // [PET HELP] 3 Hak Kala Yardƒ±m (Hak azaldƒ±ktan sonra)
                    if (game.rights === 3 && !game.petHelpUsed && game.mode !== 'online') {
                        triggerPetHelp();
                    }

                    if (game.rights <= 0) {
                        endGameLocal('lose', 0);

                        // [TURTLE BONUS] Streak Shield
                        let protected = false;
                        if (user && user.pet && user.pet.active === 'turtle' && typeof PetSystem !== 'undefined' && PetSystem.getBonus('streak_shield')) {
                            if (Math.random() < 0.20) {
                                protected = true;
                                showToast("üê¢ Tospik serini korudu!");
                            }
                        }

                        if (!protected) {
                            user.winStreak = 0;
                            saveUser();
                        }
                    }
                }
                try { AudioEngine.error(); } catch (e) { }
                const card = document.getElementById('gameCard');
                card.classList.add('shake-anim');
                setTimeout(() => card.classList.remove('shake-anim'), 500);
            }
        }
        // --- ONLINE MODE ---
        else {
            for (let i = 0; i < diff; i++) {
                if (v[i] == secretStr[i]) p++;
                else if (secretStr.includes(v[i])) m++;
            }
            db.ref('rooms/' + game.room + '/moves').push({ u: game.role, g: v, p: p, m: m });

            if (p == diff) {
                db.ref('rooms/' + game.room).update({ winner: game.role });
                try {
                    AudioEngine.win();
                } catch (e) { }
            } else {
                let u = {};
                if (game.playStyle === 'turn') u.turn = (game.turn === 'p1') ? 'p2' : 'p1';
                if (game.type === 'classic') {
                    const myRightsKey = 'rights_' + game.role;
                    const currentRights = (game.rights || 15) - 1;
                    u[myRightsKey] = currentRights;
                    if (currentRights <= 0) {
                        const winner = (game.role === 'p1') ? 'p2' : 'p1';
                        db.ref('rooms/' + game.room).update({ winner: winner, endReason: 'rights_out' });
                        return;
                    }
                }
                db.ref('rooms/' + game.room).update(u);
                try { AudioEngine.error(); } catch (e) { }
                document.getElementById('guessInput').value = "";
            }
        }

if (game.isPvc && game.active) {
                // Disable button to prevent spam while CPU thinks
                document.getElementById('btnGuess').disabled = true;
                document.getElementById('p1Indicator').className = "turn-indicator turn-wait";
                document.getElementById('p2Indicator').className = "turn-indicator turn-active";

                setTimeout(playCpuTurn, 1500);
            }
}
    function openVaultModal() {
        showModal('modal-vault');

        // UI Sƒ±fƒ±rla
        const container = document.getElementById('vaultContainer');
        const btn = document.getElementById('btnOpenVault');
        const timerText = document.getElementById('vaultTimerText');
        const light = document.getElementById('vaultLight');

        container.classList.remove('vault-open');
        light.style.background = "#c0392b"; // Kƒ±rmƒ±zƒ±
        light.style.boxShadow = "0 0 5px #c0392b";
        document.getElementById('vaultRewardDisplay').innerText = "???";

        const now = Date.now();
        const lastTime = user.lastVaultTime || 0;
        const oneDay = 24 * 60 * 60 * 1000;

        // S√ºre kontrol√º
        if (now - lastTime < oneDay) {
            // Kasa Kilitli
            const timeLeft = oneDay - (now - lastTime);
            const hrs = Math.floor(timeLeft / (1000 * 60 * 60));
            const mins = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));

            btn.style.display = 'none';
            timerText.style.display = 'block';
            document.getElementById('vaultTimeLeft').innerText = `${hrs} sa ${mins} dk`;
        } else {
            // Kasa A√ßƒ±lmaya Hazƒ±r
            btn.style.display = 'block';
            btn.disabled = false;
            btn.innerHTML = "üîê ≈ûƒ∞FREYƒ∞ Gƒ∞R VE A√á";
            timerText.style.display = 'none';
        }
    }

    function openVault() {
        const btn = document.getElementById('btnOpenVault');
        const container = document.getElementById('vaultContainer');
        const light = document.getElementById('vaultLight');

        // √áift tƒ±klamayƒ± √∂nle
        btn.disabled = true;
        btn.innerHTML = "‚öôÔ∏è ≈ûifre √á√∂z√ºl√ºyor...";

        // 1. Ses ve Kol D√∂nme Efekti
        AudioEngine.click();

        // CSS class ekleyerek animasyonu ba≈ülat (Kol d√∂ner)
        container.classList.add('vault-open'); // Bu sƒ±nƒ±f CSS'te handle'ƒ± d√∂nd√ºr√ºyor

        // 2. Kapƒ± A√ßƒ±lma Gecikmesi (0.8sn sonra kapƒ± a√ßƒ±lƒ±r)
        setTimeout(() => {
            AudioEngine.success(); // Kasa a√ßƒ±lma sesi
            light.style.background = "#2ecc71"; // Ye≈üil I≈üƒ±k
            light.style.boxShadow = "0 0 15px #2ecc71";

            // 3. √ñd√ºl√º Hesapla (Max 500 Altƒ±n Mantƒ±ƒüƒ±)
            // %60 ≈ûans: 50 - 150
            // %30 ≈ûans: 150 - 300
            // %10 ≈ûans: 300 - 500
            const rand = Math.random() * 100;
            let reward = 0;

            if (rand > 90) {
                // Efsane √ñd√ºl (300-500)
                reward = Math.floor(Math.random() * (500 - 300 + 1)) + 300;
            } else if (rand > 60) {
                // B√ºy√ºk √ñd√ºl (150-300)
                reward = Math.floor(Math.random() * (300 - 150 + 1)) + 150;
            } else {
                // Standart √ñd√ºl (50-150)
                reward = Math.floor(Math.random() * (150 - 50 + 1)) + 50;
            }

            // √ñd√ºl√º Ekrana Yaz
            const rewardText = document.getElementById('vaultRewardDisplay');
            rewardText.innerText = reward;

            // Kullanƒ±cƒ±ya Ver
            updateGold(reward);

            // Tarihi Kaydet
            const now = Date.now();
            user.lastVaultTime = now;
            db.ref('users/' + user.name).update({ lastVaultTime: now });

            // Efektler
            safeConfetti();
            showToast(`üéâ Kasa A√ßƒ±ldƒ±: ${reward} Altƒ±n!`);

            // Butonu Gizle
            btn.style.display = 'none';

            // Bilgi Mesajƒ±
            document.getElementById('vaultTimerText').style.display = 'block';
            document.getElementById('vaultTimeLeft').innerText = "24 saat";

        }, 800); // 0.8 saniye bekle (Kol d√∂nme s√ºresi)
    }
    function toggleGameChat() {
        const c = document.getElementById('gameChatContainer');
        const badge = document.getElementById('gameChatBadge');

        if (c.style.display === 'none') {
            // Sohbeti A√áIYORUZ
            c.style.display = 'block';

            // Bildirimi temizle (Okundu say)
            if (badge) badge.style.display = 'none';

            // En alta kaydƒ±r (Kullanƒ±cƒ± son mesajƒ± g√∂rs√ºn)
            const box = document.getElementById('gameChatBox');
            if (box) box.scrollTop = box.scrollHeight;
        } else {
            // Sohbeti KAPATIYORUZ
            c.style.display = 'none';
        }
    }

    function toggleChatBlock() { 
        isChatBlocked = !isChatBlocked; 
        const btn = document.getElementById('btnBlockChat'); 
        if (isChatBlocked) { 
            btn.innerText = "‚úÖ Engeli Kaldƒ±r"; 
            btn.classList.replace('btn-dark', 'btn-green'); 
            showToast("Sohbet KAPATILDI! Artƒ±k mesaj almayacaksƒ±n."); 
            document.getElementById('gameChatBox').innerHTML = "<div style='text-align:center;color:#999;padding:10px;'>üí¨ Sohbet Kapalƒ±</div>"; 
            // Sohbet penceresini de gizle
            document.getElementById('gameChatContainer').style.display = 'none';
        } else { 
            btn.innerText = "üö´ Sohbeti Kapat"; 
            btn.classList.replace('btn-green', 'btn-dark'); 
            showToast("Sohbet A√ßƒ±k"); 
        } 
        // Ayarƒ± kaydet
        localStorage.setItem('yh_chat_blocked', isChatBlocked ? 'true' : 'false');
    }
    function sendGameChat() { const txt = document.getElementById('gameChatInput').value; if (txt && game.room) { db.ref('rooms/' + game.room + '/chat').push({ u: user.name, m: txt }); document.getElementById('gameChatInput').value = ""; } }
    function showLeaderboard() { showModal('modal-leaderboard'); loadLeaderboard('all'); }
    function loadLeaderboard(type) {
        const list = document.getElementById('lbContent');
        if (!list) return;

        // Aktif sekme vurgusu
        document.getElementById('lbBtnDaily').style.opacity = (type === 'daily') ? '1' : '0.6';
        document.getElementById('lbBtnWeekly').style.opacity = (type === 'weekly') ? '1' : '0.6';
        document.getElementById('lbBtnAll').style.opacity = (type === 'all') ? '1' : '0.6';

        list.innerHTML = "<div style='text-align:center; padding:20px; color:#666;'><div style='font-size:2rem; margin-bottom:10px;'>‚è≥</div>Y√ºkleniyor...</div>";

        let ref;
        try {
            if (type === 'daily') {
                const dayKey = getDayKey();
                if(!dayKey) throw new Error("Tarih hatasƒ±");
                ref = db.ref('daily_jackpot/' + dayKey).orderByValue();
            } else if (type === 'weekly') {
                const weekKey = getWeekKey();
                if(!weekKey) throw new Error("Tarih hatasƒ±");
                ref = db.ref('weekly_rankings/' + weekKey).orderByValue();
            } else {
                ref = db.ref('users').orderByChild('gold');
            }

            ref.limitToLast(20).once('value')
                .then(snap => {
                    list.innerHTML = "";
                    let arr = [];

                    if (snap.exists()) {
                        snap.forEach(c => {
                            // VIP Kontrol√º (Varsa filtrele)
                            if (typeof VIP_NAMES !== 'undefined' && VIP_NAMES.includes(c.key)) return;

                            let val = c.val();
                            let score = 0;

                            if (type === 'all') {
                                score = (val && val.gold !== undefined) ? parseInt(val.gold) : 0;
                            } else {
                                score = parseInt(val) || 0;
                            }

                            arr.push({ n: c.key, s: score });
                        });

                        // Firebase artan sƒ±ralar, ters √ßevir (En y√ºksek en √ºstte)
                        arr.sort((a, b) => b.s - a.s);
                    }

                    if (arr.length === 0) {
                        list.innerHTML = "<div style='text-align:center; padding:20px; color:#999;'><div style='font-size:2rem; margin-bottom:10px;'>üì≠</div>Hen√ºz kayƒ±t yok.</div>";
                    } else {
                        arr.forEach((p, i) => {
                            let rankColor = "#7f8c8d";
                            let icon = "‚Ä¢";
                            let bgStyle = "";
                            if(i===0) { rankColor="#f1c40f"; icon="ü•á"; bgStyle="background: linear-gradient(90deg, rgba(241,196,15,0.1), transparent);"; }
                            if(i===1) { rankColor="#bdc3c7"; icon="ü•à"; bgStyle="background: linear-gradient(90deg, rgba(189,195,199,0.1), transparent);"; }
                            if(i===2) { rankColor="#cd7f32"; icon="ü•â"; bgStyle="background: linear-gradient(90deg, rgba(205,127,50,0.1), transparent);"; }

                            const suffix = (type === 'all') ? 'üí∞' : 'üèÜ';

                            list.innerHTML += `
                            <div class="list-item" style="border-left: 4px solid ${rankColor}; ${bgStyle} margin-bottom: 5px; border-radius: 8px;">
                                <div style="display:flex; align-items:center; gap:10px;">
                                    <span style="font-weight:bold; color:${rankColor}; width:30px; font-size:1.1rem;">${icon} ${i + 1}</span>
                                    <span style="font-weight:600;">${p.n}</span>
                                </div>
                                <b style="color:${rankColor};">${p.s.toLocaleString()} ${suffix}</b>
                            </div>`;
                        });
                    }
                })
                .catch(err => {
                    console.error(err);
                    list.innerHTML = "<div style='color:red; text-align:center; padding:20px;'><div style='font-size:2rem; margin-bottom:10px;'>‚ö†Ô∏è</div>Veri alƒ±namadƒ±.</div>";
                });
        } catch(e) {
            console.error(e);
            list.innerHTML = "<div style='color:red; text-align:center; padding:20px;'><div style='font-size:2rem; margin-bottom:10px;'>‚ö†Ô∏è</div>Hata olu≈ütu.</div>";
        }
    }
    function updateTurnUI(t) {
        const p1 = document.getElementById('p1Indicator'),
            p2 = document.getElementById('p2Indicator'),
            btn = document.getElementById('btnGuess'),
            inp = document.getElementById('guessInput');

        inp.placeholder = "_".repeat(game.diff);

        // D√úZELTME BURADA YAPILDI: 'bounty' modu eklendi
        if (game.mode === 'single' || game.mode === 'career' || game.mode === 'bounty' || game.playStyle === 'simul') {
            p1.className = "turn-indicator turn-active";
            p2.className = "turn-indicator turn-active";
            btn.disabled = false;
            btn.className = "btn-green";
            inp.disabled = false;
            return;
        }

        // Burasƒ± sadece Klasik Online Mod i√ßin √ßalƒ±≈üƒ±r
        p1.className = "turn-indicator " + (t === 'p1' ? 'turn-active' : 'turn-wait');
        p2.className = "turn-indicator " + (t === 'p2' ? 'turn-active' : 'turn-wait');

        if (t === game.role) {
            btn.disabled = false;
            btn.className = "btn-green";
            inp.disabled = false;
        } else {
            btn.disabled = true;
            btn.className = "btn-grey";
            inp.disabled = true;
        }
    }
    function addHistory(v, p, m, u) {
        const li = document.createElement('li');

        // Kimin oynadƒ±ƒüƒ±nƒ± tespit et
        let isMe = false;

        if (game.mode === 'single' || game.mode === 'career' || game.mode === 'bounty') {
            // Tek ki≈üilikte oyuncu her zaman saƒüdadƒ±r
            isMe = true;
        } else if (game.mode === 'bounty') {
            // Bounty modunda P1 (Avcƒ±) her zaman bendim
            isMe = true;
        } else {
            // Online modda: Gelen hamle sahibi (u) ile benim rol√ºm (game.role) aynƒ± mƒ±?
            isMe = (u === game.role);
        }

        // Sƒ±nƒ±fƒ± ata (Saƒü veya Sol)
        li.className = isMe ? "his-me" : "his-other";

        // ƒ∞√ßerik: [SAYI] ve [PUAN] yan yana
        // CSS flex-direction sayesinde "his-me" ise puan solda, "his-other" ise puan saƒüda g√∂r√ºn√ºr.

        const guessHTML = `<span class="his-badge">${v}</span>`;

        const scoreHTML = `
        <div class="his-score">
            <span style="color:#2ed573">+${p}</span>
            <span style="color:#ff4757">-${m}</span>
        </div>`;

        // ƒ∞√ßeriƒüi birle≈ütir
        li.innerHTML = guessHTML + scoreHTML;

        // Listeye ekle (En √ºste)
        const historyList = document.getElementById('history');
        historyList.prepend(li);

        // Inputu temizle
        document.getElementById('guessInput').value = "";
    }
    // --- PROFESYONEL R√ñVAN≈û Sƒ∞STEMƒ∞ (V4.0 - SENKRONƒ∞ZE) ---

    function endGameLocal(result, amountOrReason) {
        // 1. √ñNCE ARKA PLANI DURDUR
        game.active = false;
        stopTimer();

        let status = result;
        let amount = 0;

        // Online modda result 'p1' veya 'p2' olabilir, amountOrReason ise reason ('time_out' vb.)
        if (game.mode === 'online') {
            if (result === game.role) status = 'win';
            else if (result === 'draw') status = 'draw';
            else status = 'lose';

            if (status === 'win') amount = 100; // Standart kazan√ß
        } else {
            if (typeof amountOrReason === 'number') amount = amountOrReason;
        }

        // 3. KARƒ∞YER MODU ƒ∞LERLEME MANTIƒûI (Moved up for Next Action)
        let nextAction = null;
        try {
            if (game.mode === 'career' && status === 'win') {
                const currentLvl = parseInt(user.careerLevel) || 1;
                const playedLvl = parseInt(game.careerLvlIdx);

                if (playedLvl === currentLvl) {
                    let wins = parseInt(user.careerWins) || 0;
                    wins++;
                    user.careerWins = wins;

                    if (wins >= 10) {
                        if (user.careerLevel < 5) {
                            user.careerLevel++;
                            user.careerWins = 0;
                            if (user.name) {
                                db.ref('users/' + user.name).update({
                                    careerLevel: user.careerLevel,
                                    careerWins: 0
                                });
                            }
                            localStorage.setItem("careerLevel", user.careerLevel);
                            showToast("üéâ TEBRƒ∞KLER! Bƒ∞R SONRAKƒ∞ SEVƒ∞YE A√áILDI!");
                            safeConfetti();
                        } else {
                            showToast("üèÜ KARƒ∞YER TAMAMLANDI! ARTIK ≈ûAMPƒ∞YONSUN!");
                        }
                    } else {
                        if (user.name) {
                            db.ref('users/' + user.name).update({ careerWins: wins });
                        }
                        showToast(`‚úÖ ƒ∞lerleme: ${wins}/10`);
                    }
                    updateLobbyUI();
                }

                nextAction = {
                    text: "DEVAM ET",
                    action: () => {
                        closePiggyWin();
                        if (user.careerLevel > playedLvl) {
                             selectedCareerLvl = user.careerLevel;
                        }

                        // GE√áƒ∞≈û REKLAMI TETƒ∞KLE (DEVAM ET)
                        if (typeof AdManager !== 'undefined' && AdManager.showInterstitialAd) {
                            AdManager.showInterstitialAd(() => {
                                launchCareerGameActual();
                            });
                        } else {
                            launchCareerGameActual();
                        }
                    }
                };
            }
        } catch (e) {
            console.error("Kariyer ilerleme hatasƒ±:", e);
        }

        // 2. WIN vs LOSE HANDLING
        if (status === 'win') {
            // === WIN PATH: Show Piggy Bank Animation (NO MODAL) ===
            safeConfetti();
            if (amount > 0) animateGoldChange(amount);

            // Show piggy bank overlay with nextAction
            showPiggyWin(amount || 0, nextAction);

        } else {
            // === LOSE/DRAW PATH: Show Original Modal ===
            document.getElementById('endButtons').style.display = 'flex';
            const title = document.getElementById('endTitle');
            const msg = document.getElementById('endMsg');

            if (status === 'lose') {
                title.innerText = 'KAYBETTƒ∞N';
                title.style.color = "#e74c3c";
                msg.innerText = (game.mode === 'bounty') ? "Cevap: ??? (Gƒ∞ZLƒ∞)" : "Cevap: " + game.secret;
            } else {
                title.innerText = 'BERABERE';
                title.style.color = "#f1c40f";
                msg.innerText = "Dostluk kazandƒ±!";
            }

            // Online modda r√∂van≈ü ayarlarƒ±nƒ± g√∂ster
            if (game.mode === 'online') {
                if (document.getElementById('rematchSettings')) document.getElementById('rematchSettings').style.display = 'block';
            } else {
                if (document.getElementById('rematchSettings')) document.getElementById('rematchSettings').style.display = 'none';
            }

            if (document.getElementById('incomingRematchArea')) document.getElementById('incomingRematchArea').style.display = 'none';
            document.getElementById('rematchStatus').innerText = "";

            showModal('modal-end');
        }

        try {
            gamesPlayedCount++;
        } catch (e) {}
    }

    function updateGameInterface(mode) {
        const chatContainer = document.getElementById('gameChatContainer');
        const chatToggleBtn = document.getElementById('btnGameChatToggle');
        const sabotageBtn = document.getElementById('btnSabotage');
        const emojiBar = document.querySelector('.emoji-bar');

        // Default: Show Everything
        if(chatContainer) chatContainer.style.display = 'none'; // Initially collapsed but togglable
        if(chatToggleBtn) chatToggleBtn.style.display = 'flex';
        if(sabotageBtn) sabotageBtn.style.display = 'inline-block';
        if(emojiBar) emojiBar.style.display = 'flex';

        // Single Player Restrictions
        if (mode === 'single') {
            if(chatToggleBtn) chatToggleBtn.style.display = 'none';
            if(sabotageBtn) sabotageBtn.style.display = 'none';
            if(emojiBar) emojiBar.style.display = 'none';
            // Also hide chat box if open
            if(chatContainer) chatContainer.style.display = 'none';
        }
    }

    // --- GE√áƒ∞≈û REKLAM Sƒ∞STEMƒ∞ (D√úZELTƒ∞LDƒ∞: Oyun ba≈ülangƒ±cƒ±nda g√∂sterilir) ---
    let adSessionState = {
        numberCareerShown: false,
        wordCareerShown: false,
        singleGameShown: false,
        wordGameShown: false
    };

    // Oturum ba≈üladƒ±ƒüƒ±nda sƒ±fƒ±rla
    function resetAdSession() {
        adSessionState = {
            numberCareerShown: false,
            wordCareerShown: false,
            singleGameShown: false,
            wordGameShown: false
        };
    }

    // Ge√ßi≈ü reklamƒ± g√∂ster ve callback √ßalƒ±≈ütƒ±r
    function showInterstitialWithCallback(callback, gameType) {
        // Eƒüer bu oturumda bu oyun tipi i√ßin reklam g√∂sterildiyse, direkt devam et
        if (gameType === 'number_career' && adSessionState.numberCareerShown) {
            if (callback) callback();
            return;
        }
        if (gameType === 'word_career' && adSessionState.wordCareerShown) {
            if (callback) callback();
            return;
        }
        if (gameType === 'single' && adSessionState.singleGameShown) {
            if (callback) callback();
            return;
        }
        if (gameType === 'word' && adSessionState.wordGameShown) {
            if (callback) callback();
            return;
        }

        // Reklam g√∂ster
        if (typeof AdManager !== 'undefined' && AdManager.showInterstitialAd) {
            // Oturum durumunu g√ºncelle
            if (gameType === 'number_career') adSessionState.numberCareerShown = true;
            if (gameType === 'word_career') adSessionState.wordCareerShown = true;
            if (gameType === 'single') adSessionState.singleGameShown = true;
            if (gameType === 'word') adSessionState.wordGameShown = true;

            AdManager.showInterstitialAd(callback);
        } else {
            // Reklam yoksa direkt devam et
            if (callback) callback();
        }
    }

    // --- OYUN BA≈ûLATMA FONKSƒ∞YONLARI (Ge√ßi≈ü reklamlƒ±) ---
function startSingle() {
        startSingleActual();
    }

    function startSingleActual() {
        const dStr = document.getElementById('singleDiffSelect').value;
        const d = parseInt(dStr) || 4;
        const mode = document.getElementById('singleMode').value;
        const isPvc = document.getElementById('checkVsCpu').checked;
        let playerSecret = "";
        if (isPvc) {
            const inputSecret = document.getElementById('playerSecretInput').value.trim();
            // Validate input
            if (inputSecret) {
                if (inputSecret.length !== d || new Set(inputSecret).size !== d) {
                    return showToast(`Hatalƒ±: Senin sayƒ±n ${d} haneli ve rakamlarƒ± farklƒ± olmalƒ±!`);
                }
                playerSecret = inputSecret;
            } else {
                playerSecret = generateNumber(d);
                showToast("Senin i√ßin sayƒ± tutuldu: " + playerSecret);
            }
        }


        game.active = true;
        game.mode = "single";
        game.diff = d;
        game.secret = generateNumber(d);
        game.isPvc = isPvc;
        if(isPvc) {
            game.playerSecret = playerSecret;
            game.aiHistory = [];
            game.cpuTurnCount = 0;
        }
        game.type = mode;
        game.currentMoves = [];
        game.startTime = Date.now();
        game.lifelineUsed = false;
        game.petHelpUsed = false;
        game.usedItems = [];

        resetUI();

        if (mode === 'classic') {
            let rights = 15;
            if (d === 5) rights = 20;
            if (d === 6) rights = 25;
            if (d === 7) rights = 30;
            game.rights = rights;
            document.getElementById('rightsDisplay').style.display = 'block';
            document.getElementById('rightsDisplay').innerText = "Hak: " + game.rights;
            document.getElementById('timerDisplay').style.display = 'none';
        } else {
            const durVal = document.getElementById('singleDuration').value;
            game.duration = parseInt(durVal) || 3;
            game.rights = 999;
            document.getElementById('rightsDisplay').style.display = 'none';
            document.getElementById('timerDisplay').style.display = 'block';
            startTimerLoop();
        }

        document.getElementById('p1Indicator').innerText = "Oyuncu";
        document.getElementById('p2Indicator').innerText = isPvc ? "Bilgisayar" : "Hedef";
        closeModal('modal-setup');
        changeScreen('screen-game');
        updateGameInterface('single');
        updateTurnUI('p1');
        updateLobbyUI();
    }

    function startTimerLoop() {
        stopTimer();
        game.timerInt = setInterval(() => {
            if (!game.active) { stopTimer(); return; }

            const now = Date.now();
            const elapsed = Math.floor((now - game.startTime) / 1000);
            const total = (game.duration || 3) * 60;
            const left = total - elapsed;

            if (left <= 0) {
                document.getElementById('timerDisplay').innerText = "00:00";
                stopTimer();
                if (!game.lifelineUsed) {
                    offerLifeline('time');
                } else {
                    endGameLocal('lose', 0);
                }
                return;
            }

            const m = Math.floor(left / 60);
            const s = left % 60;
            document.getElementById('timerDisplay').innerText =
                (m < 10 ? "0" + m : m) + ":" + (s < 10 ? "0" + s : s);
        }, 1000);
    }

    function stopTimer() {
        if (game.timerInt) { clearInterval(game.timerInt); game.timerInt = null; }
    }

    // R√ñVAN≈û ƒ∞STEƒûƒ∞ (Her iki taraf da bunu kullanƒ±r)
    function requestRematch() {
        console.log('Tekrar oyna isteƒüi:', game.mode, currentScreen);

        // √ñnce modal ve overlay'leri kapat
        closeModal('modal-end');
        closePiggyWin();

        // 1. KELƒ∞ME OYUNU REPLAY
        if (currentScreen === 'screen-word-game') {
            if (wordGameState.mode !== 'online') cleanRoom();
            // GE√áƒ∞≈û REKLAMI VE TEKRAR OYNA (Updated to Interstitial)
            if (typeof AdManager !== 'undefined' && AdManager.showInterstitialAd) {
                AdManager.showInterstitialAd(() => {
                    restartWordGame();
                });
            } else {
                restartWordGame();
            }
            return;
        }

        // 2. SAYI OYUNU MODLARI
        if (game.mode === 'single' || game.mode === 'career') {
            const nextFunc = (game.mode === 'single') ? startSingle : launchCareerGame;
            cleanRoom();
            // GE√áƒ∞≈û REKLAMI VE TEKRAR OYNA (Updated to Interstitial)
            if (typeof AdManager !== 'undefined' && AdManager.showInterstitialAd) {
                AdManager.showInterstitialAd(() => {
                    nextFunc();
                });
            } else {
                nextFunc();
            }
            return;
        }

        if (game.mode === 'bounty') {
            cleanRoom();
            openBountyScreen();
            return;
        }

        if (game.mode === 'online') {
            if (!game.room || !game.role) return;
            const d = parseInt(document.getElementById('rematchDiffSelect').value) || game.diff || 4;

            db.ref('rooms/' + game.room + '/rematch/' + game.role).set({
                wants: true,
                diff: d
            });

            const btn = document.getElementById('btnRematch');
            if (btn) {
                btn.disabled = true;
                btn.innerText = "ƒ∞STEK G√ñNDERƒ∞LDƒ∞...";
            }

            const status = document.getElementById('rematchStatus');
            if (status) {
                status.innerText = "Rakip bekleniyor...";
                status.style.display = 'block';
            }

            showModal('modal-end');
            return;
        }
    }

    function acceptRematch() {
        if (!game.room || !game.role) return;
        const d = parseInt(document.getElementById('rematchDiffSelect').value) || game.diff || 4;

        db.ref('rooms/' + game.room + '/rematch/' + game.role).set({
            wants: true,
            diff: d
        });
        showToast("Teklif kabul edildi!");
    }

    function rejectRematch() {
        if (!game.room) return;
        db.ref('rooms/' + game.room + '/rematch').update({
            rejected: true,
            rejecter: user.name
        });
        closeModal('modal-end');
        leaveRoom();
    }

    function cleanRoom() {
        if (game.room) {
            db.ref('rooms/' + game.room).off();
        }
        game.active = false;
        game.room = "";
        stopTimer();
        closeModal('modal-end');
        closeModal('modal-disconnect');
        closePiggyWin();
    }

    function leaveRoom() {
        cleanRoom();
        changeScreen('screen-lobby');
    }

    // Piggy win kapatma yardƒ±mcƒ± fonksiyonu
    function closePiggyWin() {
        const overlay = document.getElementById('piggyWinOverlay');
        if (!overlay) return;

        overlay.classList.remove('show');
        setTimeout(() => {
            overlay.style.display = 'none';
            const coinLayer = document.getElementById('coinDropLayer');
            const fillBar = document.getElementById('piggyFillBar');
            const btns = document.getElementById('piggyButtons');
            if (coinLayer) coinLayer.innerHTML = '';
            if (fillBar) fillBar.style.width = '0%';
            if (btns) btns.style.display = 'none';
        }, 500);
    }

    function levelUpCareer() {
        careerLevel++;
        localStorage.setItem("careerLevel", careerLevel);
        // careerLevel deƒüi≈ükenini g√ºncelle (localstorage'dan okumana gerek yok, zaten artƒ±rdƒ±n)
        // Eƒüer UI g√ºncellemesi gerekiyorsa ve √∂yle bir fonksiyonun yoksa, ≈üimdilik bo≈ü ge√ßiyoruz.
        // updateCareerUI(); // Bu fonksiyon tanƒ±mlƒ± olmadƒ±ƒüƒ± i√ßin yorum satƒ±rƒ±na aldƒ±m, hata verdirir.

        // Kullanƒ±cƒ±ya bilgi ver
        showToast("Tebrikler! Kariyer seviyesi arttƒ±: " + careerLevel);
    }

    function closeAd() {
        const ad = document.getElementById("adModal");
        ad.style.display = "none";
        ad.style.pointerEvents = "none";
    }
    function saveUser() { localStorage.setItem("yh_name", user.name); localStorage.setItem("yh_ava", user.avatar); if (user.name) { db.ref('users/' + user.name).update({ avatar: user.avatar }); } }
    function isGoldRainTime() { const trTimeStr = new Date().toLocaleString("en-US", { timeZone: "Europe/Istanbul" }); const trDate = new Date(trTimeStr); const hour = trDate.getHours(); return (hour === 21); }
    function updateGold(amount) {
        let multiplier = 1;
        if (amount > 0) {
            if (globalMultiplier > 1) {
                multiplier = globalMultiplier;
            } else if (isGoldRainTime()) {
                multiplier = 2;
            }
        }
        const finalAmount = Math.floor(amount * multiplier);
        user.gold += finalAmount;
        document.getElementById('lobbyGold').innerText = user.gold;

        if (user.name) {
            db.ref('users/' + user.name).update({ gold: user.gold });

            // G√úNL√úK VE HAFTALIK SIRALAMA G√úNCELLEMESƒ∞ (Sadece Kazan√ßta)
            if (finalAmount > 0) {
                const today = getDayKey();
                const week = getWeekKey();

                // G√ºnl√ºk ≈ûampiyonluk
                db.ref(`daily_jackpot/${today}/${user.name}`).transaction(current => {
                    return (current || 0) + finalAmount;
                });

                // Haftalƒ±k Sƒ±ralama
                db.ref(`weekly_rankings/${week}/${user.name}`).transaction(current => {
                    return (current || 0) + finalAmount;
                });
            }
        }

        if (amount > 0 && multiplier > 1) {
            showToast(`üî• ALTIN YAƒûMURU! ${amount} yerine ${finalAmount} kazandƒ±n!`);
        }
    }
    function setGoldMultiplier(val) { if (confirm(`Oyun genelinde altƒ±n √ßarpanƒ±nƒ± x${val} yapmak istiyor musun?`)) { db.ref('system/gold_multiplier').set(val); showToast(`√áarpan x${val} olarak ayarlandƒ±.`); } }
    function checkGoldRainStatus() { const badge = document.getElementById('goldRainBadge'); if (!badge) return; let isActive = false; let currentMult = 1; if (globalMultiplier > 1) { isActive = true; currentMult = globalMultiplier; } else if (isGoldRainTime()) { isActive = true; currentMult = 2; } if (isActive) { badge.style.display = 'block'; badge.innerText = `üåßÔ∏è ALTIN YAƒûMURU AKTƒ∞F! (x${currentMult} KAZAN√á)`; } else { badge.style.display = 'none'; } }
    function checkAdmin() { document.getElementById('btnAdminPanel').style.display = 'block'; loadAdminDashboard(); db.ref('users').once('value').then(snap => { document.getElementById('totalUserCount').innerText = snap.numChildren(); }); }
    function toggleSystem(sys) {
        if (!sys) return;
        const key = 'system_status_' + sys;
        const current = localStorage.getItem(key) === 'false' ? false : true;
        const newState = !current;
        localStorage.setItem(key, newState);

        applySystemPreferences();

        showToast((sys === 'pet' ? 'Pet' : 'Sandƒ±k') + " sistemi " + (newState ? "a√ßƒ±ldƒ±" : "kapatƒ±ldƒ±") + ".");
    }

    function applySystemPreferences() {
        const petStatus = localStorage.getItem('system_status_pet') !== 'false';

        // UI Elementlerini G√ºncelle
        const petEl = document.getElementById('lobbyPetWalker');
        if (petEl) petEl.style.display = petStatus ? 'flex' : 'none';

        const chestEl = document.getElementById('chestSlotsContainer');

        // Admin Panel Butonlarƒ±nƒ± G√ºncelle (Eƒüer o an a√ßƒ±ksa)
        const btnPet = document.getElementById('btnTogglePet');
        if (btnPet) btnPet.innerText = 'üêæ Pet: ' + (petStatus ? "A√áIK" : "KAPALI");

        const btnChest = document.getElementById('btnToggleChest');
    }

    // Sayfa y√ºklendiƒüinde tercihleri uygula
    window.addEventListener('DOMContentLoaded', applySystemPreferences);

    function resetDailyJackpot() { if (confirm("Dƒ∞KKAT: Bug√ºnk√º t√ºm jackpot verileri silinecek. Emin misin?")) { db.ref(`daily_jackpot/${getDayKey()}`).remove().then(() => showToast("üóëÔ∏è Jackpot Sƒ±fƒ±rlandƒ±!")).catch(e => showToast("Hata olu≈ütu")); } }
    function resetSpeedRuns() { if (confirm("Dƒ∞KKAT: T√úM Speedrun rekorlarƒ±nƒ± silmek istiyor musun?")) { db.ref(`system/speedrun`).remove().then(() => showToast("üóëÔ∏è Speedrun Kayƒ±tlarƒ± Silindi!")).catch(e => showToast("Hata olu≈ütu")); } }
    function sendAdminMessage() { const el = document.getElementById('adminMsgInput'); const msg = el.value.trim(); if (!msg) return showToast("Mesaj bo≈ü olamaz!"); db.ref('admin_messages').push({ user: user.name, text: msg, time: firebase.database.ServerValue.TIMESTAMP }, function (error) { if (error) { showToast("Hata olu≈ütu: " + error); } else { showToast("Mesaj Y√∂netime ƒ∞letildi!"); el.value = ""; closeModal('modal-contact'); } }); }
    window.deleteAdminMsg = function (key) { if (confirm('Mesaj silinsin mi?')) { db.ref('admin_messages/' + key).remove(); } }
    function loadAdminDashboard() { if (!ADMIN_NAMES.includes(user.name)) return; function listenAdminMessages() { const list = document.getElementById('adminMsgList'); if (!list) return; db.ref('admin_messages').off(); db.ref('admin_messages').limitToLast(20).on('value', function (snapshot) { let htmlContent = ""; if (!snapshot.exists()) { htmlContent = "<div style='padding:10px;text-align:center;color:#ccc;'>üì≠ Mesaj kutusu bo≈ü.</div>"; } else { let msgs = []; snapshot.forEach(function (child) { msgs.push({ key: child.key, val: child.val() }); }); msgs.reverse(); msgs.forEach(function (item) { const m = item.val; const dateStr = new Date(m.time).toLocaleString('tr-TR'); htmlContent += `<div class="list-item" style="flex-direction:column; align-items:flex-start; background:rgba(255,255,255,0.05); margin-bottom:5px; padding:8px; border-radius:5px;"><div style="display:flex; justify-content:space-between; width:100%; font-size:0.7rem; color:#aaa; margin-bottom:3px;"><span>üë§ ${m.user}</span><span>üïí ${dateStr}</span></div><div style="font-size:0.9rem; color:#fff; word-break:break-word; margin-bottom:5px;">${m.text}</div><button class="btn-red" style="width:100%; padding:4px; font-size:0.75rem;" onclick="deleteAdminMsg('${item.key}')">üóëÔ∏è Sil</button></div>`; }); } list.innerHTML = htmlContent; }); } listenAdminMessages(); if (!adminListenersActive) { db.ref('feedback_reports').limitToLast(20).on('value', snap => { const list = document.getElementById('adminReportList'); if (list) { list.innerHTML = ""; if (!snap.exists()) { list.innerHTML = "<small>Bildirim yok.</small>"; } else { snap.forEach(c => { const r = c.val(); const key = c.key; const time = new Date(r.time).toLocaleTimeString('tr-TR'); const html = `<div class="list-item" style="flex-direction:column; align-items:flex-start; gap:5px;"><div style="width:100%; display:flex; justify-content:space-between; font-size:0.75rem; color:#ccc;"><span>üë§ ${r.user} | üïí ${time}</span><span>${r.context}</span></div><div style="width:100%; font-size:0.9rem;">${r.message}</div><button class="btn-red" style="width:100%; padding:5px; font-size:0.7rem;" onclick="db.ref('feedback_reports/${key}').remove()">üóëÔ∏è Sƒ∞L / √á√ñZ√úLD√ú</button></div>`; list.innerHTML = html + list.innerHTML; }); } } }); } if (adminListenersActive) { renderAdminView(); return; } const userList = document.getElementById('adminUserList'); userList.innerHTML = "Veriler alƒ±nƒ±yor..."; db.ref('users').on('value', usersSnap => { adminData.users = usersSnap.val() || {}; renderAdminView(); }); db.ref('presence').on('value', presenceSnap => { adminData.presence = presenceSnap.val() || {}; renderAdminView(); }); db.ref('banned').on('value', bannedSnap => { adminData.banned = bannedSnap.val() || {}; renderAdminView(); }); adminListenersActive = true; }
    function renderAdminView() {
        const list = document.getElementById('adminUserList');
        if (!list) return;

        const searchTerm = document.getElementById('adminUserSearch')?.value.toLowerCase() || '';
        let html = '';
        const users = adminData.users || {};
        const presence = adminData.presence || {};

        Object.keys(users).forEach(username => {
            if (searchTerm && !username.toLowerCase().includes(searchTerm)) return;

            const userData = users[username];
            const isOnline = presence[username] && presence[username].status === 'online';

            // Filtreleme
            if (currentAdminTab === 'online' && !isOnline) return;
            if (currentAdminTab === 'offline' && isOnline) return;
            if (currentAdminTab === 'new') {
                const dayMs = 24 * 60 * 60 * 1000;
                const isNew = userData.joinDate && (Date.now() - userData.joinDate < dayMs);
                if (!isNew) return;
            }

            const statusText = isOnline ? 'üü¢' : '‚ö´';
            const regDateStr = userData.joinDate ? new Date(userData.joinDate).toLocaleString('tr-TR') : 'Bilinmiyor';

            html += `
                <div class="list-item" style="display:flex; justify-content:space-between; align-items:center; padding:10px; background:#f8f9fa; border-radius:8px; margin-bottom:5px;">
                    <div style="display:flex; align-items:center; gap:10px;">
                        <span style="font-size:1.2rem;">${statusText}</span>
                        <div>
                            <div style="font-weight:bold; color:#2d3436;">${escapeHtml(username)}</div>
                            <small style="color:#666;">Altƒ±n: ${userData.gold || 0} | Seviye: ${userData.level || 1}</small><br>
                            <small style="color:#888; font-size:0.65rem;">üìÖ Kayƒ±t: ${regDateStr}</small>
                        </div>
                    </div>
                    <div style="display:flex; gap:5px;">
                        <button class="btn-blue" style="padding:5px 10px; font-size:0.7rem; width:auto;" onclick="viewUserProfile('${username}')">üë§</button>
                        <button class="btn-red" style="padding:5px 10px; font-size:0.7rem; width:auto;" onclick="deleteUser('${username}')">üóëÔ∏è</button>
                    </div>
                </div>
            `;
        });

        if (html === '') {
            html = '<div style="padding:20px; text-align:center; color:#999;">Kullanƒ±cƒ± bulunamadƒ±.</div>';
        }

        list.innerHTML = html;
    }

    function viewUserProfile(username) {
        openUserProfile(username);
    }

    function deleteUser(username) {
        if (!confirm(`‚ö†Ô∏è Dƒ∞KKAT!

${username} kullanƒ±cƒ±sƒ±nƒ± silmek istediƒüinize emin misiniz?

Bu i≈ülem geri alƒ±namaz!`)) {
            return;
        }

        if (!confirm(`Son uyarƒ±: ${username} ger√ßekten silinsin mi?`)) {
            return;
        }

        // Kullanƒ±cƒ±yƒ± veritabanƒ±ndan sil
        db.ref('users/' + username).remove()
            .then(() => {
                // Presence'dan da sil
                db.ref('presence/' + username).remove();
                showToast(`‚úÖ ${username} ba≈üarƒ±yla silindi!`);
                // Listeyi yenile
                setTimeout(renderAdminView, 500);
            })
            .catch(err => {
                console.error("Kullanƒ±cƒ± silme hatasƒ±:", err);
                showToast(`‚ùå Silme i≈ülemi ba≈üarƒ±sƒ±z: ${err.message}`);
            });
    }
function filterAdminUsers(mode) { currentAdminTab = mode; renderAdminView(); }
    function updateMarquee() { const input = document.getElementById('marqueeInput'); const text = input.value; if (!text) return showToast("Bo≈ü yazƒ± g√∂nderilemez!"); db.ref('system/marquee').set(text, (error) => { if (error) { showToast("Hata: " + error.message); } else { showToast("Kayan Yazƒ± G√ºncellendi! üì¢"); input.value = ""; } }); }
    function adminModifyGold(target, amount) { db.ref('users/' + target + '/gold').transaction(current => (current || 0) + amount).then(() => showToast(`${target}: ${amount > 0 ? '+' : ''}${amount} Altƒ±n`)); }
    function adminToggleBan(target, ban) { if (ban) db.ref('banned/' + target).set(true); else db.ref('banned/' + target).remove(); showToast(`${target} ${ban ? 'yasaklandƒ±' : 'yasaƒüƒ± kalktƒ±'}.`); loadAdminDashboard(); }
    function sendBroadcast() { const t = document.getElementById('broadcastInput').value; if (t) { db.ref('announcements').set({ text: t, time: Date.now() }); showToast("Duyuru Yapƒ±ldƒ±"); document.getElementById('broadcastInput').value = ""; } }
    function submitFeedback() { const t = document.getElementById('feedbackInput').value; if (!t) return showToast("Bo≈ü bƒ±rakma!"); const ctx = game.mode === 'online' ? "Room: " + game.room : "Single Player"; db.ref('feedback_reports').push({ user: user.name, message: t, context: ctx, time: Date.now() }); showToast("G√∂nderildi! Te≈üekk√ºrler."); document.getElementById('feedbackInput').value = ""; closeModal('modal-feedback'); }
    // G√úNCELLENMƒ∞≈û CREATE ROOM (AYRI HAKLAR)
    function createRoom() {
        if (user.gold < 50) return showToast("50 Altƒ±n Gerek");
        const c = Math.floor(10000 + Math.random() * 90000).toString();
        const d = parseInt(document.getElementById('createDiff').value);

        // Hak sayƒ±sƒ±nƒ± zorluƒüa g√∂re belirle
        let startRights = 15;
        if (d === 5) startRights = 20;
        if (d === 6) startRights = 25;
        if (d === 7) startRights = 30;

        updateGold(-50);
        const secret = generateNumber(d);

        db.ref('rooms/' + c).set({
            secret: secret,
            p1: { name: user.name, avatar: user.avatar },
            config: {
                diff: d,
                type: document.getElementById('createMode').value,
                playStyle: document.getElementById('createPlayStyle').value,
                duration: parseInt(document.getElementById('createDuration').value)
            },
            status: "waiting",
            turn: "p1",

            // --- DEƒûƒ∞≈ûƒ∞KLƒ∞K BURADA: Haklarƒ± ayƒ±rdƒ±k ---
            rights_p1: startRights,
            rights_p2: startRights,
            // ------------------------------------------

            startTime: Date.now(),
            round: 1
        });

        db.ref('rooms/' + c).onDisconnect().remove();
        game.room = c;
        game.role = "p1";
        game.diff = d;
        game.rights = startRights; // Yerel deƒüi≈ükeni e≈üitle
        game.type = document.getElementById('createMode').value;
        game.mode = "online";
        game.playStyle = document.getElementById('createPlayStyle').value;
        game.duration = parseInt(document.getElementById('createDuration').value);
        closeModal('modal-setup');
        changeScreen('screen-wait');
        document.getElementById('roomCodeDisplay').innerText = c;
        document.getElementById('roomModeInfo').innerText = `${d}H`;
        listenRoom(c);
    }
    function joinRoom(c) { c = c.toString().trim(); if (c.length < 5) return showToast("Kod Hatalƒ±"); if (user.gold < 50) return showToast("50 Altƒ±n Gerek"); db.ref('rooms/' + c).once('value').then(s => { const r = s.val(); if (!r) return showToast("Oda Yok"); if (r.status !== "waiting") return showToast("Oda Dolu"); updateGold(-50); game.room = c; game.role = "p2"; game.diff = r.config.diff; game.type = r.config.type; game.mode = "online"; game.playStyle = r.config.playStyle; game.duration = r.config.duration; game.secret = r.secret; db.ref('rooms/' + c).update({ p2: { name: user.name, avatar: user.avatar }, status: "playing", startTime: Date.now() }); db.ref('rooms/' + c).onDisconnect().update({ winner: 'p1', endReason: 'abandoned' }); closeModal('modal-setup'); listenRoom(c); }); }
    function saveScore(s) { db.ref('users/' + user.name + '/totalScore').transaction(c => (c || 0) + s); db.ref('scores').push({ user: user.name, score: s, timestamp: Date.now() }); }
    function sendEmoji(emoji) { if (!game.room) return; showEmojiAnim(emoji, true); db.ref('rooms/' + game.room + '/emojis').push({ e: emoji, t: Date.now() }); }
    function showEmojiAnim(emoji, isSelf) { const el = document.createElement('div'); el.className = 'floating-emoji'; el.innerText = emoji; el.style.left = (20 + Math.random() * 60) + '%'; document.getElementById('emojiLayer').appendChild(el); setTimeout(() => el.remove(), 3000); }
    function openAvatarChange() {
        const list = document.getElementById('changeAvatarList');
        list.innerHTML = ""; // Listeyi temizle

        // Avatar Resim Kaynaklarƒ± (Uzantƒ±lar .png olarak d√ºzeltildi)
        const baseUrl = "https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/";
        const avatars = [
            "Smilies/Smiling%20Face%20with%20Sunglasses.png",
            "People/Man%20Technologist.png",
            "People/Woman%20Technologist.png",
            "People/Ninja.png",
            "Animals/Lion.png",
            "Animals/Wolf.png",
            "Animals/Panda.png",
            "Animals/Cat%20Face.png",

            "Smilies/Robot.png",
            "Smilies/Alien%20Monster.png",
            "Smilies/Clown%20Face.png"
        ];

        avatars.forEach(path => {
            const fullUrl = baseUrl + path;
            const div = document.createElement('div');
            div.className = "avatar-item";

            // Eƒüer bu resim benim ≈üu anki avatarƒ±msa, ye≈üil √ßer√ßeve ekle (Se√ßili g√∂ster)
            if (user.avatar === fullUrl) {
                div.classList.add('selected');
            }

            // Resmi ekle
            div.innerHTML = `<img src="${fullUrl}" style="pointer-events:none;">`;

            // Tƒ±klama Olayƒ±
            div.onclick = () => {
                // Diƒüerlerinin se√ßimini kaldƒ±r
                list.querySelectorAll('.avatar-item').forEach(x => x.classList.remove('selected'));
                div.classList.add('selected');

                // Yeni avatarƒ± kaydet
                user.avatar = fullUrl;
                saveUser();
                updateLobbyUI();

                // Profil a√ßƒ±ksa oradaki avatarƒ± da g√ºncelle
                const pAvatar = document.getElementById('pAvatar');
                if (pAvatar && document.getElementById('modal-profile-v2').style.display === 'flex') {
                    if (fullUrl.includes('http')) {
                        pAvatar.innerHTML = `<img src="${fullUrl}">`;
                    } else {
                        pAvatar.innerText = fullUrl;
                    }
                }

                showToast("Avatar G√ºncellendi! üòé");
                setTimeout(() => closeModal('modal-avatar-change'), 300); // Hafif gecikmeli kapat
            };

            list.appendChild(div);
        });

        showModal('modal-avatar-change');
    }















    window.addEventListener('DOMContentLoaded', () => {
        // 1. Y√ºkleme Ekranƒ±nƒ± Gizle (Doƒüru ID: 'loading')
        setTimeout(() => {
            const l = document.getElementById('loading');
            if (l) l.style.display = 'none';
        }, 1500);

        // 2. Arkaplan Animasyonu
        const fakeCount = document.getElementById('fakeOnlineCount');
        if (fakeCount) fakeCount.innerText = Math.floor(Math.random() * (99 - 15 + 1) + 15);

        const bgAnimContainer = document.getElementById('bgAnim');
        if (bgAnimContainer) {
            bgAnimContainer.innerHTML = "";
            for (let i = 0; i < 15; i++) {
                const span = document.createElement('span');
                span.className = 'float-num';
                span.innerText = Math.floor(Math.random() * 10);
                span.style.left = Math.random() * 100 + '%';
                span.style.fontSize = (Math.random() * 40 + 20) + 'px';
                span.style.animationDuration = (Math.random() * 10 + 10) + 's';
                span.style.animationDelay = Math.random() * 5 + 's';
                bgAnimContainer.appendChild(span);
            }
        }

        // 3. Firebase Ba≈ülatma (KRƒ∞Tƒ∞K - BU EKSƒ∞KTƒ∞)
        try {
            if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
            db = firebase.database();
        } catch (e) {
            const errLog = document.getElementById('errorLog');
            if (errLog) errLog.innerText = "Hata: " + e.message;
        }

        // 4. Otomatik Giri≈ü Kontrol√º
        const savedName = localStorage.getItem("yh_name");
        if (savedName) {
            completeLogin(savedName);
        } else {
            changeScreen('screen-login');
        }

        // 5. Buton Dinleyicilerini Kur
        setupListeners();

        // 6. Ses Motoru Hazƒ±rlƒ±ƒüƒ± ve MUTE KONTROL√ú

        // Kayƒ±tlƒ± ayarƒ± √ßek
        const savedMute = localStorage.getItem("yh_muted");
        if (savedMute === "true") isMuted = true;
        updateMuteUI(); // Butonu g√ºncelle

        document.body.addEventListener('click', () => AudioEngine.init(), { once: true });
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible') updatePresence(true);
        });
    });
    function setupListeners() {
        // AVATAR SE√áƒ∞M Dƒ∞NLEYƒ∞Cƒ∞Sƒ∞ (G√úNCELLENDƒ∞)
        document.querySelectorAll('.avatar-item').forEach(av => {
            av.onclick = () => {
                // G√∂rsel se√ßimi g√ºncelle
                document.querySelectorAll('.avatar-item').forEach(x => x.classList.remove('selected'));
                av.classList.add('selected');

                // ƒ∞√ßindeki resim linkini al, yoksa metni al
                const imgTag = av.querySelector('img');
                if (imgTag) {
                    user.avatar = imgTag.src;
                } else {
                    user.avatar = av.innerText;
                }
                AudioEngine.click();
            };
        });

        document.getElementById('btnLogin').onclick = attemptLogin;

        // Mobil klavye fix
        window.addEventListener('resize', () => {
            if (document.activeElement.tagName === 'INPUT') {
                setTimeout(() => document.activeElement.scrollIntoView({ block: 'center' }), 100);
            }
        });
    }
    function listenRoom(c) {
        // 1. ODA DURUMUNU Dƒ∞NLE (Ana D√∂ng√º)
        db.ref('rooms/' + c).on('value', s => {
            const r = s.val();
            if (!r) return;

            // R√ñVAN≈û KONTROL√ú (YENƒ∞)

            // Baƒülantƒ± kopma kontrol√º
            if (game.active && r.status === 'playing' && (!r.p1 || !r.p2)) {
                game.active = false;
                showModal('modal-disconnect');
                AudioEngine.success();
                return;
            }

            // --- HAK G√úNCELLEMESƒ∞ (CANLI - AYRI≈ûTIRILMI≈û) ---
            // Oyun oynanƒ±rken kendi hakkƒ±m deƒüi≈üirse ekrana yansƒ±t
            if (game.active && game.type === 'classic') {
                // Hangi rol√º oynuyorsam o anahtara bak (rights_p1 veya rights_p2)
                const myKey = 'rights_' + game.role;

                // Eƒüer veritabanƒ±nda bu deƒüer varsa g√ºncelle
                if (r[myKey] !== undefined) {
                    game.rights = r[myKey];
                    document.getElementById('rightsDisplay').innerText = "Hak: " + game.rights;
                }
            }

            // --- OYUN BA≈ûLANGICI / YENƒ∞DEN BA≈ûLAMA ---
            if (r.status === "playing" && !game.active) {
                game.diff = r.config.diff; // Zorluƒüu g√ºncelle
                game.usedItems = []; game.active = true;
                game.turn = r.turn;
                game.rights = r.rights;
                game.secret = r.secret;
                game.startTime = r.startTime;

                closeModal('modal-setup');
                changeScreen('screen-game');
                updateGameInterface('online');
                resetUI(); // Ekranƒ± ve ge√ßmi≈üi temizle
                updateTurnUI(r.turn);

                if (game.type === 'classic') {
                    document.getElementById('rightsDisplay').style.display = 'block';
                    document.getElementById('rightsDisplay').innerText = "Hak: " + game.rights;
                    document.getElementById('timerDisplay').style.display = 'none';
                } else {
                    document.getElementById('rightsDisplay').style.display = 'none';
                    document.getElementById('timerDisplay').style.display = 'block';
                    startTimerLoop(); // Sayacƒ± ba≈ülat
                }
                showToast("OYUN BA≈ûLADI!");

                // OTURUM KAYDET (ROTATION FIX)
                sessionStorage.setItem('yh_game_room', game.room);
                sessionStorage.setItem('yh_game_role', game.role);

                // P1 ise, baƒülantƒ± koparsa oyunu bitirme sorumluluƒüunu al
                if (game.role === 'p1') {
                    db.ref('rooms/' + c).onDisconnect().update({ winner: 'p2', endReason: 'abandoned' });
                }
            }

            // Sƒ±ra deƒüi≈üimi
            if (game.active && r.turn !== game.turn) {
                game.turn = r.turn;
                updateTurnUI(r.turn);
            }

            // --- OYUN SONU VE R√ñVAN≈û Y√ñNETƒ∞Mƒ∞ (Fƒ∞XED) ---
            if (r.winner && r.status !== 'playing') {
                // Eƒüer modal zaten a√ßƒ±ksa tekrar √ßalƒ±≈ütƒ±rma
                const modalEnd = document.getElementById('modal-end');
                if (modalEnd && modalEnd.style.display !== 'flex') {
                    endGameLocal(r.winner, r.endReason);
                }
            }

            // --- SENKRONƒ∞ZE R√ñVAN≈û MANTIƒûI (V5 - CRASH FIX) ---
            if (r.winner && r.rematch) {

                // 1. DURUM: Biri reddetti mi? (Sadece oyun aktif deƒüilse ve hala odadaysak)
                if (r.rematch.rejected && !game.active && game.room === c) {
                    const msg = (r.rematch.rejecter === user.name)
                        ? "Teklifi reddettin."
                        : "Rakip teklifi reddetti.";
                    showToast(msg);
                    setTimeout(() => {
                        if (!game.active && game.room === c) leaveRoom();
                    }, 1500);
                    return;
                }

                const me = game.role;
                const opp = (me === 'p1') ? 'p2' : 'p1';

                // Veri g√ºvenliƒüi: Eƒüer veri yoksa bo≈ü obje ata ki kod patlamasƒ±n
                const myState = r.rematch[me] || {};
                const oppState = r.rematch[opp] || {};

                // 2. DURUM: HER ƒ∞Kƒ∞Sƒ∞ DE "EVET" DEDƒ∞ (OYUN BA≈ûLIYOR)
                if (myState.wants && oppState.wants) {

                    // Durum mesajƒ±nƒ± g√ºncelle
                    document.getElementById('rematchStatus').innerText = "Oyun Ba≈ülatƒ±lƒ±yor...";

                    // --- HOST OTORƒ∞TESƒ∞ (SADECE P1 √áALI≈ûTIRIR) ---
                    if (game.role === 'p1') {

                        // KRƒ∞Tƒ∞K D√úZELTME: Veri g√ºvenliƒüi kontrol√º
                        // P1 verisi bazen anlƒ±k olarak eksik gelebilir, bu y√ºzden varsayƒ±lan deƒüerleri zorla.
                        let p1Request = r.rematch.p1 || {};
                        let currentConfig = r.config || {};

                        // Yeni zorluk: P1 se√ßtiyse onu al, yoksa eski konfig√ºrasyonu al, o da yoksa 4 yap.
                        let newDiff = p1Request.diff || currentConfig.diff || 4;

                        // Hak sayƒ±sƒ±nƒ± hesapla
                        let newRights = 15;
                        if (newDiff === 5) newRights = 20;
                        if (newDiff === 6) newRights = 25;
                        if (newDiff === 7) newRights = 30;

                        const newSecret = generateNumber(newDiff);

                        // 1 saniye bekle ve oyunu resetle
                        setTimeout(() => {
                            db.ref('rooms/' + c).update({
                                winner: null,
                                rematch: null,
                                moves: null,
                                status: 'playing',
                                turn: 'p1',
                                rights: newRights,
                                secret: newSecret,
                                startTime: Date.now(),
                                'config/diff': newDiff
                            });
                        }, 1000);
                    }
                }

                // 3. DURUM: RAKƒ∞P ƒ∞STƒ∞YOR, BEN DAHA CEVAP VERMEDƒ∞M (DAVET EKRANI)
                else if (oppState.wants && !myState.wants) {
                    // Butonlarƒ± gizle, Davet Alanƒ±nƒ± A√ß
                    document.getElementById('endButtons').style.display = 'none';

                    const offerArea = document.getElementById('incomingRematchArea');
                    const offerText = document.getElementById('incomingRematchText');

                    offerArea.style.display = 'block';

                    // Zorluk bilgisini g√ºvenli ≈üekilde al
                    let oppDiff = oppState.diff || (r.config ? r.config.diff : 4);

                    offerText.innerHTML = `
                    <b>${r[opp] ? r[opp].name : 'Rakip'}</b> tekrar oynamak istiyor.<br>
                    <small>Zorluk: ${oppDiff} Hane</small>
                `;
                }

                // 4. DURUM: BEN ƒ∞STEDƒ∞M, RAKƒ∞Bƒ∞ BEKLƒ∞YORUM
                else if (myState.wants && !oppState.wants) {
                    document.getElementById('rematchStatus').innerText = "Rakibin kararƒ± bekleniyor...";
                    document.getElementById('incomingRematchArea').style.display = 'none';

                    const btnMy = document.getElementById('btnRematch');
                    if (btnMy) {
                        btnMy.disabled = true;
                        btnMy.innerText = "ƒ∞stek G√∂nderildi...";
                    }
                }
            }
        });
        // 2. HAMLELERƒ∞ Dƒ∞NLE
        db.ref('rooms/' + c + '/moves').off();
        db.ref('rooms/' + c + '/moves').on('child_added', s => {
            const m = s.val();
            addHistory(m.g, m.p, m.m, m.u);
        });

        // 3. SOHBETƒ∞ Dƒ∞NLE (Eksikti, buraya ekliyoruz)
        db.ref('rooms/' + c + '/chat').off();
        db.ref('rooms/' + c + '/chat').limitToLast(50).on('child_added', s => {
            // D√úZELTƒ∞LDƒ∞: Sohbet tamamen kapatƒ±lmƒ±≈üsa mesajlarƒ± i≈üleme
            if (isChatBlocked) {
                // Yine de bildirim sesini √ßalma, sadece g√∂sterme
                return;
            }
            const m = s.val();
            const box = document.getElementById('gameChatBox');
            const isMe = (m.u === user.name);
            const msgClass = isMe ? 'msg-me' : 'msg-other';

            // Mesajƒ± ekrana yaz
            box.innerHTML += `<div class="game-chat-msg ${msgClass}"><b>${m.u}</b><br>${m.m}</div>`;

            // --- Bƒ∞LDƒ∞Rƒ∞M Sƒ∞STEMƒ∞ ---
            const container = document.getElementById('gameChatContainer');
            const badge = document.getElementById('gameChatBadge');

            // Eƒüer mesaj benden deƒüilse VE sohbet penceresi kapalƒ±ysa -> Kƒ±rmƒ±zƒ± Noktayƒ± Yak
            if (!isMe && container.style.display === 'none' && badge) {
                badge.style.display = 'inline-block';
                AudioEngine.notification(); // Sesli uyarƒ±
            }

            // Eƒüer sohbet a√ßƒ±ksa otomatik a≈üaƒüƒ± kaydƒ±r
            if (container.style.display !== 'none') {
                box.scrollTop = box.scrollHeight;
            }
        });

        // 4. EMOJƒ∞ VE EFEKTLER
        db.ref('rooms/' + c + '/emojis').off();
        db.ref('rooms/' + c + '/emojis').limitToLast(1).on('child_added', s => {
            const d = s.val();
            if (Date.now() - d.t < 3000) { showEmojiAnim(d.e, false); }
        });
        db.ref('rooms/' + c + '/active_effects').off();
        db.ref('rooms/' + c + '/active_effects').limitToLast(1).on('child_added', s => {
            const eff = s.val();
            if (eff.type === 'ink' && eff.sender !== user.name && (Date.now() - eff.time < 3000)) {
                triggerSabotageEffect();
            }
        });
    }
    window.addEventListener('popstate', e => { history.pushState(null, null, location.href); const m = document.querySelectorAll('.modal-overlay'); let c = false; m.forEach(x => { if (x.style.display === 'flex') { x.style.display = 'none'; c = true; } }); if (c) return; if (game.active || currentScreen === 'screen-wait' || currentScreen === 'screen-game') { attemptExit(); } else if (currentScreen === 'screen-admin') { changeScreen('screen-lobby'); } else { showModal('modal-exit-confirm'); } }); history.pushState(null, null, location.href);
    // --- YENƒ∞ KOLEKSƒ∞YON & SOHBET MANTIƒûI ---








    // --- G√úNCELLENMƒ∞≈û PAKET ALMA FONKSƒ∞YONLARI ---



    // A≈ûAƒûIDAKƒ∞ EKSƒ∞K FONKSƒ∞YON BA≈ûLIƒûINI EKLE:


    // --- EKSƒ∞K OLAN ANƒ∞MASYON FONKSƒ∞YONU ---

    // --- KOLEKSƒ∞YON SOHBETƒ∞ ---
    let colChatListener = false;





    // --- TAKAS (TRADE) Sƒ∞STEMƒ∞ ---





    // 1. ƒ∞lan Verme Ekranƒ±nƒ± Hazƒ±rla


    // 2. ƒ∞lan Yayƒ±nla


    // 3. ƒ∞lanlarƒ± Listele


    // 4. ƒ∞lan ƒ∞ptal (Kartƒ± Geri Al)


    // 5. Takas Kabul Et



    /* --- GELƒ∞≈ûMƒ∞≈û PROFƒ∞L VE DM Sƒ∞STEMƒ∞ JS --- */

    let currentProfileUser = null; // ≈ûu an kimin profiline bakƒ±yoruz?

    function openUserProfile(targetUsername) {
        if (!targetUsername) return;
        currentProfileUser = targetUsername;

        // Yandex Banner (Paid Ad) - Pet Section inside Profile
        if (typeof AdManager !== 'undefined' && AdManager.showBanner && AdManager.yandexBannerId) {
             AdManager.showBanner(AdManager.yandexBannerId);
        }

        // Modal'ƒ± a√ß ve y√ºkleniyor g√∂ster
        showModal('modal-profile-v2');
        document.getElementById('pName').innerText = targetUsername;

        // G√∂r√ºn√ºm√º Sƒ±fƒ±rla (D√ºzenleme modu a√ßƒ±ksa kapat)
        document.getElementById('pViewMode').style.display = 'block';
        document.getElementById('pEditMode').style.display = 'none';
        document.getElementById('pBioText').innerText = "Y√ºkleniyor...";

        // Veritabanƒ±ndan Verileri √áek
        db.ref('users/' + targetUsername).once('value').then(snap => {
            const data = snap.val() || {};

            // 1. Temel Bilgiler (Resim Desteƒüi Eklendi)
            const avatar = data.avatar || "üòé";
            const avatarBox = document.getElementById('pAvatar');

            if (avatar.includes('http')) {
                // Link ise resim etiketi olu≈ütur
                avatarBox.innerHTML = `<img src="${avatar}">`;
            } else {
                // Emoji ise d√ºz yazƒ± olarak bas
                avatarBox.innerText = avatar;
            }

            document.getElementById('pLevel').innerText = data.level || 1;
            document.getElementById('pGold').innerText = data.gold || 0;

            // 2. ƒ∞statistikler
            let totalWins = 0;
            if (data.quests) {
                Object.values(data.quests).forEach(q => { totalWins += (q.wins || 0); });
            }
            document.getElementById('pWins').innerText = totalWins;

            // 3. Rozetler
            let badges = "";
            if (data.gold >= 500000) badges += "üëë ";
            if (data.adsWatched >= 100) badges += "üì∫ ";
            if (data.level >= 10) badges += "‚≠ê ";
            if (ADMIN_NAMES.includes(targetUsername)) badges += "üõ°Ô∏è Y√ñNETƒ∞Cƒ∞";
            document.getElementById('pBadges').innerText = badges;

            // 4. Biyografi ve Ki≈üisel Bilgiler (YENƒ∞ KISIM)
            document.getElementById('pBioText').innerText = data.bio || "Hen√ºz bir ≈üey yazmamƒ±≈ü...";
            document.getElementById('pCityDisplay').innerText = data.city || "-";
            document.getElementById('pJobDisplay').innerText = data.job || "-";
            document.getElementById('pHobbyDisplay').innerText = data.hobbies || "-";
            document.getElementById('pGenderDisplay').innerText = data.gender || "-";

            // Ya≈ü Hesaplama
            if (data.birthYear) {
                const age = new Date().getFullYear() - parseInt(data.birthYear);
                document.getElementById('pAgeDisplay').innerText = age;
            } else {
                document.getElementById('pAgeDisplay').innerText = "-";
            }

            // 5. Kendi Profilim mi?
            const isMe = (user.name === targetUsername);
            document.getElementById('btnEditBio').style.display = isMe ? 'block' : 'none';
            document.getElementById('btnProfileDM').style.display = isMe ? 'none' : 'block';
            const btnDelete = document.getElementById('btnDeleteProfile');
            if (btnDelete) btnDelete.style.display = isMe ? 'block' : 'none';

            // Avatar Deƒüi≈ütirme Butonu
            const btnAvatar = document.getElementById('btnChangeAvatarProfile');
            if (btnAvatar) btnAvatar.style.display = isMe ? 'flex' : 'none';

            // Pet B√∂l√ºm√º Y√∂netimi
            const petSection = document.getElementById('profilePetSection');
            if (petSection) {
                petSection.style.display = isMe ? 'block' : 'none';
                // Her a√ßƒ±lƒ±≈üta listeyi gizli ba≈ülat
                const pList = document.getElementById('profilePetListContainer');
                const pBtn = document.getElementById('btnTogglePetList');
                if (pList) pList.style.display = 'none';
                if (pBtn) pBtn.innerText = "G√ñSTER ‚ñº";
            }

            // Eƒüer kendimsem, inputlarƒ± mevcut verilerle doldur
            if (isMe) {
                document.getElementById('pBioInput').value = data.bio || "";
                document.getElementById('pCityInput').value = data.city || "";
                document.getElementById('pJobInput').value = data.job || "";
                document.getElementById('pHobbyInput').value = data.hobbies || "";
                document.getElementById('pBirthInput').value = data.birthYear || "";
                document.getElementById('pGenderInput').value = data.gender || "";
            }
        });

        // 6. Online Durumu
        db.ref('presence/' + targetUsername).once('value').then(snap => {
            const pStatus = document.getElementById('pOnlineStatus');
            pStatus.className = (snap.exists() && snap.val().status === 'online')
                ? "profile-online-badge status-online"
                : "profile-online-badge status-offline";
        });
    }

    function toggleProfilePetList() {
        const list = document.getElementById('profilePetListContainer');
        const btn = document.getElementById('btnTogglePetList');
        if (list && list.style.display === 'none') {
            list.style.display = 'grid';
            if (btn) btn.innerText = "Gƒ∞ZLE ‚ñ≤";
            if (typeof PetSystem !== 'undefined') {
                PetSystem.renderPetList();
            }
        } else {
            if (list) list.style.display = 'none';
            if (btn) btn.innerText = "G√ñSTER ‚ñº";
        }
    }

    function enableBioEdit() {
        // G√∂r√ºn√ºm modunu gizle, d√ºzenleme modunu a√ß
        document.getElementById('pViewMode').style.display = 'none';
        document.getElementById('pEditMode').style.display = 'block';
        document.getElementById('btnEditBio').style.display = 'none';
    }

    function saveBio() {
        const newBio = document.getElementById('pBioInput').value.trim();
        const city = document.getElementById('pCityInput').value.trim();
        const job = document.getElementById('pJobInput').value.trim();
        const hobbies = document.getElementById('pHobbyInput').value.trim();
        const birthYear = document.getElementById('pBirthInput').value;
        const gender = document.getElementById('pGenderInput').value;

        if (newBio.length > 50) return showToast("Biyografi √ßok uzun!");

        // Firebase'e T√ºm Bilgileri Kaydet
        db.ref('users/' + user.name).update({
            bio: newBio,
            city: city,
            job: job,
            hobbies: hobbies,
            birthYear: birthYear,
            gender: gender
        }).then(() => {
            showToast("Profil G√ºncellendi! ‚úÖ");
            // Sayfayƒ± yenilemeden verileri g√ºncellemek i√ßin profili tekrar y√ºkle
            openUserProfile(user.name);
        });
    }

    // PROFƒ∞L Sƒ∞LME (Kullanƒ±cƒ± kaydƒ±nƒ± tamamen kaldƒ±rƒ±r)
    function deleteMyProfile() {
        try {
            if (!user.name) return showToast("√ñnce giri≈ü yapmalƒ±sƒ±n.");

            // Oda/oyun i√ßindeyken temiz √ßƒ±kƒ±≈ü
            try {
                if (game && game.room) {
                    if (typeof leaveRoom === 'function') leaveRoom();
                }
            } catch (e) { }

            const ok = confirm("‚ö†Ô∏è Dƒ∞KKAT! Profilin ve t√ºm ilerlemen kalƒ±cƒ± olarak silinecek.\n\nDevam etmek istiyor musun?");
            if (!ok) return;

            const typed = prompt("Onay i√ßin SIL yaz ve Tamam'a bas (b√ºy√ºk harf).\nBu i≈ülem geri alƒ±namaz!");
            if (typed !== "SIL") return showToast("ƒ∞ptal edildi.");

            const uname = user.name;

            // Listener'larƒ± kapat (g√ºvenli)
            try { db.ref('invites/' + uname).off(); } catch (e) { }
            try { db.ref('users/' + uname + '/last_msg').off(); } catch (e) { }
            try { db.ref('presence/' + uname).off(); } catch (e) { }

            showToast("Siliniyor... ‚è≥");

            const updates = {};
            // Ana profil + ilgili d√ºƒü√ºmler
            updates['users/' + uname] = null;
            updates['presence/' + uname] = null;
            updates['invites/' + uname] = null;

            // (Opsiyonel) G√ºnl√ºk/haftalƒ±k listelerde g√∂r√ºnen kayƒ±tlar (varsa)
            try { updates['daily_jackpot/' + getDayKey() + '/' + uname] = null; } catch (e) { }
            try { updates['weekly_rankings/' + getWeekKey() + '/' + uname] = null; } catch (e) { }

            db.ref().update(updates).then(() => {
                // Yerel kayƒ±tlarƒ± temizle
                try {
                    localStorage.removeItem('yh_name');
                    localStorage.removeItem('yh_ava');
                } catch (e) { }
                try {
                    sessionStorage.removeItem('yh_game_room');
                    sessionStorage.removeItem('yh_game_role');
                } catch (e) { }

                // RAM'deki user objesini sƒ±fƒ±rla
                try {
                    user.name = "";
                    user.avatar = "üòé";
                } catch (e) { }

                try { closeModal('modal-profile-v2'); } catch (e) { }

                alert("Profilin silindi. Giri≈ü ekranƒ±na y√∂nlendiriliyorsun.");
                location.reload();
            }).catch(err => {
                console.error("Profile delete failed:", err);
                showToast("Silme ba≈üarƒ±sƒ±z: " + (err && err.message ? err.message : err));
            });
        } catch (err) {
            console.error(err);
            showToast("Silme sƒ±rasƒ±nda hata olu≈ütu.");
        }
    }


    function openAvatarChangeFromProfile() {
        // Profili kapatmamƒ±za gerek yok, √ºst√ºne a√ßƒ±lƒ±r (z-index)
        if (typeof openAvatarChange === 'function') {
            openAvatarChange();
        } else {
            showToast("Hata: Avatar sistemi y√ºklenemedi.");
        }
    }

    // Profil √úzerinden Mesajla≈üma Ba≈ülat
    function startDMFromProfile() {
        if (currentProfileUser) {
            closeModal('modal-profile-v2'); // Profili kapat
            openDM(currentProfileUser);     // Mevcut DM sistemini a√ß
        }
    }
    // --- EKSƒ∞K OLAN DM Sƒ∞STEMƒ∞ FONKSƒ∞YONLARI ---
    let activeDMPartner = null;

    // --- Sƒ∞LME √ñZELLƒ∞KLƒ∞ DM FONKSƒ∞YONU ---
    function openDM(targetUser) {
        if (!targetUser || targetUser === user.name) return;
        activeDMPartner = targetUser;

        document.getElementById('dmTitle').innerText = "Mesajla≈üma: " + targetUser;
        const msgBox = document.getElementById('dmMessages');
        msgBox.innerHTML = "Y√ºkleniyor...";
        showModal('modal-dm');

        db.ref('chats/private').off();

        const chatID = [user.name, targetUser].sort().join('_');

        db.ref('chats/private/' + chatID).limitToLast(50).on('value', snap => {
            msgBox.innerHTML = "";

            if (!snap.exists()) {
                msgBox.innerHTML = "<small style='color:#999; display:block; text-align:center; margin-top:20px;'>Hen√ºz mesaj yok. ƒ∞lk merhaba diyen sen ol! üëã</small>";
                return;
            }

            snap.forEach(c => {
                const m = c.val();
                const msgKey = c.key; // Mesajƒ±n ID'si
                const isMe = m.from === user.name;

                const bubbleStyle = isMe
                    ? "background:#dcf8c6; color:#000; align-self:flex-end; border-radius:15px 15px 0 15px;"
                    : "background:#fff; color:#000; align-self:flex-start; border-radius:15px 15px 15px 0;";

                const alignStyle = isMe ? "justify-content:flex-end;" : "justify-content:flex-start;";

                // Sadece kendi mesajƒ±na silme butonu koy
                const deleteBtn = isMe ? `<span onclick="deleteDMMessage('${chatID}', '${msgKey}')" style="cursor:pointer; font-size:0.7rem; margin-left:5px; opacity:0.6;">üóëÔ∏è</span>` : '';

                const html = `
                <div style="display:flex; ${alignStyle} margin-bottom:5px; align-items:center;">
                    <div style="${bubbleStyle} padding:8px 12px; max-width:80%; font-size:0.9rem; box-shadow:0 1px 2px rgba(0,0,0,0.1); display:flex; align-items:center;">
                        <span>${m.text}</span>
                        ${deleteBtn}
                    </div>
                </div>`;
                msgBox.innerHTML += html;
            });

            msgBox.scrollTop = msgBox.scrollHeight;
        });
    }
    function sendDM() {
        const input = document.getElementById('dmInput');
        const text = input.value.trim();

        // Kontroller
        if (!text) return;
        if (!activeDMPartner) return showToast("Bir hata olu≈ütu, pencereyi kapatƒ±p a√ßƒ±n.");

        const chatID = [user.name, activeDMPartner].sort().join('_');

        // 1. Mesajƒ± Sohbet Ge√ßmi≈üine Kaydet
        db.ref('chats/private/' + chatID).push({
            from: user.name,
            text: text,
            timestamp: firebase.database.ServerValue.TIMESTAMP
        });

        // 2. Kar≈üƒ± Tarafa Bƒ∞LDƒ∞Rƒ∞M G√ñNDER (Kritik Nokta)
        // 'seen: false' olduƒüu i√ßin kar≈üƒ± tarafƒ±n Listener'ƒ± tetiklenecek ve kƒ±rmƒ±zƒ± nokta yanacak.
        db.ref('users/' + activeDMPartner + '/last_msg').set({
            from: user.name,
            text: text,
            seen: false, // <--- BU √áOK √ñNEMLƒ∞
            time: firebase.database.ServerValue.TIMESTAMP
        });

        input.value = "";

        // Sohbeti a≈üaƒüƒ± kaydƒ±r (Kendi ekranƒ±n i√ßin)
        setTimeout(() => {
            const box = document.getElementById('dmMessages');
            if (box) box.scrollTop = box.scrollHeight;
        }, 200);
    }
    // --- MESAJ Sƒ∞LME FONKSƒ∞YONU ---
    function deleteDMMessage(chatID, msgKey) {
        if (confirm("Bu mesajƒ± silmek istiyor musun?")) {
            db.ref('chats/private/' + chatID + '/' + msgKey).remove()
                .then(() => {
                    showToast("Mesaj silindi.");
                })
                .catch((err) => {
                    showToast("Hata: " + err.message);
                });
        }
    }
    // En son gelen mesajƒ± a√ßan fonksiyon
    function openLastMessage() {
        db.ref('users/' + user.name + '/last_msg').once('value').then(snap => {
            const data = snap.val();
            if (data && data.from) {
                // Mesajƒ± "g√∂r√ºld√º" olarak i≈üaretle
                db.ref('users/' + user.name + '/last_msg/seen').set(true);

                // Butonu gizle
                document.getElementById('btnNewMsg').style.display = 'none';

                // O ki≈üinin DM kutusunu a√ß
                openDM(data.from);
            } else {
                showToast("Okunmamƒ±≈ü mesaj yok.");
                document.getElementById('btnNewMsg').style.display = 'none';
            }
        });
    }
    // --- GELEN KUTUSU (INBOX) Sƒ∞STEMƒ∞ ---

    // --- D√úZELTƒ∞LMƒ∞≈û GELEN KUTUSU (INBOX) FONKSƒ∞YONU ---
    // --- Sƒ∞LME BUTONLU GELEN KUTUSU (INBOX) ---
    function openInboxModal() {
        showModal('modal-inbox');
        const list = document.getElementById('inboxList');
        list.innerHTML = "<div style='text-align:center;'>Sohbetler taranƒ±yor...</div>";

        db.ref('users/' + user.name + '/last_msg').once('value').then(snap => {
            const lastMsg = snap.val();
            list.innerHTML = "";

            // 1. Son gelen mesaj varsa (En √ºstte g√∂ster)
            if (lastMsg && lastMsg.from) {
                const isUnread = !lastMsg.seen && lastMsg.from !== user.name;
                const badgeHtml = isUnread ? '<span style="color:red; font-weight:bold;">(1)</span>' : '';
                const bgColor = isUnread ? '#fff3cd' : '#fff';

                // Silme butonu eklendi (onclick event.stopPropagation √∂nemli!)
                list.innerHTML += `
                <div class="list-item" style="background:${bgColor}; cursor:pointer;" onclick="closeModal('modal-inbox'); openDM('${lastMsg.from}')">
                    <div style="display:flex; align-items:center; gap:10px;">
                        <div style="font-size:1.5rem;">üë§</div>
                        <div>
                            <div style="font-weight:bold;">${lastMsg.from} ${badgeHtml}</div>
                            <div style="font-size:0.7rem; color:#666;">Son mesaj...</div>
                        </div>
                    </div>
                    <div style="display:flex; gap:5px;">
                        <button class="btn-blue" style="width:auto; padding:5px;">A√á</button>
                        <button class="btn-red" style="width:auto; padding:5px 8px;" onclick="event.stopPropagation(); deleteConversation('${lastMsg.from}')">üóëÔ∏è</button>
                    </div>
                </div>`;
            }

            // 2. Diƒüer sohbet ge√ßmi≈üi
            db.ref('chats/private').once('value').then(chatSnap => {
                let hasChat = false;

                if (chatSnap.exists()) {
                    chatSnap.forEach(c => {
                        const key = c.key;
                        if (key.includes(user.name)) {
                            const parts = key.split('_');
                            const partner = parts[0] === user.name ? parts[1] : parts[0];

                            // Eƒüer zaten yukarƒ±da (lastMsg) g√∂sterdiysek tekrar ekleme
                            if (lastMsg && lastMsg.from === partner) return;

                            hasChat = true;

                            list.innerHTML += `
                            <div class="list-item" onclick="closeModal('modal-inbox'); openDM('${partner}')" style="cursor:pointer;">
                                <div style="display:flex; align-items:center; gap:10px;">
                                    <div style="font-size:1.5rem;">üë§</div>
                                    <div>
                                        <div style="font-weight:bold;">${partner}</div>
                                        <div style="font-size:0.7rem; color:#666;">Ge√ßmi≈ü sohbet</div>
                                    </div>
                                </div>
                                <div style="display:flex; gap:5px;">
                                    <button class="btn-grey" style="width:auto; padding:5px;">A√á</button>
                                    <button class="btn-red" style="width:auto; padding:5px 8px;" onclick="event.stopPropagation(); deleteConversation('${partner}')">üóëÔ∏è</button>
                                </div>
                            </div>`;
                        }
                    });
                }

                if (!hasChat && (!lastMsg || !lastMsg.from)) {
                    list.innerHTML = "<div style='text-align:center; padding:20px; color:#999;'>Hen√ºz sohbet yok.</div>";
                }
            });
        });
    }

    function openNewChatPrompt() {
        const target = prompt("Mesaj g√∂ndermek istediƒüin kullanƒ±cƒ±nƒ±n adƒ±:");
        if (target && target.trim() !== "") {
            // Kullanƒ±cƒ± var mƒ± kontrol et (Opsiyonel ama iyi olur)
            db.ref('users/' + target).once('value').then(s => {
                if (s.exists()) {
                    closeModal('modal-inbox');
                    openDM(target);
                } else {
                    showToast("B√∂yle bir kullanƒ±cƒ± bulunamadƒ±!");
                }
            });
        }
    }
    function deleteConversation(partner) {
        if (!confirm(partner + " ile olan t√ºm sohbet ge√ßmi≈üini silmek istiyor musun?")) return;

        // Sohbet ID'sini bul
        const chatID = [user.name, partner].sort().join('_');

        // 1. Veritabanƒ±ndan sohbeti sil
        db.ref('chats/private/' + chatID).remove().then(() => {

            // 2. Eƒüer bu ki≈üi 'son mesaj' (last_msg) kƒ±smƒ±ndaysa, orayƒ± da temizle
            db.ref('users/' + user.name + '/last_msg').once('value', snap => {
                const data = snap.val();
                if (data && data.from === partner) {
                    db.ref('users/' + user.name + '/last_msg').remove();
                }
            });

            showToast("Sohbet silindi.");
            // Listeyi yenilemek i√ßin gelen kutusunu tekrar y√ºkle
            openInboxModal();

        }).catch(err => {
            showToast("Hata: " + err.message);
        });
    }
    // --- ADMIN MESAJ TAKƒ∞P (SPY) Sƒ∞STEMƒ∞ ---

    function loadAdminSpy(type) {
        const list = document.getElementById('adminSpyList');
        list.innerHTML = "<div style='padding:10px; text-align:center;'>Veriler taranƒ±yor...</div>";

        // 1. KOLEKSƒ∞YON (GLOBAL) SOHBETƒ∞
        if (type === 'global') {
            db.ref('chats/collection_global').limitToLast(50).once('value').then(snap => {
                list.innerHTML = "";
                if (!snap.exists()) {
                    list.innerHTML = "<small style='padding:10px;'>Mesaj yok.</small>";
                    return;
                }

                // Mesajlarƒ± ters √ßevirip g√∂ster (En yeni en √ºstte)
                let msgs = [];
                snap.forEach(c => msgs.push({ key: c.key, ...c.val() }));
                msgs.reverse();

                msgs.forEach(m => {
                    const date = new Date(m.t).toLocaleTimeString('tr-TR');
                    list.innerHTML += `
                    <div style="padding:8px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <b style="color:#2980b9;">${m.u}</b> <span style="font-size:0.7rem; color:#999;">(${date})</span><br>
                            <span style="color:#333;">${m.m}</span>
                        </div>
                        <button class="btn-red" style="width:auto; padding:2px 8px; font-size:0.7rem;" onclick="adminDeleteMsg('chats/collection_global/${m.key}', 'global')">üóëÔ∏è</button>
                    </div>`;
                });
            });
        }

        // 2. √ñZEL MESAJLAR (DM)
        else if (type === 'private') {
            // √ñzel mesajlar "Kullanƒ±cƒ±A_Kullanƒ±cƒ±B" ≈üeklinde tutulur. √ñnce sohbet ba≈ülƒ±klarƒ±nƒ± listeleriz.
            db.ref('chats/private').limitToLast(50).once('value').then(snap => {
                list.innerHTML = "";
                if (!snap.exists()) {
                    list.innerHTML = "<small style='padding:10px;'>DM ge√ßmi≈üi yok.</small>";
                    return;
                }

                snap.forEach(c => {
                    const pair = c.key.replace('_', ' ‚ÜîÔ∏è '); // ƒ∞simleri ayƒ±r
                    list.innerHTML += `
                    <div style="padding:10px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center; background:#f9f9f9; margin-bottom:5px;">
                        <span style="font-weight:bold; color:#d35400;">${pair}</span>
                        <button class="btn-blue" style="width:auto; padding:4px 10px; font-size:0.75rem;" onclick="adminReadDM('${c.key}')">üëÄ OKU</button>
                    </div>`;
                });
            });
        }

        // 3. ODA SOHBETLERƒ∞ (Sadece Aktif Odalar)
        else if (type === 'rooms') {
            db.ref('rooms').once('value').then(snap => {
                list.innerHTML = "";
                let hasChat = false;

                snap.forEach(room => {
                    const rData = room.val();
                    // Eƒüer odada chat verisi varsa
                    if (rData.chat) {
                        hasChat = true;
                        // Odanƒ±n i√ßindeki mesajlarƒ± diziye √ßevir
                        const chatKeys = Object.keys(rData.chat);
                        const lastMsgKey = chatKeys[chatKeys.length - 1];
                        const lastMsg = rData.chat[lastMsgKey];

                        list.innerHTML += `
                        <div style="padding:8px; border-bottom:1px solid #eee; background:#f0f8ff; margin-bottom:5px;">
                            <div style="font-size:0.8rem; font-weight:bold; color:#2c3e50;">
                                Oda: ${room.key} (Son Mesaj)
                            </div>
                            <div style="font-size:0.85rem; margin-top:3px;">
                                <b>${lastMsg.u}:</b> ${lastMsg.m}
                            </div>
                            <button class="btn-purple" style="width:100%; margin-top:5px; padding:2px; font-size:0.7rem;" onclick="adminReadRoomChat('${room.key}')">T√úM√úN√ú G√ñR</button>
                        </div>`;
                    }
                });

                if (!hasChat) list.innerHTML = "<small style='padding:10px;'>Aktif oda sohbeti yok.</small>";
            });
        }
    }

    // DM ƒ∞√áERƒ∞ƒûƒ∞Nƒ∞ G√ñR√úNT√úLEME
    function adminReadDM(chatID) {
        const list = document.getElementById('adminSpyList');
        list.innerHTML = `<div style='padding:10px;'><button class="btn-grey" onclick="loadAdminSpy('private')">‚¨Ö Geri D√∂n</button><h4 style="margin:5px 0;">Sohbet Detayƒ±</h4></div>`;

        db.ref('chats/private/' + chatID).limitToLast(20).once('value').then(snap => {
            snap.forEach(c => {
                const m = c.val();
                list.innerHTML += `
                <div style="padding:5px 10px; border-bottom:1px solid #eee; font-size:0.85rem;">
                    <b>${m.from}:</b> ${m.text}
                    <button style="float:right; background:none; border:none; cursor:pointer;" onclick="adminDeleteMsg('chats/private/${chatID}/${c.key}', 'private', '${chatID}')">üóëÔ∏è</button>
                </div>`;
            });
        });
    }

    // ODA SOHBETƒ∞Nƒ∞ G√ñR√úNT√úLEME
    function adminReadRoomChat(roomID) {
        const list = document.getElementById('adminSpyList');
        list.innerHTML = `<div style='padding:10px;'><button class="btn-grey" onclick="loadAdminSpy('rooms')">‚¨Ö Geri D√∂n</button><h4 style="margin:5px 0;">Oda: ${roomID}</h4></div>`;

        db.ref('rooms/' + roomID + '/chat').limitToLast(20).once('value').then(snap => {
            snap.forEach(c => {
                const m = c.val();
                list.innerHTML += `
                <div style="padding:5px 10px; border-bottom:1px solid #eee; font-size:0.85rem;">
                    <b>${m.u}:</b> ${m.m}
                    <button style="float:right; background:none; border:none; cursor:pointer;" onclick="adminDeleteMsg('rooms/${roomID}/chat/${c.key}', 'rooms', '${roomID}')">üóëÔ∏è</button>
                </div>`;
            });
        });
    }

    // MESAJ Sƒ∞LME
    function adminDeleteMsg(path, returnType, extraID) {
        if (confirm("Bu mesaj kalƒ±cƒ± olarak silinsin mi?")) {
            db.ref(path).remove().then(() => {
                showToast("Mesaj silindi.");
                // Listeyi yenile
                if (returnType === 'global') loadAdminSpy('global');
                if (returnType === 'private') adminReadDM(extraID);
                if (returnType === 'rooms') adminReadRoomChat(extraID);
            });
        }
    }
    /* --- KARƒ∞YER (SAGA) Sƒ∞STEMƒ∞ - TAMƒ∞R EDƒ∞LMƒ∞≈û VERSƒ∞YON --- */



    // 1. SEVƒ∞YE AYARLARI
    const CAREER_LEVELS = {
        1: { diff: 3, rights: 15, times: [1, 3, 5], oracleLimit: 99, desc: "Ba≈ülangƒ±√ß: 3 Hane", icon: "üå±", reward: 500 },
        2: { diff: 4, rights: 15, times: [1, 3, 5], oracleLimit: 99, desc: "Isƒ±nma: 4 Hane", icon: "üî•", reward: 1000 },
        3: { diff: 5, rights: 20, times: [3, 5, 6], oracleLimit: 1, desc: "Zorlu: 5 Hane (Kahin x1)", icon: "‚öîÔ∏è", reward: 1500 },
        4: { diff: 6, rights: 20, times: [5, 7, 8], oracleLimit: 1, desc: "Uzman: 6 Hane (Kahin x1)", icon: "üß†", reward: 2000 },
        5: { diff: 7, rights: 25, times: [10], oracleLimit: 1, desc: "Fƒ∞NAL: 7 Hane (Kahin x1)", icon: "üèÜ", reward: 5000 }
    };

    let selectedCareerLvl = 1;

    // 2. HARƒ∞TAYI A√áAN FONKSƒ∞YON (10 GALƒ∞Bƒ∞YET G√ñSTERGELƒ∞)
    function openCareerMap() {
        showModal('modal-career');
        const container = document.getElementById('careerMapContent');

        // Y√ºkleniyor ekranƒ±
        container.innerHTML = `<div style="text-align:center; padding:50px; color:#666;">Harita Y√ºkleniyor...<br><small>Veriler alƒ±nƒ±yor</small></div>`;
        container.className = "career-container";

        // Veritabanƒ± okumasƒ±
        db.ref('users').once('value')
            .then(snapshot => {
                drawMapWithUsers(container, snapshot.val() || {});
            })
            .catch(error => {
                console.error("Harita verisi alƒ±namadƒ±:", error);
                drawMapWithUsers(container, {});
            });
    }

    function drawMapWithUsers(container, allUsers) {
        // Kullanƒ±cƒ±larƒ± seviyelerine g√∂re grupla
        const levelsData = { 1: [], 2: [], 3: [], 4: [], 5: [] };

        if (allUsers) {
            Object.keys(allUsers).forEach(username => {
                const uData = allUsers[username];
                const lvl = uData.careerLevel || 1;
                if (levelsData[lvl]) {
                    levelsData[lvl].push(username);
                }
            });
        }

        container.innerHTML = `<div class="career-bg-decoration"></div>`;
        const currentLvl = user.careerLevel || 1;
        const currentWins = user.careerWins || 0; // Mevcut galibiyet sayƒ±sƒ±

        for (let i = 1; i <= 5; i++) {
            const config = CAREER_LEVELS[i];
            let statusClass = "locked";
            let content = `<span style="font-size:1.5rem;">üîí</span>`;
            let clickAction = "";
            let progressBadge = ""; // ƒ∞lerleme rozeti

            // DURUM BELƒ∞RLEME
            if (i < currentLvl) {
                statusClass = "completed";
                content = config.icon;
                clickAction = `openCareerLevelSetup(${i})`;
            } else if (i === currentLvl) {
                statusClass = "current";
                // Aktif seviyede Avatar ve ƒ∞lerleme Durumu (√ñrn: 3/10)
                content = `<div style="width:40px; height:40px; border-radius:50%; overflow:hidden; border:2px solid white; box-shadow:0 2px 5px rgba(0,0,0,0.5);">
                        ${user.avatar.includes('http') ? `<img src="${user.avatar}" style="width:100%;">` : user.avatar}
                       </div>`;


                // Buraya ilerleme durumunu ekliyoruz
                progressBadge = `<div style="position:absolute; bottom:-12px; background:#fff; color:#d35400; font-size:0.65rem; padding:2px 8px; border-radius:10px; border:1px solid #e67e22; font-weight:bold; white-space:nowrap; box-shadow:0 2px 4px rgba(0,0,0,0.1);">${currentWins}/10</div>`;

                clickAction = `openCareerLevelSetup(${i})`;
            } else {
                content = `<span style="opacity:0.5; font-size:1.5rem;">${config.icon}</span>`;
            }

            // KONUMLANDIRMA (Zikzak)
            let positionStyle = "";
            let rivalsClass = "rivals-right";

            if (i === 2) { positionStyle = "transform: translateX(-60px);"; rivalsClass = "rivals-right"; }
            else if (i === 4) { positionStyle = "transform: translateX(60px);"; rivalsClass = "rivals-left"; }

            // YOL √áƒ∞ZGƒ∞Sƒ∞
            let pathSVG = "";
            if (i < 5) {
                const dashColor = (i < currentLvl) ? "#fff" : "rgba(0,0,0,0.2)";
                let pathD = "M 50 100 Q 50 50 50 0";
                let svgStyle = `position:absolute; bottom:50px; left:50%; transform:translateX(-50%); width:100px; height:100px; z-index:-1; pointer-events:none;`;

                if (i === 1) { pathD = "M 50 90 Q 50 50 20 10"; svgStyle += "transform: translateX(-80%) scaleX(1);"; }
                else if (i === 2) { pathD = "M 20 90 Q 50 50 50 10"; svgStyle += "transform: translateX(-20%) scaleX(1);"; }
                else if (i === 3) { pathD = "M 50 90 Q 50 50 80 10"; svgStyle += "transform: translateX(-20%) scaleX(1);"; }
                else if (i === 4) { pathD = "M 80 90 Q 50 50 50 10"; svgStyle += "transform: translateX(-80%) scaleX(1);"; }

                pathSVG = `<svg style="${svgStyle}" viewBox="0 0 100 100" fill="none"><path d="${pathD}" stroke="${dashColor}" stroke-width="6" stroke-dasharray="8 8" stroke-linecap="round" /></svg>`;
            }

            // RAKƒ∞P Lƒ∞STESƒ∞
            let playersHTML = "";
            const playersHere = levelsData[i] || [];
            const filteredPlayers = playersHere.filter(p => p !== user.name);

            if (filteredPlayers.length > 0) {
                const showLimit = 3;
                const visibleNames = filteredPlayers.slice(0, showLimit).join('<br>');
                const remaining = filteredPlayers.length - showLimit;
                let extraText = remaining > 0 ? `<span style="color:#999;">+${remaining} ki≈üi</span>` : "";

                playersHTML = `
            <div class="career-rivals ${rivalsClass}">
                <b>Buradakiler</b>
                ${visibleNames}
                ${extraText}
            </div>`;
            }

            // √ñD√úL SANDIƒûI MANTIƒûI
            const claimedRewards = user.claimedCareerRewards || {};
            const isClaimed = claimedRewards[i] === true;
            const canClaim = (i < currentLvl) || (i === currentLvl && currentWins >= 10);

            let chestHtml = "";
            if (config.reward) {
                let chestClass = "career-chest";
                if (isClaimed) chestClass += " claimed";
                else if (canClaim) chestClass += " claimable";

                chestHtml = `
                    <div class="${chestClass}" onclick="event.stopPropagation(); claimCareerReward(${i})">
                        üéÅ
                        <div class="chest-reward-badge">${config.reward} üí∞</div>
                    </div>
                `;
            }

            const html = `
        <div class="career-step" style="${positionStyle}">
            ${pathSVG}
            <div class="career-node ${statusClass}" onclick="${clickAction}">
                ${content}
                ${progressBadge}
                <div class="career-label">${config.diff} Hane</div>
                ${chestHtml}
            </div>
            ${playersHTML}
        </div>`;

            container.innerHTML += html;
        }
    }

    // 3. SEVƒ∞YE DETAY PENCERESƒ∞
    function openCareerLevelSetup(lvl) {
        selectedCareerLvl = lvl;
        const config = CAREER_LEVELS[lvl];

        showModal('careerLevelSetupModal');
        document.getElementById('careerLevelTitle').innerText = "SEVƒ∞YE " + lvl;
        document.getElementById('careerLevelDesc').innerText = config.desc;

        if (config.oracleLimit === 1) {
            document.getElementById('careerRestrictionText').innerText = "‚ö†Ô∏è Dƒ∞KKAT: Kahin Sadece 1 Kez Kullanƒ±labilir!";
        } else {
            document.getElementById('careerRestrictionText').innerText = "‚úÖ Kƒ±sƒ±tlama Yok";
        }

        const timeSelect = document.getElementById('careerTimeSelect');
        timeSelect.innerHTML = "";
        config.times.forEach(t => {
            const opt = document.createElement('option');
            opt.value = t;
            opt.innerText = t + " Dakika";
            timeSelect.appendChild(opt);
        });

        document.getElementById('careerModeSelect').value = "classic";
        toggleCareerTimeSelect();
    }

    // 4. MOD SE√áƒ∞Mƒ∞
    function toggleCareerTimeSelect() {
        const mode = document.getElementById('careerModeSelect').value;
        document.getElementById('careerTimeDiv').style.display = (mode === 'timed') ? 'block' : 'none';
    }

    // --- KARƒ∞YER √ñD√úL TOPLAMA ---
    function claimCareerReward(lvl) {
        if (!user || !user.name) return;

        const config = CAREER_LEVELS[lvl];
        if (!config || !config.reward) return;

        const currentLvl = user.careerLevel || 1;
        const currentWins = user.careerWins || 0;
        const claimedRewards = user.claimedCareerRewards || {};

        // 1. Zaten alƒ±nmƒ±≈ü mƒ±?
        if (claimedRewards[lvl]) {
            return showToast("Bu √∂d√ºl√º zaten aldƒ±n!");
        }

        // 2. Almaya hak kazanmƒ±≈ü mƒ±?
        const canClaim = (lvl < currentLvl) || (lvl === currentLvl && currentWins >= 10);
        if (!canClaim) {
            return showToast("√ñd√ºl√º almak i√ßin bu seviyeyi tamamlamalƒ±sƒ±n!");
        }

        // 3. √ñd√ºl√º Ver
        if (!confirm(`Tebrikler! ${config.reward} Altƒ±n √∂d√ºl√ºn√º almak istiyor musun?`)) return;

        claimedRewards[lvl] = true;
        user.claimedCareerRewards = claimedRewards;

        // Veritabanƒ±nƒ± G√ºncelle
        db.ref('users/' + user.name).update({
            claimedCareerRewards: claimedRewards
        }).then(() => {
            updateGold(config.reward);
            showToast(`üéÅ ${config.reward} Altƒ±n Hesabƒ±na Eklendi!`);
            AudioEngine.win();
            safeConfetti();

            // Haritayƒ± Yenile
            openCareerMap();
        });
    }

    // 5. OYUNU BA≈ûLATAN ANA FONKSƒ∞YON
    function launchCareerGame() {
        launchCareerGameActual();
    }

    function launchCareerGameActual() {
        const lvl = selectedCareerLvl;
        const config = CAREER_LEVELS[lvl];
        const modeType = document.getElementById('careerModeSelect').value;

        game.active = true;
        game.mode = "career";
        game.careerLvlIdx = lvl;
        game.diff = config.diff;
        game.secret = generateNumber(game.diff);
        game.type = modeType;
        game.oracleUsedCount = 0;
        game.oracleMax = config.oracleLimit;
        game.currentMoves = [];
        game.startTime = Date.now();
        game.usedItems = [];

        if (modeType === 'classic') {
            game.rights = config.rights;
            document.getElementById('rightsDisplay').style.display = 'block';
            document.getElementById('rightsDisplay').innerText = "Hak: " + game.rights;
            document.getElementById('timerDisplay').style.display = 'none';
        } else {
            game.duration = parseInt(document.getElementById('careerTimeSelect').value);
            game.rights = 999;
            document.getElementById('rightsDisplay').style.display = 'none';
            document.getElementById('timerDisplay').style.display = 'block';
            startTimerLoop();
        }

        document.getElementById('p1Indicator').innerText = "Kariyer";
        document.getElementById('p2Indicator').innerText = "Hedef";
        resetUI();
        closeModal('careerLevelSetupModal');
        closeModal('modal-career');
        changeScreen('screen-game');
        updateTurnUI('p1');
        updateLobbyUI();
    }
    /* --- KARƒ∞YER Sƒ∞STEMƒ∞ SONU --- */
    // --- T√úM KULLANICILARIN KARƒ∞YERƒ∞Nƒ∞ SIFIRLA (ADMƒ∞N) ---
    function adminResetAllCareer() {
        // 1. G√ºvenlik Onayƒ±
        const onay = prompt("T√ºm kullanƒ±cƒ±larƒ±n kariyerini SIFIRLAMAK √ºzeresin.\nBu i≈ülem geri alƒ±namaz!\n\nOnaylamak i√ßin 'SIFIRLA' yaz:");
        if (onay !== "SIFIRLA") return showToast("ƒ∞≈ülem iptal edildi.");

        showToast("Sƒ±fƒ±rlama i≈ülemi ba≈üladƒ±... L√ºtfen bekleyin.");

        db.ref('users').once('value').then(snapshot => {
            if (!snapshot.exists()) {
                showToast("Veritabanƒ±nda kullanƒ±cƒ± bulunamadƒ±.");
                return;
            }

            const updates = {};
            let count = 0;

            snapshot.forEach(child => {
                const userKey = child.key;

                // Her kullanƒ±cƒ± i√ßin sƒ±fƒ±rlama komutunu hazƒ±rlƒ±yoruz
                updates['users/' + userKey + '/careerLevel'] = 1;
                updates['users/' + userKey + '/careerWins'] = 0;

                count++;
            });

            // Veritabanƒ±na tek seferde g√∂nder
            db.ref().update(updates)
                .then(() => {
                    // BA≈ûARILI
                    showToast(`‚úÖ ƒ∞≈ûLEM TAMAM: ${count} Kullanƒ±cƒ± Sƒ±fƒ±rlandƒ±!`);
                    AudioEngine.success();

                    // 2. Kendi ekranƒ±nƒ± hemen g√ºncelle (F5 atmaya gerek kalmasƒ±n)
                    user.careerLevel = 1;
                    user.careerWins = 0;

                    // 3. Tarayƒ±cƒ± hafƒ±zasƒ±nƒ± da temizle (Eski veri kalmasƒ±n)
                    localStorage.setItem("careerLevel", 1);

                    updateLobbyUI();
                })
                .catch(error => {
                    // HATA DURUMU              console.error("Sƒ±fƒ±rlama Hatasƒ±:", error);
                    alert("Hata olu≈ütu: " + error.message);
                });
        });
    }

    function adminResetWordCareer() {
        if (!confirm("‚ö†Ô∏è T√úM Kelime Kariyer ilerlemelerini SIFIRLAMAK √ºzeresin. Onaylƒ±yor musun?")) return;

        showToast("Sƒ±fƒ±rlanƒ±yor...");
        db.ref('users').once('value').then(snap => {
            const updates = {};
            snap.forEach(c => {
                const k = c.key;
                updates['users/' + k + '/wordLevel'] = 1;
                updates['users/' + k + '/wordCareerWins'] = 0;
                updates['users/' + k + '/claimedWordRewards'] = null; // Clear rewards too
            });

            db.ref().update(updates).then(() => {
                showToast("‚úÖ Kelime Kariyeri Sƒ±fƒ±rlandƒ±!");
                user.wordLevel = 1;
                user.wordCareerWins = 0;
                user.claimedWordRewards = {};
                updateLobbyUI();
            });
        });
    }



    // --- OYUN HAKKINDA METNƒ∞ Y√ñNETƒ∞Mƒ∞ ---
    

    function loadAboutText() {
        // ƒ∞stemci tarafƒ±: Metni √ßek ve g√∂ster
        db.ref('settings/aboutText').once('value').then(snap => {
            const txt = snap.val();
            const container = document.getElementById('aboutContent');
            if (container) {
                container.innerHTML = txt || "Hen√ºz bir a√ßƒ±klama metni girilmemi≈ü.";
            }

            // Eƒüer Admin panelindeysek inputu da doldur
            const input = document.getElementById('adminAboutInput');
            if (input && input.offsetParent !== null) { // G√∂r√ºn√ºrse
                input.value = txt || "";
            }
        });
    }

    // --- ANDROID UYGULAMA ƒ∞√áƒ∞N EKRAN Y√ñN√ú Kƒ∞Lƒ∞TLEME ---
    window.addEventListener('load', () => {
        // 1. Mobil cihaz tespiti: Sadece mobilde dikey zorlamayƒ± aktif et
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        if (isMobile) {
            document.body.classList.add('mobile-app');
        }

        // BEYAZ EKRAN √á√ñZ√úM√ú: Y√ºkleme bitince hidden sƒ±nƒ±fƒ±nƒ± kaldƒ±r
        document.body.classList.remove('hidden');

        // 2. Ekran Kilitleme API'si (Varsa)
        try {
            if (screen.orientation && screen.orientation.lock) {
                screen.orientation.lock("portrait").catch(e => {
                    console.log("Orientation lock info: ", e);
                });
            }
        } catch (e) {
            console.log("Orientation lock error: ", e);
        }
    });

    // --- PET SYSTEM ENTRY (SAFE) ---
    // Some builds may not include the full Pet system. This prevents UI buttons from crashing the game.
    function openPetModalSafe() {
        // Redirect to Profile V2 (with user's own profile)
        if (!user || !user.name) {
            // Fallback if user not loaded
            if (typeof window.showModal === 'function' && document.getElementById('modal-pet')) {
                window.showModal('modal-pet');
            } else {
                alert('Profil y√ºklenemedi.');
            }
            return;
        }

        if (typeof openUserProfile === 'function') {
            openUserProfile(user.name);

            // Auto-expand pet section after a short delay to ensure modal is open
            setTimeout(() => {
                const petSection = document.getElementById('profilePetSection');
                const list = document.getElementById('profilePetListContainer');
                const btn = document.getElementById('btnTogglePetList');

                if (petSection) petSection.scrollIntoView({ behavior: 'smooth' });
                if (list && list.style.display === 'none') {
                    list.style.display = 'grid';
                    if (btn) btn.innerText = 'Gƒ∞ZLE ‚ñ≤';
                    if (typeof PetSystem !== 'undefined') PetSystem.renderPetList();
                }
            }, 300);
        } else {
            // Fallback if function missing
            if (typeof window.showModal === 'function' && document.getElementById('modal-pet')) {
                window.showModal('modal-pet');
            }
        }
    }
    window.openPetModalSafe = openPetModalSafe;


    // --- LIFELINE & WIN STREAK IMPLEMENTATION ---
    function offerLifeline(type) {
        if (game.lifelineUsed) return;

        // Setup Modal
        const msg = document.getElementById('lifelineMsg');
        const title = document.getElementById('lifelineTitle');
        if (document.getElementById('lifelineEmoji')) document.getElementById('lifelineEmoji').innerText = "ƒü≈∏¬¶‚Äû";
        if (title) title.innerText = "SON √Ö¬ûANS!";

        if (type === 'time') {
            msg.innerText = "S√É¬ºre bitti! Reklam izleyerek +30 saniye kazanmak ister misin?";
        } else {
            msg.innerText = "Haklar√Ñ¬±n bitti! Reklam izleyerek +4 hak kazanmak ister misin?";
        }

        window.currentLifelineAction = function () {
            // NativeAdManager might not be defined if ad system is missing, check it
            if (typeof AdManager !== 'undefined') {
                AdManager.showRewardedAd(() => {
                    game.lifelineUsed = true;
                    closeModal('modal-lifeline');
                    if (type === 'time') {
                        game.startTime += 30000;
                        startTimerLoop();
                        showToast("+30 Saniye Eklendi!");
                    } else {
                        game.rights += 4;
                        document.getElementById('rightsDisplay').innerText = "Hak: " + game.rights;
                        updateTurnUI('p1');
                        showToast("+4 Hak Eklendi!");
                    }
                });
            } else {
                // Mock for web testing if needed
                // alert("Reklam (Mock): +√É‚Äìd√É¬ºl verildi.");
                game.lifelineUsed = true;
                closeModal('modal-lifeline');
                if (type === 'time') { game.startTime += 30000; startTimerLoop(); }
                else { game.rights += 4; updateTurnUI('p1'); }
                showToast("Mock Ad Success");
            }
        };
        showModal('modal-lifeline');
    }

    function handleWinStreak() {
        user.winStreak = (user.winStreak || 0) + 1;
        // Save to DB
        if (user.name && typeof db !== 'undefined') {
            db.ref('users/' + user.name).update({ winStreak: user.winStreak });
        }

        // 3 consecutive wins check
        if (user.winStreak > 0 && user.winStreak % 3 === 0) {
            updateGold(1000);
            showToast("ƒü≈∏‚Äù¬• 3 SER√Ñ¬∞ GAL√Ñ¬∞B√Ñ¬∞YET: +1000 ALTIN KAZANDIN!");
            safeConfetti(); try { if (typeof AudioEngine !== 'undefined') AudioEngine.win(); } catch (e) { }
        }
    }

    function openBountyScreen() {
        changeScreen('screen-bounty');
        switchBountyTab('list');
        loadBounties();
    }

    function switchBountyTab(tab) {
        const listArea = document.getElementById('bountyListArea');
        const createArea = document.getElementById('bountyCreateArea');
        const btnList = document.getElementById('tabBountyList');
        const btnCreate = document.getElementById('tabBountyCreate');

        if (tab === 'list') {
            listArea.style.display = 'block';
            createArea.style.display = 'none';
            btnList.className = 'btn-blue';
            btnCreate.className = 'btn-grey';
            loadBounties();
        } else {
            listArea.style.display = 'none';
            createArea.style.display = 'block';
            btnList.className = 'btn-grey';
            btnCreate.className = 'btn-blue';
        }
    }

    function updateBountyInputRules(val) {
        const input = document.getElementById('bountySecretInput');
        input.maxLength = val;
        input.placeholder = val + " Rakam";
        input.value = "";
    }

    function postBounty() {
        const diff = parseInt(document.getElementById('bountyDiffSelect').value);
        const secret = document.getElementById('bountySecretInput').value.trim();
        const reward = parseInt(document.getElementById('bountyRewardInput').value);

        if (!secret.match(/^[0-9]+$/)) return showToast("Sadece rakam girmelisin!");
        if (secret.length !== diff) return showToast(`Sayƒ± tam ${diff} haneli olmalƒ±!`);
        if (new Set(secret).size !== diff) return showToast("Rakamlar birbirinden farklƒ± olmalƒ±!");

        let minReward = 100;
        if (diff === 5) minReward = 250;
        if (diff === 6) minReward = 500;
        if (diff === 7) minReward = 1000;

        if (!reward || reward < minReward) return showToast(`Bu zorluk i√ßin en az ${minReward} Altƒ±n koymalƒ±sƒ±n!`);
        if (user.gold < reward) return showToast("Yetersiz Altƒ±n!");

        if (!confirm(`${reward} Altƒ±n √∂d√ºll√º ilan yayƒ±nlanacak. Onaylƒ±yor musun?`)) return;

        updateGold(-reward);

        db.ref('bounties').push({
            owner: user.name,
            secret: secret,
            reward: reward,
            diff: diff,
            avatar: user.avatar,
            timestamp: firebase.database.ServerValue.TIMESTAMP
        }, (error) => {
            if (!error) {
                showToast("ƒ∞lan Ba≈üarƒ±yla Yayƒ±nlandƒ±! ü§†");
                document.getElementById('bountySecretInput').value = "";
                document.getElementById('bountyRewardInput').value = "";
                switchBountyTab('list');
                AudioEngine.success();
            } else {
                showToast("Hata olu≈ütu: " + error.message);
                updateGold(reward);
            }
        });
    }

    function loadBounties() {
        const container = document.getElementById('bountyListContainer');
        container.innerHTML = "<div style='text-align:center; padding:20px;'>Veriler √ßekiliyor...</div>";

        db.ref('bounties').off();
        db.ref('bounties').on('value', snap => {
            container.innerHTML = "";
            if (!snap.exists()) {
                container.innerHTML = `
                <div style='padding:30px; text-align:center; opacity:0.7;'>
                    <div style='font-size:3rem;'>üåµ</div>
                    <p>Hen√ºz a√ßƒ±k bir ilan yok.<br>ƒ∞lk ilanƒ± sen ver!</p>
                </div>`;
                return;
            }

            const bounties = [];
            snap.forEach(child => {
                bounties.push({ key: child.key, ...child.val() });
            });
            bounties.sort((a, b) => b.reward - a.reward);

            bounties.forEach(b => {
                const isMine = b.owner === user.name;
                const entryFee = Math.floor(b.reward * 0.1);
                const difficulty = b.diff || 4;
                let ownerAvatarContent = b.avatar || "üë§";
                if (ownerAvatarContent.includes('http')) {
                    ownerAvatarContent = `<img src="${ownerAvatarContent}" style="width:100%; height:100%; object-fit:cover; border-radius:50%;">`;
                }
                let stars = "‚≠ê".repeat(difficulty - 3);

                let actionBtn = "";
                if (isMine) {
                    actionBtn = `<button class="btn-red" style="width:auto; padding:8px 12px; font-size:0.75rem; border-radius:8px;" onclick="cancelBounty('${b.key}', ${b.reward})">ƒ∞PTAL ET</button>`;
                } else {
                    actionBtn = `<button class="btn-green" style="width:auto; padding:8px 12px; font-size:0.8rem; border-radius:8px; box-shadow:0 4px 0 #218c74;" onclick="attemptBounty('${b.key}', '${b.owner}', '${b.secret}', ${b.reward}, ${difficulty})">AVLA (${entryFee}üí∞)</button>`;
                }

                const html = `
            <div class="card" style="margin:8px 0; padding:12px; display:flex; justify-content:space-between; align-items:center; border-left:5px solid #d35400; background:#fff;">
                <div style="display:flex; align-items:center; gap:10px;">
                    <div style="font-size:1.5rem; background:#eee; width:45px; height:45px; min-width:45px; display:flex; align-items:center; justify-content:center; border-radius:50%; overflow:hidden; border:2px solid #ddd;">
                        ${ownerAvatarContent}
                    </div>
                    <div>
                        <div style="font-weight:bold; color:#d35400; font-size:1rem;">ü§† ${b.reward} Altƒ±n</div>
                        <div style="font-size:0.75rem; color:#444; font-weight:bold;">${b.owner} <span style="color:#999; font-weight:normal;">arƒ±yor...</span></div>
                        <div style="font-size:0.7rem; color:#666; margin-top:2px;">Zorluk: ${difficulty} Hane ${stars}</div>
                    </div>
                </div>
                <div style="text-align:right;">
                    ${actionBtn}
                </div>
            </div> `;
                container.innerHTML += html;
            });
        });
    }

    function cancelBounty(key, reward) {
        if (confirm("ƒ∞lanƒ± kaldƒ±rmak istiyor musun? Altƒ±nƒ±n iade edilecek.")) {
            db.ref('bounties/' + key).remove();
            updateGold(reward);
            showToast("ƒ∞lan kaldƒ±rƒ±ldƒ± ve altƒ±n iade edildi.");
        }
    }

    function attemptBounty(key, owner, secret, reward, diff) {
        const entryFee = Math.floor(reward * 0.1);

        if (user.gold < entryFee) return showToast(`Giri≈ü √ºcreti (${entryFee} Altƒ±n) i√ßin paran yetersiz!`);

        if (confirm(`${entryFee} Altƒ±n giri≈ü √ºcreti √∂deyip bu avƒ± ba≈ülatmak istiyor musun?\n\n√ñd√ºl: ${reward} Altƒ±n\nZorluk: ${diff} Hane`)) {
            updateGold(-entryFee);

            game.active = true;
            game.mode = "bounty";
            game.bountyId = key;
            game.bountyOwner = owner;
            game.bountyPrize = reward;
            game.secret = secret.toString();
            game.diff = parseInt(diff);

            if (game.diff === 4) game.rights = 10;
            else if (game.diff === 5) game.rights = 15;
            else if (game.diff === 6) game.rights = 20;
            else game.rights = 25;

            game.startTime = Date.now();
            game.usedItems = [];

            resetUI();
            changeScreen('screen-game');

            document.getElementById('p1Indicator').innerText = "AVCI";
            document.getElementById('p2Indicator').innerText = "HEDEF";
            document.getElementById('p2Indicator').className = "turn-indicator turn-wait";

            document.getElementById('rightsDisplay').style.display = 'block';
            document.getElementById('rightsDisplay').innerText = "Hak: " + game.rights;
            document.getElementById('timerDisplay').style.display = 'none';

            updateTurnUI('p1');
            showToast("ü§† AV BA≈ûLADI! ƒ∞Yƒ∞ ≈ûANSLAR...");
            AudioEngine.notification();
        }
    }

    function closePiggyAndReplay() {
        requestRematch();
    }

    function closePiggyAndExit() {
        const overlay = document.getElementById('piggyWinOverlay');
        if(overlay) {
            overlay.classList.remove('show');
            setTimeout(() => { overlay.style.display = 'none'; }, 500);
        }
        changeScreen('screen-lobby');
    }

    function playCpuTurn() {
        if (!game.active) return;

        const diff = game.diff;
        const history = game.aiHistory || [];

        // AI Guess
        const guess = CpuAI.getGuess(diff, history);

        // Score against Player Secret
        const score = getScore(game.playerSecret, guess);

        // Add to history (UI)
        // Add to history list manually or use addHistory?
        // addHistory uses 'his-me' / 'his-other' based on logic.
        // I need to update addHistory to handle AI?
        // Or just force it.

        // Let's create a custom list item for AI to ensure it's on the left.
        const li = document.createElement('li');
        li.className = "his-other"; // AI is "other"
        li.innerHTML = `<span class="his-badge">${guess}</span>
        <div class="his-score">
            <span style="color:#2ed573">+${score.p}</span>
            <span style="color:#ff4757">-${score.m}</span>
        </div>`;
        document.getElementById('history').prepend(li);

        // Save to AI history for next turn logic
        game.aiHistory.push({ g: guess, p: score.p, m: score.m });

        // Check Win
        if (score.p === diff) {
            game.active = false;
            stopTimer();
            showToast("üíª Bilgisayar Kazandƒ±! Sayƒ±sƒ±: " + game.secret);
            endGameLocal('lose', 0); // Player lost
        } else {
            // Turn back to Player
            document.getElementById('btnGuess').disabled = false;
            document.getElementById('p1Indicator').className = "turn-indicator turn-active";
            document.getElementById('p2Indicator').className = "turn-indicator turn-wait";
            document.getElementById('guessInput').focus();
        }
    }

    // --- KELƒ∞ME OYUNU MANTIƒûI ---
    function startWordGame() {
        // Load user level
        const lvl = user.wordLevel || 1;
        const config = WORD_DATA[lvl] || WORD_DATA[Object.keys(WORD_DATA).length]; // Fallback to max

        // Pick random word
        const pool = config.words;
        const secret = pool[Math.floor(Math.random() * pool.length)];

        wordGameState = {
            active: true,
            secret: secret,
            length: config.length,
            guesses: [],
            maxGuesses: 6,
            currentGuess: "",
            level: lvl
        };

        changeScreen('screen-word-game');
        renderWordBoard();
        updateWordKeyboard();

        document.getElementById('wordLevelDisplay').innerText = `Seviye ${lvl} - ${config.length} Harf`;
    }

    function handleWordKey(key) {
        if (!wordGameState.active) return;

        if (key === 'ENTER') {
            submitWordGuess();
        } else if (key === 'DEL') {
            wordGameState.currentGuess = wordGameState.currentGuess.slice(0, -1);
            renderWordBoard();
        } else {
            if (wordGameState.currentGuess.length < wordGameState.length) {
                wordGameState.currentGuess += key;
                renderWordBoard();
                AudioEngine.click();
            }
        }
    }

    function submitWordGuess() {
        const guess = wordGameState.currentGuess.toUpperCase();
        const secret = wordGameState.secret.toUpperCase();

        if (guess.length !== wordGameState.length) {
            return showToast(`Eksik harf! Kelime ${wordGameState.length} harfli olmalƒ±.`);
        }

        wordGameState.guesses.push(guess);
        wordGameState.currentGuess = "";

        renderWordBoard();
        updateWordKeyboard();
        AudioEngine.notification();

        // Check Win - G√ú√áLENDƒ∞Rƒ∞LMƒ∞≈û KONTROL
        const isWin = guess === secret;
        const isGameOver = wordGameState.guesses.length >= wordGameState.maxGuesses;

        if (isWin) {
            wordGameState.active = false;
            stopWordTimer();
            // Kazanma bildirimini hemen g√∂ster
            setTimeout(() => {
                showToast('üéâ TEBRƒ∞KLER! Kelimeyi Buldun!');
                AudioEngine.win();
                safeConfetti();
            }, 300);
            // Sonra ana kazanma fonksiyonunu √ßaƒüƒ±r
            setTimeout(() => {
                handleWordGameWin();
            }, 1500);
        } else if (isGameOver) {
            wordGameState.active = false;
            stopWordTimer();
            AudioEngine.error();

            // Seriyi Sƒ±fƒ±rla
            if (user.name) {
                user.winStreak = 0;
                db.ref('users/' + user.name).update({ winStreak: 0 });
            }

            setTimeout(() => {
                document.getElementById('endTitle').innerText = 'KAYBETTƒ∞N';
                document.getElementById('endTitle').style.color = "#e74c3c";
                document.getElementById('endMsg').innerText = "Maalesef bilemedin! Kelime: " + wordGameState.secret;
                document.getElementById('endButtons').style.display = 'flex';
                showModal('modal-end');
            }, 500);
        }

        // PvC & Online Logic (Preserved)
        if (wordGameState.mode === 'pvc' && wordGameState.active) {
            setTimeout(() => {
                if(!wordGameState.active) return;
                const lvl = wordGameState.level;
                const data = WORD_DATA[lvl] || WORD_DATA[1];
                const pool = data.words;
                const aiGuess = pool[Math.floor(Math.random() * pool.length)];

                wordGameState.aiGuesses.push(aiGuess);

                if (aiGuess === wordGameState.secret) {
                    wordGameState.active = false;
                    AudioEngine.error();
                    showToast("üíª Bilgisayar Kelimeyi Buldu: " + wordGameState.secret);
                    setTimeout(() => {
                        document.getElementById('endTitle').innerText = 'Bƒ∞LGƒ∞SAYAR KAZANDI! ü§ñ';
                        document.getElementById('endTitle').style.color = "#e74c3c";
                        document.getElementById('endMsg').innerText = "Kelime: " + wordGameState.secret;
                        document.getElementById('endButtons').style.display = 'flex';
                        showModal('modal-end');
                    }, 1000);
                } else {
                    showToast(`ü§ñ Bilgisayar Tahmini: ${aiGuess}`);
                }
            }, 1500);
        }
    }

    function renderWordBoard() {
        const board = document.getElementById('wordGameBoard');
        if (!board) return;

        board.innerHTML = "";
        board.style.gridTemplateColumns = `repeat(${wordGameState.length}, 1fr)`;

        // Render past guesses
        wordGameState.guesses.forEach((guess, guessIndex) => {
            const guessUpper = guess.toUpperCase();
            const secretUpper = wordGameState.secret.toUpperCase();

            for (let i = 0; i < guessUpper.length; i++) {
                const letter = guessUpper[i];
                let status = 'absent'; // grey

                if (letter === secretUpper[i]) status = 'correct'; // green
                else if (secretUpper.includes(letter)) status = 'present'; // yellow

                const cell = document.createElement('div');
                cell.className = `word-cell ${status}`;
                cell.innerText = letter;

                // Animasyon ekle (son tahmin i√ßin)
                if (guessIndex === wordGameState.guesses.length - 1) {
                    cell.style.animation = `popIn 0.3s ease ${i * 0.1}s both`;
                }

                board.appendChild(cell);
            }
        });

        // Animasyon stilleri ekle
        if (!document.getElementById('wordBoardAnimations')) {
            const animStyle = document.createElement('style');
            animStyle.id = 'wordBoardAnimations';
            animStyle.textContent = `
                @keyframes popIn {
                    0% { transform: scale(0); opacity: 0; }
                    70% { transform: scale(1.1); }
                    100% { transform: scale(1); opacity: 1; }
                }
            `;
            document.head.appendChild(animStyle);
        }

        // Render current guess (active row)
        if (wordGameState.active) {
            const current = wordGameState.currentGuess.padEnd(wordGameState.length, ' ');
            for (let i = 0; i < current.length; i++) {
                const letter = current[i];
                const cell = document.createElement('div');
                cell.className = "word-cell active";
                if(letter !== ' ') cell.classList.add('filled');
                cell.innerText = letter;
                board.appendChild(cell);
            }

            // Render empty rows
            const remaining = 0; // Hiding future rows per user request
            for (let r = 0; r < remaining; r++) {
                for (let c = 0; c < wordGameState.length; c++) {
                    const cell = document.createElement('div');
                    cell.className = "word-cell empty";
                    board.appendChild(cell);
                }


           }
        }

        setTimeout(() => { const c = document.getElementById('wordGameBoardContainer'); if(c) c.scrollTop = c.scrollHeight; }, 50);
    }

    function updateWordKeyboard() {
        // Update keyboard colors based on guesses
        // Map: Letter -> Status (priority: correct > present > absent)

        const statusMap = {};

        wordGameState.guesses.forEach(guess => {
            for (let i = 0; i < guess.length; i++) {
                const letter = guess[i];
                const secret = wordGameState.secret;
                let status = 'absent';
                if (letter === secret[i]) status = 'correct';
                else if (secret.includes(letter)) status = 'present';

                // Update map if status is higher priority
                const current = statusMap[letter];
                if (!current) statusMap[letter] = status;
                else if (current === 'absent' && (status === 'present' || status === 'correct')) statusMap[letter] = status;
                else if (current === 'present' && status === 'correct') statusMap[letter] = status;
            }
        });

        // Apply to DOM
        document.querySelectorAll('.key-btn').forEach(btn => {
            const key = btn.getAttribute('data-key');
            btn.classList.remove('correct', 'present', 'absent');
            if (statusMap[key]) {
                btn.classList.remove('correct', 'present', 'absent');
                btn.classList.add(statusMap[key]);
            }
        });
    }


    function openWordCareer() {
        showModal('modal-word-career');
        const container = document.getElementById('wordCareerContent');
        container.innerHTML = `<div style="text-align:center; padding:50px; color:#666;">Harita Y√ºkleniyor...<br><small>Veriler alƒ±nƒ±yor</small></div>`;
        container.className = "career-container"; // Reuse styles

        db.ref('users').once('value')
            .then(snapshot => {
                drawWordMapWithUsers(container, snapshot.val() || {});
            })
            .catch(error => {
                console.error("Kelime Harita Hatasƒ±:", error);
                drawWordMapWithUsers(container, {});
            });
    }



    let wordTimerInt = null;
    function startWordTimer(minutes) {
        stopWordTimer();
        const display = document.getElementById('wordTimerDisplay');
        display.style.display = 'block';

        const duration = minutes * 60;
        const end = Date.now() + duration * 1000;

        wordTimerInt = setInterval(() => {
            if (!wordGameState.active) { stopWordTimer(); return; }

            const left = end - Date.now();
            if (left <= 0) {
                stopWordTimer();
                display.innerText = "00:00";
                wordGameState.active = false;
                AudioEngine.error();
                document.getElementById('endTitle').innerText = 'S√úRE Bƒ∞TTƒ∞! ‚åõ';
                document.getElementById('endTitle').style.color = "#e74c3c";
                document.getElementById('endMsg').innerText = "Kelime: " + wordGameState.secret;
                document.getElementById('endButtons').style.display = 'flex';
                showModal('modal-end');
                return;
            }

            const m = Math.floor(left / 60000);
            const s = Math.floor((left % 60000) / 1000);
            display.innerText = `${m}:${s < 10 ? '0'+s : s}`;
        }, 1000);
    }

    function stopWordTimer() {
        if (wordTimerInt) clearInterval(wordTimerInt);
    }

function restartWordGame() {
        const diff = wordGameState.length;
        const isPvC = (wordGameState.mode === 'pvc');
        const isCareer = (wordGameState.mode === 'career');

        const lvl = diff - 2;
        const data = WORD_DATA[lvl] || WORD_DATA[1];
        const pool = data.words;
        const secret = pool[Math.floor(Math.random() * pool.length)];

        // √ñnceki state'i temizle
        wordGameState = {
            active: true,
            mode: wordGameState.mode,
            secret: secret,
            length: diff,
            guesses: [],
            maxGuesses: 6,
            currentGuess: "",
            level: lvl,
            startTime: Date.now()
        };

        if(isPvC) wordGameState.aiGuesses = [];

        // Ekranƒ± temizle ve yeniden ba≈ülat
        renderWordBoard();
        updateWordKeyboard();
        closeModal('modal-end');
        closeModal('modal-word-career');

        // Timer'ƒ± sƒ±fƒ±rla
        stopWordTimer();

        // Bildirim g√∂ster
        showToast(`üéÆ Yeni Oyun Ba≈üladƒ±! (${diff} Harf)`);

        // Kariyer modu i√ßin √∂zel i≈ülem
        if (isCareer && wordGameState.careerLevel) {
            startWordTimer(5); // 5 dakika
        }
    }

    function drawWordMapWithUsers(container, allUsers) {
        // Group users by wordLevel
        const levelsData = {};
        for(let i=1; i<=8; i++) levelsData[i] = [];

        if (allUsers) {
            Object.keys(allUsers).forEach(username => {
                const uData = allUsers[username];
                const lvl = uData.wordLevel || 1;
                if (levelsData[lvl]) levelsData[lvl].push(username);
            });
        }

        container.innerHTML = `<div class="career-bg-decoration"></div>`;
        const currentLvl = user.wordLevel || 1;
        // Need to track word wins for current level?
        // User asked: "her 10 oyunda bir seviye atlansƒ±n".
        // I need to track `user.wordCareerWins`.
        // Assuming I'll add this property.

        const currentWins = user.wordCareerWins || 0;

        for (let i = 1; i <= 8; i++) {
            const config = WORD_CAREER_LEVELS[i];
            let statusClass = "locked";
            let content = `<span style="font-size:1.5rem;">üîí</span>`;
            let clickAction = "";
            let progressBadge = "";

            if (i < currentLvl) {
                statusClass = "completed";
                content = config.icon;
                clickAction = `startWordCareerLevel(${i})`; // Can replay? Yes.
            } else if (i === currentLvl) {
                statusClass = "current";
                content = `<div style="width:40px; height:40px; border-radius:50%; overflow:hidden; border:2px solid white; box-shadow:0 2px 5px rgba(0,0,0,0.5);">
                        ${user.avatar.includes('http') ? `<img src="${user.avatar}" style="width:100%;">` : user.avatar}
                       </div>`;
                progressBadge = `<div style="position:absolute; bottom:-12px; background:#fff; color:#8e44ad; font-size:0.65rem; padding:2px 8px; border-radius:10px; border:1px solid #9b59b6; font-weight:bold; white-space:nowrap; box-shadow:0 2px 4px rgba(0,0,0,0.1);">${currentWins}/10</div>`;
                clickAction = `startWordCareerLevel(${i})`;
            } else {
                content = `<span style="opacity:0.5; font-size:1.5rem;">${config.icon}</span>`;
            }

            // Zigzag logic
            let positionStyle = "";
            let rivalsClass = "rivals-right";
            // Simple alternating for 8 levels
            if (i % 2 === 0) { positionStyle = "transform: translateX(-50px);"; rivalsClass = "rivals-right"; }
            else { positionStyle = "transform: translateX(50px);"; rivalsClass = "rivals-left"; }

            // Path SVG
            let pathSVG = "";
            if (i < 8) {
                const dashColor = (i < currentLvl) ? "#fff" : "rgba(0,0,0,0.2)";
                // Dynamic path based on zigzag
                // Start (50, 100) -> End (50, 0) relative? No, container stacking.
                // Just use the same style as Number Career but adapted?
                // Number Career hardcoded paths for 5 levels.
                // For 8 levels, generic S-curve might be better or just simple lines.
                // Let's use simple vertical dashed line if zigzag is complex to SVG.
                // Or reuse the logic:
                // i -> i+1.
                // Left -> Right, Right -> Left.

                // Simplified Path:
                let pathD = "M 50 100 L 50 0"; // Straight line if centered
                // Since I use translateX on parent div, relative SVG drawing is tricky.
                // Let's just use the vertical line for now to ensure stability,
                // or rely on the CSS connecting them visually (margin-bottom).
                // The Number Career SVG logic was specific to 5 items.

                // Let's create a simple SVG line connecting nodes.
                // Since nodes are centered but offset, a straight line in the center of the viewport (ignoring offset)
                // works if we draw it in the background of the container? No.

                // Let's omit complex SVG paths for this iteration to ensure no layout break,
                // or use a simple vertical dotted line.

                pathSVG = `<div style="position:absolute; bottom:-50px; left:50%; width:2px; height:50px; background:repeating-linear-gradient(to bottom, ${dashColor} 0, ${dashColor} 5px, transparent 5px, transparent 10px); z-index:-1;"></div>`;
            }

            // Rivals
            let playersHTML = "";
            const playersHere = levelsData[i] || [];
            const filteredPlayers = playersHere.filter(p => p !== user.name);
            if (filteredPlayers.length > 0) {
                const showLimit = 3;
                const visibleNames = filteredPlayers.slice(0, showLimit).join('<br>');
                const remaining = filteredPlayers.length - showLimit;
                let extraText = remaining > 0 ? `<span style="color:#999;">+${remaining} ki≈üi</span>` : "";
                playersHTML = `<div class="career-rivals ${rivalsClass}"><b>Buradakiler</b>${visibleNames}${extraText}</div>`;
            }

            // Reward Chest
            const claimedRewards = user.claimedWordRewards || {};
            const isClaimed = claimedRewards[i] === true;
            const canClaim = (i < currentLvl) || (i === currentLvl && currentWins >= 10);

            let chestHtml = "";
            if (config.reward) {
                let chestClass = "career-chest";
                if (isClaimed) chestClass += " claimed";
                else if (canClaim) chestClass += " claimable";
                chestHtml = `
                    <div class="${chestClass}" onclick="event.stopPropagation(); claimWordCareerReward(${i})">
                        üéÅ
                        <div class="chest-reward-badge">${config.reward} üí∞</div>
                    </div>`;
            }

            const html = `
            <div class="career-step" style="${positionStyle}; margin-bottom: 60px;">
                ${pathSVG}
                <div class="career-node ${statusClass}" onclick="${clickAction}" style="border-bottom-color:#8e44ad; background:${statusClass==='current'?'linear-gradient(135deg, #9b59b6, #8e44ad)': (statusClass==='completed'?'#2ecc71':'#bdc3c7')};">
                    ${content}
                    ${progressBadge}
                    <div class="career-label" style="background:#8e44ad;">${config.length} Harf</div>
                    ${chestHtml}
                </div>
                ${playersHTML}
            </div>`;

            container.innerHTML += html;
        }
    }

    function claimWordCareerReward(lvl) {
        if (!user || !user.name) return;
        const config = WORD_CAREER_LEVELS[lvl];
        if (!config) return;

        const currentLvl = user.wordLevel || 1;
        const currentWins = user.wordCareerWins || 0;
        const claimedRewards = user.claimedWordRewards || {};

        if (claimedRewards[lvl]) return showToast("Bu √∂d√ºl√º zaten aldƒ±n!");
        const canClaim = (lvl < currentLvl) || (lvl === currentLvl && currentWins >= 10);
        if (!canClaim) return showToast("√ñd√ºl√º almak i√ßin bu seviyeyi tamamlamalƒ±sƒ±n!");

        if (!confirm(`Tebrikler! ${config.reward} Altƒ±n √∂d√ºl√ºn√º almak istiyor musun?`)) return;

        if (!user.claimedWordRewards) user.claimedWordRewards = {};
        user.claimedWordRewards[lvl] = true;

        db.ref('users/' + user.name).update({
            claimedWordRewards: user.claimedWordRewards
        }).then(() => {
            updateGold(config.reward);
            showToast(`üéÅ ${config.reward} Altƒ±n Hesabƒ±na Eklendi!`);
            AudioEngine.win();
            safeConfetti();
            openWordCareer(); // Refresh
        });
    }

    function startWordCareerLevel(lvl) {
        if(user.wordLevel < lvl) return showToast("√ñnceki seviyeyi tamamla!");
        startWordCareerLevelActual(lvl);
    }

    function startWordCareerLevelActual(lvl) {
        const config = WORD_CAREER_LEVELS[lvl];
        // Ensure data exists for this length
        // WORD_DATA is 1-based level.
        // But WORD_DATA level 1 is length 3.
        // WORD_CAREER_LEVELS level 1 is length 3.
        // So they match 1:1.

        const data = WORD_DATA[lvl];
        if(!data) return showToast("Veri eksik!");

        const pool = data.words;
        const secret = pool[Math.floor(Math.random() * pool.length)];

        wordGameState = {
            active: true,
            mode: 'career',
            secret: secret,
            length: config.length,
            guesses: [],
            maxGuesses: 6, // Standard
            currentGuess: "",
            level: lvl,
            startTime: Date.now()
        };

        closeModal('modal-word-career');
        closeModal('modal-word-setup');
        changeScreen('screen-word-game');
        renderWordBoard();
        updateWordKeyboard();

        document.getElementById('wordLevelDisplay').innerText = `Kariyer Seviye ${lvl} - ${currentWinsInfo()}`;
    }

    function currentWinsInfo() {
        return (user.wordCareerWins || 0) + "/10";
    }

    // Global Ad Counter for Word Game
    let wordGameAdCounter = 0;

    function handleWordGameWin() {
        AudioEngine.win();
        safeConfetti();
        const baseGold = wordGameState.length * 20; // 5 chars = 100 gold
        updateGold(baseGold);

        // G√ºnl√ºk G√∂rev ve Seri G√ºncellemesi
        const today = getDayKey();
        if (user.name) {
            db.ref(`users/${user.name}/quests/${today}/wins`).transaction(w => (w || 0) + 1);
        }
        checkQuestProgress();
        handleWinStreak();

        let nextAction = null;

        // Career Progression
        if (wordGameState.mode === 'career') {
            if (wordGameState.level === user.wordLevel && user.wordLevel <= 8) {
                user.wordCareerWins = (user.wordCareerWins || 0) + 1;

                if (user.wordCareerWins >= 10) {
                    if (user.wordLevel < 8) {
                        user.wordLevel++;
                        user.wordCareerWins = 0;
                        showToast(`üéâ SEVƒ∞YE ATLADIN! Yeni Seviye: ${user.wordLevel}`);
                    } else {
                        showToast("üèÜ KARƒ∞YER TAMAMLANDI! EFSANESƒ∞N!");
                    }
                } else {
                    showToast(`‚úÖ ƒ∞lerleme: ${user.wordCareerWins}/10`);
                }

                // Save
                if(user.name) {
                    db.ref('users/'+user.name).update({
                        wordLevel: user.wordLevel,
                        wordCareerWins: user.wordCareerWins
                    });
                }
            }

            // Prepare Next Action (Continue)
            nextAction = {
                text: "DEVAM ET",
                action: () => {
                    closePiggyWin();
                    // GE√áƒ∞≈û REKLAMI TETƒ∞KLE (DEVAM ET)
                    if (typeof AdManager !== 'undefined' && AdManager.showInterstitialAd) {
                        AdManager.showInterstitialAd(() => {
                            startWordCareerLevelActual(user.wordLevel);
                        });
                    } else {
                        startWordCareerLevelActual(user.wordLevel);
                    }
                }
            };
        }

        showPiggyWin(baseGold, nextAction);
    }

    function checkWordGameAd(callback) {
        // Oyun sayacƒ±nƒ± artƒ±r
        if (typeof wordGameAdCounter === 'undefined') {
            wordGameAdCounter = 0;
        }
        wordGameAdCounter++;

        console.log('Oyun sayacƒ±:', wordGameAdCounter);

        // 4 oyunda bir reklam g√∂ster
        if (wordGameAdCounter % 4 === 0) {
            console.log('Reklam g√∂steriliyor...');
            if (typeof AdManager !== 'undefined' && AdManager.showInterstitialAd) {
                AdManager.showInterstitialAd(callback);
            } else {
                if (callback) callback();
            }
        } else {
            if (callback) callback();
        }
    }

    // Oyun kapanƒ±≈üƒ±nda reklam g√∂sterme - OVERRIDE
    window._originalBeforeUnload = window.onbeforeunload;
    window.onbeforeunload = function(e) {
        // Oyun kapanƒ±≈üƒ±nda reklam g√∂sterme
        // Sadece orijinal event varsa √ßaƒüƒ±r
        if (window._originalBeforeUnload) {
            return window._originalBeforeUnload(e);
        }
    };


    // --- NEW WORD GAME LOGIC ---

    function toggleWordMode(context, type) {
        if (context === 'single') {
            const timeOpts = document.getElementById('singleTimeOptions');
            const moveOpts = document.getElementById('singleMoveOptions');
            if (type === 'time') {
                timeOpts.style.display = 'block';
                moveOpts.style.display = 'none';
            } else {
                timeOpts.style.display = 'none';
                moveOpts.style.display = 'block';
            }
        }
        // Online toggles are just radios, no UI change needed unless we want to show details.
        // But for clarity, we can add labels or just rely on the radio text.
    }

    function renderWordActivePlayers() {
        const list = document.getElementById('wordActivePlayersList');
        if (!list) return;

        // Use existing adminData.presence or fetch from DB
        // We can reuse the logic from `updateActivePlayersList` but filtered
        // Or just fetch `presence` again.

        db.ref('presence').once('value').then(snapshot => {
            const data = snapshot.val() || {};
            list.innerHTML = "";
            let count = 0;

            Object.keys(data).forEach(key => {
                if (key === user.name) return; // Don't list self
                const p = data[key];
                if (Date.now() - p.lastSeen > 120000) return; // Offline

                count++;
                const item = document.createElement('div');
                item.className = "list-item";
                item.style.display = "flex";
                item.style.justifyContent = "space-between";
                item.style.alignItems = "center";
                item.innerHTML = `
                    <div style="display:flex; align-items:center; gap:5px;">
                        <span>${p.avatar || 'üë§'}</span>
                        <span style="font-weight:bold; font-size:0.8rem;">${key}</span>
                    </div>
                    <button class="btn-green" style="padding:2px 8px; font-size:0.7rem;" onclick="sendWordInvite('${key}')">DAVET</button>
                `;
                list.appendChild(item);
            });

            if (count === 0) {
                list.innerHTML = `<div style="padding:10px; text-align:center; color:#999; font-size:0.8rem;">Kimse yok.</div>`;
            }
        });
    }

    function sendWordInvite(targetUser) {
        if (user.gold < 50) return showToast("50 Altƒ±n Gerek (Oda Kurmak ƒ∞√ßin)");

        // Read config from UI
        const diff = parseInt(document.getElementById('createWordDiff').value);
        const isTime = document.getElementById('radioOnlineTime').checked;
        const timeLimit = isTime ? 5 : 0; // Fixed 5 mins for online time mode per UI? Or add dropdown? UI says "5dk"
        const maxGuesses = isTime ? 1000 : 15; // 15 moves if 'moves' mode

        // Create Room First
        const c = Math.floor(10000 + Math.random() * 90000).toString();

        // Deduct Gold? Or only on join?
        // createWordRoom deducts. Here we are inviting, which implies creating.
        updateGold(-50);

        const lvl = diff - 2;
        const data = WORD_DATA[lvl] || WORD_DATA[1];
        const secret = data.words[Math.floor(Math.random() * data.words.length)];

        db.ref('rooms/' + c).set({
            type: 'word',
            secret: secret,
            p1: { name: user.name, avatar: user.avatar },
            config: { length: diff, timeLimit: timeLimit, maxGuesses: maxGuesses },
            status: "waiting",
            startTime: Date.now()
        });
        db.ref('rooms/' + c).onDisconnect().remove();
        game.room = c;
        game.role = "p1";
        game.mode = "online_word"; // Custom tag

        // Send Invite
        db.ref('invites/' + targetUser).push({
            from: user.name,
            room: c,
            type: 'word', // TAG IT
            timestamp: Date.now()
        });

        closeModal('modal-word-setup');
        showToast(`üì® ${targetUser} davet edildi!`);

        // Enter Lobby Wait
        // Use existing lobby or custom?
        // We can reuse `listenWordRoom`.
        document.getElementById('roomCodeDisplay').innerText = c;
        document.getElementById('roomModeInfo').innerText = `Kelime (${diff})`;
        changeScreen('screen-word-lobby');
        listenWordRoom(c);
    }

    function startWordGameCustom() {
        startWordGameCustomActual();
    }

    function startWordGameCustomActual() {
        const diff = parseInt(document.getElementById('wordDiffSelect').value);
        const isPvC = document.getElementById('checkWordVsCpu').checked;

        // Determine Mode (Time vs Moves)
        const isTimeMode = document.getElementById('radioSingleTime').checked;

        let timeLimit = 0;
        let moveLimit = 15; // Standard for Moves mode

        if (isTimeMode) {
            timeLimit = parseInt(document.getElementById('wordTimeSelect').value);
            moveLimit = 1000; // Effectively infinite for timed mode
        } else {
            timeLimit = 0;
            moveLimit = 15; // Fixed 15 hak
        }

        // Correct Mapping: Length 3 -> Level 1
        const lvl = diff - 2;
        const data = WORD_DATA[lvl] || WORD_DATA[1];

        if (!data) return showToast("Veri yok!");

        const pool = data.words;
        const secret = pool[Math.floor(Math.random() * pool.length)];

        wordGameState = {
            active: true,
            mode: isPvC ? 'pvc' : 'single',
            secret: secret,
            length: diff,
            guesses: [],
            maxGuesses: moveLimit,
            currentGuess: "",
            level: lvl,
            startTime: Date.now(),
            timeLimit: timeLimit
        };

        if(isPvC) wordGameState.aiGuesses = [];

        closeModal('modal-word-setup');
        changeScreen('screen-word-game');
        renderWordBoard();
        updateWordKeyboard();

        if (timeLimit > 0) {
            startWordTimer(timeLimit);
        } else {
            stopWordTimer();
            document.getElementById('wordTimerDisplay').style.display = 'none';
        }

        const modeText = isPvC ? 'üÜö Bilgisayar' : 'Tek Ki≈üilik';
        const limitText = timeLimit > 0 ? `${timeLimit} Dk` : `${moveLimit} Hak`;
        document.getElementById('wordLevelDisplay').innerText = `${diff} Harf - ${limitText} - ${modeText}`;
    }

    function createWordRoom() {
        if (user.gold < 50) return showToast("50 Altƒ±n Gerek");

        const diff = parseInt(document.getElementById('createWordDiff').value);

        // Mode logic
        const isTime = document.getElementById('radioOnlineTime').checked;
        const timeLimit = isTime ? 5 : 0; // 5 min default for online time
        const maxGuesses = isTime ? 1000 : 15;

        updateGold(-50);

        const c = Math.floor(10000 + Math.random() * 90000).toString();
        const lvl = diff - 2;
        const data = WORD_DATA[lvl] || WORD_DATA[1];
        const secret = data.words[Math.floor(Math.random() * data.words.length)];

        db.ref('rooms/' + c).set({
            type: 'word',
            secret: secret,
            p1: { name: user.name, avatar: user.avatar },
            config: { length: diff, timeLimit: timeLimit, maxGuesses: maxGuesses },
            status: "waiting",
            startTime: Date.now()
        });

        db.ref('rooms/' + c).onDisconnect().remove();
        game.room = c;
        game.role = "p1";
        game.mode = "online_word";

        closeModal('modal-word-setup');
        document.getElementById('roomCodeDisplay').innerText = c;
        document.getElementById('roomModeInfo').innerText = `Kelime (${diff})`;
        changeScreen('screen-word-lobby');
        listenWordRoom(c);
    }

    function joinWordRoom(c) {
        c = c.toString().trim();
        db.ref('rooms/' + c).once('value').then(s => {
            const r = s.val();
            if (!r || r.type !== 'word') return showToast("Oda Yok/Hatalƒ±");
            if (r.status !== "waiting") return showToast("Dolu");

            updateGold(-50);
            game.room = c;
            game.role = "p2";
            game.mode = "online_word";

            db.ref('rooms/' + c).update({
                p2: { name: user.name, avatar: user.avatar },
                status: "playing",
                startTime: Date.now()
            });

            closeModal('modal-word-setup');
            listenWordRoom(c);
        });
    }

    function listenWordRoom(c) {
        db.ref('rooms/' + c).on('value', s => {
            const r = s.val();
            if (!r) return;

            if (r.status === 'playing' && currentScreen !== 'screen-word-game') {
                // Apply Config
                const conf = r.config || { length: 5, timeLimit: 0, maxGuesses: 6 };

                wordGameState = {
                    active: true,
                    mode: 'online',
                    secret: r.secret,
                    length: conf.length,
                    guesses: [],
                    maxGuesses: conf.maxGuesses || 15,
                    currentGuess: "",
                    level: 1,
                    startTime: r.startTime,
                    timeLimit: conf.timeLimit || 0
                };

                changeScreen('screen-word-game');
                renderWordBoard();
                updateWordKeyboard();

                if (wordGameState.timeLimit > 0) {
                    startWordTimer(wordGameState.timeLimit);
                } else {
                    stopWordTimer();
                    document.getElementById('wordTimerDisplay').style.display = 'none';
                }

                const limitText = wordGameState.timeLimit > 0 ? `${wordGameState.timeLimit} Dk` : `${wordGameState.maxGuesses} Hak`;
                document.getElementById('wordLevelDisplay').innerText = `ONLINE - ${wordGameState.length} Harf - ${limitText}`;

                // Listen for opponent moves
                db.ref('rooms/' + c + '/word_moves').off();
                db.ref('rooms/' + c + '/word_moves').on('child_added', s => {
                   // Logic for moves display... (Simplified)
                });
            }

            // Winner Logic (R√∂van≈ü uyumlu)
            if (r.winner && wordGameState.active && r.status !== 'playing') {
                wordGameState.active = false;
                stopWordTimer();

                if (r.winner === user.name) {
                    AudioEngine.win();
                    showPiggyWin(100);
                } else {
                    AudioEngine.error();
                    document.getElementById('endTitle').innerText = 'KAYBETTƒ∞N';
                    document.getElementById('endTitle').style.color = "#e74c3c";
                    document.getElementById('endMsg').innerText = "Kelime: " + wordGameState.secret;
                    document.getElementById('endButtons').style.display = 'flex';
                    showModal('modal-end');
                }
            }

            // Wait Logic (P2 Joined)
            if (r.status === 'playing' && currentScreen === 'screen-word-lobby') {
                // Logic handled above (changeScreen)
            }
        });
    }

    function safeOpenWordSetup() {
        showModal('modal-word-setup');
        renderWordActivePlayers(); // Populate list
    }

    function listenForInvites() {
        if (!user.name) return;
        const inviteRef = db.ref('invites/' + user.name);
        inviteRef.off();

        inviteRef.on('child_added', snapshot => {
            const invite = snapshot.val();
            const key = snapshot.key;
            db.ref('invites/' + user.name + '/' + key).remove();

            if (Date.now() - invite.timestamp > 120000) return;
            if (game.active || wordGameState.active) {
                showToast(`üì® ${invite.from} seni davet etti (Oyundasƒ±n).`);
                return;
            }

            pendingInviteRoom = invite.room;
            pendingInviteType = invite.type || 'normal'; // Capture Type

            document.getElementById('inviterNameDisplay').innerText = invite.from;
            const typeText = (invite.type === 'word') ? "KELƒ∞ME D√úELLOSU" : "Sayƒ± Tahmin";
            document.querySelector('#modal-invite-incoming h3').innerText = `üì® DAVET VAR! (${typeText})`;

            showModal('modal-invite-incoming');
            AudioEngine.notification();
        });
    }

    // We also need to update acceptInvite to use pendingInviteType
    function acceptInvite() {
        closeModal('modal-invite-incoming');
        if (pendingInviteRoom) {
            if (typeof pendingInviteType !== 'undefined' && pendingInviteType === 'word') {
                joinWordRoom(pendingInviteRoom);
            } else {
                if (game.room && !game.active) leaveRoom();
                joinRoom(pendingInviteRoom);
            }
        }
    }



    // ============================================
    // YENƒ∞ MESAJ Bƒ∞LDƒ∞Rƒ∞M Sƒ∞STEMƒ∞
    // ============================================
    function showMessageNotification(user, message, avatar) {
        // Ses √ßal
        AudioEngine.message();

        // Bildirim olu≈ütur
        const notif = document.createElement('div');
        notif.className = 'message-notification';
        notif.innerHTML = `
            <div class="msg-notif-avatar">${avatar || 'üë§'}</div>
            <div class="msg-notif-content">
                <div class="msg-notif-user">${user}</div>
                <div class="msg-notif-text">${message.substring(0, 50)}${message.length > 50 ? '...' : ''}</div>
            </div>
        `;

        // Stil ekle
        notif.style.cssText = `
            position: fixed;
            top: 80px;
            right: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 15px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            z-index: 9999;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 300px;
            animation: slideInRight 0.3s ease, fadeOut 0.5s ease 4.5s forwards;
            font-family: 'Segoe UI', system-ui, sans-serif;
        `;

        document.body.appendChild(notif);

        // 5 saniye sonra kaldƒ±r
        setTimeout(() => {
            if (notif.parentNode) notif.parentNode.removeChild(notif);
        }, 5000);
    }

    // Animasyon stilleri ekle
    const notifStyles = document.createElement('style');
    notifStyles.textContent = `
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes fadeOut {
            to { opacity: 0; transform: translateX(100%); }
        }
        .message-notification .msg-notif-avatar {
            font-size: 2rem;
            flex-shrink: 0;
        }
        .message-notification .msg-notif-content {
            flex: 1;
            min-width: 0;
        }
        .message-notification .msg-notif-user {
            font-weight: bold;
            font-size: 0.85rem;
            margin-bottom: 3px;
        }
        .message-notification .msg-notif-text {
            font-size: 0.8rem;
            opacity: 0.9;
            word-break: break-word;
        }
    `;
    document.head.appendChild(notifStyles);

    // AudioEngine'e mesaj sesi ekle
    if (typeof AudioEngine !== 'undefined') {
        AudioEngine.message = function() {
            if (isMuted) return;
            try {
                const ctx = this.getContext();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();

                osc.frequency.setValueAtTime(800, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1200, ctx.currentTime + 0.1);

                gain.gain.setValueAtTime(0.1, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.15);

                osc.connect(gain);
                gain.connect(ctx.destination);

                osc.start(ctx.currentTime);
                osc.stop(ctx.currentTime + 0.15);
            } catch(e) {}
        };
    }
    // ============================================

</script>

    <canvas id="confettiCanvas" aria-hidden="true"></canvas>
</body>

</html>
